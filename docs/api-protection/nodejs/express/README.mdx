---
sidebar_label: Express.js
---

import guideFocus from '@site/docs/api-protection/assets/guide-focus.png';
import globalApiResources from '@site/docs/authorization/assets/rbac-global-api-resources.png';
import organizationLevelApiResources from '@site/docs/authorization/assets/rbac-organization-level-api-resources.png';
import organizationPermissions from '@site/docs/authorization/assets/rbac-organization-permissions.png';

import InitConstsAndUtils from '../../../authorization/validate-access-tokens/fragments/_init-consts-and-utils.md';
import RetrieveInfoAboutLogtoTenant from '../../../authorization/validate-access-tokens/fragments/_retrieve-info-about-logto-tenant.md';
import ValidateTokenAndPermissions from '../../../authorization/validate-access-tokens/fragments/_validate-token-and-permissions.md';
import NodeAddValidationLogic from '../../../authorization/validate-access-tokens/nodejs/_add-validation-logic.mdx';
import NodeInit from '../../../authorization/validate-access-tokens/nodejs/_init.mdx';
import ExpressApplyMiddleware from '../../../authorization/validate-access-tokens/nodejs/fragments/express/_apply-middleware.md';

Protect your Express.js API with RBAC and JWT validation

This guide will help you implement authorization to secure your Express.js APIs using [Role-based access control (RBAC)](/authorization/role-based-access-control) and [JSON Web Tokens (JWTs)](https://auth.wiki/jwt) issued by Logto.

## Before you start

Your client applications need to obtain access tokens from Logto. If you haven't set up client integration yet, check out our [Quick starts](/quick-starts) for React, Vue, Angular, or other client frameworks, or see our [Machine-to-machine guide](/quick-starts/m2m) for server-to-server access.

This guide focuses on the **server-side validation** of those tokens in your Express.js application.

<img
  src={guideFocus}
  alt="A figure showing the focus of this guide"
  style={{ width: '100%', maxWidth: '480px', margin: '20px auto' }}
/>

### What you will learn

- JWT token validation and middleware creation
- Different permission models (global API resources, organization permissions, organization-level API resources)
- Best practices for production deployment

### Prerequisites

- Node.js LTS installed
- Basic Express.js knowledge
- A Logto application configured (see [Quick starts](/quick-starts) if needed)

## Permission models overview

Before implementing protection, choose the permission model that fits your application architecture. This aligns with Logto's three main [authorization scenarios](/authorization#authorization-scenarios):

<details>
<summary>**Global API Resources**</summary>

<img src={globalApiResources} alt="Global API resources RBAC" style={{ maxWidth: '100%' }} />

- **Use case:** Protect API resources shared across your entire application (not organization-specific)
- **Token type:** Access token with global audience
- **Examples:** Public APIs, core product services, admin endpoints
- **Best for:** SaaS products with APIs used by all customers, microservices without tenant isolation
- **Learn more:** [Protect global API resources](/authorization/global-api-resources)

</details>

<details>
<summary>**Organization (non-API) Permissions**</summary>

<img
  src={organizationPermissions}
  alt="Organization permissions RBAC"
  style={{ maxWidth: '800px', width: '100%' }}
/>

- **Use case:** Control organization-specific actions, UI features, or business logic (not APIs)
- **Token type:** Organization token with organization-specific audience
- **Examples:** Feature gating, dashboard permissions, member invitation controls
- **Best for:** Multi-tenant SaaS with organization-specific features and workflows
- **Learn more:** [Protect organization (non-API) permissions](/authorization/organization-permissions)

</details>

<details>
<summary>**Organization-level API Resources**</summary>

<img
  src={organizationLevelApiResources}
  alt="Organization-level API resources RBAC"
  style={{ width: '100%' }}
/>

- **Use case:** Protect API resources accessible within a specific organization context
- **Token type:** Organization token with API resource audience + organization context
- **Examples:** Multi-tenant APIs, organization-scoped data endpoints, tenant-specific microservices
- **Best for:** Multi-tenant SaaS where API data is organization-scoped
- **Learn more:** [Protect organization-level API resources](/authorization/organization-level-api-resources)

</details>

<br />

**ðŸ’¡ Choose your model before proceeding** - the implementation will reference your chosen approach throughout this guide.

## Quick preparation steps

### Configure Logto resources & permissions

**Based on your chosen permission model:**

#### Global API resources

1. **Create API resource:** Go to [Console â†’ API resources](https://cloud.logto.io/api-resources) and register your API (e.g., `https://api.yourapp.com`)
2. **Define permissions:** Add scopes like `read:products`, `write:orders` - see [Define API resources with permissions](/authorization/role-based-access-control#define-api-resources-with-permissions)
3. **Create global roles:** Go to [Console â†’ Roles](https://cloud.logto.io/roles) and create roles that include your API permissions - see [Configure global roles](/authorization/role-based-access-control#configure-global-roles)
4. **Assign roles:** Assign roles to users or M2M applications that need API access

#### Organization permissions

2. **Define organization permissions:** Create non-API organization permissions like `invite:member`, `manage:billing` in the organization template
1. **Set up organization roles:** Configure the organization template with organization-specific roles and assign permissions to them
1. **Assign organization roles:** Assign users to organization roles within each organization context

#### Organization-level API resources

1. **Create API resource:** Register your API resource as above, but it will be used in organization context
2. **Define permissions:** Add scopes like `read:data`, `write:settings` that are scoped to organization context
3. **Configure organization template:** Set up organization roles that include your API resource permissions
4. **Assign organization roles:** Assign users or M2M applications to organization roles that include API permissions
5. **Multi-tenant setup:** Ensure your API can handle organization-scoped data and validation

:::tip New to RBAC?
Start with our [Role-based access control guide](/authorization/role-based-access-control) for step-by-step setup instructions.
:::

### Update your client application

**Request appropriate scopes in your client:**

- User authentication: [Update your app â†’](/quick-starts) to request your API scopes and/or organization context
- Machine-to-machine: [Configure M2M scopes â†’](/quick-starts/m2m) for server-to-server access

The process usually involves updating your client configuration to include one or more of the following:

- `scope` parameter in OAuth flows
- `resource` parameter for API resource access
- `organization_id` for organization context

:::tip Before you code
Make sure the user or M2M app you are testing has been assigned proper roles or organization roles that include the necessary permissions for your API.
:::

## Initialize Express project

```bash
npm init -y
npm install express
```

If you are using TypeScript, remember to set up your TypeScript environment accordingly.

### Basic Express server setup

```ts title="server.ts"
import express from 'express';

const app = express();

// We'll add protection middleware in the next steps
app.get('/api/public', (req, res) => {
  res.json({ message: 'This is a public endpoint' });
});

app.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});
```

## Initialize constants and utilities

<InitConstsAndUtils />

<NodeInit />

## Retrieve info about your Logto tenant

<RetrieveInfoAboutLogtoTenant />

## Validate the token and permissions

<ValidateTokenAndPermissions />

### Add the validation logic

<NodeAddValidationLogic framework="express" />

## Apply the middleware to your API

<ExpressApplyMiddleware />

## Test your protected API

### Get access tokens

**From your client application:**
If you've set up a client integration, your app can obtain tokens automatically. Extract the access token and use it in API requests.

**For testing with curl/Postman:**

1. **User tokens:** Use your client app's developer tools to copy the access token from localStorage or the network tab
2. **Machine-to-machine tokens:** Use the client credentials flow. Here's a non-normative example using curl:

   ```bash
   curl -X POST https://your-tenant.logto.app/oidc/token \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "grant_type=client_credentials" \
     -d "client_id=your-m2m-client-id" \
     -d "client_secret=your-m2m-client-secret" \
     -d "resource=https://your-api-resource-indicator" \
     -d "scope=api:read api:write"
   ```

   You may need to adjust the `resource` and `scope` parameters based on your API resource and permissions; an `organization_id` parameter may also be required if your API is organization-scoped.

### Test protected endpoints

<details>
<summary>**Valid token request**</summary>

```bash
curl -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..." \
  http://localhost:3000/api/protected
```

**Expected response:**

```json
{
  "auth": {
    "sub": "user123",
    "clientId": "app456",
    "organizationId": "org789",
    "scopes": ["api:read", "api:write"],
    "audience": ["https://your-api-resource-indicator"]
  }
}
```

</details>

<details>
<summary>**Missing token**</summary>

```bash
curl http://localhost:3000/api/protected
```

**Expected response (401):**

```json
{
  "error": "Authorization header is missing"
}
```

</details>

<details>
<summary>**Invalid token**</summary>

```bash
curl -H "Authorization: Bearer invalid-token" \
  http://localhost:3000/api/protected
```

**Expected response (401):**

```json
{
  "error": "Invalid token"
}
```

</details>

### Permission model-specific testing

<details>
<summary>**Global API resources**</summary>

Test scenarios for APIs protected with global scopes:

- **Valid scopes:** Test with tokens that include your required API scopes (e.g., `api:read`, `api:write`)
- **Missing scopes:** Expect **403 Forbidden** when token lacks required scopes
- **Audience validation:** Verify tokens work only with correct resource indicator
- **Wrong audience:** Expect **401 Unauthorized** when token has different resource audience

```bash
# Token with missing scopes - expect 403
curl -H "Authorization: Bearer token-without-required-scopes" \
  http://localhost:3000/api/protected
```

</details>

<details>
<summary>**Organization permissions**</summary>

Test scenarios for organization-specific access control:

- **Valid organization token:** Test with tokens that include correct organization context
- **Missing organization:** Expect **401 Unauthorized** when token lacks organization context
- **Wrong organization:** Expect **403 Forbidden** when user doesn't have permissions in the specified organization
- **Organization role validation:** Verify organization-specific role assignments work correctly

```bash
# Token for wrong organization - expect 403
curl -H "Authorization: Bearer token-for-different-organization" \
  http://localhost:3000/api/protected
```

</details>

<details>
<summary>**Organization-level API resources**</summary>

Test scenarios combining API resource validation with organization context:

- **Valid organization + API scopes:** Test with tokens that have both organization context and required API scopes
- **Missing API scopes:** Expect **403 Forbidden** when organization token lacks required API permissions
- **Wrong organization:** Expect **403 Forbidden** when accessing API with token from different organization
- **API audience validation:** Verify both API resource audience and organization context are validated
- **Cross-organization access:** Ensure users cannot access API resources from other organizations

```bash
# Organization token without API scopes - expect 403
curl -H "Authorization: Bearer org-token-without-api-scopes" \
  http://localhost:3000/api/protected
```

</details>

## Further reading

<Url href="/use-cases/authorization/rbac-in-practice">
  RBAC in practice: Implementing secure authorization for your application
</Url>
<Url href="/use-cases/multi-tenancy/build-multi-tenant-saas-application">
  Build a multi-tenant SaaS application: A complete guide from design to implementation
</Url>
