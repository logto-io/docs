---
sidebar_position: 2
sidebar_label: Enable AI agent and third-party app access to MCP server
---

import QuickStartsReference from '../../quick-starts/third-party/oidc/_quick-starts-reference.md';

import thirdPartyAppPermissions from './assets/third-party-app-permissions.png';
import Prerequisites from './fragments/_mcp-prerequisites.mdx';
import SampleCode from './fragments/_mcp-sample-code.mdx';
import SetUpServer from './fragments/_mcp-set-up-server.mdx';

# Enable AI agent and third-party app access to your MCP server

:::note
If you want to integrate your MCP server with your own app, please refer to the [Enable auth for your MCP-powered apps with Logto](./mcp-server-add-auth) guide.
:::

This guide walks you through integrating Logto with your MCP server using [mcp-auth](https://mcp-auth.dev), allowing you to authenticate users and securely retrieve their identity information using the standard OpenID Connect flow.

You'll learn how to:

- Configure Logto as the authorization server for your MCP server.
- Set up a “whoami” tool to return the current user's identity claims.
- Test the flow with an AI agent or third-party app.

After this tutorial, your MCP server will:

- Authenticate users in your Logto tenant.
- Return identity claims (`sub`, `username`, `name`, `email`, etc.) for the "whoami" tool invocation.

<Prerequisites clientDescription="The AI agent or third-party app will be used as the client in this guide." />

## Set up AI agent or third-party app

To enable the AI agent or third-party app (client) to access your MCP server, you need to set up the following:

1. The client should be able to make MCP requests to invoke the tools exposed by the MCP server.
2. The client should be able to handle the 401 Unauthorized response. See [Authorization Flow Steps](https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization#2-5-authorization-flow-steps) for more details.
3. After successful authentication, the client should be able to make requests to the MCP server with the access token obtained from Logto.

## Set up app in Logto

### Allow developers to create third-party apps

If you are building a marketplace or want to allow developers to create third-party apps, you can leverage [Logto Management API](/integrate-logto/interact-with-management-api) to create third-party apps programmatically. This allows developers to register their applications and obtain the necessary credentials for authentication.

You'll need to host your own service to handle the client registration process. This service will interact with the Logto Management API to create third-party apps on behalf of developers.

```mermaid
flowchart LR
  A[Developer] -->|Register app| B[Your app registration service]
  B -->|Create app| C[Logto Management API]
  C -->|App ID, secret, etc.| B
  B -->|App ID, secret, etc.| A
```

Alternatively, you can manually create third-party apps in Logto Console to get familiar with the process.

### Manually create a third-party app

You can manually create a third-party app in Logto Console for testing purposes or ad-hoc integrations. This is useful when you want to quickly test the integration without implementing a full client-registration flow.

1. Sign in to your Logto Console.
2. Go <CloudLink to="/applications">**Applications**</CloudLink> → **Create application** → **Third-party app** -> **OIDC**.
3. Fill in the app name and other required fields, then click **Create application**.
4. Click **Permissions** tab, in the **User** section, click "Add".
5. In the opened dialog -> **User data** -> select **`profile`**, **`email`** permissions, then click **Save**.
6. In the third-party app, configure scopes to request `openid profile email` permissions.
7. Configure the **redirect URI** of your third-party application accordingly. Remember to update the redirect URI in Logto as well.

<img
  src={thirdPartyAppPermissions}
  alt="Third-party app permissions"
  style={{ maxWidth: '800px', width: '100%' }}
/>

---

<QuickStartsReference />

<SetUpServer />

## Test the integration

1. Start the MCP server.
2. Start the AI agent or third-party app (client).
3. In the client, invoke the `whoami` tool to retrieve the current user's identity claims.
4. The client should handle the 401 Unauthorized response and redirect the user to Logto for authentication.
5. After successful authentication, the client should receive an access token and use it to make requests to the MCP server.
6. The client should be able to retrieve the identity claims from the MCP server using the access token.

<SampleCode />
