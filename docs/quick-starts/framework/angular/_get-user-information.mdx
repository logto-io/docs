import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

Once the user has successfully signed in, Logto will issue an [ID token](https://openid.net/specs/openid-connect-core-1_0.html#IDToken) that contains the user information claims. The ID token is a JSON Web Token (JWT).

It's important to note that the user information claims that can be retrieved depending on the
scopes used by the user during signing-in, and considering performance and data size, the ID token
may not contain all user claims, some user claims are only available in the [userinfo endpoint](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) (see
the related list below).

The `buildAngularAuthConfig()` utility will enable `autoUserInfo` and `renewUserInfoAfterTokenRenew` if there's no `resource` provided in the config. This means that Logto will automatically fetch the user information after the user signs in and renew the user information after the token is renewed.

:::info
To learn more about configuring the `angular-auth-oidc-client` library, see the [official documentation](https://angular-auth-oidc-client.com/).
:::

### Display user information

The `OidcSecurityService` provides a convenient way to subscribe to the authentication state as well as user information:

```ts title="app/app.component.ts"
import { OidcSecurityService } from 'angular-auth-oidc-client';
import type { UserInfoResponse } from '@logto/js';

export class AppComponent implements OnInit {
  isAuthenticated = false;
  userData?: UserInfoResponse;
  idToken?: string;
  accessToken?: string;

  constructor(public oidcSecurityService: OidcSecurityService) {}

  ngOnInit() {
    this.oidcSecurityService
      .checkAuth()
      .subscribe(({ isAuthenticated, userData, idToken, accessToken }) => {
        console.log('app authenticated', isAuthenticated, userData);
        this.isAuthenticated = isAuthenticated;
        this.userData = userData;
        this.idToken = idToken;
        this.accessToken = accessToken;
      });
  }

  // ...other methods
}
```

And use it in the template:

```html title="app/app.component.html"
<button *ngIf="!isAuthenticated" (click)="signIn()">Sign in</button>
<ng-container *ngIf="isAuthenticated">
  <pre>{{ userData | json }}</pre>
  <p>ID token: {{ idToken }}</p>
  <p>Access token: {{ accessToken }}</p>
  <!-- ... -->
  <button (click)="signOut()">Sign out</button>
</ng-container>
```

### Request additional claims

<FindUserInfoMissing method="userData" />

<ScopesAndClaimsIntroduction />

To request additional scopes, you can configure the auth provider configs:

```tsx title="app/app.config.ts"
import { UserScope, buildAngularAuthConfig } from '@logto/js';

export const appConfig: ApplicationConfig = {
  providers: [
    provideHttpClient(withFetch()),
    provideAuth({
      config: buildAngularAuthConfig({
        // ...other configs
        // highlight-start
        scopes: [
          UserScope.Email,
          UserScope.Phone,
          UserScope.CustomData,
          UserScope.Identities,
          UserScope.Organizations,
        ],
        // highlight-end
      }),
    }),
    // ...other providers
  ],
};
```

Then you can access the additional claims in the return value of `userData`.

### Scopes and claims

<ScopesAndClaims />
