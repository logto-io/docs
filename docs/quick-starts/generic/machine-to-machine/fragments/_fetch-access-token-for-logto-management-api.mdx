import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import AccessTokenResponse from './_access-token-response.mdx';
import M2mAccessTokenNote from './_m2m-access-token-sub-note.mdx';

Logto provides a built-in “Logto Management API” resource, it’s a readonly resource with the `all` permission to access Logto Management API, you can see it from your API resource list.
The resource API indicator is in the pattern of `https://{your-tenant-id}.logto.app/api` , and this will be your resource value used in the access token request body.

<img alt="Logto Management API details" src="/img/assets/logto-management-api.png" width="600px" />

Before accessing Logto Management API, make sure your M2M app has been assigned with M2M roles that include the `all` permission from this built-in “Logto Management API” resource.

:::info
Logto also provides a pre-configured “Logto Management API access” M2M role for new created tenants, which the Logto Management API resource’s all permission has already assigned to. You can use it directly without manually setting permissions. This pre-configured role can also be edited and deleted as needed.
:::

Now, compose all we have and send the request:

:::info
Since v1.30.1 release, Logto provides an official `@logto/api` Node.js SDK to help you easily interact with the Logto Management API.
:::

<Tabs groupId="interact-with-m-api">

<TabItem value="with-@logto-api-sdk" label="Node.js with `@logto/api` SDK">

#### Logto Cloud \{#logto-cloud}

```js
import { createManagementApi } from '@logto/api/management';

const { apiClient, clientCredentials } = createManagementApi('your-tenant-id', {
  clientId: 'your-client-id',
  clientSecret: 'your-client-secret',
});

const { value } = await clientCredentials.getAccessToken();
console.log('Access token:', value);

// Or you can even skip getting the access token and directly make API calls
const response = await apiClient.GET('/api/users');
console.log(response.data);
```

#### Self-hosted / OSS \{#self-hosted-oss}

OSS users should use `default` as the tenant ID, and also provide `baseUrl` and `apiIndicator` configs.

```js
const { apiClient, clientCredentials } = createManagementApi('default', {
  clientId: 'your-client-id',
  clientSecret: 'your-client-secret',
  // highlight-start
  baseUrl: 'https://your.logto.endpoint',
  apiIndicator: 'https://default.logto.app/api',
  // highlight-end
});
```

</TabItem>

<TabItem value="nodejs" label="Node.js">

```js
const logtoEndpoint = 'https://your.logto.endpoint'; // Replace with your Logto endpoint
const tokenEndpoint = `${logtoEndpoint}/oidc/token`;
const applicationId = 'your-application-id';
const applicationSecret = 'your-application-secret';
const tenantId = 'your-tenant-id';

const fetchAccessToken = async () => {
  return await fetch(tokenEndpoint, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      Authorization: `Basic ${Buffer.from(`${applicationId}:${applicationSecret}`).toString(
        'base64'
      )}`,
    },
    body: new URLSearchParams({
      grant_type: 'client_credentials',
      resource: `https://${tenantId}.logto.app/api`,
      scope: 'all',
    }).toString(),
  });
};
```

:::caution
For Logto Cloud users: when you’re interacting with Logto Management API, you can not use custom domain, use the default Logto endpoint `https://{your_tenant_id}.logto.app/oidc/token` to grant access tokens.
:::

<AccessTokenResponse />
<M2mAccessTokenNote />

</TabItem>

<TabItem value="curl" label="cURL">

```bash
curl --location \
  --request POST 'https://your.logto.endpoint' \
  --header 'Authorization: Basic ${your_auth_string}' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'grant_type=client_credentials' \
  --data-urlencode 'resource=https://${tenantId}.logto.app/api' \
  --data-urlencode 'scope=all'
```

Remember to replace the actual values with your own.

:::caution
For Logto Cloud users: when you’re interacting with Logto Management API, you can not use custom domain, use the default Logto endpoint `https://{your_tenant_id}.logto.app/oidc/token` to grant access tokens.
:::

<AccessTokenResponse />
<M2mAccessTokenNote />

</TabItem>

</Tabs>
