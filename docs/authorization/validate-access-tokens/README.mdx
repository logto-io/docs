---
sidebar_position: 6
sidebar_label: Validate access tokens in API
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import DotNetAddValidationLogic from './dotnet/_add-validation-logic.mdx';
import DotNetApplyMiddleware from './dotnet/_apply-middleware.mdx';
import DotNetInit from './dotnet/_init.mdx';
import GoAddValidationLogic from './go/_add-validation-logic.mdx';
import GoApplyMiddleware from './go/_apply-middleware.mdx';
import GoInit from './go/_init.mdx';
import JavaAddValidationLogic from './java/_add-validation-logic.mdx';
import JavaApplyMiddleware from './java/_apply-middleware.mdx';
import JavaInit from './java/_init.mdx';
import NodeAddValidationLogic from './nodejs/_add-validation-logic.mdx';
import NodeApplyMiddleware from './nodejs/_apply-middleware.mdx';
import NodeInit from './nodejs/_init.mdx';
import PhpAddValidationLogic from './php/_add-validation-logic.mdx';
import PhpApplyMiddleware from './php/_apply-middleware.mdx';
import PhpInit from './php/_init.mdx';
import PythonAddValidationLogic from './python/_add-validation-logic.mdx';
import PythonApplyMiddleware from './python/_apply-middleware.mdx';
import PythonInit from './python/_init.mdx';
import RubyAddValidationLogic from './ruby/_add-validation-logic.mdx';
import RubyApplyMiddleware from './ruby/_apply-middleware.mdx';
import RubyInit from './ruby/_init.mdx';
import RustAddValidationLogic from './rust/_add-validation-logic.mdx';
import RustApplyMiddleware from './rust/_apply-middleware.mdx';
import RustInit from './rust/_init.mdx';

# How to validate access tokens in your API service or backend

Validating access tokens is a critical part of enforcing [role-based access control (RBAC)](/authorization/role-based-access-control) in Logto. This guide walks you through verifying Logto-issued JWTs in your backend/API, checking for signature, issuer, audience, expiration, permissions (scopes), and organization context.

## Before you start \{#before-you-start}

- This guide assumes you are familiar with Logto’s RBAC concepts.
- If you are protecting API resources, this guide assumes you have gone through the [Protect global API resources](/authorization/global-api-resources) guide.
- If you are protecting in-app features or workflows (non-API permissions), this guide assumes you have gone through the [Protect organization (non-API) permissions](/authorization/organization-permissions) guide.
- If you are protecting organization-level API resources, this guide assumes you have gone through the [Protect organization-level API resources](/authorization/organization-level-api-resources) guide.

## Step 1: Initialize constants and utilities \{#step-1-initialize-constants-and-utilities}

Define necessary constants and utilities in your code to handle token extraction and validation. A valid request must include an `Authorization` header in the form `Bearer <access_token>`.

<Tabs groupId="api-language">
  <TabItem value="node" label="Node.js">
    <NodeInit />
  </TabItem>
  <TabItem value="python" label="Python">
    <PythonInit />
  </TabItem>
  <TabItem value="go" label="Go">
    <GoInit />
  </TabItem>
  <TabItem value="java" label="Java">
    <JavaInit />
  </TabItem>
  <TabItem value="dotnet" label=".NET">
    <DotNetInit />
  </TabItem>
  <TabItem value="php" label="PHP">
    <PhpInit />
  </TabItem>
  <TabItem value="ruby" label="Ruby">
    <RubyInit />
  </TabItem>
  <TabItem value="rust" label="Rust">
    <RustInit />
  </TabItem>
</Tabs>

## Step 2: Retrieve info about your Logto tenant \{#step-2-retrieve-info-about-your-logto-tenant}

You’ll need the following values to validate Logto-issued tokens:

- JSON Web Key Set (JWKS) URI: The URL to Logto’s public keys, used to verify JWT signatures.
- Issuer: The expected issuer value (Logto’s OIDC URL).

First, find your Logto tenant’s endpoint. You can find it in various places:

- In the Logto Console, under **Settings** → **Domains**.
- In any application settings where you configured in Logto, **Settings** → **Endpoints & Credentials**.

### Fetch from OpenID Connect discovery endpoint \{#fetch-from-openid-connect-discovery-endpoint}

These values can be retrieved from Logto’s OpenID Connect discovery endpoint:

```
https://<your-logto-endpoint>/oidc/.well-known/openid-configuration
```

Here’s an example response (other fields omitted for brevity):

```json
{
  "jwks_uri": "https://your-tenant.logto.app/oidc/jwks",
  "issuer": "https://your-tenant.logto.app/oidc"
}
```

### Hardcode in your code (not recommended) \{#hardcode-in-your-code-not-recommended}

Since Logto doesn't allow customizing the JWKS URI or issuer, you can hardcode these values in your code. However, this is not recommended for production applications as it may increase maintenance overhead if some configuration changes in the future.

- JWKS URI: `https://<your-logto-endpoint>/oidc/jwks`
- Issuer: `https://<your-logto-endpoint>/oidc`

## Step 3: Validate the token and permissions \{#step-3-validate-the-token-and-permissions}

After extracting the token and fetching the OIDC config, validate the following:

- **Signature:** JWT must be valid and signed by Logto (via JWKS).
- **Issuer:** Must match your Logto tenant’s issuer.
- **Audience:** Must match the API’s resource indicator registered in Logto, or the organization context if applicable.
- **Expiration:** Token must not be expired.
- **Permissions (scopes):** Token must include required scopes for your API/action. Scopes are space-separated strings in the `scope` claim.
- **Organization context:** If protecting organization-level API resources, validate the `organization_id` claim.

See [JSON Web Token](https://auth.wiki/jwt) to learn more about JWT structure and claims.

### What to check for each permission model \{#what-to-check-for-each-permission-model}

The claims and validation rules differ by permission model:

| Permission model                   | Audience claim (`aud`)                                                 | Organization claim (`organization_id`) | Scopes (permissions) to check (`scope`) |
| ---------------------------------- | ---------------------------------------------------------------------- | -------------------------------------- | --------------------------------------- |
| Global API resources               | API resource indicator                                                 | _Not present_                          | API resource permissions                |
| Organization (non-API) permissions | `urn:logto:organization:<id>` (organization context is in `aud` claim) | _Not present_                          | Organization permissions                |
| Organization-level API resources   | API resource indicator                                                 | Organization ID (must match request)   | API resource permissions                |

<small>
  For non-API organization permissions, the organization context is represented by the `aud` claim
  (e.g., `urn:logto:organization:abc123`). The `organization_id` claim is only present for
  organization-level API resource tokens.
</small>

:::tip
Always validate both permissions (scopes) and context (audience, organization) for secure multi-tenant APIs.
:::

### Add the validation logic \{#add-the-validation-logic}

<Tabs groupId="api-language">
  <TabItem value="node" label="Node.js">
    <NodeAddValidationLogic />
  </TabItem>
  <TabItem value="python" label="Python">
    <PythonAddValidationLogic />
  </TabItem>
  <TabItem value="go" label="Go">
    <GoAddValidationLogic />
  </TabItem>
  <TabItem value="java" label="Java">
    <JavaAddValidationLogic />
  </TabItem>
  <TabItem value="dotnet" label=".NET">
    <DotNetAddValidationLogic />
  </TabItem>
  <TabItem value="php" label="PHP">
    <PhpAddValidationLogic />
  </TabItem>
  <TabItem value="ruby" label="Ruby">
    <RubyAddValidationLogic />
  </TabItem>
  <TabItem value="rust" label="Rust">
    <RustAddValidationLogic />
  </TabItem>
</Tabs>

## Step 4: Apply middleware to your API \{#step-4-apply-middleware-to-your-api}

Apply the middleware your protected API routes.

<Tabs groupId="api-language">
  <TabItem value="node" label="Node.js">
    <NodeApplyMiddleware />
  </TabItem>
  <TabItem value="python" label="Python">
    <PythonApplyMiddleware />
  </TabItem>
  <TabItem value="go" label="Go">
    <GoApplyMiddleware />
  </TabItem>
  <TabItem value="java" label="Java">
    <JavaApplyMiddleware />
  </TabItem>
  <TabItem value="dotnet" label=".NET">
    <DotNetApplyMiddleware />
  </TabItem>
  <TabItem value="php" label="PHP">
    <PhpApplyMiddleware />
  </TabItem>
  <TabItem value="ruby" label="Ruby">
    <RubyApplyMiddleware />
  </TabItem>
  <TabItem value="rust" label="Rust">
    <RustApplyMiddleware />
  </TabItem>
</Tabs>

## Step 5: Test your implementation \{#step-5-test-your-implementation}

Test your API with valid and invalid tokens to ensure:

- Valid tokens pass through and provide access.
- Return `401 Unauthorized` for invalid/missing tokens. Return `403 Forbidden` for valid tokens that lack required permissions or context.

## Related resources \{#related-resources}

<Url href="/developers/custom-token-claims">Customizing token claims</Url>
<Url href="https://auth.wiki/jwt">JSON Web Token (JWT)</Url>
<Url href="https://openid.net/specs/openid-connect-discovery-1_0.html">
  OpenID Connect Discovery
</Url>
<Url href="https://www.rfc-editor.org/rfc/rfc8707.html">RFC 8707: Resource Indicators</Url>
