"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[1913],{49613:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return m}});var n=r(59496);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||o;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},27698:function(e,t,r){r.r(t),r.d(t,{assets:function(){return p},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var n=r(665),a=r(40151),o=(r(59496),r(49613)),i=r.p+"assets/images/create-api-resource-8a6f4c86fb1175ba6877f22e08b260bb.png",s=["components"],l={sidebar_position:2},u="\u2694\ufe0f Protect your API",c={unversionedId:"docs/recipes/protect-your-api/README",id:"docs/recipes/protect-your-api/README",title:"\u2694\ufe0f Protect your API",description:"As an out-of-the-box authorization service, Logto allows you to apply authorization to your backend API resources for better privacy protection.",source:"@site/docs/docs/recipes/protect-your-api/README.mdx",sourceDirName:"docs/recipes/protect-your-api",slug:"/docs/recipes/protect-your-api/",permalink:"/docs/recipes/protect-your-api/",draft:!1,editUrl:"https://github.com/logto-io/docs/tree/master/docs/docs/recipes/protect-your-api/README.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Vue",permalink:"/docs/recipes/integrate-logto/vue"},next:{title:"Node(Express)",permalink:"/docs/recipes/protect-your-api/node"}},p={},d=[{value:"Register the API resources using Logto <strong>Admin Console</strong>",id:"register-the-api-resources-using-logto-admin-console",level:2},{value:"Validate the API request&#39;s authorization token",id:"validate-the-api-requests-authorization-token",level:2},{value:"Understanding JWS token",id:"understanding-jws-token",level:3},{value:"Validate the authorization token",id:"validate-the-authorization-token",level:3},{value:"Reference",id:"reference",level:2}],m={toc:d};function h(e){var t=e.components,l=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\ufe0f-protect-your-api"},"\u2694\ufe0f Protect your API"),(0,o.kt)("p",null,"As an out-of-the-box authorization service, Logto allows you to apply authorization to your backend ",(0,o.kt)("a",{parentName:"p",href:"/docs/references/resources/"},"API resources")," for better privacy protection."),(0,o.kt)("h2",{id:"register-the-api-resources-using-logto-admin-console"},"Register the API resources using Logto ",(0,o.kt)("strong",{parentName:"h2"},"Admin Console")),(0,o.kt)("p",null,"You will need to register your backend APIs in Logto Admin Console. Logto will identify those registered ",(0,o.kt)("a",{parentName:"p",href:"/docs/references/resources/"},"API resources")," from an authorization request and grant an audience-restricted ",(0,o.kt)("inlineCode",{parentName:"p"},"access_token")," accordingly."),(0,o.kt)("p",null,"Go to the ",(0,o.kt)("strong",{parentName:"p"},"API Resources")," section in ",(0,o.kt)("strong",{parentName:"p"},"Admin Console"),". You will notice a build-in resource listed with the API identifier shown as ",(0,o.kt)("inlineCode",{parentName:"p"},"https://api.logto.io"),". This resource indicates all the management APIs of Logto. It guarantees all our APIs are under the protection and restricted to those Logto authorized users only."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"API resources",src:r(33038).Z,width:"1920",height:"964"})),(0,o.kt)("p",null,"Click on the ",(0,o.kt)("strong",{parentName:"p"},"Create API Resource")," button and following the interactive form to create your own API resources:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A human-readable ",(0,o.kt)("strong",{parentName:"li"},"API Name")," that may better helps you to identify this entity."),(0,o.kt)("li",{parentName:"ul"},"A unique ",(0,o.kt)("strong",{parentName:"li"},"API Identifier")," (a.k.a. ",(0,o.kt)("a",{parentName:"li",href:"/docs/references/resources/#resource-indicator"},"Resource Indicator"),") in URI format. It represents the identity of the API resource.")),(0,o.kt)("img",{src:i,alt:"Create API resource",width:"700px"}),(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The API Identifier is unique and used as the single source of truth for Logto. ",(0,o.kt)("strong",{parentName:"p"},"NOT")," editable once created. Be careful when you create it.")),(0,o.kt)("p",null,"The new API will show up on the list once created. You may manage or delete it at the API details page by clicking on the entity."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"API resource details",src:r(53817).Z,width:"1920",height:"956"})),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"/docs/references/resources/#logto-api-resource-schema"},"API Resource Logto Schema")," for detailed API setting definitions."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The API Resources registered in Logto ",(0,o.kt)("strong",{parentName:"p"},"Admin Console")," will be shared across all your applications.")),(0,o.kt)("h2",{id:"validate-the-api-requests-authorization-token"},"Validate the API request's authorization token"),(0,o.kt)("p",null,"Logto issues a standard ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7519"},"JWT")," format authorization token for each authorized API request. The token is encrypted and signatured as a ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7515"},"JWS")," token."),(0,o.kt)("h3",{id:"understanding-jws-token"},"Understanding JWS token"),(0,o.kt)("p",null,"An encoded ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7515"},"JWS")," token is constructed with three parts:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"JOSE Header: Declares the code type and encoding algorithm"),(0,o.kt)("li",{parentName:"ul"},"JWS Payload: Includes all the token's claims"),(0,o.kt)("li",{parentName:"ul"},"JWS Signature: Signature signed with ",(0,o.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc7517"},"JWK"))),(0,o.kt)("p",null,"A standard schema of Logto issued JWS Payload: (claims may vary, based on your custom OIDC config)"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"key"),(0,o.kt)("th",{parentName:"tr",align:null},"description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"jti"),(0,o.kt)("td",{parentName:"tr",align:null},"unique JWT ID")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"sub"),(0,o.kt)("td",{parentName:"tr",align:null},"subject, usually user-id")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"iat"),(0,o.kt)("td",{parentName:"tr",align:null},"timestamp token issues at")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"exp"),(0,o.kt)("td",{parentName:"tr",align:null},"timestamp token expires at")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_id"),(0,o.kt)("td",{parentName:"tr",align:null},"application id")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"iss"),(0,o.kt)("td",{parentName:"tr",align:null},"token issuer identity")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"aud"),(0,o.kt)("td",{parentName:"tr",align:null},"audience of the token")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"For development, to visually inspect a JWT token, you could visit ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io/"},"jwt.io")," to decode and check the tokens you received. Be careful with or never use the tokens from a production environment. As this is a third party provided public online service, your token may be exposed.")),(0,o.kt)("h3",{id:"validate-the-authorization-token"},"Validate the authorization token"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2"},"Validating a JWT.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2"},"Validating the JWS signature.")),(0,o.kt)("li",{parentName:"ol"},"The token's issuer is ",(0,o.kt)("inlineCode",{parentName:"li"},"https://<your-logto-domain>/oidc")," (issued by your Logto auth server)."),(0,o.kt)("li",{parentName:"ol"},"The token's audience is equal to the current receiver's resource indicator registered in Logto Admin Console."),(0,o.kt)("li",{parentName:"ol"},"The token is within its expiration time.")),(0,o.kt)("p",null,"There are various open-source libraries and packages that can help you to validate and decode a JWT token easily. You may pick one and integrate with your backend application based on the language and framework you are using. Please check some of the examples we have:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"./node"},"Node(Express)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"./spring-boot"},"Spring Boot")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"./python"},"Python"))),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("p",null,"Logto uses the code-based OAuth 2.0 Authorization Protocol to make your API request safer. If you are interested in the strategy behind it, refer to OAuth 2.0's ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1"},"official document")," for more details."))}h.isMDXComponent=!0},53817:function(e,t,r){t.Z=r.p+"assets/images/api-resource-details-5374ce9fe35f232dfc729570f4125c6c.png"},33038:function(e,t,r){t.Z=r.p+"assets/images/api-resources-381d558bded7d7a2949cee6250e42e40.png"}}]);