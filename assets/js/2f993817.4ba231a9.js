"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[9140],{47747:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"logto-oss/using-cli/rotate-signing-keys","title":"Rotate signing keys (OSS)","description":"If you\'re using Logto Cloud, you can rotate signing keys in the Console UI, please refer to this tutorial.","source":"@site/docs/logto-oss/using-cli/rotate-signing-keys.mdx","sourceDirName":"logto-oss/using-cli","slug":"/logto-oss/using-cli/rotate-signing-keys","permalink":"/logto-oss/using-cli/rotate-signing-keys","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/logto-oss/using-cli/rotate-signing-keys.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Migrate configs from env","permalink":"/logto-oss/using-cli/migrate-from-env"},"next":{"title":"Translate CLI","permalink":"/logto-oss/translate-cli"}}');var r=n(86070),s=n(15658),a=n(78551),i=n(77501);const l={},c="Rotate signing keys (OSS)",u={},d=[{value:"Rotate OIDC private signing keys",id:"rotate-oidc-private-signing-keys",level:2},{value:"Rotate OIDC cookie keys",id:"rotate-oidc-cookie-keys",level:2},{value:"What about the previous keys?",id:"what-about-the-previous-keys",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Using Logto as OIDC Provider in Cloudflare Zero Trust",id:"using-logto-as-oidc-provider-in-cloudflare-zero-trust",level:3}];function g(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"rotate-signing-keys-oss",children:"Rotate signing keys (OSS)"})}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["If you're using Logto Cloud, you can rotate signing keys in the Console UI, please refer to ",(0,r.jsx)(t.a,{href:"/developers/signing-keys/#rotate-signing-keys-from-console-ui",children:"this tutorial"}),"."]})}),"\n",(0,r.jsx)(t.p,{children:"Logto OSS has supported rotating signing keys since v1.8."}),"\n",(0,r.jsx)(t.p,{children:"Logto OIDC signing keys, as known as \u201cOIDC private keys\u201d and \u201cOIDC cookie keys\u201d, are the signing keys used to encrypt JWT tokens (access tokens and ID tokens) and browser cookies in Logto sign-in sessions."}),"\n",(0,r.jsx)(t.p,{children:"Rotate your signing keys regularly can reduce the risks of potential key compromise. Logto recommends you to rotate your signing keys at least once a year."}),"\n",(0,r.jsx)(t.h2,{id:"rotate-oidc-private-signing-keys",children:"Rotate OIDC private signing keys"}),"\n",(0,r.jsx)(t.p,{children:"Use the CLI command below to generate a new OIDC private signing key. The new key will be automatically utilized after reboot."}),"\n",(0,r.jsx)(t.p,{children:"Available options:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'--type    (Optional) The signing key algorithm for your JWT tokens.\n          Values are "rsa" or "ec". Defaults to "ec".\n'})}),"\n",(0,r.jsxs)(i.A,{groupId:"cmd",children:[(0,r.jsx)(a.A,{value:"cli",label:"CLI",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"logto db config rotate oidc.privateKeys --type rsa\n"})})}),(0,r.jsx)(a.A,{value:"Local",label:"local",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npm run cli db config rotate oidc.privateKeys -- --type rsa\n"})})}),(0,r.jsx)(a.A,{value:"npx",label:"npx",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npx @logto/cli db config rotate oidc.privateKeys -- --type rsa\n"})})})]}),"\n",(0,r.jsx)(t.h2,{id:"rotate-oidc-cookie-keys",children:"Rotate OIDC cookie keys"}),"\n",(0,r.jsx)(t.p,{children:"Use the CLI command below to generate a new OIDC cookie key. The new key will be automatically utilized after reboot."}),"\n",(0,r.jsxs)(i.A,{groupId:"cmd",children:[(0,r.jsx)(a.A,{value:"cli",label:"CLI",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"logto db config rotate oidc.cookieKeys\n"})})}),(0,r.jsx)(a.A,{value:"Local",label:"local",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npm run cli db config rotate oidc.cookieKeys\n"})})}),(0,r.jsx)(a.A,{value:"npx",label:"npx",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npx @logto/cli db config rotate oidc.cookieKeys\n"})})})]}),"\n",(0,r.jsx)(t.h2,{id:"what-about-the-previous-keys",children:"What about the previous keys?"}),"\n",(0,r.jsx)(t.p,{children:"Logto key rotation commands will not delete your previous signing keys, and they will be kept in the database unless you manually delete them."}),"\n",(0,r.jsx)(t.p,{children:"Also, be cautious when deleting your previous keys, as it may cause unexpected issues. It is recommended to keep both the new key and the previous key for a period of time (e.g. 2 weeks), until you are confident that all your users have migrated to the new key."}),"\n",(0,r.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(t.h3,{id:"using-logto-as-oidc-provider-in-cloudflare-zero-trust",children:"Using Logto as OIDC Provider in Cloudflare Zero Trust"}),"\n",(0,r.jsxs)(t.p,{children:["If you intend to use Logto as an OIDC provider with Cloudflare Zero Trust, please note that it does not support OIDC providers using ECDSA algorithms. When rotating OIDC private signing keys, ensure you use the RSA algorithm by specifying ",(0,r.jsx)(t.code,{children:"--type rsa"})," in the rotation command:"]}),"\n",(0,r.jsxs)(i.A,{groupId:"cmd-cloudflare-zero-trust",children:[(0,r.jsx)(a.A,{value:"cli",label:"CLI",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"logto db config rotate oidc.privateKeys --type rsa\n"})})}),(0,r.jsx)(a.A,{value:"Local",label:"local",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npm run cli db config rotate oidc.privateKeys -- --type rsa\n"})})}),(0,r.jsx)(a.A,{value:"npx",label:"npx",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npx @logto/cli db config rotate oidc.privateKeys -- --type rsa\n"})})})]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},78551:(e,t,n)=>{n.d(t,{A:()=>a});n(30758);var o=n(13526);const r={tabItem:"tabItem_PGP0"};var s=n(86070);function a(e){let{children:t,hidden:n,className:a}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,o.A)(r.tabItem,a),hidden:n,children:t})}},77501:(e,t,n)=>{n.d(t,{A:()=>j});var o=n(30758),r=n(13526),s=n(65052),a=n(25557),i=n(77469),l=n(50873),c=n(62230),u=n(60196);function d(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:o,default:r}}=e;return{value:t,label:n,attributes:o,default:r}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:n}=e;const r=(0,a.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(s),(0,o.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,s=g(e),[a,l]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const o=n.find((e=>e.default))??n[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:t,tabValues:s}))),[c,d]=p({queryString:n,groupId:r}),[b,y]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,s]=(0,u.Dv)(n);return[r,(0,o.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:r}),m=(()=>{const e=c??b;return h({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{m&&l(m)}),[m]);return{selectedValue:a,selectValue:(0,o.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),y(e)}),[d,y,s]),tabValues:s}}var y=n(13887);const m={tabList:"tabList_CGfx",tabItem:"tabItem_JX1E"};var f=n(86070);function v(e){let{className:t,block:n,selectedValue:o,selectValue:a,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=e=>{const t=e.currentTarget,n=l.indexOf(t),r=i[n].value;r!==o&&(c(t),a(r))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:i.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,ref:e=>l.push(e),onKeyDown:d,onClick:u,...s,className:(0,r.A)("tabs__item",m.tabItem,s?.className,{"tabs__item--active":o===t}),children:n??t},t)}))})}function x(e){let{lazy:t,children:n,selectedValue:s}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===s));return e?(0,o.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function k(e){const t=b(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",m.tabList),children:[(0,f.jsx)(v,{...t,...e}),(0,f.jsx)(x,{...t,...e})]})}function j(e){const t=(0,y.A)();return(0,f.jsx)(k,{...e,children:d(e.children)},String(t))}},15658:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var o=n(30758);const r={},s=o.createContext(r);function a(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);