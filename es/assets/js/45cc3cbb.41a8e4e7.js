"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7110],{51918:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>t,contentTitle:()=>i,default:()=>p,frontMatter:()=>d,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"developers/custom-token-claims/create-script","title":"Crear un script de reclamos de token personalizado","description":"Para a\xf1adir reclamos personalizados al token de acceso, necesitas proporcionar un script que devuelva un objeto que contenga esos reclamos. El script debe estar escrito como una funci\xf3n de JavaScript que devuelva un objeto con los reclamos personalizados.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","sourceDirName":"developers/custom-token-claims","slug":"/developers/custom-token-claims/create-script","permalink":"/es/developers/custom-token-claims/create-script","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"create-script","title":"Crear un script de reclamos de token personalizado","sidebar_label":"Crear un script de reclamos de token personalizado","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Casos de uso comunes","permalink":"/es/developers/custom-token-claims/common-use-cases"},"next":{"title":"Suplantaci\xf3n de usuario","permalink":"/es/developers/user-impersonation"}}');var a=n(86070),r=n(15658);const d={id:"create-script",title:"Crear un script de reclamos de token personalizado",sidebar_label:"Crear un script de reclamos de token personalizado",sidebar_position:3},i="Crear un script de reclamos de token personalizado",t={},c=[{value:"Implementar la funci\xf3n <code>getCustomJwtClaims()</code>",id:"implementar-la-funci\xf3n-getcustomjwtclaims",level:2},{value:"Paso 1: Editar el script",id:"paso-1-editar-el-script",level:2},{value:"Paso 2: Par\xe1metros de entrada",id:"paso-2-par\xe1metros-de-entrada",level:2},{value:"token",id:"token",level:3},{value:"context (Solo disponible para token de acceso de usuario)",id:"context-solo-disponible-para-token-de-acceso-de-usuario",level:3},{value:"environmentVariables",id:"environmentvariables",level:3},{value:"api",id:"api",level:3},{value:"Paso 3: Obtener datos externos",id:"paso-3-obtener-datos-externos",level:2},{value:"Paso 4: Probar el script",id:"paso-4-probar-el-script",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:o}=s;return o||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"crear-un-script-de-reclamos-de-token-personalizado",children:"Crear un script de reclamos de token personalizado"})}),"\n",(0,a.jsxs)(s.p,{children:["Para ",(0,a.jsx)(s.a,{href:"/developers/custom-token-claims",children:"a\xf1adir reclamos personalizados"})," al ",(0,a.jsx)(s.a,{href:"https://auth.wiki/access-token",children:"token de acceso"}),", necesitas proporcionar un script que devuelva un objeto que contenga esos reclamos. El script debe estar escrito como una funci\xf3n de ",(0,a.jsx)(s.code,{children:"JavaScript"})," que devuelva un objeto con los reclamos personalizados."]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:["Navega a ",(0,a.jsx)(o,{to:"/customize-jwt",children:"Consola > JWT Personalizado"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsx)(s.p,{children:"Hay dos tipos diferentes de tokens de acceso para los cuales puedes personalizar los reclamos del token de acceso:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Token de acceso de usuario"}),": El token de acceso emitido para usuarios finales. Por ejemplo, para aplicaciones web o aplicaciones m\xf3viles."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Token de acceso m\xe1quina a m\xe1quina"}),": El token de acceso emitido para los servicios o aplicaciones. Por ejemplo, para ",(0,a.jsx)(s.a,{href:"/quick-starts/m2m",children:"aplicaciones m\xe1quina a m\xe1quina"}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Diferentes tipos de tokens de acceso pueden tener diferentes contextos de carga \xfatil del token. Puedes personalizar los reclamos del token para cada tipo de token de acceso por separado."}),"\n",(0,a.jsxs)(s.p,{children:["Elige cualquier tipo de token de acceso para el cual desees personalizar los reclamos del token y haz clic en el bot\xf3n ",(0,a.jsx)(s.strong,{children:"A\xf1adir reclamos personalizados"})," para crear un nuevo script."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.p,{children:"La funci\xf3n de reclamos de token personalizados solo est\xe1 disponible para:"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Usuarios de ",(0,a.jsx)(s.a,{href:"/logto-oss",children:"Logto OSS"})]}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/logto-cloud/tenant-settings#development",children:"Inquilinos de Logto Cloud con entorno de desarrollo"})}),"\n",(0,a.jsxs)(s.li,{children:["Inquilinos pagos de Logto Cloud con entorno de producci\xf3n (incluyendo ",(0,a.jsx)(s.a,{href:"https://logto.io/pricing",children:"Inquilinos Pro e Inquilinos Empresariales"}),")"]}),"\n"]})]}),"\n",(0,a.jsxs)(s.h2,{id:"implementar-la-funci\xf3n-getcustomjwtclaims",children:["Implementar la funci\xf3n ",(0,a.jsx)(s.code,{children:"getCustomJwtClaims()"})]}),"\n",(0,a.jsxs)(s.p,{children:["En la p\xe1gina de detalles de ",(0,a.jsx)(s.strong,{children:"JWT Personalizado"}),", puedes encontrar el editor de scripts para escribir tu script de reclamos de token personalizado. El script debe ser una funci\xf3n de ",(0,a.jsx)(s.code,{children:"JavaScript"})," que devuelva un objeto de reclamos personalizados."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"P\xe1gina de detalles de reclamos de token personalizado",src:n(50100).A+"",width:"3146",height:"1818"})}),"\n",(0,a.jsx)(s.h2,{id:"paso-1-editar-el-script",children:"Paso 1: Editar el script"}),"\n",(0,a.jsxs)(s.p,{children:["Usa el editor de c\xf3digo en el lado izquierdo para modificar el script. Se proporciona un ",(0,a.jsx)(s.code,{children:"getCustomJwtClaims"})," predeterminado con un valor de retorno de objeto vac\xedo para que comiences. Puedes modificar la funci\xf3n para devolver un objeto de tus propios reclamos personalizados."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ token, context, environmentVariables }) => {\n  return {};\n};\n"})}),"\n",(0,a.jsx)(s.p,{children:"Este editor utiliza el servidor de lenguaje JavaScript para proporcionar resaltado de sintaxis b\xe1sico, autocompletado de c\xf3digo y verificaci\xf3n de errores. El par\xe1metro de entrada est\xe1 bien tipado y documentado en estilo jsDoc. Puedes usar el IntelliSense del editor para acceder correctamente a las propiedades del objeto de entrada. Puedes encontrar las definiciones detalladas de los par\xe1metros en el lado derecho de la p\xe1gina."}),"\n",(0,a.jsx)(s.admonition,{type:"note",children:(0,a.jsxs)(s.p,{children:["Esta funci\xf3n se exportar\xe1 como un m\xf3dulo. Aseg\xfarate de mantener el nombre de la funci\xf3n como ",(0,a.jsx)(s.code,{children:"getCustomJwtClaims"})," para que el m\xf3dulo pueda exportar la funci\xf3n correctamente."]})}),"\n",(0,a.jsx)(s.h2,{id:"paso-2-par\xe1metros-de-entrada",children:"Paso 2: Par\xe1metros de entrada"}),"\n",(0,a.jsxs)(s.p,{children:["La funci\xf3n ",(0,a.jsx)(s.code,{children:"getCustomJwtClaims"})," toma un objeto como par\xe1metro de entrada. El objeto de entrada contiene las siguientes propiedades:"]}),"\n",(0,a.jsx)(s.h3,{id:"token",children:"token"}),"\n",(0,a.jsx)(s.p,{children:"El objeto de carga \xfatil del token. Este objeto contiene reclamos originales del token y metadatos que puedes necesitar acceder en el script."}),"\n",(0,a.jsx)(s.p,{children:"Puedes encontrar la definici\xf3n de tipo detallada del objeto de carga \xfatil del token y del objeto de datos del usuario en el lado derecho de la p\xe1gina. El IntelliSense del editor tambi\xe9n te ayudar\xe1 a acceder correctamente a estas propiedades del objeto de entrada."}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Objeto de datos del token de acceso de usuario","\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Propiedad"}),(0,a.jsx)(s.th,{children:"Descripci\xf3n"}),(0,a.jsx)(s.th,{children:"Tipo"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"jti"})}),(0,a.jsx)(s.td,{children:"El ID \xfanico del JWT"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"aud"})}),(0,a.jsx)(s.td,{children:"La audiencia del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"scope"})}),(0,a.jsx)(s.td,{children:"Los alcances del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"clientId"})}),(0,a.jsx)(s.td,{children:"El ID del cliente del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"accountId"})}),(0,a.jsx)(s.td,{children:"El ID del usuario del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"expiresWithSession"})}),(0,a.jsx)(s.td,{children:"Si el token expirar\xe1 con la sesi\xf3n"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"boolean"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"grantId"})}),(0,a.jsx)(s.td,{children:"El ID de concesi\xf3n de autenticaci\xf3n actual del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"gty"})}),(0,a.jsx)(s.td,{children:"El tipo de concesi\xf3n del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"kind"})}),(0,a.jsx)(s.td,{children:"El tipo de token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"AccessToken"})})]})]})]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Objeto de datos del token de acceso m\xe1quina a m\xe1quina","\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Propiedad"}),(0,a.jsx)(s.th,{children:"Descripci\xf3n"}),(0,a.jsx)(s.th,{children:"Tipo"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"jti"})}),(0,a.jsx)(s.td,{children:"El ID \xfanico del JWT"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"aud"})}),(0,a.jsx)(s.td,{children:"La audiencia del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"scope"})}),(0,a.jsx)(s.td,{children:"Los alcances del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"clientId"})}),(0,a.jsx)(s.td,{children:"El ID del cliente del token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"string"})})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"kind"})}),(0,a.jsx)(s.td,{children:"El tipo de token"}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"ClientCredentials"})})]})]})]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"context-solo-disponible-para-token-de-acceso-de-usuario",children:"context (Solo disponible para token de acceso de usuario)"}),"\n",(0,a.jsx)(s.p,{children:"El objeto de contexto contiene los datos del usuario y los datos de concesi\xf3n que son relevantes para el proceso de autorizaci\xf3n actual."}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Objeto de datos del usuario"}),"\nPara el token de acceso de usuario, Logto proporciona un contexto de datos de usuario adicional para que accedas. El objeto de datos del usuario contiene todos los datos del perfil del usuario y los datos de membres\xeda de la organizaci\xf3n que puedas necesitar para configurar los reclamos personalizados. Por favor, consulta ",(0,a.jsx)(s.a,{href:"/user-management/user-data",children:"Usuarios"})," y ",(0,a.jsx)(s.a,{href:"/organizations/organization-data",children:"Organizaciones"})," para m\xe1s detalles."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Objeto de datos de concesi\xf3n"}),"\nPara el token de acceso de usuario otorgado por intercambio de token de suplantaci\xf3n, Logto proporciona un contexto de datos de concesi\xf3n adicional para que accedas. El objeto de datos de concesi\xf3n contiene el contexto personalizado del token del sujeto. Por favor, consulta ",(0,a.jsx)(s.a,{href:"/developers/user-impersonation",children:"Suplantaci\xf3n de usuario"})," para m\xe1s detalles."]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"environmentvariables",children:"environmentVariables"}),"\n",(0,a.jsxs)(s.p,{children:["Usa la secci\xf3n ",(0,a.jsx)(s.strong,{children:"Configurar variables de entorno"})," en el lado derecho para configurar las variables de entorno para tu script. Puedes usar estas variables para almacenar informaci\xf3n sensible o datos de configuraci\xf3n que no deseas codificar en el script. Por ejemplo, claves de API, secretos o URLs."]}),"\n",(0,a.jsxs)(s.p,{children:["Todas las variables de entorno que configures aqu\xed estar\xe1n disponibles en el script. Usa el objeto ",(0,a.jsx)(s.code,{children:"environmentVariables"})," en el par\xe1metro de entrada para acceder a estas variables."]}),"\n",(0,a.jsx)(s.h3,{id:"api",children:"api"}),"\n",(0,a.jsxs)(s.p,{children:["El objeto ",(0,a.jsx)(s.code,{children:"api"})," proporciona un conjunto de funciones de utilidad que puedes usar en tu script para un control de acceso adicional sobre el proceso de emisi\xf3n de tokens. El objeto ",(0,a.jsx)(s.code,{children:"api"})," contiene las siguientes funciones:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-jsx",children:"api.denyAccess(message?: string): void\n"})}),"\n",(0,a.jsxs)(s.p,{children:["La funci\xf3n ",(0,a.jsx)(s.code,{children:"api.denyAccess()"})," te permite denegar el proceso de emisi\xf3n de tokens con un mensaje personalizado. Puedes usar esta funci\xf3n para imponer una validaci\xf3n de acceso adicional sobre el proceso de emisi\xf3n de tokens."]}),"\n",(0,a.jsx)(s.h2,{id:"paso-3-obtener-datos-externos",children:"Paso 3: Obtener datos externos"}),"\n",(0,a.jsxs)(s.p,{children:["Puedes usar la funci\xf3n incorporada ",(0,a.jsx)(s.code,{children:"fetch"})," de node para obtener datos externos en tu script. La funci\xf3n ",(0,a.jsx)(s.code,{children:"fetch"})," es una funci\xf3n basada en promesas que te permite hacer solicitudes HTTP a APIs externas."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ environmentVariables }) => {\n  const response = await fetch('https://api.example.com/data', {\n    headers: {\n      Authorization: `Bearer ${environmentVariables.API_KEY}`,\n    },\n  });\n\n  const data = await response.json();\n\n  return {\n    data,\n  };\n};\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"note",children:[(0,a.jsx)(s.p,{children:"Ten en cuenta que cualquier obtenci\xf3n de datos externos puede introducir latencia en el proceso de emisi\xf3n de tokens. Aseg\xfarate de que la API externa sea confiable y lo suficientemente r\xe1pida para cumplir con tus requisitos."}),(0,a.jsx)(s.p,{children:"Adem\xe1s:"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Maneja el error y el tiempo de espera adecuadamente en tu script para evitar que el proceso de emisi\xf3n de tokens se bloquee."}),"\n",(0,a.jsx)(s.li,{children:"Usa encabezados de autorizaci\xf3n adecuados para proteger tu API externa de accesos no autorizados."}),"\n"]})]}),"\n",(0,a.jsx)(s.h2,{id:"paso-4-probar-el-script",children:"Paso 4: Probar el script"}),"\n",(0,a.jsxs)(s.p,{children:["Aseg\xfarate de probar tu script antes de guardarlo. Haz clic en la pesta\xf1a ",(0,a.jsx)(s.strong,{children:"Contexto de prueba"})," en el lado derecho de la p\xe1gina para modificar la carga \xfatil del token simulado y el contexto de datos del usuario para la prueba."]}),"\n",(0,a.jsxs)(s.p,{children:["Haz clic en ",(0,a.jsx)(s.strong,{children:"Ejecutar prueba"})," en la esquina superior derecha del editor para ejecutar el script con los datos simulados. La salida del script se mostrar\xe1 en el caj\xf3n de ",(0,a.jsx)(s.strong,{children:"Resultado de la prueba"}),"."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Probar script de JWT personalizado",src:n(3747).A+"",width:"2682",height:"1322"})}),"\n",(0,a.jsx)(s.admonition,{type:"note",children:(0,a.jsxs)(s.p,{children:["El resultado de la prueba es la salida de la funci\xf3n ",(0,a.jsx)(s.code,{children:"getCustomJwtClaims"}),' con los datos simulados que configuraste ("reclamos de token adicionales" obtenidos despu\xe9s de completar el paso 3 en ',(0,a.jsx)(s.a,{href:"/developers/custom-token-claims/#how-do-custom-token-claims-work",children:"el diagrama de secuencia"}),"). La carga \xfatil real del token y el contexto de datos del usuario ser\xe1n diferentes cuando el script se ejecute en el proceso de emisi\xf3n de tokens."]})}),"\n",(0,a.jsxs)(s.p,{children:["Haz clic en el bot\xf3n ",(0,a.jsx)(s.strong,{children:"Crear"})," para guardar el script. El script de reclamos de token personalizado se guardar\xe1 y aplicar\xe1 al proceso de emisi\xf3n de tokens de acceso."]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},50100:(e,s,n)=>{n.d(s,{A:()=>o});const o=n.p+"assets/images/custom-jwt-detail-page-9dc0f24eaf27c30b0b8b505111355be4.png"},3747:(e,s,n)=>{n.d(s,{A:()=>o});const o=n.p+"assets/images/test-custom-jwt-script-312444d1b749a7a2be2b94f501dda3aa.png"},15658:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>i});var o=n(30758);const a={},r=o.createContext(a);function d(e){const s=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),o.createElement(r.Provider,{value:s},e.children)}}}]);