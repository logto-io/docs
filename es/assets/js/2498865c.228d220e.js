"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[59012],{10747:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"logto-oss/deployment-and-configuration","title":"Despliegue y configuraci\xf3n","description":"En el art\xedculo anterior, cubrimos los conceptos b\xe1sicos para comenzar r\xe1pidamente con Logto. Este art\xedculo profundiza m\xe1s, enfoc\xe1ndose en las mejores pr\xe1cticas y pasos detallados de configuraci\xf3n para desplegar Logto en un entorno de producci\xf3n.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/logto-oss/deployment-and-configuration.mdx","sourceDirName":"logto-oss","slug":"/logto-oss/deployment-and-configuration","permalink":"/es/logto-oss/deployment-and-configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/logto-oss/deployment-and-configuration.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Comienza con OSS","permalink":"/es/logto-oss/get-started-with-oss"},"next":{"title":"Logto CLI","permalink":"/es/logto-oss/using-cli/"}}');var r=o(86070),s=o(15658);const t={sidebar_position:2},i="Despliegue y configuraci\xf3n",c={},d=[{value:"Variables de entorno",id:"variables-de-entorno",level:2},{value:"Esenciales",id:"esenciales",level:3},{value:"HTTPS",id:"https",level:3},{value:"Proxy inverso",id:"proxy-inverso",level:3},{value:"Contenerizaci\xf3n",id:"contenerizaci\xf3n",level:2},{value:"Carpeta de conectores compartida",id:"carpeta-de-conectores-compartida",level:3},{value:"Alteraci\xf3n de la base de datos",id:"alteraci\xf3n-de-la-base-de-datos",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"despliegue-y-configuraci\xf3n",children:"Despliegue y configuraci\xf3n"})}),"\n",(0,r.jsx)(n.p,{children:"En el art\xedculo anterior, cubrimos los conceptos b\xe1sicos para comenzar r\xe1pidamente con Logto. Este art\xedculo profundiza m\xe1s, enfoc\xe1ndose en las mejores pr\xe1cticas y pasos detallados de configuraci\xf3n para desplegar Logto en un entorno de producci\xf3n."}),"\n",(0,r.jsx)(n.h2,{id:"variables-de-entorno",children:"Variables de entorno"}),"\n",(0,r.jsxs)(n.p,{children:["Usamos un conjunto predefinido de variables de entorno en nuestra demostraci\xf3n (",(0,r.jsx)(n.code,{children:"docker-compose.yml"}),"), que deber\xedas reemplazar con las tuyas propias y mantener la consistencia a trav\xe9s de m\xfaltiples instancias de Logto."]}),"\n",(0,r.jsxs)(n.p,{children:["Puedes establecer las variables de entorno directamente o colocar un archivo ",(0,r.jsx)(n.code,{children:".env"})," dentro de la ra\xedz del proyecto Logto. Si est\xe1s probando con Docker, revisa el ",(0,r.jsx)(n.code,{children:".env"})," generado de la imagen en ",(0,r.jsx)(n.code,{children:"/etc/logto"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"esenciales",children:"Esenciales"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DB_URL"})," El ",(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/14/libpq-connect.html#id-1.7.3.8.3.6",children:"Postgres DSN"})," para la base de datos de Logto."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"PORT"})," El puerto al que Logto escucha. Por defecto ",(0,r.jsx)(n.code,{children:"3001"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ENDPOINT"})," Puedes especificar una URL con tu dominio personalizado para producci\xf3n (Ej. ",(0,r.jsx)(n.code,{children:"ENDPOINT=https://logto.domain.com"}),"). Esto tambi\xe9n afectar\xe1 el valor del ",(0,r.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#IssuerIdentifier",children:"identificador del emisor OIDC"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Habilitar Admin Console"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ADMIN_PORT"})," El puerto al que escucha Logto Admin Console. Por defecto ",(0,r.jsx)(n.code,{children:"3002"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ADMIN_ENDPOINT"})," Puedes especificar una URL con tu dominio personalizado para producci\xf3n (Ej. ",(0,r.jsx)(n.code,{children:"ADMIN_ENDPOINT=https://admin.domain.com"}),"). Esto tambi\xe9n afectar\xe1 el valor de los URIs de redirecci\xf3n de Admin Console."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Deshabilitar Admin Console"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ADMIN_DISABLE_LOCALHOST"})," Establ\xe9celo en ",(0,r.jsx)(n.code,{children:"1"})," o ",(0,r.jsx)(n.code,{children:"true"})," para cerrar el puerto para Admin Console. Con ",(0,r.jsx)(n.code,{children:"ADMIN_ENDPOINT"})," sin establecer, deshabilitar\xe1 completamente el Admin Console."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Para m\xe1s detalles sobre las variables de entorno, consulta ",(0,r.jsx)(n.a,{href:"/concepts/core-service/configuration/",children:"Configuraci\xf3n"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"https",children:"HTTPS"}),"\n",(0,r.jsxs)(n.p,{children:["Puedes usar Node.js para servir HTTPS directamente o configurar un proxy / balanceador HTTPS frente a Node.js. Consulta ",(0,r.jsx)(n.a,{href:"/concepts/core-service/configuration/#enabling-https",children:"Habilitar HTTPS"})," para m\xe1s detalles."]}),"\n",(0,r.jsx)(n.h3,{id:"proxy-inverso",children:"Proxy inverso"}),"\n",(0,r.jsx)(n.p,{children:"Si deseas usar un proxy inverso en tu servidor, por ejemplo Nginx o Apache, necesitas mapear los puertos 3001 y 3002 por separado en tus configuraciones de proxy pass. Suponiendo que est\xe1s usando Nginx, tu endpoint de autenticaci\xf3n de Logto est\xe1 ejecut\xe1ndose en el puerto 3001, y tu consola de administraci\xf3n de Logto est\xe1 ejecut\xe1ndose en el 3002, coloca la siguiente configuraci\xf3n en nginx.conf:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"server {\n  listen 443 ssl;\n  server_name <your_endpoint_url>; // ej. auth.your-domain.com\n  ...\n\n  location / {\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto https;\n\n    proxy_pass http://127.0.0.1:3001;\n  }\n\n  ssl_certificate <path-to-your-certificate-for-auth-endpoint>;\n  ssl_certificate_key <path-to-your-certificate-key-for-auth-endpoint>\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Luego agrega una configuraci\xf3n similar para tu consola de administraci\xf3n:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"server {\n  listen 443 ssl;\n  server_name <your_admin_endpoint_url>; // ej. admin.your-domain.com\n  ...\n\n  location / {\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto https;\n\n    proxy_pass http://127.0.0.1:3002;\n  }\n\n  ssl_certificate <path-to-your-certificate-for-admin-endpoint>;\n  ssl_certificate_key <path-to-your-certificate-key-for-admin-endpoint>\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Recarga la configuraci\xf3n de Nginx para aplicar los \xfaltimos cambios:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"nginx -s reload\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Todo est\xe1 listo. Abre el navegador y visita ",(0,r.jsx)(n.code,{children:"https://admin.your-domain.com"}),", deber\xedas poder ver la p\xe1gina de bienvenida de Logto."]}),"\n",(0,r.jsx)(n.h2,{id:"contenerizaci\xf3n",children:"Contenerizaci\xf3n"}),"\n",(0,r.jsx)(n.p,{children:"Para producci\xf3n, puedes usar Docker para contenerizar Logto. Puedes encontrar el Dockerfile en el directorio ra\xedz del proyecto. Si deseas ejecutar m\xfaltiples instancias de Logto, por ejemplo, desplegar Logto en un cl\xfaster de Kubernetes, hay algunos pasos adicionales que necesitas seguir."}),"\n",(0,r.jsx)(n.h3,{id:"carpeta-de-conectores-compartida",children:"Carpeta de conectores compartida"}),"\n",(0,r.jsxs)(n.p,{children:["Por defecto, Logto crear\xe1 una carpeta ",(0,r.jsx)(n.code,{children:"connectors"})," en el directorio ra\xedz de la carpeta ",(0,r.jsx)(n.code,{children:"core"}),". Recomendamos compartir la carpeta entre m\xfaltiples instancias de Logto, necesitas montar la carpeta ",(0,r.jsx)(n.code,{children:"packages/core/connectors"})," al contenedor y ejecutar ",(0,r.jsx)(n.code,{children:"npm run cli connector add -- --official"})," para desplegar los conectores."]}),"\n",(0,r.jsxs)(n.p,{children:["Hay un ejemplo m\xednimo de ",(0,r.jsx)(n.code,{children:"deployment"})," para Kubernetes:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: logto\n  namespace: default\nspec:\n  template:\n    spec:\n      volumes:\n        - name: connectors\n          emptyDir: {}\n      initContainers:\n        - image: ghcr.io/logto-io/logto\n          command:\n            - /bin/sh\n          args:\n            - '-c'\n            - 'npm run cli connector add -- --official'\n          name: init\n          volumeMounts:\n            - name: connectors\n              mountPath: /etc/logto/packages/core/connectors\n      containers:\n        - image: ghcr.io/logto-io/logto\n          name: logto\n          volumeMounts:\n            - name: connectors\n              mountPath: /etc/logto/packages/core/connectors\n"})}),"\n",(0,r.jsxs)(n.p,{children:["En este ejemplo, creamos un directorio vac\xedo como volumen y lo montamos en los contenedores. Luego ejecutamos ",(0,r.jsx)(n.code,{children:"npm run cli connector add -- --official"})," en el contenedor de inicializaci\xf3n para descargar los conectores. Finalmente, cada contenedor compartir\xe1 la misma carpeta de conectores con nuestros conectores oficiales ya dentro."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Este es un ejemplo de yaml, para ejecutar Logto, necesitas configurar las variables de entorno adecuadamente."})}),"\n",(0,r.jsx)(n.p,{children:'Para producci\xf3n, puedes reemplazar el volumen de "directorio vac\xedo" con un volumen persistente, y realizar el trabajo de "inicializaci\xf3n" a tu manera, \xa1sabes lo que est\xe1s haciendo!'}),"\n",(0,r.jsx)(n.h3,{id:"alteraci\xf3n-de-la-base-de-datos",children:"Alteraci\xf3n de la base de datos"}),"\n",(0,r.jsx)(n.p,{children:"Similar a los conectores, la alteraci\xf3n de la base de datos necesita ejecutarse en una sola instancia. Puedes usar un trabajo para ejecutar el script de alteraci\xf3n."}),"\n",(0,r.jsxs)(n.p,{children:["La variable de entorno ",(0,r.jsx)(n.code,{children:"CI=true"})," es necesaria cuando la alteraci\xf3n se ejecuta de manera no interactiva."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: alteration\nspec:\n  template:\n    spec:\n      containers:\n        - name: alteration\n          image: ghcr.io/logto-io/logto\n          imagePullPolicy: Always\n          env:\n            - name: CI\n              value: 'true'\n            - name: DB_URL\n              value: postgresql://user:password@localhost:5432/logto\n          command:\n            - /bin/sh\n          args:\n            - '-c'\n            - 'npm run alteration deploy latest'\n      restartPolicy: Never\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Consulta ",(0,r.jsx)(n.a,{href:"/logto-oss/using-cli/database-alteration/",children:"Alteraci\xf3n de la base de datos"})," para m\xe1s detalles sobre el comando de alteraci\xf3n."]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},15658:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>i});var a=o(30758);const r={},s=a.createContext(r);function t(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);