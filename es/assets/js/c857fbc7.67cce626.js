"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[31676],{43157:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"authorization/organization-template/protect-organization-resources","title":"Proteger recursos de la organizaci\xf3n","description":"Adem\xe1s de Proteger tu API, que toma la API como recurso, la organizaci\xf3n tambi\xe9n puede ser un recurso, y proteger tu recurso de organizaci\xf3n de la misma manera. En este art\xedculo, nos centraremos en c\xf3mo cambiar para proteger tu recurso de organizaci\xf3n de manera similar.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-organization-resources.mdx","sourceDirName":"authorization/organization-template","slug":"/authorization/organization-template/protect-organization-resources","permalink":"/es/authorization/organization-template/protect-organization-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-organization-resources.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Configurar plantilla de organizaci\xf3n","permalink":"/es/authorization/organization-template/configure-organization-template"},"next":{"title":"Proteger el recurso de API con plantilla de organizaci\xf3n","permalink":"/es/authorization/organization-template/protect-api-reources"}}');var i=o(86070),r=o(15658),s=o(78551),t=o(77501);const c={sidebar_position:2},l="Proteger recursos de la organizaci\xf3n",d={},u=[{value:"Paso 1: Obtener IDs de organizaci\xf3n del flujo OIDC",id:"paso-1-obtener-ids-de-organizaci\xf3n-del-flujo-oidc",level:2},{value:"Opcional: Obtener roles de la organizaci\xf3n",id:"opcional-obtener-roles-de-la-organizaci\xf3n",level:3},{value:"Paso 2. Obtener token de organizaci\xf3n",id:"paso-2-obtener-token-de-organizaci\xf3n",level:2},{value:"Agregar par\xe1metros a la solicitud de autenticaci\xf3n",id:"agregar-par\xe1metros-a-la-solicitud-de-autenticaci\xf3n",level:3},{value:"Obtener el token de organizaci\xf3n",id:"obtener-el-token-de-organizaci\xf3n",level:3},{value:"Ejemplo",id:"ejemplo",level:3},{value:"Obtener token de organizaci\xf3n para una aplicaci\xf3n m\xe1quina a m\xe1quina",id:"obtener-token-de-organizaci\xf3n-para-una-aplicaci\xf3n-m\xe1quina-a-m\xe1quina",level:3},{value:"Paso 3. Verificar tokens de organizaci\xf3n",id:"paso-3-verificar-tokens-de-organizaci\xf3n",level:2}];function g(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"proteger-recursos-de-la-organizaci\xf3n",children:"Proteger recursos de la organizaci\xf3n"})}),"\n",(0,i.jsxs)(n.p,{children:["Adem\xe1s de ",(0,i.jsx)(n.a,{href:"/authorization/api-resources/protect-your-api",children:"Proteger tu API"}),", que toma la API como recurso, la organizaci\xf3n tambi\xe9n puede ser un recurso, y proteger tu recurso de organizaci\xf3n de la misma manera. En este art\xedculo, nos centraremos en c\xf3mo cambiar para proteger tu recurso de organizaci\xf3n de manera similar."]}),"\n",(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\n    participant Cliente\n    participant Logto\n    participant API\n\n    %% Flujo OIDC est\xe1ndar\n    Note over Cliente,Logto: Flujo OIDC est\xe1ndar\n    Cliente->>Logto: Solicitud de autorizaci\xf3n\n    Note right of Cliente: Incluye alcances de organizaci\xf3n:<br/>"urn:logto:scope:organizations"\n    Logto->>Cliente: C\xf3digo de autorizaci\xf3n\n    Cliente->>Logto: Solicitud de token\n    Logto->>Cliente: Token de ID + Token de acceso\n    Note right of Cliente: El Token de ID contiene `organizations`\n\n    %% Solicitud de token de organizaci\xf3n\n    Note over Cliente,API: Solicitud de token de organizaci\xf3n\n    Cliente->>Logto: POST /oidc/token\n    Note right of Cliente: con recurso "urn:logto:scope:organizations"<br/>y alcances solicitados incluyendo<br/>"urn:logto:scope:organizations"\n    Note right of Cliente: incluye el par\xe1metro organization_id\n\n    Note over Logto: Verificar acceso del usuario a la organizaci\xf3n\n\n    alt Sin acceso a organization_id\n        Logto--\x3e>Cliente: 403 Prohibido\n    else Tiene acceso a la organizaci\xf3n\n        Note over Logto: Filtrar alcances solicitados\n        Logto--\x3e>Cliente: Devuelve token de acceso JWT\n        Note left of Logto: El token contiene:<br/>- Reclamos est\xe1ndar de JWT<br/>- Alcances concedidos<br/>- audiencia `urn:logto:organization:{organization_id}`\n    end\n\n    Note over Cliente,API: Solicitud de API\n    Cliente->>API: Solicitud con token Bearer (token de organizaci\xf3n JWT)\n\n    Note over API: Validar token JWT:<br/>- Validaci\xf3n est\xe1ndar de JWT<br/>- Verificar organization_id\n\n    alt Token inv\xe1lido\n        API--\x3e>Cliente: 401 No autorizado\n    else Token v\xe1lido\n        alt organization_id inv\xe1lido\n            API--\x3e>Cliente: 403 Prohibido\n        else organization_id v\xe1lido\n            API--\x3e>Cliente: Recurso protegido\n        end\n    end'}),"\n",(0,i.jsx)(n.h2,{id:"paso-1-obtener-ids-de-organizaci\xf3n-del-flujo-oidc",children:"Paso 1: Obtener IDs de organizaci\xf3n del flujo OIDC"}),"\n",(0,i.jsxs)(n.p,{children:["Logto extiende el protocolo est\xe1ndar ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect"})," para permitir que tu aplicaci\xf3n obtenga la informaci\xf3n de la organizaci\xf3n del usuario. Hay dos maneras de hacerlo:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si est\xe1s utilizando un SDK de Logto con soporte para Organizaciones, puedes agregar el alcance ",(0,i.jsx)(n.code,{children:"urn:logto:scope:organizations"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"scopes"})," del objeto de configuraci\xf3n. Usualmente el SDK tendr\xe1 un enum para este alcance, por ejemplo, ",(0,i.jsx)(n.code,{children:"UserScope.Organizations"})," en ",(0,i.jsx)(n.a,{href:"https://github.com/logto-io/js",children:"Logto JS SDKs"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.A,{groupId:"sdk",children:[(0,i.jsx)(s.A,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { LogtoClient, UserScope } from '@logto/browser'; // o @logto/node, @logto/client\n\nconst logto = new LogtoClient({\n  // ...\n  scopes: [UserScope.Organizations],\n});\n"})})}),(0,i.jsx)(s.A,{value:"react",label:"React",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { LogtoProvider, UserScope } from '@logto/react';\n\nconst App = () => (\n  <LogtoProvider\n    config={{\n      // ...\n      scopes: [UserScope.Organizations],\n    }}\n  >\n    {/* ... */}\n  </LogtoProvider>\n);\n"})})}),(0,i.jsx)(s.A,{value:"python",label:"Python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from logto import UserInfoScope\n\nclient = LogtoClient(\n    LogtoConfig(\n        # ...\n        scopes=[UserInfoScope.organizations],\n    )\n)\n"})})}),(0,i.jsx)(s.A,{value:"php",label:"PHP",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Logto\\Sdk\\Constants\\UserScope;\n\n$client = new LogtoClient(\n  new LogtoConfig(\n    // ...\n    scopes: [UserScope::organizations],\n  )\n);\n"})})}),(0,i.jsx)(s.A,{value:"swift",label:"Swift",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"import Logto\nimport LogtoClient\n\nlet config = try? LogtoConfig(\n    // ...\n    scopes: [\n        UserScope.organizations.rawValue,\n    ],\n    // ...\n)\nlet client = LogtoClient(useConfig: config)\n"})})}),(0,i.jsx)(s.A,{value:"others",label:"Otros",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n};\n"})})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Para otros casos, necesitas agregar el alcance ",(0,i.jsx)(n.code,{children:"urn:logto:scope:organizations"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"scope"})," de la configuraci\xf3n del SDK (o solicitud de autenticaci\xf3n)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Una vez que el usuario finaliza el flujo de autenticaci\xf3n, puedes obtener la informaci\xf3n de la organizaci\xf3n del ",(0,i.jsx)(n.code,{children:"idToken"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// Usar JavaScript como ejemplo\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // Un array de cadenas de IDs de organizaci\xf3n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["El campo ",(0,i.jsx)(n.code,{children:"organizations"})," (reclamo) tambi\xe9n se incluir\xe1 en la respuesta del ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"endpoint UserInfo"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"opcional-obtener-roles-de-la-organizaci\xf3n",children:"Opcional: Obtener roles de la organizaci\xf3n"}),"\n",(0,i.jsxs)(n.p,{children:["Si a\xfan no has configurado roles de organizaci\xf3n, consulta ",(0,i.jsx)(n.a,{href:"/authorization/organization-template/configure-organization-template/#create-organization-role",children:"esta secci\xf3n"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Para obtener todos los roles de organizaci\xf3n del usuario actual:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si est\xe1s utilizando un SDK de Logto con soporte para Organizaciones, puedes agregar el alcance ",(0,i.jsx)(n.code,{children:"urn:logto:scope:organization_roles"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"scopes"})," del objeto de configuraci\xf3n. Usualmente el SDK tendr\xe1 un enum para este alcance, por ejemplo, ",(0,i.jsx)(n.code,{children:"UserScope.OrganizationRoles"})," en ",(0,i.jsx)(n.a,{href:"https://github.com/logto-io/js",children:"Logto JS SDKs"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Para otros casos, necesitas agregar el alcance ",(0,i.jsx)(n.code,{children:"urn:logto:scope:organization_roles"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"scope"})," de la configuraci\xf3n del SDK (o solicitud de autenticaci\xf3n)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Luego puedes obtener los roles de la organizaci\xf3n del ",(0,i.jsx)(n.code,{children:"idToken"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// Usar JavaScript como ejemplo\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organization_roles); // Un array de cadenas de roles de organizaci\xf3n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Cada cadena en el array tiene el formato ",(0,i.jsx)(n.code,{children:"organization_id:role_id"}),", por ejemplo, ",(0,i.jsx)(n.code,{children:"org_123:admin"})," significa que el usuario tiene el rol ",(0,i.jsx)(n.code,{children:"admin"})," en la organizaci\xf3n con ID ",(0,i.jsx)(n.code,{children:"org_123"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["El campo ",(0,i.jsx)(n.code,{children:"organization_roles"})," (reclamo) tambi\xe9n se incluir\xe1 en la respuesta del ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"endpoint UserInfo"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"paso-2-obtener-token-de-organizaci\xf3n",children:"Paso 2. Obtener token de organizaci\xf3n"}),"\n",(0,i.jsx)(n.p,{children:"Para realizar acciones en el contexto de una organizaci\xf3n, el usuario necesita recibir un token de acceso para esa organizaci\xf3n (token de organizaci\xf3n). El token de organizaci\xf3n es un token JWT que contiene el ID de la organizaci\xf3n y los permisos (alcances) del usuario en la organizaci\xf3n."}),"\n",(0,i.jsx)(n.h3,{id:"agregar-par\xe1metros-a-la-solicitud-de-autenticaci\xf3n",children:"Agregar par\xe1metros a la solicitud de autenticaci\xf3n"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si est\xe1s utilizando un SDK de Logto con soporte para Organizaciones, puedes agregar el alcance ",(0,i.jsx)(n.code,{children:"urn:logto:scope:organizations"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"scopes"})," del objeto de configuraci\xf3n, de la misma manera que ",(0,i.jsx)(n.a,{href:"/authorization/organization-template/protect-organization-resources/#step-1-get-organization-ids-from-oidc-flow",children:"Obtener IDs de organizaci\xf3n del usuario actual"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El SDK de Logto con soporte para Organizaciones manejar\xe1 autom\xe1ticamente el resto de la configuraci\xf3n."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Para otros casos, necesitas agregar los alcances ",(0,i.jsx)(n.code,{children:"offline_access"})," y ",(0,i.jsx)(n.code,{children:"urn:logto:scope:organizations"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"scope"})," y el recurso ",(0,i.jsx)(n.code,{children:"urn:logto:resource:organizations"})," al par\xe1metro ",(0,i.jsx)(n.code,{children:"resource"})," de la configuraci\xf3n del SDK (o solicitud de autenticaci\xf3n).","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Nota: ",(0,i.jsx)(n.code,{children:"offline_access"})," es necesario para obtener el ",(0,i.jsx)(n.code,{children:"refresh_token"})," que se puede usar para obtener tokens de organizaci\xf3n."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// Solo para otros casos. Para SDKs de Logto, ver arriba.\nconst config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n  resource: 'urn:logto:resource:organizations',\n};\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["El recurso ",(0,i.jsx)(n.code,{children:"urn:logto:resource:organizations"})," es un recurso especial que representa la plantilla de organizaci\xf3n."]})}),"\n",(0,i.jsx)(n.h3,{id:"obtener-el-token-de-organizaci\xf3n",children:"Obtener el token de organizaci\xf3n"}),"\n",(0,i.jsxs)(n.p,{children:["Logto extiende el tipo de concesi\xf3n ",(0,i.jsx)(n.code,{children:"refresh_token"})," est\xe1ndar para permitir que tu aplicaci\xf3n obtenga tokens de organizaci\xf3n."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Si est\xe1s utilizando un SDK de Logto con soporte para Organizaciones, puedes llamar al m\xe9todo ",(0,i.jsx)(n.code,{children:"getOrganizationToken()"})," (o al m\xe9todo ",(0,i.jsx)(n.code,{children:"getOrganizationTokenClaims()"}),") del SDK."]}),"\n",(0,i.jsxs)(n.li,{children:["Para otros casos, necesitas llamar al endpoint de token con los siguientes par\xe1metros:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"grant_type"}),": ",(0,i.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"client_id"}),": El ID de la aplicaci\xf3n que el usuario us\xf3 para autenticarse."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"refresh_token"}),": El ",(0,i.jsx)(n.code,{children:"refresh_token"})," que obtuviste del flujo de autenticaci\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"organization_id"}),": El ID de la organizaci\xf3n para la que deseas obtener el token."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scope"})," (opcional): Los alcances que deseas conceder al usuario en la organizaci\xf3n. Si no se especifica, el servidor de autorizaci\xf3n intentar\xe1 conceder los mismos alcances que el flujo de autenticaci\xf3n."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.A,{groupId:"sdk",children:[(0,i.jsx)(s.A,{value:"js",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const token = await logto.getOrganizationToken('<organization-id>');\n"})})}),(0,i.jsx)(s.A,{value:"react",label:"React",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"const App = () => {\n  const { getOrganizationToken } = useLogto();\n\n  const getToken = async () => {\n    const token = await getOrganizationToken('<organization-id>');\n  };\n\n  return <button onClick={getToken}>Obtener token de organizaci\xf3n</button>;\n};\n"})})}),(0,i.jsx)(s.A,{value:"python",label:"Python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'token = await client.getOrganizationToken("<organization-id>")\n# o\nclaims = await client.getOrganizationTokenClaims("<organization-id>")\n'})})}),(0,i.jsx)(s.A,{value:"php",label:"PHP",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$token = $client->getOrganizationToken('<organization-id>');\n// o\n$claims = $client->getOrganizationTokenClaims('<organization-id>');\n"})})}),(0,i.jsx)(s.A,{value:"swift",label:"Swift",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:'let token = try await client.getOrganizationToken(forId: "<organization-id>")\n'})})}),(0,i.jsx)(s.A,{value:"others",label:"Otros",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Usar JavaScript como ejemplo\n\nconst params = new URLSearchParams();\n\nparams.append('grant_type', 'refresh_token');\nparams.append('client_id', 'YOUR_CLIENT_ID');\nparams.append('refresh_token', 'REFRESH_TOKEN');\nparams.append('organization_id', 'org_123');\n\nconst response = await fetch('https://YOUR_LOGTO_ENDPOINT/oidc/token', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n  },\n  body: params,\n});\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["La respuesta estar\xe1 en el mismo formato que el ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint",children:"endpoint de token est\xe1ndar"}),", y el ",(0,i.jsx)(n.code,{children:"access_token"})," es el token de organizaci\xf3n en formato JWT."]}),"\n",(0,i.jsx)(n.p,{children:"Adem\xe1s de los reclamos regulares de un token de acceso, el token de organizaci\xf3n tambi\xe9n contiene los siguientes reclamos:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"aud"}),": La audiencia del token de organizaci\xf3n es ",(0,i.jsx)(n.code,{children:"urn:logto:organization:{organization_id}"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scope"}),": Los alcances concedidos al usuario en la organizaci\xf3n con espacio como delimitador."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ejemplo",children:"Ejemplo"}),"\n",(0,i.jsx)(n.p,{children:"Un buen ejemplo puede superar mil palabras. Supongamos que nuestra plantilla de organizaci\xf3n tiene la siguiente configuraci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Permisos: ",(0,i.jsx)(n.code,{children:"read:logs"}),", ",(0,i.jsx)(n.code,{children:"write:logs"}),", ",(0,i.jsx)(n.code,{children:"read:users"}),", ",(0,i.jsx)(n.code,{children:"write:users"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Roles: ",(0,i.jsx)(n.code,{children:"admin"}),", ",(0,i.jsx)(n.code,{children:"member"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["El rol ",(0,i.jsx)(n.code,{children:"admin"})," tiene todos los permisos."]}),"\n",(0,i.jsxs)(n.li,{children:["El rol ",(0,i.jsx)(n.code,{children:"member"})," tiene permisos ",(0,i.jsx)(n.code,{children:"read:logs"})," y ",(0,i.jsx)(n.code,{children:"read:users"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Y el usuario tiene la siguiente configuraci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["IDs de organizaci\xf3n: ",(0,i.jsx)(n.code,{children:"org_1"}),", ",(0,i.jsx)(n.code,{children:"org_2"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Roles de organizaci\xf3n: ",(0,i.jsx)(n.code,{children:"org_1:admin"}),", ",(0,i.jsx)(n.code,{children:"org_2:member"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"En la configuraci\xf3n del SDK de Logto (o solicitud de autenticaci\xf3n), configuramos otras cosas correctamente y agregamos los siguientes alcances:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"urn:logto:scope:organizations"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"openid"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"offline_access"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"read:logs"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"write:logs"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Ahora, cuando el usuario finaliza el flujo de autenticaci\xf3n, podemos obtener los IDs de organizaci\xf3n del ",(0,i.jsx)(n.code,{children:"idToken"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// Usar JavaScript como ejemplo\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // ['org_1', 'org_2']\n"})}),"\n",(0,i.jsx)(n.p,{children:"Si queremos obtener los tokens de organizaci\xf3n:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// Usar JavaScript como ejemplo\nconst org1Token = await logto.getOrganizationTokenClaims('org_1');\nconst org2Token = await logto.getOrganizationTokenClaims('org_2');\n\nconsole.log(org1Token.aud); // 'urn:logto:organization:org_1'\nconsole.log(org1Token.scope); // 'read:logs write:logs'\nconsole.log(org2Token.aud); // 'urn:logto:organization:org_2'\nconsole.log(org2Token.scope); // 'read:logs'\n\nconst org3Token = await logto.getOrganizationTokenClaims('org_3'); // Error: El usuario no es miembro de la organizaci\xf3n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Explicaci\xf3n:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Para ",(0,i.jsx)(n.code,{children:"org_1"}),", el usuario tiene el rol ",(0,i.jsx)(n.code,{children:"admin"}),", por lo que el token de organizaci\xf3n deber\xeda tener todos los permisos disponibles (alcances)."]}),"\n",(0,i.jsxs)(n.li,{children:["Para ",(0,i.jsx)(n.code,{children:"org_2"}),", el usuario tiene el rol ",(0,i.jsx)(n.code,{children:"member"}),", por lo que el token de organizaci\xf3n deber\xeda tener permisos ",(0,i.jsx)(n.code,{children:"read:logs"})," y ",(0,i.jsx)(n.code,{children:"read:users"})," (alcances)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Dado que solo solicitamos los alcances ",(0,i.jsx)(n.code,{children:"read:logs"})," y ",(0,i.jsx)(n.code,{children:"write:logs"}),' en el flujo de autenticaci\xf3n, los tokens de organizaci\xf3n se han "reducido" en consecuencia, resultando en la intersecci\xf3n de los alcances solicitados y los alcances disponibles.']}),"\n",(0,i.jsx)(n.h3,{id:"obtener-token-de-organizaci\xf3n-para-una-aplicaci\xf3n-m\xe1quina-a-m\xe1quina",children:"Obtener token de organizaci\xf3n para una aplicaci\xf3n m\xe1quina a m\xe1quina"}),"\n",(0,i.jsxs)(n.p,{children:["Similar a obtener tokens de organizaci\xf3n para usuarios, tambi\xe9n puedes obtener tokens de organizaci\xf3n para aplicaciones m\xe1quina a m\xe1quina. La \xfanica diferencia es que necesitas usar el tipo de concesi\xf3n ",(0,i.jsx)(n.code,{children:"client_credentials"})," en lugar del tipo de concesi\xf3n ",(0,i.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Para aprender m\xe1s sobre aplicaciones m\xe1quina a m\xe1quina, consulta ",(0,i.jsx)(n.a,{href:"/quick-starts/m2m/",children:"M\xe1quina a m\xe1quina: Autenticaci\xf3n con Logto"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"paso-3-verificar-tokens-de-organizaci\xf3n",children:"Paso 3. Verificar tokens de organizaci\xf3n"}),"\n",(0,i.jsxs)(n.p,{children:["Una vez que la aplicaci\xf3n obtiene un token de organizaci\xf3n, puede usar el token de la misma manera que un token de acceso regular, por ejemplo, llamar a las APIs con el token en el encabezado ",(0,i.jsx)(n.code,{children:"Authorization"})," en el formato ",(0,i.jsx)(n.code,{children:"Bearer {token}"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["En tu API, la forma de verificar el token de organizaci\xf3n es bastante similar a ",(0,i.jsx)(n.a,{href:"/authorization/api-resources/protect-your-api/#validate-authorization-tokens-for-api-requests",children:"Proteger tu API"}),". Principales diferencias:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A diferencia de los tokens de acceso para recursos de API, un usuario NO PUEDE obtener un token de organizaci\xf3n si no es miembro de la organizaci\xf3n."}),"\n",(0,i.jsxs)(n.li,{children:["La audiencia del token de organizaci\xf3n es ",(0,i.jsx)(n.code,{children:"urn:logto:organization:{organization_id}"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Para ciertos permisos (alcances), necesitas verificar el reclamo ",(0,i.jsx)(n.code,{children:"scope"})," del token de organizaci\xf3n dividiendo la cadena con espacio como delimitador."]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},78551:(e,n,o)=>{o.d(n,{A:()=>s});o(30758);var a=o(13526);const i={tabItem:"tabItem_PGP0"};var r=o(86070);function s(e){let{children:n,hidden:o,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(i.tabItem,s),hidden:o,children:n})}},77501:(e,n,o)=>{o.d(n,{A:()=>v});var a=o(30758),i=o(13526),r=o(65052),s=o(25557),t=o(77469),c=o(50873),l=o(62230),d=o(60196);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:n,children:o}=e;return(0,a.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:o,attributes:a,default:i}}=e;return{value:n,label:o,attributes:a,default:i}}))}(o);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,o])}function p(e){let{value:n,tabValues:o}=e;return o.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:o}=e;const i=(0,s.W6)(),r=function(e){let{queryString:n=!1,groupId:o}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:n,groupId:o});return[(0,c.aZ)(r),(0,a.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function m(e){const{defaultValue:n,queryString:o=!1,groupId:i}=e,r=g(e),[s,c]=(0,a.useState)((()=>function(e){let{defaultValue:n,tabValues:o}=e;if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${o.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=o.find((e=>e.default))??o[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:r}))),[l,u]=h({queryString:o,groupId:i}),[m,j]=function(e){let{groupId:n}=e;const o=function(e){return e?`docusaurus.tab.${e}`:null}(n),[i,r]=(0,d.Dv)(o);return[i,(0,a.useCallback)((e=>{o&&r.set(e)}),[o,r])]}({groupId:i}),x=(()=>{const e=l??m;return p({value:e,tabValues:r})?e:null})();(0,t.A)((()=>{x&&c(x)}),[x]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),j(e)}),[u,j,r]),tabValues:r}}var j=o(13887);const x={tabList:"tabList_CGfx",tabItem:"tabItem_JX1E"};var z=o(86070);function f(e){let{className:n,block:o,selectedValue:a,selectValue:s,tabValues:t}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),d=e=>{const n=e.currentTarget,o=c.indexOf(n),i=t[o].value;i!==a&&(l(n),s(i))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const o=c.indexOf(e.currentTarget)+1;n=c[o]??c[0];break}case"ArrowLeft":{const o=c.indexOf(e.currentTarget)-1;n=c[o]??c[c.length-1];break}}n?.focus()};return(0,z.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":o},n),children:t.map((e=>{let{value:n,label:o,attributes:r}=e;return(0,z.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>c.push(e),onKeyDown:u,onClick:d,...r,className:(0,i.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":a===n}),children:o??n},n)}))})}function b(e){let{lazy:n,children:o,selectedValue:r}=e;const s=(Array.isArray(o)?o:[o]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,z.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function k(e){const n=m(e);return(0,z.jsxs)("div",{className:(0,i.A)("tabs-container",x.tabList),children:[(0,z.jsx)(f,{...n,...e}),(0,z.jsx)(b,{...n,...e})]})}function v(e){const n=(0,j.A)();return(0,z.jsx)(k,{...e,children:u(e.children)},String(n))}},15658:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>t});var a=o(30758);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);