"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[4370],{18279:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"logto-oss/using-cli/database-alteration","title":"Alteraci\xf3n de la base de datos","description":"C\xf3mo implementar alteraciones en la base de datos.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/logto-oss/using-cli/database-alteration.mdx","sourceDirName":"logto-oss/using-cli","slug":"/logto-oss/using-cli/database-alteration","permalink":"/es/logto-oss/using-cli/database-alteration","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/logto-oss/using-cli/database-alteration.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"description":"C\xf3mo implementar alteraciones en la base de datos.","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Gestionar conectores","permalink":"/es/logto-oss/using-cli/manage-connectors"},"next":{"title":"Gestionar configuraciones de base de datos","permalink":"/es/logto-oss/using-cli/manage-database-configs"}}');var s=n(86070),t=n(15658),l=n(78551),o=n(77501);const i={description:"C\xf3mo implementar alteraciones en la base de datos.",sidebar_position:3},c="Alteraci\xf3n de la base de datos",d={},u=[{value:"Determinar la versi\xf3n a implementar",id:"determinar-la-versi\xf3n-a-implementar",level:2},{value:"Revertir alteraciones",id:"revertir-alteraciones",level:2},{value:"Para colaboradores",id:"para-colaboradores",level:2}];function p(e){const a={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"alteraci\xf3n-de-la-base-de-datos",children:"Alteraci\xf3n de la base de datos"})}),"\n",(0,s.jsx)(a.p,{children:"Al desarrollar nuevas funcionalidades o al refactorizar las existentes, a veces es inevitable cambiar los esquemas de la base de datos."}),"\n",(0,s.jsx)(a.p,{children:"Las cosas pueden sonar aterradoras, como usuario, usualmente necesitas:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Verificar dos veces la diferencia entre dos o m\xe1s versiones"}),"\n",(0,s.jsx)(a.li,{children:"Alterar la base de datos de una manera segura y compatible hacia atr\xe1s"}),"\n",(0,s.jsx)(a.li,{children:"Prepararte para posibles fallos, por ejemplo, tener un script de reversi\xf3n"}),"\n",(0,s.jsx)(a.li,{children:"Reemplazar gradualmente las instancias de Logto en ejecuci\xf3n a la nueva versi\xf3n"}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Oye, nosotros tambi\xe9n somos desarrolladores, y sabemos que no es agradable hacer todas estas cosas arriesgadas pero obligatorias."})," Entonces, \xbfpor qu\xe9 no se las damos a alguien que no cometer\xe1 errores, como un CLI?"]}),"\n",(0,s.jsx)(a.p,{children:"A partir de ahora, tu proceso de actualizaci\xf3n ser\xe1:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["Ejecutar ",(0,s.jsx)(a.code,{children:"logto db alt deploy"})," desde cualquier lugar que pueda acceder a la base de datos"]}),"\n",(0,s.jsx)(a.li,{children:"Reemplazar gradualmente las instancias de Logto en ejecuci\xf3n a la nueva versi\xf3n"}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"\xa1Comencemos!"}),"\n",(0,s.jsx)(a.h2,{id:"determinar-la-versi\xf3n-a-implementar",children:"Determinar la versi\xf3n a implementar"}),"\n",(0,s.jsxs)(a.p,{children:["Si tienes Logto CLI instalado globalmente, es ",(0,s.jsx)(a.strong,{children:"altamente recomendable"})," actualizar el CLI a la \xfaltima versi\xf3n antes de implementar para obtener todas las alteraciones de base de datos disponibles. Luego ejecuta el comando:"]}),"\n",(0,s.jsxs)(o.A,{groupId:"cmd",children:[(0,s.jsx)(l.A,{value:"cli",label:"CLI",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"logto db alteration deploy\n"})})}),(0,s.jsx)(l.A,{value:"npx",label:"npx",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"npx @logto/cli db alteration deploy\n"})})})]}),"\n",(0,s.jsx)(a.p,{children:"Si tu base de datos est\xe1 actualizada, ver\xe1s el siguiente mensaje:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"[info] Found 0 alteration to deploy\n"})}),"\n",(0,s.jsx)(a.p,{children:"Si tienes alteraciones no implementadas, el CLI te pedir\xe1 que elijas la versi\xf3n deseada:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"? Choose the alteration target version (Use arrow keys)\n> 1.2.0\n  1.0.0\n"})}),"\n",(0,s.jsx)(a.p,{children:"Te\xf3ricamente, la versi\xf3n a implementar deber\xeda coincidir con la versi\xf3n de tu instancia de Logto. Mientras tanto, puedes usar el comando con una versi\xf3n objetivo:"}),"\n",(0,s.jsxs)(o.A,{groupId:"cmd",children:[(0,s.jsx)(l.A,{value:"cli",label:"CLI",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"logto db alteration deploy 1.2.0\n"})})}),(0,s.jsx)(l.A,{value:"npx",label:"npx",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"npx @logto/cli db alteration deploy 1.2.0\n"})})})]}),"\n",(0,s.jsxs)(a.p,{children:["Es \xfatil cuando deseas hacer la alteraci\xf3n en un pipeline no-TTY, solo recuerda pasar la URL de la base de datos usando ",(0,s.jsx)(a.code,{children:"--db-url"}),". Consulta ",(0,s.jsx)(a.a,{href:"/logto-oss/deployment-and-configuration/",children:"Despliegue y configuraci\xf3n"})," para configurar un trabajo de alteraci\xf3n en tu cl\xfaster."]}),"\n",(0,s.jsx)(a.admonition,{type:"note",children:(0,s.jsx)(a.p,{children:"Para cada script de alteraci\xf3n, Logto CLI ejecutar\xe1 todo el script en una transacci\xf3n. As\xed que si una implementaci\xf3n falla, puedes continuar f\xe1cilmente con el mismo comando despu\xe9s de solucionar el problema."})}),"\n",(0,s.jsx)(a.h2,{id:"revertir-alteraciones",children:"Revertir alteraciones"}),"\n",(0,s.jsxs)(a.p,{children:["Nuestros scripts de alteraci\xf3n tambi\xe9n vienen con un script ",(0,s.jsx)(a.code,{children:"down"})," que puede revertir los cambios. Para revertir el estado de la base de datos a una versi\xf3n espec\xedfica, reemplaza ",(0,s.jsx)(a.code,{children:"1.0.0"})," con tu versi\xf3n objetivo y ejecuta el siguiente comando:"]}),"\n",(0,s.jsxs)(o.A,{groupId:"cmd",children:[(0,s.jsx)(l.A,{value:"cli",label:"CLI",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"logto db alteration rollback 1.0.0\n"})})}),(0,s.jsx)(l.A,{value:"npx",label:"npx",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"npx @logto/cli db alteration rollback 1.0.0\n"})})})]}),"\n",(0,s.jsx)(a.admonition,{type:"note",children:(0,s.jsxs)(a.p,{children:["Puedes encontrar todos los scripts de alteraci\xf3n ",(0,s.jsx)(a.a,{href:"https://github.com/logto-io/logto/tree/master/packages/schemas/alterations",children:"en este directorio"}),"."]})}),"\n",(0,s.jsx)(a.h2,{id:"para-colaboradores",children:"Para colaboradores"}),"\n",(0,s.jsx)(a.p,{children:'La rama principal del repositorio de Logto puede contener scripts de alteraci\xf3n no publicados. Puede que necesites implementar manualmente las alteraciones "next" ejecutando:'}),"\n",(0,s.jsxs)(o.A,{groupId:"cmd",children:[(0,s.jsx)(l.A,{value:"cli",label:"CLI",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"logto db alteration deploy next\n"})})}),(0,s.jsx)(l.A,{value:"npx",label:"npx",children:(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"npx @logto/cli db alteration deploy next\n"})})})]}),"\n",(0,s.jsx)(a.p,{children:"Si est\xe1s desarrollando una funcionalidad que requiere alteraciones en la base de datos, en lugar de actualizar el esquema de la base de datos, tambi\xe9n necesitas proporcionar un script en el siguiente formato:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"next-[timestamp]-what-to-do.ts\n"})}),"\n",(0,s.jsxs)(a.p,{children:["Consulta ",(0,s.jsx)(a.a,{href:"https://github.com/logto-io/logto/tree/master/packages/schemas/alterations",children:"este directorio"})," como referencia."]})]})}function h(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},78551:(e,a,n)=>{n.d(a,{A:()=>l});n(30758);var r=n(13526);const s={tabItem:"tabItem_PGP0"};var t=n(86070);function l(e){let{children:a,hidden:n,className:l}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,l),hidden:n,children:a})}},77501:(e,a,n)=>{n.d(a,{A:()=>A});var r=n(30758),s=n(13526),t=n(65052),l=n(25557),o=n(77469),i=n(50873),c=n(62230),d=n(60196);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:a,children:n}=e;return(0,r.useMemo)((()=>{const e=a??function(e){return u(e).map((e=>{let{props:{value:a,label:n,attributes:r,default:s}}=e;return{value:a,label:n,attributes:r,default:s}}))}(n);return function(e){const a=(0,c.XI)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,n])}function h(e){let{value:a,tabValues:n}=e;return n.some((e=>e.value===a))}function m(e){let{queryString:a=!1,groupId:n}=e;const s=(0,l.W6)(),t=function(e){let{queryString:a=!1,groupId:n}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:a,groupId:n});return[(0,i.aZ)(t),(0,r.useCallback)((e=>{if(!t)return;const a=new URLSearchParams(s.location.search);a.set(t,e),s.replace({...s.location,search:a.toString()})}),[t,s])]}function b(e){const{defaultValue:a,queryString:n=!1,groupId:s}=e,t=p(e),[l,i]=(0,r.useState)((()=>function(e){let{defaultValue:a,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!h({value:a,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:a,tabValues:t}))),[c,u]=m({queryString:n,groupId:s}),[b,g]=function(e){let{groupId:a}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(a),[s,t]=(0,d.Dv)(n);return[s,(0,r.useCallback)((e=>{n&&t.set(e)}),[n,t])]}({groupId:s}),x=(()=>{const e=c??b;return h({value:e,tabValues:t})?e:null})();(0,o.A)((()=>{x&&i(x)}),[x]);return{selectedValue:l,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),g(e)}),[u,g,t]),tabValues:t}}var g=n(13887);const x={tabList:"tabList_CGfx",tabItem:"tabItem_JX1E"};var j=n(86070);function f(e){let{className:a,block:n,selectedValue:r,selectValue:l,tabValues:o}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),d=e=>{const a=e.currentTarget,n=i.indexOf(a),s=o[n].value;s!==r&&(c(a),l(s))},u=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=i.indexOf(e.currentTarget)+1;a=i[n]??i[0];break}case"ArrowLeft":{const n=i.indexOf(e.currentTarget)-1;a=i[n]??i[i.length-1];break}}a?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},a),children:o.map((e=>{let{value:a,label:n,attributes:t}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===a?0:-1,"aria-selected":r===a,ref:e=>i.push(e),onKeyDown:u,onClick:d,...t,className:(0,s.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":r===a}),children:n??a},a)}))})}function v(e){let{lazy:a,children:n,selectedValue:t}=e;const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(a){const e=l.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:l.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==t})))})}function y(e){const a=b(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,j.jsx)(f,{...a,...e}),(0,j.jsx)(v,{...a,...e})]})}function A(e){const a=(0,g.A)();return(0,j.jsx)(y,{...e,children:u(e.children)},String(a))}},15658:(e,a,n)=>{n.d(a,{R:()=>l,x:()=>o});var r=n(30758);const s={},t=r.createContext(s);function l(e){const a=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:a},e.children)}}}]);