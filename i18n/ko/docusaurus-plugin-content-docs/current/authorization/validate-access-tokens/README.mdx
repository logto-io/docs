---
sidebar_position: 6
sidebar_label: API에서 액세스 토큰 (Access token) 검증하기
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import DotNetAddValidationLogic from './dotnet/_add-validation-logic.mdx';
import DotNetApplyMiddleware from './dotnet/_apply-middleware.mdx';
import DotNetInit from './dotnet/_init.mdx';
import GoAddValidationLogic from './go/_add-validation-logic.mdx';
import GoApplyMiddleware from './go/_apply-middleware.mdx';
import GoInit from './go/_init.mdx';
import JavaAddValidationLogic from './java/_add-validation-logic.mdx';
import JavaApplyMiddleware from './java/_apply-middleware.mdx';
import JavaInit from './java/_init.mdx';
import NodeAddValidationLogic from './nodejs/_add-validation-logic.mdx';
import NodeApplyMiddleware from './nodejs/_apply-middleware.mdx';
import NodeInit from './nodejs/_init.mdx';
import PhpAddValidationLogic from './php/_add-validation-logic.mdx';
import PhpApplyMiddleware from './php/_apply-middleware.mdx';
import PhpInit from './php/_init.mdx';
import PythonAddValidationLogic from './python/_add-validation-logic.mdx';
import PythonApplyMiddleware from './python/_apply-middleware.mdx';
import PythonInit from './python/_init.mdx';
import RubyAddValidationLogic from './ruby/_add-validation-logic.mdx';
import RubyApplyMiddleware from './ruby/_apply-middleware.mdx';
import RubyInit from './ruby/_init.mdx';
import RustAddValidationLogic from './rust/_add-validation-logic.mdx';
import RustApplyMiddleware from './rust/_apply-middleware.mdx';
import RustInit from './rust/_init.mdx';

# API 서비스 또는 백엔드에서 액세스 토큰 (Access token) 검증하는 방법

액세스 토큰 (Access token) 검증은 Logto에서 [역할 기반 접근 제어 (RBAC)](/authorization/role-based-access-control)를 적용하는 데 중요한 부분입니다. 이 가이드에서는 백엔드 / API에서 Logto가 발급한 JWT를 검증하는 방법, 서명, 발급자 (Issuer), 대상 (Audience), 만료, 권한 (스코프), 조직 컨텍스트 등을 확인하는 방법을 안내합니다.

## 시작하기 전에 \{#before-you-start}

- 이 가이드는 Logto의 RBAC 개념에 익숙하다고 가정합니다.
- API 리소스를 보호하는 경우, [글로벌 API 리소스 보호하기](/authorization/global-api-resources) 가이드를 먼저 참고하세요.
- 인앱 기능 또는 워크플로우(비 API 권한)를 보호하는 경우, [조직 (비 API) 권한 보호하기](/authorization/organization-permissions) 가이드를 참고하세요.
- 조직 수준의 API 리소스를 보호하는 경우, [조직 수준 API 리소스 보호하기](/authorization/organization-level-api-resources) 가이드를 참고하세요.

## 1단계: 상수 및 유틸리티 초기화 \{#step-1-initialize-constants-and-utilities}

토큰 추출 및 검증을 처리하기 위해 코드에서 필요한 상수와 유틸리티를 정의하세요. 유효한 요청에는 `Authorization` 헤더가 `Bearer <access_token>` 형식으로 포함되어야 합니다.

<Tabs groupId="api-language">
  <TabItem value="node" label="Node.js">
    <NodeInit />
  </TabItem>
  <TabItem value="python" label="Python">
    <PythonInit />
  </TabItem>
  <TabItem value="go" label="Go">
    <GoInit />
  </TabItem>
  <TabItem value="java" label="Java">
    <JavaInit />
  </TabItem>
  <TabItem value="dotnet" label=".NET">
    <DotNetInit />
  </TabItem>
  <TabItem value="php" label="PHP">
    <PhpInit />
  </TabItem>
  <TabItem value="ruby" label="Ruby">
    <RubyInit />
  </TabItem>
  <TabItem value="rust" label="Rust">
    <RustInit />
  </TabItem>
</Tabs>

## 2단계: Logto 테넌트 정보 가져오기 \{#step-2-retrieve-info-about-your-logto-tenant}

Logto가 발급한 토큰을 검증하려면 다음 값이 필요합니다:

- JSON Web Key Set (JWKS) URI: JWT 서명 검증에 사용되는 Logto 공개키의 URL입니다.
- 발급자 (Issuer): 기대하는 발급자 값 (Logto의 OIDC URL).

먼저, Logto 테넌트의 엔드포인트를 찾으세요. 여러 위치에서 확인할 수 있습니다:

- Logto 콘솔의 **설정** → **도메인**에서 확인
- Logto에서 구성한 애플리케이션 설정의 **설정** → **엔드포인트 & 자격 증명**에서 확인

### OpenID Connect 디스커버리 엔드포인트에서 가져오기 \{#fetch-from-openid-connect-discovery-endpoint}

이 값들은 Logto의 OpenID Connect 디스커버리 엔드포인트에서 가져올 수 있습니다:

```
https://<your-logto-endpoint>/oidc/.well-known/openid-configuration
```

예시 응답 (다른 필드는 생략):

```json
{
  "jwks_uri": "https://your-tenant.logto.app/oidc/jwks",
  "issuer": "https://your-tenant.logto.app/oidc"
}
```

### 코드에 하드코딩 (권장하지 않음) \{#hardcode-in-your-code-not-recommended}

Logto는 JWKS URI 또는 발급자 (Issuer) 커스터마이징을 허용하지 않으므로, 이 값을 코드에 하드코딩할 수 있습니다. 하지만, 향후 설정이 변경될 경우 유지보수 부담이 커질 수 있으므로 프로덕션 애플리케이션에서는 권장하지 않습니다.

- JWKS URI: `https://<your-logto-endpoint>/oidc/jwks`
- 발급자 (Issuer): `https://<your-logto-endpoint>/oidc`

## 3단계: 토큰 및 권한 검증 \{#step-3-validate-the-token-and-permissions}

토큰을 추출하고 OIDC 구성을 가져온 후, 다음을 검증하세요:

- **서명:** JWT가 유효하며 Logto(JWKS를 통해)에서 서명되었는지 확인
- **발급자 (Issuer):** Logto 테넌트의 발급자와 일치해야 함
- **대상 (Audience):** Logto에 등록된 API의 리소스 지표 (Resource indicator) 또는 해당되는 경우 조직 컨텍스트와 일치해야 함
- **만료:** 토큰이 만료되지 않았는지 확인
- **권한 (스코프):** 토큰에 API / 액션에 필요한 스코프가 포함되어야 함. 스코프는 `scope` 클레임에 공백으로 구분된 문자열로 포함됨
- **조직 컨텍스트:** 조직 수준 API 리소스를 보호하는 경우 `organization_id` 클레임을 검증

JWT 구조와 클레임에 대해 더 알고 싶다면 [JSON Web Token](https://auth.wiki/jwt) 을 참고하세요.

### 각 권한 모델별로 확인해야 할 사항 \{#what-to-check-for-each-permission-model}

클레임 및 검증 규칙은 권한 모델에 따라 다릅니다:

| 권한 모델            | Audience 클레임 (`aud`)                                             | 조직 클레임 (`organization_id`) | 확인할 스코프 (권한) (`scope`) |
| -------------------- | ------------------------------------------------------------------- | ------------------------------- | ------------------------------ |
| 글로벌 API 리소스    | API 리소스 지표 (Resource indicator)                                | _없음_                          | API 리소스 권한                |
| 조직 (비 API) 권한   | `urn:logto:organization:<id>` (조직 컨텍스트가 `aud` 클레임에 있음) | _없음_                          | 조직 권한                      |
| 조직 수준 API 리소스 | API 리소스 지표 (Resource indicator)                                | 조직 ID (요청과 일치해야 함)    | API 리소스 권한                |

<small>
  비 API 조직 권한의 경우, 조직 컨텍스트는 `aud` 클레임(예: `urn:logto:organization:abc123`)으로
  표현됩니다. `organization_id` 클레임은 조직 수준 API 리소스 토큰에만 존재합니다.
</small>

:::tip
보안이 중요한 멀티 테넌트 API에서는 항상 권한(스코프)과 컨텍스트(대상, 조직)를 모두 검증하세요.
:::

### 검증 로직 추가 \{#add-the-validation-logic}

<Tabs groupId="api-language">
  <TabItem value="node" label="Node.js">
    <NodeAddValidationLogic />
  </TabItem>
  <TabItem value="python" label="Python">
    <PythonAddValidationLogic />
  </TabItem>
  <TabItem value="go" label="Go">
    <GoAddValidationLogic />
  </TabItem>
  <TabItem value="java" label="Java">
    <JavaAddValidationLogic />
  </TabItem>
  <TabItem value="dotnet" label=".NET">
    <DotNetAddValidationLogic />
  </TabItem>
  <TabItem value="php" label="PHP">
    <PhpAddValidationLogic />
  </TabItem>
  <TabItem value="ruby" label="Ruby">
    <RubyAddValidationLogic />
  </TabItem>
  <TabItem value="rust" label="Rust">
    <RustAddValidationLogic />
  </TabItem>
</Tabs>

## 4단계: 미들웨어를 API에 적용 \{#step-4-apply-middleware-to-your-api}

보호하려는 API 라우트에 미들웨어를 적용하세요.

<Tabs groupId="api-language">
  <TabItem value="node" label="Node.js">
    <NodeApplyMiddleware />
  </TabItem>
  <TabItem value="python" label="Python">
    <PythonApplyMiddleware />
  </TabItem>
  <TabItem value="go" label="Go">
    <GoApplyMiddleware />
  </TabItem>
  <TabItem value="java" label="Java">
    <JavaApplyMiddleware />
  </TabItem>
  <TabItem value="dotnet" label=".NET">
    <DotNetApplyMiddleware />
  </TabItem>
  <TabItem value="php" label="PHP">
    <PhpApplyMiddleware />
  </TabItem>
  <TabItem value="ruby" label="Ruby">
    <RubyApplyMiddleware />
  </TabItem>
  <TabItem value="rust" label="Rust">
    <RustApplyMiddleware />
  </TabItem>
</Tabs>

## 5단계: 구현 테스트 \{#step-5-test-your-implementation}

유효한 토큰과 유효하지 않은 토큰으로 API를 테스트하여 다음을 확인하세요:

- 유효한 토큰은 정상적으로 통과하여 접근이 허용됩니다.
- 유효하지 않거나 누락된 토큰에는 `401 Unauthorized`를 반환합니다. 필요한 권한 또는 컨텍스트가 없는 유효한 토큰에는 `403 Forbidden`을 반환합니다.

## 관련 리소스 \{#related-resources}

<Url href="/developers/custom-token-claims">토큰 클레임 커스터마이징</Url>
<Url href="https://openid.net/specs/openid-connect-discovery-1_0.html">
  OpenID Connect Discovery
</Url>
<Url href="https://www.rfc-editor.org/rfc/rfc8707.html">
  RFC 8707: 리소스 지표 (Resource Indicators)
</Url>
