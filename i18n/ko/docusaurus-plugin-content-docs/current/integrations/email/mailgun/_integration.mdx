## 사전 준비 사항 \{#prerequisites}

- [Mailgun](https://www.mailgun.com/) 계정
- Mailgun 계정에서 발급받은 API 키 (메시지(이메일) 전송 권한 필요). 자세한 내용은 [Where Can I Find My API Key and SMTP Credentials?](https://help.mailgun.com/hc/en-us/articles/203380100-Where-Can-I-Find-My-API-Key-and-SMTP-Credentials-)를 참고하세요.

## 기본 구성 \{#basic-configuration}

- 다른 Mailgun API 엔드포인트를 사용하는 경우 `endpoint` 필드를 입력하세요. 예를 들어, EU 지역은 `https://api.eu.mailgun.net`이어야 합니다. 기본값은 `https://api.mailgun.net`입니다.
- `domain` 필드에는 Mailgun 계정에 등록된 도메인을 입력하세요. 이 값은 Mailgun 대시보드의 **Domains** 섹션에서 확인할 수 있습니다. 도메인은 `https://` 또는 `http://` 접두사 없이 `example.com` 형식이어야 합니다.
- `apiKey` 필드에는 Mailgun 계정에서 생성한 API 키를 입력하세요.
- `from` 필드에는 이메일을 발송할 이메일 주소를 입력하세요. 이 이메일 주소는 반드시 Mailgun 계정에 등록되어 있어야 합니다. 이메일 주소는 `Sender Name <sender@example.com>` 형식이어야 합니다.

## Deliveries \{#deliveries}

### Config 객체 \{#config-object}

"Deliveries" 섹션에서는 다양한 상황에서 발송될 이메일의 내용을 구성할 수 있습니다. 이는 JSON 키-값 맵으로, 키는 사용 유형(usage type)이고 값은 발송할 이메일의 콘텐츠 구성을 담고 있는 객체입니다.

```json
{
  "<usage-type>": {
    // ...
  }
}
```

### 사용 유형(Usage types) \{#usage-types}

다음과 같은 사용 유형이 지원됩니다:

- `Register`: 사용자가 회원가입할 때 발송되는 이메일.
- `SignIn`: 사용자가 로그인할 때 발송되는 이메일.
- `ForgotPassword`: 사용자가 비밀번호를 재설정할 때 발송되는 이메일.
- `Generic`: 사용자가 일반적인 작업(예: 이메일 커넥터 테스트)을 수행할 때 발송되는 이메일.

:::note
deliveries 구성에서 사용 유형이 지정되지 않은 경우, generic 이메일이 발송됩니다. generic 이메일도 지정되지 않은 경우, 커넥터는 오류를 반환합니다.
:::

### 콘텐츠 구성(Content config) \{#content-config}

커넥터는 직접 작성한 HTML 콘텐츠와 Mailgun 템플릿 모두를 지원합니다. 각 사용 유형마다 둘 중 하나를 사용할 수 있습니다.

subject와 content 모두에서 `{{code}}` 플레이스홀더를 사용하여 인증 코드를 삽입할 수 있습니다.

직접 HTML 콘텐츠를 사용하려면 다음 필드를 입력하세요:

- `subject`: 발송할 이메일의 제목.
- `replyTo`: 회신용 이메일 주소.
- `html`: (필수) 발송할 이메일의 HTML 콘텐츠.
- `text`: 발송할 이메일의 일반 텍스트 버전.

Mailgun 템플릿을 사용하려면 다음 필드를 입력하세요:

- `subject`: 발송할 이메일의 제목.
- `replyTo`: 회신용 이메일 주소.
- `template`: (필수) 사용할 Mailgun 템플릿의 이름.
- `variables`: Mailgun 템플릿에 전달할 변수들. Mailgun으로 전송되기 전에 문자열로 변환되므로 JSON 키-값 맵이어야 합니다. `code` 변수는 커넥터가 자동으로 추가하므로 별도로 포함할 필요가 없습니다.

### 예시 \{#example}

다음은 deliveries 구성 예시입니다:

```json
{
  "Register": {
    "subject": "{{code}} is your verification code",
    "replyTo": "Foo <foo@bar.com>",
    "html": "<h1>Welcome to Logto</h1><p>Your verification code is {{code}}.</p>",
    "text": "Welcome to Logto. Your verification code is {{code}}."
  },
  "SignIn": {
    "subject": "Welcome back to Logto",
    "replyTo": "Foo <foo@bar.com>",
    "template": "logto-sign-in",
    "variables": {
      "bar": "baz"
    }
  }
}
```
