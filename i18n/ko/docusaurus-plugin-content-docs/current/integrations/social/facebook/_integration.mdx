## 1단계: Facebook App Dashboard에서 앱 설정하기 \{#step-1-set-up-an-app-on-facebook-app-dashboard}

Facebook을 인증 (Authentication) 제공자로 사용하기 전에, Facebook 개발자 플랫폼에서 앱을 설정하여 OAuth 2.0 자격 증명을 받아야 합니다.

1. 아직 계정이 없다면 [Facebook 개발자 등록](https://developers.facebook.com/docs/development/register/)을 하세요.
2. [앱](https://developers.facebook.com/apps) 페이지로 이동하세요.
3. 기존 앱을 클릭하거나 필요하다면 [새 앱을 생성](https://developers.facebook.com/docs/development/create-an-app)하세요.

:::tip
사용 사례(Use case)는 앱이 Meta와 상호작용하는 주요 방식이며, 앱에서 사용할 수 있는 API, 기능, 권한, 제품을 결정합니다. 소셜 인증 (Authentication)만 필요하다면(이메일 및 public_profile 획득), "Authentication and request data from users with Facebook Login"을 선택하세요. Facebook API에 접근하려면 원하는 사용 사례를 선택하세요. 대부분의 경우 앱 생성 후 "Facebook Login for business" 통합도 지원합니다.
:::

4. 앱 생성 후, 앱 대시보드 페이지에서 **Use cases > Facebook Login > Settings** 또는 **Facebook Login for business > Settings**로 이동하세요.
5. **Valid OAuth Redirect URIs**에 Logto **Callback URI**를 입력하세요(Logto Facebook 커넥터에서 복사). 사용자가 Facebook으로 로그인하면, 이곳으로 리디렉션되어 Logto가 인증 (Authentication)을 완료하는 데 필요한 인가 코드가 전달됩니다.
6. **Use cases**로 이동하여 사용 사례의 **Customize**를 클릭해 스코프를 추가하세요. Logto에서 Facebook 로그인을 구현하려면 `email`과 `public_profile` 추가를 권장합니다.

## 2단계: 클라이언트 자격 증명으로 Logto 커넥터 설정 \{#step-2-set-up-logto-connector-with-client-credentials}

1. Facebook App Dashboard에서 사이드바의 **App settings > Basic**을 클릭하세요.
2. 패널에서 **App ID**와 **App secret**을 확인할 수 있습니다.
3. App secret 입력란 옆의 **Show** 버튼을 클릭해 내용을 표시하고 복사하세요.
4. Logto Facebook 커넥터 설정을 구성하세요:
   - `clientId` 필드에 **App ID**를 입력하세요.
   - `clientSecret` 필드에 **App secret**을 입력하세요.
   - Logto에서 **Save and Done**을 클릭해 아이덴티티 시스템을 Facebook과 연결하세요.

## 3단계: 스코프 구성 \{#step-3-configure-scopes}

스코프는 앱이 사용자에게 요청하는 권한을 정의하며, 사용자의 Facebook 계정에서 프로젝트가 접근할 수 있는 개인 데이터 범위를 제어합니다.

### Facebook App Dashboard에서 스코프 구성 \{#configure-scopes-in-facebook-app-dashboard}

1. **Facebook App Dashboard > Use cases**로 이동하여 **Customize** 버튼을 클릭하세요.
2. 앱에 필요한 스코프만 추가하세요. 사용자는 Facebook 동의 화면에서 이 권한을 검토하고 승인합니다:
   - **인증 (Authentication)용(필수)**: `email` 및 `public_profile`
   - **API 접근용(선택)**: 앱에 필요한 추가 스코프(예: Threads API 접근을 위한 `threads_content_publish`, `threads_read_replies`). 사용 가능한 서비스는 [Meta 개발자 문서](https://developers.facebook.com/docs/)를 참고하세요.

### Logto에서 스코프 구성 \{#configure-scopes-in-logto}

필요에 따라 다음 방법 중 하나 이상을 선택하세요:

**옵션 1: 추가 API 스코프가 필요 없는 경우**

- Logto Facebook 커넥터의 `Scopes` 필드를 비워 두세요.
- 기본 스코프 `email public_profile`이 요청되어 Logto가 기본 사용자 정보를 올바르게 가져올 수 있습니다.

**옵션 2: 로그인 시 추가 스코프 요청**

- 원하는 모든 스코프를 **Scopes** 필드에 공백으로 구분하여 입력하세요.
- 여기에 입력한 스코프가 기본값을 덮어쓰므로, 항상 인증 (Authentication) 스코프인 `email public_profile`을 포함하세요.

**옵션 3: 나중에 점진적으로 스코프 요청**

- 사용자가 로그인한 후, 페더레이티드 소셜 인가 (Authorization) 플로우를 다시 시작하고 사용자의 저장된 토큰 세트를 업데이트하여 추가 스코프를 요청할 수 있습니다.
- 이러한 추가 스코프는 Logto Facebook 커넥터의 `Scopes` 필드에 입력할 필요가 없으며, Logto의 Social Verification API를 통해 달성할 수 있습니다.

이 과정을 따르면, Logto Facebook 커넥터는 앱에 꼭 필요한 권한만 요청합니다.

:::tip
앱이 Facebook API에 접근하여 작업을 수행하려면, Logto Facebook 커넥터에서 **Store tokens for persistent API access**를 활성화하세요. 자세한 내용은 다음 섹션을 참고하세요.
:::

## 4단계: 일반 설정 \{#step-4-general-settings}

아래는 Facebook과의 연결을 막지는 않지만, 최종 사용자 인증 (Authentication) 경험에 영향을 줄 수 있는 일반 설정입니다.

### 프로필 정보 동기화 \{#sync-profile-information}

Facebook 커넥터에서 사용자 이름, 아바타 등 프로필 정보 동기화 정책을 설정할 수 있습니다. 선택지는 다음과 같습니다:

- **가입 시에만 동기화**: 사용자가 처음 로그인할 때 한 번만 프로필 정보를 가져옵니다.
- **로그인 시마다 항상 동기화**: 사용자가 로그인할 때마다 프로필 정보를 업데이트합니다.

### Facebook API 접근을 위한 토큰 저장(선택 사항) \{#store-tokens-to-access-facebook-apis-optional}

Facebook API에 접근하여 사용자 인가 (Authorization)로 작업을 수행하려면(소셜 로그인 또는 계정 연동을 통해), Logto가 특정 API 스코프를 받아 토큰을 저장해야 합니다.

1. 위 튜토리얼을 따라 필요한 스코프를 추가하세요.
2. Logto Facebook 커넥터에서 **Store tokens for persistent API access**를 활성화하세요. Logto는 Facebook 액세스 토큰을 Secret Vault에 안전하게 저장합니다.

:::note
Facebook은 리프레시 토큰을 제공하지 않습니다. 하지만 토큰 저장이 활성화되면, Logto는 사용자 인증 (Authentication) 시 자동으로 장기 액세스 토큰(60일)을 요청합니다. 이 기간 동안 사용자는 수동으로 액세스 토큰을 철회할 수 있지만, 그렇지 않으면 Facebook API 접근을 위해 재인가가 필요하지 않습니다. 참고: `offline_access`를 `Scope` 필드에 추가하지 마세요. 오류가 발생할 수 있습니다.
:::

## 5단계: Facebook 테스트 사용자로 로그인 테스트(선택 사항) \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

테스트, 개발자, 관리자 사용자 계정으로 앱 로그인 테스트를 할 수 있습니다. 앱을 바로 게시하여 모든 Facebook 사용자가 로그인할 수 있도록 할 수도 있습니다.

1. Facebook App Dashboard에서 사이드바의 **App roles > Test Users**를 클릭하세요.
2. **Create test users** 버튼을 클릭해 테스트 사용자를 생성하세요.
3. 기존 테스트 사용자의 **Options** 버튼을 클릭하면 "이름 및 비밀번호 변경" 등 추가 작업을 할 수 있습니다.

## 6단계: Facebook 로그인 설정 게시 \{#step-6-publish-facebook-sign-in-settings}

일반적으로 테스트, 관리자, 개발자 사용자만 앱으로 로그인할 수 있습니다. 실제 환경에서 일반 Facebook 사용자가 앱으로 로그인할 수 있도록 하려면 앱을 게시해야 할 수 있습니다.

1. Facebook App Dashboard에서 사이드바의 **Publish**를 클릭하세요.
2. 필요하다면 **Privacy Policy URL** 및 **User data deletion** 필드를 입력하세요.
3. 오른쪽 하단의 **Save changes** 버튼을 클릭하세요.
4. 앱 상단 바의 **Live** 스위치 버튼을 클릭하세요.
