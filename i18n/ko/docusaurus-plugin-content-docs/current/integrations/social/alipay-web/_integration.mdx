## Alipay 개발자 계정 등록하기 \{#register-alipay-developer-account}

[Alipay 개발자 계정 등록](https://certifyweb.alipay.com/certify/reg/guide#/)을 아직 하지 않았다면 진행하세요.

## Alipay 앱 생성 및 구성하기 \{#create-and-configure-alipay-app}

1. 방금 등록한 계정으로 [Alipay 콘솔](https://open.alipay.com/)에 로그인하세요.
2. "내 애플리케이션" (我的应用) 패널의 "웹 & 모바일 애플리케이션" (网页&移动应用) 탭으로 이동하세요.
3. "앱 생성" (立即创建) 버튼을 클릭하여 애플리케이션 구성을 시작하세요.
4. "애플리케이션 이름" (应用名称)에 명명 규칙을 따라 이름을 입력하고, "애플리케이션 아이콘" (应用图标)을 업로드하세요. "앱 유형" (应用类型)으로 "웹 애플리케이션" (网页应用)을 선택해야 합니다.
5. 애플리케이션 생성을 완료하면, 개요 페이지로 이동합니다. 여기서 "기능 추가" (添加能力)를 클릭하여 "타사 애플리케이션 인가" (第三方应用授权), "회원 정보 가져오기" (获取会员信息), "앱 Alipay 로그인" (App 支付宝登录)을 추가해야 Alipay 로그인을 활성화할 수 있습니다.
6. [Alipay 고객 센터](https://b.alipay.com/index2.htm)로 이동하여 Alipay 개발자 계정으로 로그인하세요. 상단바에서 "계정 센터" (账号中心)를 클릭하고, 사이드바 하단에서 "APPID 바인딩" (APPID 绑定)으로 이동하세요. 4단계에서 생성한 웹 애플리케이션의 APPID를 입력하여 "바인딩 추가" (添加绑定)를 진행하세요.
7. "App Alipay 로그인"의 "서명" 버튼을 클릭하고 안내에 따라 서명 과정을 완료하세요. 이 단계를 마치면 5단계에서 추가한 기능들이 활성화된 것을 확인할 수 있습니다.
8. Alipay 오픈 플랫폼 콘솔 페이지로 돌아가 "개발 정보" (开发信息) 섹션에서 "인터페이스 서명 방식" (接口加签方式（密钥/证书）)을 찾을 수 있습니다. "설정" (设置) 버튼을 클릭하면 서명 방식을 설정하는 페이지로 이동합니다. "공개 키" (公钥)가 권장 서명 방식이며, 생성한 공개 키 파일의 내용을 텍스트 입력란에 입력하세요.
9. Alipay 콘솔 페이지 하단의 "설정" (设置) 버튼을 클릭하여 "인가 리디렉션 URI" (授权回调地址)를 설정하세요. `${your_logto_origin}/callback/${connector_id}`는 Logto 코어에서 사용하는 기본 리디렉션 URI입니다. `connector_id`는 Logto Admin Console 커넥터 상세 페이지 상단에서 확인할 수 있습니다.
10. 모든 단계를 완료한 후, Alipay 콘솔 페이지 우측 상단에서 "검토 제출" (提交审核)을 클릭하세요. 검토가 승인되면 원활한 Alipay 로그인 플로우를 사용할 수 있습니다.

:::note

- openssl \*을 사용하여 로컬 컴퓨터에서 다음 코드 스니펫을 터미널에 실행하여 키 쌍을 생성할 수 있습니다.

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Alipay 앱 설정 웹사이트에서 공개 키를 입력할 때, `public.pem`의 헤더와 푸터를 제거하고 모든 줄바꿈 문자를 삭제한 후, 나머지 내용을 "공개 키" 입력란에 붙여넣어야 합니다.

:::

## Logto Alipay Web 커넥터 설정하기 \{set-up-the-logto-alipay-web-connector-settings}

1. [Alipay 콘솔 작업 공간](https://open.alipay.com/dev/workspace)에서 "내 애플리케이션" (我的应用) 패널로 이동한 후 "웹 & 모바일 애플리케이션" (网页&移动应用) 탭을 클릭하면 모든 애플리케이션의 APPID를 확인할 수 있습니다.
2. 앞선 7단계에서 이미 개인 키와 공개 키를 포함한 키 쌍을 생성했습니다.
3. Logto 커넥터 설정을 작성하세요:
   - 1단계에서 얻은 APPID로 `appId` 필드를 입력하세요.
   - 2단계에서 언급한 개인 키 파일의 내용으로 `privateKey` 필드를 입력하세요. 반드시 모든 줄바꿈 문자를 '\n'으로 대체하고, 개인 키 파일의 헤더와 푸터는 제거하지 마세요.
   - "Create And Configure Alipay Apps"의 7단계에서 선택한 `Public key` 서명 방식에 따라 `signType` 필드는 'RSA2'로 입력하세요.
   - `charset` 필드는 'gbk' 또는 'utf8' 중 하나로 입력할 수 있습니다. 이 필드는 선택 사항이며, 기본값은 'utf8'입니다.
   - `scope` 필드는 'auth_base' 또는 'auth_user' 중 하나로 입력할 수 있습니다. 이 필드 역시 선택 사항이며, 기본값은 'auth_user'입니다. [차이점](https://opendocs.alipay.com/fw/api/105942)을 참고하세요.

### 설정 타입 \{#config-types}

| 이름       | 타입               | Enum 값                    |
| ---------- | ------------------ | -------------------------- |
| appId      | string             | N/A                        |
| privateKey | string             | N/A                        |
| signType   | enum string        | 'RSA' / 'RSA2'             |
| charset    | enum string (선택) | 'gbk' / 'utf8' / undefined |
| scope      | enum string (선택) | 'auth_user' / 'auth_base'  |
