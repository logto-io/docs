## WeChat 오픈 플랫폼에서 모바일 앱 생성하기 \{#create-a-mobile-app-in-the-wechat-open-platform}

:::tip

이미 완료한 부분이 있다면 일부 섹션을 건너뛸 수 있습니다.

:::

### 계정 생성하기 \{#create-an-account}

https://open.weixin.qq.com/ 에 접속하여 오른쪽 상단의 "Sign Up" 버튼을 클릭한 후, 회원가입 절차를 완료하세요.

### 모바일 앱 생성하기 \{#create-a-mobile-app}

방금 생성한 계정으로 로그인하세요. "모바일 애플리케이션" (移动应用) 탭에서 큰 초록색 버튼 "모바일 앱 생성" (创建移动应用)을 클릭하세요.

<img src="/img/assets/app-tabs.png" alt="App tabs" />

이제 애플리케이션 양식에 필수 정보를 입력해봅시다.

<img src="/img/assets/create-mobile-app.png" alt="Create mobile app" />

#### 기본 정보 \{#basic-info}

대부분은 매우 직관적이지만, 몇 가지 팁을 드립니다:

- WeChat 로그인을 테스트만 하고 앱이 App Store에 등록되어 있지 않다면, "앱 사용 가능 여부" 섹션에서 "아니오"를 선택하여 "앱 다운로드 링크"를 건너뛸 수 있습니다.
- "앱 운영 흐름도"는 다소 까다로워 보일 수 있습니다. 경험상, 간단한 플로우차트와 몇 장의 앱 스크린샷을 준비하면 심사 통과 가능성이 높아집니다.

"다음 단계"를 클릭하여 진행하세요.

#### 플랫폼 정보 \{#platform-info}

Logto와 WeChat 네이티브 로그인을 통합하려면 iOS와 Android 중 하나 또는 둘 다를 설정할 수 있습니다.

**iOS 앱**

"iOS 앱" (iOS 应用)을 체크한 후, 앱의 대상 기기 유형을 선택하세요.

<img src="/img/assets/platform.png" alt="App platform" />

App Store 등록 여부에서 "아니오"를 선택했다면, 여기서 "AppStore 다운로드 주소" 입력을 건너뛸 수 있습니다.

_Bundle ID_, _테스트 버전 Bundle ID_, *Universal Links*를 입력하세요 (사실상 링크는 하나만 필요합니다 😂).

:::note

*Bundle ID*와 *테스트 버전 Bundle ID*는 동일한 값을 사용할 수 있습니다.

:::

:::tip

WeChat 네이티브 로그인을 위해서는 universal link가 필요합니다. 아직 설정하지 않았거나 잘 모른다면 [Apple 공식 문서](https://developer.apple.com/ios/universal-links/)를 참고하세요.

:::

**Android 앱**

"Android 앱" (Android 应用)을 체크하세요.

<img src="/img/assets/platform-android-app.png" alt="Android app platform" />

_애플리케이션 서명_ (应用签名)과 _애플리케이션 패키지명_ (应用包名)을 입력하세요.

:::note

앱에 서명을 해야 서명 값을 얻을 수 있습니다. 자세한 내용은 [앱 서명하기](https://developer.android.com/studio/publish/app-signing)를 참고하세요.

:::

서명 후, `signingReport` 태스크를 실행하여 서명 값을 얻을 수 있습니다.

```bash
./gradlew your-android-project:signingReport
```

해당 빌드 변형의 리포트에서 `MD5` 값을 _애플리케이션 서명_ (应用签名)으로 사용하면 됩니다. 단, 값에서 모든 세미콜론을 제거하고 소문자로 변환하세요.

예시: `1A:2B:3C:4D` -> `1a2b3c4d`.

#### 심사 결과 대기 \{#waiting-for-the-review-result}

플랫폼 정보를 모두 입력한 후 "심사 제출"을 클릭하여 계속 진행하세요. 보통 심사는 빠르게 진행되며 1~2일 내에 끝납니다.

심사 기준이 유동적이어서 제출할 때마다 심사자가 무작위로 배정되는 것으로 보입니다. 처음에 거절될 수도 있지만 포기하지 마세요! 현재 상황을 설명하고 심사자에게 어떻게 수정해야 하는지 문의하세요.

## 앱에서 WeChat 네이티브 로그인 활성화하기 \{#enable-wechat-native-sign-in-in-your-app}

### iOS \{#ios}

앱에 <MainSiteUrl href="/quick-starts/swift">Logto iOS SDK</MainSiteUrl>를 이미 통합했다고 가정합니다. 이 경우 매우 간단하며, WeChat SDK 문서를 읽을 필요도 없습니다:

**1. Xcode 프로젝트에서 universal link 및 URL scheme 설정**

Xcode 프로젝트 -> Signing & Capabilities 탭에서 "Associated Domains" 기능을 추가하고, 앞서 설정한 universal link를 입력하세요.

<img src="/img/assets/universal-link.png" alt="Universal link" />

그 다음 "Info" 탭으로 이동하여 [커스텀 URL scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app)을 WeChat App ID로 추가하세요.

<img src="/img/assets/custom-url-scheme.png" alt="Custom URL scheme" />

마지막으로 `Info.plist`를 열어 `LSApplicationQueriesSchemes` 아래에 `weixinULAPI`와 `weixin`을 추가하세요.

<img src="/img/assets/plist.png" alt="Plist" />

:::note

이 작업들이 다소 비합리적으로 느껴질 수 있지만, 저희가 찾은 최소한의 동작 솔루션입니다. 자세한 내용은 [마법 같은 공식 가이드](https://developers.weixin.qq.com/doc/oplatform/en/Mobile_App/Access_Guide/iOS.html)를 참고하세요.

:::

**2. Xcode 프로젝트에 `LogtoSocialPluginWechat` 추가**

프레임워크를 추가하세요:

<img src="/img/assets/add-framework.png" alt="Add framework" />

그리고 Build Settings > Linking > Other Linker Flags에 `-ObjC`를 추가하세요:

<img src="/img/assets/linker-flags.png" alt="Linker flags" />

:::note

이 플러그인에는 WeChat Open SDK 1.9.2가 포함되어 있습니다. 플러그인을 임포트하면 바로 `import WechatOpenSDK`를 사용할 수 있습니다.

:::

**3. `LogtoClient` 초기화 옵션에 플러그인 추가**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginWechat()]
)
```

**4. `onOpenURL`을 올바르게 처리하기**

:::note

`LogtoClient.handle(url:)` 함수는 활성화한 모든 네이티브 커넥터를 처리합니다. 한 번만 호출하면 됩니다.

:::

```swift
// SwiftUI
YourRootView()
  .onOpenURL { url in
      LogtoClient.handle(url: url)
  }

// 또는 AppDelegate
func application(_ app: UIApplication, open url: URL, options: /*...*/) -> Bool {
  LogtoClient.handle(url: url)
}
```

### Android \{#android}

앱에 <MainSiteUrl href="/quick-starts/android">Logto Android SDK</MainSiteUrl>를 이미 통합했다고 가정합니다. 이 경우 매우 간단하며, WeChat SDK 문서를 읽을 필요도 없습니다:

**1. 프로젝트에 `Wechat Open SDK` 추가**

Gradle 프로젝트의 repositories에 `mavenCentral()`이 포함되어 있는지 확인하세요:

```kotlin
repositories {
  // ...
  mavenCentral()
}
```

의존성에 Wechat Open SDK를 추가하세요:

```kotlin
dependencies {
  // ...
  api("com.tencent.mm.opensdk:wechat-sdk-android:6.8.0")  // kotlin-script
  // 또는
  api 'com.tencent.mm.opensdk:wechat-sdk-android:6.8.0'   // groovy-script
}
```

**2. 프로젝트에 `WXEntryActivity` 추가**

패키지 루트 아래에 `wxapi` 패키지를 만들고, 그 안에 `WXEntryActivity`를 추가하세요 (`com.sample.app` 예시):

```kotlin
// WXEntryActivity.kt
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

class WXEntryActivity: WechatSocialResultActivity()
```

```java
// WXEntryActivity.java
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

public class WXEntryActivity extends WechatSocialResultActivity {}
```

프로젝트 내에서 `WXEntryActivity`의 최종 위치는 다음과 같아야 합니다 (Kotlin 예시):

```bash
src/main/kotlin/com/sample/app/wxapi/WXEntryActivity.kt
```

**3. `AndroidManifest.xml` 수정**

`AndroidManifest.xml`에 다음 라인을 추가하세요:

```xml
\<?xml version="1.0" encoding="utf-8"?>
\<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.sample.app">

  \<application>
    \<!-- 추가할 라인 -->
    \<activity android:name=".wxapi.WXEntryActivity" android:exported="true"/>
  \</application>

\</manifest>
```
