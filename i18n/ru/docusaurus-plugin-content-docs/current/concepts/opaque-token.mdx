---
sidebar_position: 6
---

# Непрозрачный токен

Во время процесса аутентификации, если ресурс не указан, Logto выдаст непрозрачный токен доступа вместо JWT. Непрозрачный токен — это случайная строка, и он значительно короче, чем JWT:

```json
{
  "access_token": "some-random-string", // непрозрачный токен
  "expires_in": 3600,
  "id_token": "eyJhbGc...aBc", // JWT
  "scope": "openid profile email",
  "token_type": "Bearer"
}
```

Непрозрачный токен может быть использован для вызова [userinfo endpoint](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) и для доступа к защищенным ресурсам, требующим аутентификации. Поскольку это не JWT, как сервер ресурса может его проверить?

Logto предоставляет [интроспекционный endpoint](https://www.rfc-editor.org/rfc/rfc7662.html), который может быть использован для проверки непрозрачных токенов. По умолчанию, интроспекционный endpoint — это `/oidc/token/introspection` и принимает `POST` запросы. Требуется следующий параметр:

- `token`: непрозрачный токен для проверки

Endpoint также требует аутентификации клиента. Вы можете использовать один из следующих методов:

- HTTP Basic аутентификация: Используйте заголовок `Authorization` со значением `Basic <base64-encoded-credentials>`. Учетные данные должны быть client ID и client secret, разделенные двоеточием (`:`) и закодированные в base64.
- HTTP POST аутентификация: Используйте параметры `client_id` и `client_secret`:
  - `client_id`: client ID приложения, запросившего токен
  - `client_secret`: client secret приложения, запросившего токен

Client ID (app ID) и client secret (app secret) могут быть учетными данными приложения из любого "традиционного веб" или "машина-машина" приложения в Logto. Интроспекционный endpoint вернет ошибку, если учетные данные недействительны.

Интроспекционный endpoint возвращает JSON объект с утверждениями токена:

```json
{
  "active": true, // является ли токен действительным или нет
  "sub": "1234567890" // субъект токена (ID пользователя)
}
```

Если токен недействителен, поле `active` будет `false`, и поле `sub` будет опущено.

Вот ненормативный пример запроса интроспекции:

```bash
curl --location \
  --request POST 'https://[tenant-id].logto.app/oidc/token/introspection' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'token=some-random-string' \
  --data-urlencode 'client_id=1234567890' \
  --data-urlencode 'client_secret=1234567890'
```

Не забудьте заменить `[tenant-id]` на ваш tenant ID.
