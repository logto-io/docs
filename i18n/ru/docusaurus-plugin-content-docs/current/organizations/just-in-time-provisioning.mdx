---
sidebar_position: 4
---

import jitConflictImage from './assets/jit-conflict.webp';
import jitEmailImage from './assets/jit-email.webp';
import jitSsoImage from './assets/jit-sso.webp';

# Just-in-Time подготовка

В Logto [Just-in-Time (JIT) подготовка](https://auth.wiki/jit-provisioning) — это процесс, используемый для назначения членства в организациях и ролей пользователям на лету, когда они впервые входят в систему. Вместо предварительной подготовки учетных записей для пользователей заранее, JIT подготовка динамически настраивает необходимые учетные записи пользователей, когда пользователь проходит аутентификацию.

## Как это работает \{#how-it-works}

Вот краткий обзор процесса JIT подготовки:

1. **Аутентификация пользователя**: Пользователь пытается войти в приложение или сервис, и провайдер идентификации (Logto) аутентифицирует пользователя.
2. **Вход в учетную запись или создание**: В зависимости от статуса пользователя, Logto либо входит в учетную запись пользователя, создает новую учетную запись, либо добавляет новую идентичность к существующей учетной записи.
3. **Подготовка**: Если пользователь или его идентичность новые, Logto запускает процесс подготовки.

Вот подробная блок-схема JIT подготовки:

JIT подготовка — полезная функция для [B2B](/introduction/plan-your-architecture/b2b) и продуктов с мультитенантностью. Она делает процесс интеграции участников арендатора плавным и не требует административного вмешательства.

Например, если вы подключили бизнес и хотите, чтобы его сотрудники безопасно входили в ваш продукт и присоединялись к организации с правильным доступом к ролям, есть несколько способов достичь этого. Давайте рассмотрим возможные решения, которые предоставляет Logto, и как JIT может помочь.

| Сценарий                                              | Типы пользователей   | Автоматизировано | Поведение                                                                                                                                                                                                           |
| ----------------------------------------------------- | -------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Приглашение администратора                            | Новые и существующие |                  | Пользователи могут [получить приглашение по электронной почте](/end-user-flows/organization-experience/invite-organization-members) для присоединения к организации.                                                |
| Создание или импорт пользователя через Management API | Новые и существующие |                  | Пользователи могут использовать [предварительно созданную учетную запись](/end-user-flows/sign-up-and-sign-in/disable-user-registration#implement-an-invitation-only-sign-up-flow) для присоединения к организации. |
| Just-in-time подготовка через SSO                     | Новые и существующие | ✅               | Пользователи, которые впервые входят через [SSO](/end-user-flows/enterprise-sso), могут присоединиться к организации.                                                                                               |
| Just-in-time подготовка по домену электронной почты   | Новые                | ✅               | Пользователи с определенными проверенными доменами, которые впервые входят, могут присоединиться к организации.                                                                                                     |
| Синхронизация директории                              | Новые и существующие | ✅               | Используйте функцию синхронизации директории IdP для предварительной подготовки пользователей в приложении.                                                                                                         |

В настоящее время Logto поддерживает **Just-in-time подготовку через SSO** и **Just-in-time подготовку по домену электронной почты**.

### Преимущества JIT подготовки \{#benefits-of-jit-provisioning}

JIT подготовка предлагает несколько преимуществ:

1. **Эффективность**: Снижает административные затраты на ручное создание и управление учетными записями пользователей.
2. **Масштабируемость**: Автоматически обрабатывает создание учетных записей для большого количества пользователей без предварительной настройки.
3. **Реальное время**: Обеспечивает доступ пользователей к ресурсам сразу после аутентификации, без задержек.

Мы реализовали функции JIT на самом масштабируемом и безопасном уровне, чтобы упростить и ускорить процесс подготовки для вас. Однако, поскольку системы подготовки могут быть сложными и адаптированными к специфическим потребностям ваших клиентов, важно сочетать предустановленные функции JIT Logto, ваш тщательный дизайн системы и Logto Management API. Этот интегрированный подход поможет вам создать надежную и эффективную систему подготовки.

### Различия между JIT и синхронизацией директории \{#differences-between-jit-and-directory-sync}

- **JIT подготовка** запускается действиями, инициированными пользователем, в то время как **синхронизация директории** может быть как инициированной пользователем, так и системой (запланированной или в реальном времени).
- **JIT подготовка** не обеспечивает членство или назначение ролей, в то время как **синхронизация директории** может их обеспечивать.
- **JIT подготовка** более подходит для интеграции новых пользователей независимо от источника идентичности пользователя, в то время как **синхронизация директории** более подходит для управляемых учетных записей пользователей.

Вкратце, JIT подготовка — это более гибкий и удобный для пользователя подход к интеграции пользователей, так как она может дать пользователям свободу присоединяться или покидать организации и позволяет вам управлять существующими пользователями по своему усмотрению.

## Just-in-time подготовка в Logto \{#just-in-time-provisioning-in-logto}

:::note

Just-in-time (JIT) подготовка запускается только для действий, инициированных пользователем, и не влияет на взаимодействия с Logto Management API.

:::

Перейдите в <CloudLink to="/organizations">Консоль > Организации</CloudLink>. Вы можете настроить JIT подготовку на странице деталей организации.

### Подготовка через корпоративный SSO \{#enterprise-sso-provisioning}

Если у вас настроен [корпоративный SSO](/end-user-flows/enterprise-sso) в Logto, вы можете выбрать корпоративный SSO вашей организации, чтобы включить just-in-time подготовку.

Когда выполняется одно из следующих условий:

- Новые пользователи входят через корпоративный SSO;
- Существующие пользователи впервые входят через корпоративный SSO.

Они автоматически присоединяются к организации и получают роли по умолчанию в организации.

<center>
  <img src={jitSsoImage} width="100%" alt="JIT SSO" />
</center>

### Подготовка по домену электронной почты \{#email-domain-provisioning}

Если у вашего клиента нет выделенного корпоративного SSO, вы все равно можете использовать домены электронной почты для just-in-time подготовки.

Когда пользователь регистрируется, если его проверенный адрес электронной почты соответствует настроенным JIT доменам электронной почты на уровне организации, он будет подготовлен к соответствующим организациям с соответствующими ролями.

<center>
  <img src={jitEmailImage} width="100%" alt="JIT email" />
</center>

Сопоставление адресов может распознавать проверенный адрес электронной почты из всех источников идентичности, не относящихся к корпоративному SSO, включая:

1. [Регистрация по электронной почте](/end-user-flows/sign-up-and-sign-in/sign-up) аутентификация
2. [Регистрация через социальные сети](/end-user-flows/sign-up-and-sign-in/social-sign-in) аутентификация

:::note

**Почему подготовка по домену электронной почты не применяется к процессу входа существующих пользователей?**

Вход существующих пользователей требует дальнейшего контроля, чтобы определить, могут ли они быть подготовлены к конкретной организации или получить роль. Этот процесс динамичен и зависит от конкретных случаев использования и бизнес-потребностей, таких как частота входа и политики на уровне организации.

Например, если вы включаете подготовку по домену электронной почты для существующего пользователя и позже хотите подключить другую группу пользователей с другой ролью, следует ли ранее подключенному пользователю назначить новую роль, которую вы настроили? Это создает сложный сценарий для «обновлений just-in-time». Точное поведение часто зависит от того, как настроено приложение и интеграция IdP. Мы предоставляем этот контроль вам, позволяя вам свободно разрабатывать вашу систему подготовки и обрабатывать наиболее частые сценарии для создания новых учетных записей и интеграции организаций.

:::

#### Опыт входа по электронной почте, когда включена подготовка по домену электронной почты \{#email-sign-in-experience-when-email-domain-provisioning-is-enabled}

| Статус пользователя                                                                                    | Описание                                                                                                       |
| ------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------- |
| Пользователь не существует и регистрируется по электронной почте                                       | Пользователь создается и автоматически присоединяется к соответствующей организации с соответствующими ролями. |
| Пользователь существует с тем же проверенным адресом электронной почты, что и домены электронной почты | Обычный опыт входа по электронной почте.                                                                       |

#### Опыт входа через социальные сети, когда включена подготовка по домену электронной почты \{#social-sign-in-experience-when-email-domain-provisioning-is-enabled}

| Статус пользователя                                                                                                                                | Описание                                                                                                       |
| -------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| Пользователь не существует, регистрируется через социальную сеть с использованием проверенной электронной почты                                    | Пользователь создается и автоматически присоединяется к соответствующей организации с соответствующими ролями. |
| Пользователь не существует, регистрируется через социальную сеть с использованием непроверенной электронной почты или без нее                      | Обычный опыт регистрации через социальные сети.                                                                |
| Пользователь существует с тем же проверенным адресом электронной почты, что и домены электронной почты, входит через новую социальную идентичность | Обычный опыт входа через социальные сети.                                                                      |

### Обработка потенциального конфликта между методами JIT подготовки \{#handling-the-potential-conflict-between-jit-provisioning-methods}

Если вы изначально настроили подготовку по домену электронной почты, а затем настроили корпоративный SSO с тем же доменом электронной почты, вот что произойдет:

Когда пользователь вводит свой адрес электронной почты, он будет перенаправлен к провайдеру идентификации SSO, обходя аутентификацию по электронной почте. Это означает, что подготовка по домену электронной почты не будет запущена.

Чтобы решить эту проблему, мы покажем предупреждающее сообщение при настройке. Убедитесь, что вы обрабатываете этот случай, выбрав правильный коннектор SSO для включения корпоративной подготовки SSO, и не полагайтесь на подготовку по домену электронной почты.

<center>
  <img src={jitConflictImage} width="100%" alt="JIT conflict" />
</center>

## Роли организации по умолчанию \{#default-organization-roles}

При подготовке пользователей в организации вы можете установить их роли по умолчанию в организации. Список ролей берется из [шаблона организации](/authorization/organization-template#organization-role), и вы можете выбрать роль или оставить ее пустой.

## Связанные ресурсы \{#related-resources}

<Url href="https://blog.logto.io/jit-provisioning">Понимание Just-in-Time подготовки</Url>
