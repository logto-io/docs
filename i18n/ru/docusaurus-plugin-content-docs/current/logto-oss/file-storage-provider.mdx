---
sidebar_position: 6
---

# Провайдер хранения файлов

По умолчанию Logto Console использует текстовое поле для URL статических файлов, таких как аватары. Чтобы включить более интуитивный опыт загрузки файлов с помощью перетаскивания, необходимо настроить провайдера хранения.

Logto поддерживает несколько провайдеров хранения, включая AWS S3 и Azure Storage. Этот рецепт покажет вам, как настроить провайдера хранения для Logto.

Конфигурация хранится в таблице `systems` базы данных, но рекомендуется использовать CLI для настройки провайдера хранения. Для получения дополнительной информации попробуйте команду "help":

```sh
pnpm logto db system --help
```

## Azure Storage \{#azure-storage}

Azure Storage — это мощное и масштабируемое облачное решение для хранения данных, которое позволяет хранить и управлять вашими данными в облаке. Следующий рецепт покажет вам, как настроить Azure Storage в качестве провайдера хранения для Logto.

### Предварительные требования \{#prerequisites}

- [Аккаунт Azure Storage](https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview)

### Настройка с использованием CLI \{#config-using-cli}

Пример использования:

```
pnpm logto db system set storageProvider '{"provider":"AzureStorage","connectionString":"DefaultEndpointsProtocol=https;AccountName=logto;AccountKey=oRhfTBHOHiBxxxxxxxxxxxxxxxxZ0se6XROftl/Xrow==;EndpointSuffix=core.windows.net","container":"logto"}'
```

#### `connectionString` \{#connectionstring}

Для доступа к Azure Storage необходимо использовать строку подключения, которая представляет собой строку символов, содержащую необходимую информацию для установления соединения с вашим аккаунтом хранения.

Чтобы получить строку подключения, следуйте официальной [документации по строке подключения Azure Storage](https://docs.microsoft.com/en-us/azure/storage/common/storage-configure-connection-string).

#### `container` \{#container}

Контейнер — это ресурс хранения, который хранит блобы. Вы можете использовать контейнер для организации ваших блобов и управления доступом к вашим данным.

Чтобы создать контейнер, следуйте официальной [документации по контейнерам Azure Storage](https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction#containers).

#### `publicUrl` \{#publicurl}

Необязательно.

Публичный URL — это URL, который можно использовать для публичного доступа к ресурсу хранения. Если вы не используете CDN, вы можете оставить это поле пустым, чтобы использовать "Основную конечную точку" Azure Storage в качестве публичного URL. Logto получит это значение из "connectionString" с помощью Azure SDK. Чтобы узнать больше о вашей основной конечной точке аккаунта хранения, следуйте официальной [документации по основной конечной точке Azure Storage](https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview#primary-endpoints).

## S3 Storage \{#s3-storage}

S3 Storage — это облачный сервис хранения, который предлагает объектное хранение через веб-сервисный интерфейс. Следующий рецепт покажет вам, как настроить S3 Storage в качестве провайдера хранения для Logto.

### Предварительные требования \{#prerequisites-1}

- [Аккаунт S3 Storage](https://docs.aws.amazon.com/AmazonS3/latest/userguide/creating-buckets.html) или другой совместимый с S3 сервис хранения, такой как [MinIO](https://min.io/)

### Настройка с использованием CLI \{#config-using-cli-1}

Пример использования:

```
pnpm logto db system set storageProvider '{"provider":"S3Storage","accessKeyId":"my-access-key-id","accessSecretKey": "my-secret-access-key","bucket":"logto","endpoint":"https://s3.us-east-2.amazonaws.com"}'
```

#### `accessKeyId` \{#accesskeyid}

Идентификатор ключа доступа — это идентификатор вашего аккаунта AWS. Чтобы найти ваш идентификатор ключа доступа для вашего аккаунта AWS, следуйте официальной [документации по идентификатору ключа доступа AWS](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey).

#### `accessSecretKey` \{#accesssecretkey}

Секретный ключ доступа используется вместе с идентификатором ключа доступа для подписания программных запросов. Чтобы найти ваш секретный ключ доступа для вашего аккаунта AWS, следуйте официальной [документации по секретному ключу доступа AWS](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey).

#### `bucket` \{#bucket}

Бакет — это контейнер для объектов, хранящихся в Amazon S3. Чтобы создать бакет, следуйте официальной [документации по бакетам AWS S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/creating-buckets.html).

#### `region` \{#region}

Необязательно.

Регион — это географический регион, где расположен бакет AWS S3. Если `endpoint` является стандартной конечной точкой AWS S3, он может быть извлечен из `endpoint`. Чтобы найти ваш регион AWS S3, следуйте официальной [документации по регионам AWS S3](https://docs.aws.amazon.com/general/latest/gr/s3.html).

Если вы используете совместимый с S3 сервис хранения, вы можете оставить это поле пустым.

#### `endpoint` \{#endpoint}

Необязательно.

Конечная точка — это URL, который используется для доступа к сервису AWS S3. Чтобы найти вашу конечную точку AWS S3, следуйте официальной [документации по конечным точкам AWS S3](https://docs.aws.amazon.com/general/latest/gr/s3.html).

Вы можете оставить это поле пустым, чтобы использовать конечную точку по умолчанию для региона. Если вы используете совместимый с S3 сервис хранения, вы можете использовать конечную точку этого сервиса.

#### `publicUrl` \{#publicurl-1}

Необязательно.

Публичный URL — это URL, который можно использовать для публичного доступа к ресурсу хранения. Если вы не используете CDN, вы можете оставить это поле пустым, чтобы использовать URL по умолчанию для S3 Storage.

## Google Cloud Storage \{#google-cloud-storage}

Google Cloud Storage — это облачный сервис хранения, который предоставляет объектное хранение через веб-сервисный интерфейс. Следующее руководство покажет вам, как настроить Google Cloud Storage в качестве провайдера хранения для Logto.

### Предварительные требования \{#prerequisites-2}

- Проект Google Cloud
- Бакет, обратитесь к официальной документации Google Cloud: https://cloud.google.com/storage/docs/creating-buckets.

### Получение файла ключа \{#obtain-the-key-file}

Google Cloud SDK обычно используют "файл ключа". Если вы не знакомы с Google Cloud, это может быть самой сложной частью. Вот как его получить:

1. Перейдите на страницу аккаунтов сервиса: https://console.cloud.google.com/iam-admin/serviceaccounts
2. Создайте аккаунт, введите имя и продолжите.
3. На следующем шаге выберите роль "Storage Object User". Вы можете найти ее с помощью фильтра.
4. После завершения создания аккаунта перейдите на страницу деталей аккаунта и выберите вкладку "ключи".
5. Нажмите "добавить ключ", выберите "создать новый ключ", выберите "json" в диалоге и затем скачайте ваш json файл.

### Добавление файла ключа в Logto \{#add-the-key-file-to-logto}

Logto должен иметь доступ к файлу ключа.

**Запуск в Node.js**

Скопируйте файл в `/path/to/logto/core` и переименуйте его в `google-storage-key.json`.

**Запуск в Docker контейнере**

Если вы запускаете Logto в Docker контейнере, вам нужно будет смонтировать файл в контейнер. Предполагая, что вы используете Docker Compose, добавьте это в вашу конфигурацию:

```yaml
volumes:
  - ./path/to/google-storage-key.json:/etc/logto/core/google-storage-key.json
```

Не забудьте заменить `/path/to` на фактический путь.

### Настройка с использованием CLI \{#config-using-cli-2}

Пример использования:

```
pnpm logto db system set storageProvider '{"provider":"GoogleStorage","projectId":"psychic-trainer-403801","keyFilename":"google-storage-key.json","bucketName":"logto-test2"}'
```

#### `projectId` \{#projectid}

Ваш идентификатор проекта Google Cloud.

#### `keyFilename` \{#keyfilename}

Имя файла ключа, если вы следовали вышеуказанным шагам, то это `google-storage-key.json`.

#### `bucketName` \{#bucketname}

Имя бакета.

#### `publicUrl` \{#publicurl-2}

Необязательно.

Публичный URL — это URL, который можно использовать для публичного доступа к ресурсу хранения. Если вы не используете CDN, вы можете оставить это поле пустым, чтобы использовать URL по умолчанию для S3 Storage.
