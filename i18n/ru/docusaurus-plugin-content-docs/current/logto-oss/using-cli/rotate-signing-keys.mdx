import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

# Поворот ключей подписи (OSS)

:::note
Если вы используете Logto Cloud, вы можете вращать ключи подписи в интерфейсе Console UI, пожалуйста, обратитесь к [этому руководству](/developers/signing-keys/#rotate-signing-keys-from-console-ui).
:::

Logto OSS поддерживает вращение ключей подписи с версии v1.8.

Ключи подписи Logto OIDC, также известные как «OIDC private keys» и «OIDC cookie keys», это ключи подписи, используемые для шифрования JWT токенов (токенов доступа и ID токенов) и файлов cookie браузера в сеансах входа Logto.

Регулярное вращение ваших ключей подписи может снизить риски потенциального компрометации ключей. Logto рекомендует вращать ваши ключи подписи как минимум раз в год.

## Вращение OIDC private signing keys \{#rotate-oidc-private-signing-keys}

Используйте команду CLI ниже, чтобы сгенерировать новый OIDC private signing key. Новый ключ будет автоматически использован после перезагрузки.

Доступные опции:

```
--type    (Необязательно) Алгоритм ключа подписи для ваших JWT токенов.
          Значения: "rsa" или "ec". По умолчанию "ec".
```

<Tabs groupId="cmd">

  <TabItem value="cli" label="CLI">

```bash
logto db config rotate oidc.privateKeys --type rsa
```

  </TabItem>
  <TabItem value="Local" label="local">

```bash
npm run cli db config rotate oidc.privateKeys -- --type rsa
```

  </TabItem>
  <TabItem value="npx" label="npx">

```bash
npx @logto/cli db config rotate oidc.privateKeys -- --type rsa
```

  </TabItem>

</Tabs>

## Вращение OIDC cookie keys \{#rotate-oidc-cookie-keys}

Используйте команду CLI ниже, чтобы сгенерировать новый OIDC cookie key. Новый ключ будет автоматически использован после перезагрузки.

<Tabs groupId="cmd">

  <TabItem value="cli" label="CLI">

```bash
logto db config rotate oidc.cookieKeys
```

  </TabItem>
  <TabItem value="Local" label="local">

```bash
npm run cli db config rotate oidc.cookieKeys
```

  </TabItem>
  <TabItem value="npx" label="npx">

```bash
npx @logto/cli db config rotate oidc.cookieKeys
```

  </TabItem>

</Tabs>

## Что насчет предыдущих ключей? \{#what-about-the-previous-keys}

Команды вращения ключей Logto не удалят ваши предыдущие ключи подписи, и они будут сохранены в базе данных, если вы не удалите их вручную.

Также будьте осторожны при удалении ваших предыдущих ключей, так как это может вызвать неожиданные проблемы. Рекомендуется сохранять как новый ключ, так и предыдущий ключ в течение некоторого времени (например, 2 недели), пока вы не будете уверены, что все ваши пользователи перешли на новый ключ.

## Устранение неполадок \{#troubleshooting}

### Использование Logto в качестве OIDC провайдера в Cloudflare Zero Trust \{#using-logto-as-oidc-provider-in-cloudflare-zero-trust}

Если вы намерены использовать Logto в качестве OIDC провайдера с Cloudflare Zero Trust, обратите внимание, что он не поддерживает OIDC провайдеров, использующих алгоритмы ECDSA. При вращении OIDC private signing keys убедитесь, что вы используете алгоритм RSA, указав `--type rsa` в команде вращения:

<Tabs groupId="cmd-cloudflare-zero-trust">
  <TabItem value="cli" label="CLI">

```bash
logto db config rotate oidc.privateKeys --type rsa
```

  </TabItem>
  <TabItem value="Local" label="local">

```bash
npm run cli db config rotate oidc.privateKeys -- --type rsa
```

  </TabItem>
  <TabItem value="npx" label="npx">

```bash
npx @logto/cli db config rotate oidc.privateKeys -- --type rsa
```

  </TabItem>
</Tabs>
