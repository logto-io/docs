---
sidebar_position: 3
---

# Пошаговое руководство по разработке социального коннектора

Самый быстрый способ начать — скопировать код из существующего официального коннектора и изменить его в соответствии с вашими потребностями. Возьмем в качестве примера коннектор GitHub.

## Шаг 1: Клонирование существующего пакета коннектора \{#step-1-clone-an-existing-connector-package}

В папке с исходным кодом коннектора вы найдете следующие файлы:

- `index.ts`: Основной файл входа коннектора.
- `constant.ts`: Константы, используемые в коннекторе.
- `types.ts`: Типы TypeScript, используемые в коннекторе.
- `index.test.ts`: Тестовые случаи для коннектора.
- `mock.ts`: Мок-данные, используемые в тестовых случаях коннектора.

Кроме этих файлов, вам также нужно предоставить файл `README.md` для описания коннектора, `logo.svg` (опционально `logo-dark.svg` для лучшего опыта в темном режиме) и файл `package.json` для определения информации о пакете npm.

## Шаг 2: Изменение основного файла входа (index.ts) \{#step-2-modify-the-main-entry-file-indexts}

В файле `index.ts` вы найдете основную логику коннектора. Обычно вам нужно реализовать 4 функции:

- `getAuthorizationUri`: Генерация URI авторизации для сторонней социальной платформы. Для GitHub это будет: `https://github.com/login/oauth/authorize?client_id={clientId}&redirect_uri={redirectUri}&state={state}`. Обратитесь к документации разработчика вашей целевой социальной платформы, чтобы получить правильный URI.
- `authorizationCallbackHandler`: Защита возвращаемых значений параметров в URI обратного вызова авторизации, извлечение `code` авторизации и обработка потенциальных ошибок.
- `getAccessToken`: Обмен `code` авторизации на токен доступа.
- `getUserInfo`: Получение информации о пользователе с третьей стороны социальной платформы с использованием токена доступа.

Большинство других общих логик уже учтены в наборе коннекторов Logto, что должно облегчить вашу работу.

Наконец, в конце файла вам просто нужно экспортировать объект коннектора, следуя той же структуре кода, что и в коннекторе GitHub.

```tsx
const createGithubConnector: CreateConnector<SocialConnector> = async ({ getConfig }) => {
  return {
    metadata: defaultMetadata,
    type: ConnectorType.Social,
    configGuard: githubConfigGuard,
    getAuthorizationUri: getAuthorizationUri(getConfig),
    getUserInfo: getUserInfo(getConfig),
  };
};
```

## Шаг 3: Тестирование коннектора \{#step-3-test-the-connector}

### Модульное тестирование \{#unit-test}

Сначала напишите несколько модульных тестов и убедитесь, что основные функции работают как ожидается.

### Локальное тестирование \{#local-test}

- Настройте Logto в вашей локальной среде: Logto предоставляет несколько способов запуска локально, вы можете использовать CLI, docker или даже собрать из исходного кода. Ознакомьтесь с документацией для [подробностей](/logto-oss/using-cli/install-logto/).
- Свяжите ваш пользовательский коннектор с вашей инстанцией Logto: Используйте CLI для создания символической ссылки вашего коннектора на инстанцию Logto. [Подробнее](/logto-oss/using-cli/manage-connectors/#link-local-connectors).
  ```bash
  cd logto
  npx @logto/cli connector link -p .
  ```
- После связывания коннектора вы должны увидеть его в папке `<logto-root-path>/packages/core/connectors`.
- Перезапустите вашу инстанцию Logto, перейдите в Logto Admin Console, вы должны увидеть его в списке социальных коннекторов.
- Настройте ваш коннектор в <CloudLink to="/sign-in-experience/sign-up-and-sign-in">Консоль > Опыт входа > Регистрация и вход</CloudLink> > Социальный вход. И попробуйте его в нашем демонстрационном приложении с функцией "Живой просмотр".
