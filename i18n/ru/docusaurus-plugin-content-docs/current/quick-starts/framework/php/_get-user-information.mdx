import CodeBlock from '@theme/CodeBlock';

import CliamsNeedNetworkRequest from '../../fragments/_claims-need-network-request.mdx';
import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

### Отображение информации о пользователе \{#display-user-information}

Чтобы отобразить информацию о пользователе, вы можете использовать метод `getIdTokenClaims` или метод `fetchUserInfo` для получения информации о пользователе. В то время как `getIdTokenClaims` возвращает информацию о пользователе, содержащуюся в ID токене, `fetchUserInfo` извлекает информацию о пользователе с конечной точки userinfo.

```php title="index.php"
Route::get('/userinfo', function () {
  if ($client->isAuthenticated() === false) {
    return "Не аутентифицирован <a href='/sign-in'>Войти</a>";
  }

  return (
    // Получить локальные утверждения ID токена
    json_decode($client->getIdTokenClaims())
    . "<br>"
    // Извлечь информацию о пользователе с конечной точки userinfo Logto
    json_decode($client->fetchUserInfo())
  );
});
```

Наши модели данных основаны на [JsonModel](https://github.com/logto-io/php/blob/master/docs/api/classes/Logto/Sdk/Models/JsonModel.md), что позволяет безопасно принимать неопределенные ключи при кодировании или декодировании JSON.

Обратите внимание, что поле (утверждение) со значением `null` не означает, что поле установлено. Причиной может быть то, что связанная область действия не запрошена, или у пользователя нет этого поля.

Например, если мы не запрашивали область действия `email` при входе, поле `email` будет `null`. Однако, если мы запрашивали область действия `email`, поле `email` будет содержать адрес электронной почты пользователя, если он доступен.

### Запрос дополнительных утверждений \{#request-additional-claims}

<FindUserInfoMissing method="getIdTokenClaims" />

<ScopesAndClaimsIntroduction />

Чтобы запросить дополнительные области действия, вы можете настроить параметр `scopes` при инициализации клиента Logto:

```php title="index.php"
$client = new LogtoClient(
  new LogtoConfig(
    // ...другие настройки
    // highlight-next-line
    scopes: ["email", "phone"], // Обновите в соответствии с вашими потребностями
  ),
);
```

Кроме того, вы можете использовать перечисление `UserScope` для добавления областей действия:

```php title="index.php"
// highlight-next-line
use Logto\Sdk\Constants\UserScope;

$client = new LogtoClient(
  new LogtoConfig(
    // ...другие настройки
    // highlight-next-line
    scopes: [UserScope::email, UserScope::phone], // Обновите в соответствии с вашими потребностями
  ),
);
```

Затем дополнительные утверждения будут доступны в возвращаемом значении `getIdTokenClaims` или `fetchUserInfo`.

<CliamsNeedNetworkRequest
  type="method"
  method="fetchUserInfo"
  codeSnippet={
    <CodeBlock
      language="php"
      title="index.php"
    >{`$client->fetchUserInfo()->custom_data;`}</CodeBlock>
  }
/>

### Области действия и утверждения \{#scopes-and-claims}

<ScopesAndClaims />
