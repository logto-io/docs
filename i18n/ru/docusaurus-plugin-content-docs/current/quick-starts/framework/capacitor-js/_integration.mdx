import SignInFlowSummary from '../../fragments/_web-sign-in-flow-summary.mdx';

### Инициализация клиента Logto \{#init-logto-client}

Добавьте следующий код в ваш проект Capacitor:

```ts
import LogtoClient, { type LogtoConfig } from '@logto/capacitor';

const logtoConfig: LogtoConfig = {
  endpoint: '<your-logto-endpoint>',
  appId: '<your-application-id>',
};

const logtoClient = new LogtoClient(config);
```

### Реализация входа \{#implement-sign-in}

<SignInFlowSummary />

Теперь давайте настроим перенаправление URI. Перенаправление URI используется для возврата пользователя в ваше приложение после завершения процесса аутентификации.

Убедитесь, что URI перенаправляет в приложение Capacitor, например, `com.example.app://callback`. Значение может варьироваться в зависимости от конфигурации вашего приложения Capacitor. Для получения более подробной информации смотрите [Capacitor Deep Links](https://capacitorjs.com/docs/guides/deep-links).

Затем добавьте следующий код в обработчик onClick кнопки входа:

```ts
const onClick = async () => {
  await logtoClient.signIn('com.example.app://callback');
  console.log(await logtoClient.isAuthenticated()); // true
  console.log(await logtoClient.getIdTokenClaims()); // { sub: '...', ... }
};
```

### Реализация выхода \{#implement-sign-out}

Поскольку Capacitor использует Safari View Controller на iOS и Chrome Custom Tabs на Android, состояние аутентификации может сохраняться некоторое время. Однако иногда пользователь может захотеть немедленно выйти из приложения. В этом случае мы можем использовать метод `signOut` для выхода пользователя:

```ts
const onClick = async () => {
  await logtoClient.signOut();
  console.log(await logtoClient.isAuthenticated()); // false
};
```

Метод `signOut` имеет необязательный параметр для URI перенаправления после выхода. Если он не указан, пользователь будет перенаправлен на страницу выхода Logto.

Пользователю нужно нажать "Готово", чтобы закрыть веб-вид и вернуться в приложение Capacitor. Если вы хотите автоматически перенаправить пользователя обратно в приложение Capacitor, вы можете указать URI перенаправления после выхода, например, `com.example.app://callback/sign-out`.

Убедитесь, что URI перенаправления после выхода может перенаправлять в приложение Capacitor. Затем добавьте следующий код в обработчик onClick кнопки выхода:

```ts
const onClick = async () => {
  await logtoClient.signOut('com.example.app://callback/sign-out');
};
```

### Контрольная точка: Запуск процесса аутентификации \{#checkpoint-trigger-the-authentication-flow}

Запустите приложение Capacitor и нажмите кнопку входа. Откроется окно браузера, перенаправляющее на страницу входа Logto.

Если пользователь закроет окно браузера, не завершив процесс аутентификации, приложение Capacitor получит `LogtoClientError`.
