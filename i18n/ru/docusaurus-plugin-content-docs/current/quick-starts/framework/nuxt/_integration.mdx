import Checkpoint from '../../fragments/_checkpoint-test-your-application.md';
import AssumingUrl from '../../fragments/_web-assuming-url.mdx';
import WebConfigureRedirectUris from '../../fragments/_web-configure-redirect-uris.mdx';
import SignInFlowSummary from '../../fragments/_web-sign-in-flow-summary.mdx';

### Регистрация модуля Logto \{#register-logto-module}

В вашем файле конфигурации Nuxt добавьте модуль Logto и настройте его:

```ts title="nuxt.config.ts"
export default defineNuxtConfig({
  // highlight-start
  modules: ['@logto/nuxt'],
  runtimeConfig: {
    logto: {
      endpoint: '<your-logto-endpoint>',
      appId: '<your-logto-app-id>',
      appSecret: '<your-logto-app-secret>',
      cookieEncryptionKey: '<a-random-string>',
    },
  },
  // highlight-end
  // ...другие настройки
});
```

Поскольку эта информация является конфиденциальной, рекомендуется использовать переменные окружения (`.env`):

```bash title=".env"
NUXT_LOGTO_ENDPOINT="<your-logto-endpoint>"
NUXT_LOGTO_APP_ID="<your-logto-app-id>"
NUXT_LOGTO_APP_SECRET="<your-logto-app-secret>"
NUXT_LOGTO_COOKIE_ENCRYPTION_KEY="<a-random-string>"
```

Смотрите [runtime config](https://nuxt.com/docs/guide/going-further/runtime-config) для получения дополнительной информации.

### Настройка перенаправления URI \{#configure-redirect-uris}

<SignInFlowSummary />

<AssumingUrl />

<WebConfigureRedirectUris />

### Обработка обратного вызова \{#handle-callback}

Дополнительная настройка для обработки маршрута обратного вызова не требуется. При регистрации модуля `@logto/nuxt` он выполнит следующее:

- Добавит три маршрута для входа (`/sign-in`), выхода (`/sign-out`) и обратного вызова (`/callback`).
- Импортирует два composables: `useLogtoClient` и `useLogtoUser`.

Эти маршруты можно настроить через `logto.pathnames` в параметрах модуля, например:

```ts title="nuxt.config.ts"
export default defineNuxtConfig({
  // highlight-start
  logto: {
    pathnames: {
      signIn: '/login',
      signOut: '/logout',
      callback: '/auth/callback',
    },
  },
  // highlight-end
  // ...другие настройки
});
```

Ознакомьтесь с [файлом определения типов](https://github.com/logto-io/js/blob/HEAD/packages/nuxt/src/runtime/utils/types.ts) в пакете `@logto/nuxt` для получения дополнительной информации.

:::note
Если вы настроите маршрут обратного вызова на другой путь, вам нужно будет обновить URI перенаправления в Logto соответственно.
:::

### Реализация входа и выхода \{#implement-sign-in-and-sign-out}

Поскольку страницы Nuxt будут гидратированы и станут одностраничным приложением (SPA) после начальной загрузки, нам нужно перенаправить пользователя на маршрут входа или выхода, когда это необходимо. Чтобы помочь с этим, наш SDK предоставляет composable `useLogtoUser()`, который можно использовать как на стороне сервера, так и на стороне клиента.

```html title="index.vue"
<script setup lang="ts">
  import { useLogtoUser } from '#imports'; // Добавьте эту строку, если автоимпорт отключен
  const user = useLogtoUser();
</script>
<template>
  <!-- Упрощенная кнопка для входа и выхода -->
  <nuxt-link :to="`/sign-${ user ? 'out' : 'in' }`">
    Войти {{ user ? 'выйти' : 'войти' }}
  </nuxt-link>
</template>
```

<Checkpoint />
