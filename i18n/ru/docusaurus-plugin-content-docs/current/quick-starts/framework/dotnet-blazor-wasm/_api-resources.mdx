import ApiResourcesDescription from '../../fragments/_api-resources-description.md';

<ApiResourcesDescription />

По умолчанию, когда вы обращаетесь к `User?.AccessToken`, вы получите непрозрачный токен, который имеет короткую длину и не является JWT (JSON Web Token). Этот токен используется для доступа к конечной точке userinfo.

### Добавление ресурса API в конфигурацию \{#add-api-resource-to-configuration}

Чтобы получить JWT токен, который можно использовать для доступа к ресурсу API, определенному в Logto, добавьте следующие параметры в файл `appsettings.json` (используя `https://my-api-resource` в качестве примера):

{/* eslint-disable prettier/prettier */}
```json5 title="appsettings.json"
{
  // ...
  "IdentityServer": {
    // ...
    // highlight-start
    "Scope": "openid profile email <your-api-scopes>", // Добавьте ваши области действия API здесь
    "Resource": "https://my-api-resource",
    "ExtraTokenParams": {
        "resource": "https://my-api-resource" // Убедитесь, что ключ "resource" в нижнем регистре
    }
    // highlight-end
  }
}
```
{/* eslint-enable prettier/prettier */}

Свойство `Resource` используется для добавления ресурса API в запрос аутентификации. Свойство `ExtraTokenParams` используется для добавления ресурса API в запрос токена. Поскольку Logto соответствует [RFC 8707](https://tools.ietf.org/html/rfc8707) для ресурсов API, оба свойства обязательны.

:::caution
Поскольку WebAssembly является клиентским приложением, запрос токена будет отправлен на сервер только один раз. Из-за этой особенности `LoadUserInfo` конфликтует с получением токена доступа для ресурсов API.
:::

### Использование токена доступа \{#use-access-token}

После аутентификации пользователя вы можете получить доступ к ресурсу API, используя свойство `User?.AccessToken`. Например, вы можете использовать `HttpClient` для доступа к ресурсу API:

```csharp
using Blorc.OpenIdConnect;

builder.Services
    .AddHttpClient("MyApiResource", client =>
    {
        client.BaseAddress = new Uri("https://my-api-resource");
    })
    .AddAccessToken(); // Добавьте токен доступа в заголовок запроса
```
