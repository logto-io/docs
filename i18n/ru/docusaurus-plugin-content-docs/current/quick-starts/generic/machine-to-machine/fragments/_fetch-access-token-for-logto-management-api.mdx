import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import LogtoManagementApiSrc from '../assets/logto-management-api.png';

Logto предоставляет встроенный ресурс «Logto Management API», это ресурс только для чтения с разрешением `all` для доступа к Logto Management API, вы можете увидеть его в списке ваших ресурсов API. Индикатор ресурса API имеет формат `https://{your-tenant-id}.logto.app/api`, и это будет значение вашего ресурса, используемое в теле запроса токена доступа.

<img alt="Детали Logto Management API" src={LogtoManagementApiSrc} width="600px" />

Перед доступом к Logto Management API убедитесь, что вашему M2M приложению назначены M2M роли, которые включают разрешение `all` из этого встроенного ресурса «Logto Management API».

:::info
Logto также предоставляет предварительно настроенную роль M2M «Logto Management API access» для новых созданных арендаторов, которой уже назначено все разрешение ресурса Logto Management API. Вы можете использовать её напрямую без ручной настройки разрешений. Эта предварительно настроенная роль также может быть отредактирована и удалена по мере необходимости.
:::

Теперь соберите всё, что у нас есть, и отправьте запрос:

<Tabs>

<TabItem value="Node.js" label="Node.js">

```js
const logtoEndpoint = 'https://your.logto.endpoint'; // Замените на ваш Logto endpoint
const tokenEndpoint = `${logtoEndpoint}/oidc/token`;
const applicationId = 'your-application-id';
const applicationSecret = 'your-application-secret';
const tenantId = 'your-tenant-id';

const fetchAccessToken = async () => {
  return await fetch(tokenEndpoint, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      Authorization: `Basic ${Buffer.from(`${applicationId}:${applicationSecret}`).toString(
        'base64'
      )}`,
    },
    body: new URLSearchParams({
      grant_type: 'client_credentials',
      resource: `https://${tenantId}.logto.app/api`,
      scope: 'all',
    }).toString(),
  });
};
```

</TabItem>

<TabItem value="cURL" label="cURL">

```bash
curl --location \
  --request POST 'https://your.logto.endpoint' \
  --header 'Authorization: Basic ${your_auth_string}' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'grant_type=client_credentials' \
  --data-urlencode 'resource=https://${tenantId}.logto.app/api' \
  --data-urlencode 'scope=all'
```

Не забудьте заменить фактические значения на ваши собственные.

</TabItem>

</Tabs>

:::caution
Для пользователей Logto Cloud: при взаимодействии с Logto Management API вы не можете использовать пользовательский домен, используйте стандартный Logto endpoint `https://{your_tenant_id}.logto.app/oidc/token` для получения токенов доступа.
:::
