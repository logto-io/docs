---
sidebar_position: 4
---

# Персональный токен доступа

Персональные токены доступа (PATs) предоставляют безопасный способ для пользователей предоставлять [токен доступа](https://auth.wiki/access-token) без использования их учетных данных и интерактивного входа. Это полезно для CI/CD, скриптов или приложений, которым необходимо программно получать доступ к ресурсам.

## Управление персональными токенами доступа \{#managing-personal-access-tokens}

### Использование Console \{#using-console}

Вы можете управлять персональными токенами доступа на странице сведений о пользователе в <CloudLink to="/users">Console > Управление пользователями</CloudLink>. В карточке "Аутентификация" вы можете увидеть список персональных токенов доступа и создать новые.

### Использование Management API \{#using-management-api}

После настройки [Management API](/integrate-logto/interact-with-management-api/), вы можете использовать [API endpoints](https://openapi.logto.io/operation/operation-listuserpersonalaccesstokens) для создания, перечисления и удаления персональных токенов доступа.

## Использование PATs для предоставления токенов доступа \{#use-pats-to-grant-access-tokens}

После создания PAT вы можете использовать его для предоставления токенов доступа вашему приложению, используя endpoint обмена токенами.

### Запрос \{#request}

Приложение делает [запрос на обмен токенами](https://auth.wiki/authorization-code-flow#token-exchange-request) к [endpoint токенов](/integrate-logto/application-data-structure#token-endpoint) арендатора с использованием специального типа предоставления через метод HTTP POST. Следующие параметры включены в тело сущности HTTP-запроса в формате `application/x-www-form-urlencoded`.

1. `client_id`: ОБЯЗАТЕЛЬНО. Идентификатор клиента приложения.
2. `grant_type`: ОБЯЗАТЕЛЬНО. Значение этого параметра должно быть `urn:ietf:params:oauth:grant-type:token-exchange`, что указывает на выполнение обмена токенами.
3. `resource`: НЕОБЯЗАТЕЛЬНО. Индикатор ресурса, такой же, как и в других запросах токенов.
4. `scope`: НЕОБЯЗАТЕЛЬНО. Запрашиваемые области действия, такие же, как и в других запросах токенов.
5. `subject_token`: ОБЯЗАТЕЛЬНО. PAT пользователя.
6. `subject_token_type`: ОБЯЗАТЕЛЬНО. Тип предоставленного токена безопасности в параметре `subject_token`. Значение этого параметра должно быть `urn:logto:token-type:personal_access_token`.

### Ответ \{#response}

Если запрос на обмен токенами успешен, endpoint токенов арендатора возвращает токен доступа, представляющий личность пользователя. Ответ включает следующие параметры в теле сущности HTTP-ответа в формате `application/json`.

1. `access_token`: ОБЯЗАТЕЛЬНО. Токен доступа пользователя, такой же, как и в других запросах токенов, таких как `authorization_code` или `refresh_token`.
2. `issued_token_type`: ОБЯЗАТЕЛЬНО. Тип выданного токена. Значение этого параметра должно быть `urn:ietf:params:oauth:token-type:access_token`.
3. `token_type`: ОБЯЗАТЕЛЬНО. Тип токена. Значение этого параметра должно быть `Bearer`.
4. `expires_in`: ОБЯЗАТЕЛЬНО. Время жизни токена доступа в секундах.
5. `scope`: НЕОБЯЗАТЕЛЬНО. Области действия токена доступа.

### Пример обмена токенами \{#example-token-exchange}

```
POST /oidc/token HTTP/1.1
Host: tenant.logto.app
Content-Type: application/x-www-form-urlencoded
Authorization: Basic <base64(client-id:client-secret)>

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange
&scope=profile
&subject_token=pat_W51arOqe7nynW75nWhvYogyc
&subject_token_type=urn%3Alogto%3Atoken-type%3Apersonal_access_token
```

```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "access_token": "eyJhbGci...zg",
  "issued_token_type": "urn:ietf:params:oauth:token-type:access_token",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "profile"
}
```

Пример полезной нагрузки токена доступа:

```json
{
  "jti": "iFtbZBeh2M1cTTBuKbHk4",
  "sub": "123",
  "iss": "https://tenant.logto.app/oidc",
  "exp": 1672531200,
  "iat": 1672527600,
  "scope": "profile",
  "client_id": "client-id"
}
```

## Связанные ресурсы \{#related-resources}

<Url href="https://blog.logto.io/pat-and-api-keys">
  Персональные токены доступа, аутентификация машина-машина и определение API ключей и их сценарии в
  реальном мире
</Url>
