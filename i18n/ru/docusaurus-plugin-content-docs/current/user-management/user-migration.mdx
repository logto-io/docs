---
sidebar_position: 5
---

# Миграция пользователей

Logto поддерживает ручную миграцию существующих пользователей с другой платформы. Это руководство покажет вам, как импортировать существующих пользователей через Management API и расскажет о вещах, которые следует учитывать перед миграцией.

## Схема пользователя \{#user-schema}

Прежде чем начать, давайте взглянем на [схему пользователя](/user-management/user-data/#user-profile) в Logto. Есть 3 части схемы пользователя, о которых вам следует знать:

1. **Основные данные**: это основная информация из профиля пользователя, вы можете сопоставить данные из вашего существующего профиля пользователя.
2. **Пользовательские данные**: хранит дополнительную информацию о пользователе, вы можете использовать это для хранения файлов, которые не удается сопоставить с основными данными.
3. **Социальные идентичности**: хранит информацию о пользователе, полученную через социальный вход.

Вы можете создать карту для сопоставления информации о пользователе из вашего существующего профиля пользователя с **основными данными** и **пользовательскими данными**. Для социального входа вам понадобятся дополнительные шаги для импорта социальных идентичностей, пожалуйста, обратитесь к API [Привязка социальной идентичности к пользователю](https://openapi.logto.io/operation/operation-createuseridentity).

## Хеширование паролей \{#password-hashing}

Logto использует [Argon2](https://en.wikipedia.org/wiki/Argon2) для хеширования паролей пользователей, а также поддерживает другие алгоритмы, такие как `MD5`, `SHA1`, `SHA256` и `Bcrypt` для удобства миграции. Эти алгоритмы считаются небезопасными, соответствующие хеши паролей будут мигрированы на Argon2 при первом успешном входе пользователя.

Если вам нужна поддержка какого-либо конкретного алгоритма хеширования, [пожалуйста, дайте нам знать](https://logto.io/contact).

## Шаги для миграции \{#steps-to-migrate}

1.  **Подготовьте данные пользователя**
    Сначала вам следует экспортировать данные пользователя с вашей существующей платформы, а затем сопоставить информацию о пользователе со схемой пользователя Logto. Мы рекомендуем подготовить сопоставленные данные в формате JSON. Вот пример данных пользователя:

    ```json
    [
      {
        "username": "user1",
        "passwordDigest": "password-encrypted",
        "passwordAlgorithm": "SHA256"
      },
      {
        "username": "user2",
        "passwordDigest": "password-encrypted",
        "passwordAlgorithm": "SHA256"
      }
    ]
    ```

2.  **Создайте арендатора Logto**
    Вам нужно будет настроить арендатора в Logto. Вы можете использовать либо Logto Cloud, либо Logto OSS. Если вы еще этого не сделали, пожалуйста, обратитесь к руководству [Настройка Logto cloud](/introduction/set-up-logto-cloud/#create-logto-tenant).
3.  **Настройте подключение Management API**
    Мы будем использовать Management API для импорта данных пользователя, вы можете обратиться к [Management API](/integrate-logto/interact-with-management-api), чтобы узнать, как настроить подключение в вашей среде разработки.
4.  **Импортируйте данные пользователя**
    Рекомендуется подготовить скрипт для импорта данных пользователя по одному, мы будем вызывать API [создания пользователя](https://openapi.logto.io/operation/operation-createuser) для импорта данных пользователя. Вот пример скрипта:

    ```jsx
    const users = require('./users.json');

    const importUsers = async () => {
      for (const user of users) {
        try {
          await fetch('https://[tenant_id].logto.app/api/users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: 'Bearer [your-access-token]',
            },
            body: JSON.stringify(user),
          });
          // Пауза, чтобы избежать ограничения скорости
          await new Promise((resolve) => setTimeout(resolve, 200));
        } catch (error) {
          console.error(`Не удалось импортировать пользователя ${user.username}: ${error.message}`);
        }
      }
    };

    importUsers();
    ```

Обратите внимание, что API ограничен по скорости, вам следует добавить паузу между каждым запросом, чтобы избежать ограничения скорости. Пожалуйста, ознакомьтесь с нашей страницей [ограничений скорости](/integrate-logto/interact-with-management-api/#rate-limit) для получения подробной информации.

Если у вас большое количество данных пользователей (100k+ пользователей), вы можете [связаться с нами](https://logto.io/contact) для увеличения ограничения скорости.

## Связанные ресурсы \{#related-resources}

<Url href="https://blog.logto.io/general-migration-guide">
  Общие рекомендации по миграции вашей существующей базы данных пользователей в Logto
</Url>
