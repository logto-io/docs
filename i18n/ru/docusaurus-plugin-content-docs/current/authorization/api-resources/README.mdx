---
sidebar_position: 1
---

# Ресурсы API

Ресурсы API, также известные как [Индикаторы ресурсов](https://www.rfc-editor.org/rfc/rfc8707.html), указывают целевые сервисы или ресурсы, которые запрашиваются, обычно это переменная в формате URI, представляющая идентичность ресурса. Это ключевая концепция в системе авторизации Logto, так как она определяет конечную точку, которую должна защищать политика авторизации.

## Индикатор ресурса \{#resource-indicator}

- Значение ресурса указывает целевой сервис или ресурс, к которому запрашивается доступ.
- Его значение **ДОЛЖНО** быть абсолютным URI.
- URI **НЕ ДОЛЖЕН** включать компонент фрагмента.
- Он **НЕ ДОЛЖЕН** включать компонент запроса.
- Вы **ДОЛЖНЫ** предоставить наиболее специфичный URI, который может быть для полного API или набора ресурсов, к которым он намеревается получить доступ.

На практике клиент может знать базовый URI или приложение или ресурс для взаимодействия. Было бы уместно использовать его в качестве значения параметра ресурса.

Например, базовый URI Logto Management API.

```
https://tenantId.logto.app/api
```

По умолчанию этот ресурс API предварительно зарегистрирован в вашей службе Logto. Все [Management API](https://openapi.logto.io/) под этим URI защищены Logto.

## Схема ресурса API Logto \{#logto-api-resource-schema}

| **Имя свойства**                                                                                                                                                                                                | **Описание свойства**                                                                                                            | **Обязательно** |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- | --------------- |
| Имя API                                                                                                                                                                                                         | Удобочитаемое имя, которое может помочь вам идентифицировать ресурс API.                                                         | true            |
| Идентификатор API                                                                                                                                                                                               | Уникальное значение [Индикатора ресурса](https://www.rfc-editor.org/rfc/rfc8707.html) API, с ограничениями, перечисленными выше. |
| Logto будет использовать его для идентификации запрашиваемого ресурса API и выдачи токенов авторизации соответственно.                                                                                          | true                                                                                                                             |
| Время истечения токена _(в секундах)_                                                                                                                                                                           | Время истечения, установленное для `токена доступа`. Значение истечения по умолчанию — **3600**.                                 | false           |
| API по умолчанию                                                                                                                                                                                                | Только ноль или один API по умолчанию может быть установлен на арендатора.                                                       |
| Когда назначен API по умолчанию, параметр ресурса может быть опущен в запросе авторизации. Последующие обмены токенов будут использовать этот API в качестве аудитории по умолчанию, что приведет к выдаче JWT. | false                                                                                                                            |

:::note

Запросы с истекшим `токеном доступа` должны быть ограничены. Это реализовано для защиты вашего API от злоупотребления токеном. Чем больше значение установлено, тем дольше выданный `токен доступа` будет действовать, и тем более уязвимым будет ваш API.

:::

## API по умолчанию \{#default-api}

:::note

Эта функция в основном предназначена для приложений, которые НЕ поддерживают индикаторы ресурсов OIDC, например, плагины ChatGPT.

:::

Logto использует [RFC 8707: Индикаторы ресурсов для OAuth 2.0](https://www.rfc-editor.org/rfc/rfc8707) для реализации управления доступом на основе ролей (RBAC). Хотя это одна из функций OAuth 2.0, она еще не получила широкую поддержку.

В реализации Logto каждое определенное пользователем разрешение (область действия) должно быть связано с ресурсом API. В противном случае оно будет рассматриваться как разрешение OpenID Connect (или OAuth). В общем, это не влияет на ваш процесс авторизации. Однако при интеграции с сторонними приложениями, которые не поддерживают [RFC 8707](https://www.rfc-editor.org/rfc/rfc8707.html) (например, плагины ChatGPT), это может вызвать проблемы, так как начальный запрос авторизации может не включать параметр `resource`. В результате Logto всегда будет выдавать Непрозрачные токены доступа.

Чтобы решить эту проблему, вы можете назначить ресурс API в качестве ресурса по умолчанию на уровне арендатора. Как только это будет сделано:

- Logto будет использовать ресурс API по умолчанию, когда параметр `resource` отсутствует в [Запросе аутентификации](https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest).
- Если область действия `openid` включена, Непрозрачный токен доступа для [Конечной точки Userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) будет выдан, когда параметр `resource` отсутствует в последующих [Запросах токена](https://openid.net/specs/openid-connect-core-1_0.html#TokenRequest).
- Если область действия `openid` не включена, JWT токен доступа для ресурса API по умолчанию будет выдан, когда параметр `resource` отсутствует в последующих [Запросах токена](https://openid.net/specs/openid-connect-core-1_0.html#TokenRequest).

Назначая ресурс API по умолчанию, вы можете обеспечить плавную интеграцию с приложениями, не поддерживающими RFC 8707, при этом сохраняя соответствующий контроль доступа.

## Регистрация ресурсов API в Logto \{#register-the-api-resources-in-logto}

Чтобы получить `токен доступа`, ограниченный аудиторией, от Logto, сначала зарегистрируйте свои бэкенд API, чтобы включить токены доступа, ограниченные аудиторией Logto. Когда будет получен запрос авторизации, Logto идентифицирует зарегистрированные ресурсы API и предоставит доступ соответственно.

Чтобы зарегистрировать свои API, перейдите в <CloudLink to="/api-resources">Консоль > Ресурсы API</CloudLink>. Вы увидите встроенный ресурс с идентификатором API, отображаемым как `https://[your-tenant-id].logto.app/api`. Этот ресурс охватывает все Management API Logto и гарантирует, что они защищены и доступны только авторизованным пользователям Logto.

Нажмите на кнопку **Создать ресурс API** и следуйте интерактивной форме, чтобы создать свои собственные ресурсы API:

- Удобочитаемое **имя API**, которое может лучше помочь вам идентифицировать эту сущность.
- Уникальный **идентификатор API** в формате URI. Он представляет идентичность ресурса API.

Новый API появится в списке после создания. Вы можете управлять им или удалить его на странице деталей API, нажав на сущность.

## Связанные ресурсы \{#related-resources}

<Url href="https://blog.logto.io/opaque-token-vs-jwt">Непрозрачный токен против JWT</Url>

<Url href="https://blog.logto.io/when-should-i-use-jwts">Когда следует использовать JWT?</Url>

<Url href="https://blog.logto.io/api-authorization-methods">Методы авторизации API</Url>
