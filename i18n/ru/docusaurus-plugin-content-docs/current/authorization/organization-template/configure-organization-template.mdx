---
sidebar_position: 1
---

# Настройка шаблона организации

Мы рассмотрим процесс настройки функции шаблона организации через Logto Console.

Сначала перейдите в <CloudLink to="/organization-template">Console > Organization template</CloudLink>. Вы увидите, что шаблон организации включает две части: [Роли организации](/authorization/organization-template#organization-role) и [Разрешения организации](/authorization/organization-template#organization-permission). Шаблон организации определяет общие политики управления доступом (разрешения и роли) для нескольких организаций.

## Настройка через Logto Console \{#configure-via-logto-console}

### Создание разрешения организации \{#create-organization-permission}

Разрешения организации являются ключевой частью шаблона организации. Эти разрешения разработаны специально для организаций в вашем продукте. Вот как ими управлять:

- **Найдите вкладку разрешений организации:** Перейдите на вкладку "Разрешения организации", чтобы увидеть существующие разрешения.
- **Добавление, удаление и редактирование:** Вы можете легко добавлять новые разрешения организации, удалять ненужные и редактировать существующие разрешения по мере необходимости.

### Создание роли организации \{#create-organization-role}

Logto поддерживает два типа ролей организации, это то же самое, что и RBAC на уровне пользователя / системы:

- **Пользователь**: Роли, назначаемые пользователям.
- **Машина-машина**: Роли, назначаемые [приложениям машина-машина](/quick-starts/m2m).

<br />

Logto позволяет определять роли организации различными способами, чтобы соответствовать структуре вашей системы:

**Вариант 1: Только разрешения организации для ролей организации**

- **Когда использовать:** У вас есть отдельные конечные точки для пользователя / системы и организации.
- **Объяснение:** Это самый простой подход, если техническая архитектура вашего продукта и дизайн API четко разделяют [ресурсы на уровне пользователя / системы](/authorization/role-based-access-control#permissionsscopes) от [ресурсов организации](/authorization/organization-template#organization-permission). Ваши роли организации будут включать только разрешения, которые вы определяете для организации.

**Вариант 2: Только разрешения API для ролей организации**

- **Когда использовать:** Управление доступом на уровне пользователя / системы и организации осуществляется через одни и те же конечные точки.
- **Объяснение:** Выберите это, если хотите управлять всеми разрешениями через унифицированные [ресурсы API](/authorization/api-resources).

**Вариант 3: Смешанные разрешения API и организации в ролях организации**

- **Когда использовать:** У вас есть отдельные конечные точки, определенные для вашего продукта на уровне пользователя / системы и организации, но некоторые пользовательские роли требуют сочетания как [разрешений на уровне пользователя](/authorization/role-based-access-control#permissionsscopes), так и [разрешений на уровне организации](/authorization/organization-template#organization-permission).
- **Объяснение:** Это предлагает наибольшую гибкость, но также может быть самым сложным в управлении.

## Настройка через Logto Management API \{#configure-via-logto-management-api}

Все, что вы можете сделать в Console, также можно сделать через [Management API](/integrate-logto/interact-with-management-api), включая: Управление шаблоном организации для создания, удаления или редактирования разрешений и ролей организации.

Для полного списка возможностей, пожалуйста, обратитесь к нашему API-справочнику:

<Url href="https://openapi.logto.io/operation/operation-updateorganizationrole">
  Logto Management API - роль организации
</Url>

<Url href="https://openapi.logto.io/operation/operation-listorganizationscopes">
  Logto Management API - разрешение организации
</Url>

С помощью Logto Management API вы можете создавать пользовательские организационные опыты, такие как разрешение администраторам организаций самостоятельно создавать организации. Ознакомьтесь с [этим разделом](/end-user-flows/organization-experience/), чтобы включить больше функций и управления на уровне организации.

## Обработка изменения разрешений участника \{#handle-member-permission-change}

Аналогично API RBAC, разрешения участников могут быть изменены во время сеанса — например, им могут быть назначены новые роли или изменены существующие разрешения ролей.

Что происходит, когда разрешения участника изменяются? Есть два случая.

#### В систему не вводятся новые разрешения \{#no-new-permissions-introduced-into-the-system}

Текущие токены доступа организации (также известные как токен организации) останутся действительными до истечения срока их действия, даже после изменения разрешений организации пользователя. Однако новые разрешения будут отражены в последующих токенах организации, а любые отозванные разрешения будут исключены.

:::note

Токены организации имеют фиксированное время истечения, которое нельзя изменить, в отличие от общих токенов доступа.

:::

Вызывайте конечные точки [Logto Management API](/integrate-logto/interact-with-management-api/) периодически или устанавливайте долговременное соединение (например, используя WebSocket), чтобы динамически получать разрешения организации пользователя. При обнаружении изменений очистите существующий токен организации, и вновь выданные токены автоматически отразят изменения в области разрешений организации.

```bash
curl \
 -X GET https://[tenant_id].logto.app/api/organizations/{id}/users/{userId}/scopes \
 -H "Authorization: Bearer $ORGANIZATION_TOKEN"
```

При обнаружении изменений разрешений сначала очистите токен организации из хранилища, а затем вызовите метод SDK `getOrganizationToken(organizationId)`, чтобы получить новый. Вновь выданный токен организации должен отразить изменения разрешений.

#### В систему вводится новое разрешение и назначается участнику \{#new-permission-is-introduced-into-the-system-and-assigned-to-a-member}

Это происходит, когда в ваш шаблон организации вводятся новые разрешения. В этом случае вам сначала нужно включить вновь введенные области разрешений при инициализации клиента Logto. Например:

```tsx
new LogtoClient({
  appId: 'your-app-id',
  endpoint: 'your-logto-endpoint',
  scopes: [
    'urn:logto:scope:organizations',
    // ... ваши другие существующие области разрешений организации,
    'new-organization-permission-scope',
  ],
});
```

Во-вторых, каждому вашему клиентскому приложению необходимо повторно получить согласие или повторно войти в систему, чтобы получить изменения разрешений. Затем новая область разрешений будет отражена в новых токенах организации.

Пример кода для повторного получения согласия:

```tsx
signIn({ redirectUri: 'your-redirect-url', prompt: 'consent' });
```
