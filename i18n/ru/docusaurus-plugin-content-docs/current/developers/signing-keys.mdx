---
id: signing-keys
title: Signing keys
sidebar_label: Signing keys
sidebar_position: 4
---

# Ключи подписи

Ключи подписи Logto [OIDC](https://auth.wiki/signing-key), также известные как "OIDC private keys" и "OIDC cookie keys", используются для подписи JWT токенов ([токенов доступа](https://auth.wiki/access-token) и [ID токенов](https://auth.wiki/id-token)) и браузерных cookies в Logto [сессиях входа](/end-user-flows/sign-out#sign-in-session). Эти ключи подписи генерируются при инициализации базы данных Logto ([open-source](/logto-oss)) или создании нового арендатора ([Cloud](/logto-cloud)) и могут управляться через [CLI](/logto-oss/using-cli) (open-source), Management API или Console UI.

По умолчанию Logto использует алгоритм эллиптической кривой (EC) для генерации цифровых подписей. Однако, учитывая, что пользователям часто необходимо проверять подписи JWT, а многие старые инструменты не поддерживают алгоритм EC (поддерживая только RSA), мы реализовали возможность ротации приватных ключей и позволяем пользователям выбирать алгоритм подписи (включая как RSA, так и EC). Это обеспечивает совместимость с сервисами, использующими устаревшие инструменты проверки подписей.

:::note
Теоретически, ключи подписи не должны утекать и не имеют времени истечения, что означает, что их ротация не требуется. Однако периодическая ротация ключа подписи после определенного периода может повысить безопасность.
:::

## Как это работает? \{#how-it-works}

- **OIDC private key**
  При инициализации экземпляра Logto автоматически генерируется пара открытого и закрытого ключей, которые регистрируются в базовом OIDC провайдере. Таким образом, когда Logto выдает новый JWT токен (токен доступа или ID токен), токен подписывается закрытым ключом. В то же время любое клиентское приложение, получающее JWT токен, может использовать парный открытый ключ для проверки подписи токена, чтобы убедиться, что токен не был изменен третьей стороной. Закрытый ключ защищен на сервере Logto. Открытый ключ, как следует из названия, является общедоступным и может быть доступен через интерфейс `/oidc/jwks` OIDC endpoint. Алгоритм ключа подписи можно указать при генерации закрытого ключа, и Logto по умолчанию использует алгоритм EC (эллиптическая кривая). Администраторы могут изменить алгоритм по умолчанию на RSA (Rivest-Shamir-Adleman) путем ротации закрытых ключей.
- **OIDC cookie key**
  Когда пользователь инициирует процесс входа или регистрации, на сервере создается "OIDC session", а также набор браузерных cookies. С помощью этих cookies браузер может запрашивать Logto Experience API для выполнения ряда взаимодействий от имени пользователя, таких как вход, регистрация и сброс пароля. Однако, в отличие от JWT токенов, cookies подписываются и проверяются только самим сервисом Logto OIDC, асимметричные криптографические меры не требуются. Таким образом, у нас нет парных открытых ключей для ключей подписи cookies, и асимметричные алгоритмы шифрования не используются.

## Ротация ключей подписи через Console UI \{#rotate-signing-keys-from-console-ui}

Logto представляет функцию "Ротация ключей подписи", которая позволяет вам создать новый OIDC private key и cookie key в вашем арендаторе.

1. Перейдите в <CloudLink to="/signing-keys">Console > Signing keys</CloudLink>. Там вы можете управлять как OIDC private keys, так и OIDC cookie keys.
2. Чтобы выполнить ротацию ключа подписи, нажмите кнопку "Rotate private keys" или "Rotate cookie keys". При ротации private keys у вас есть возможность изменить алгоритм подписи.
3. Вы найдете таблицу, в которой перечислены все используемые ключи подписи. Примечание: Вы можете удалить предыдущий ключ, но не можете удалить текущий.

   | Статус   | Описание                                                                                                                                |
   | -------- | --------------------------------------------------------------------------------------------------------------------------------------- |
   | Current  | Это указывает на то, что этот ключ в настоящее время активно используется в ваших приложениях и API.                                    |
   | Previous | Это относится к ключу, который ранее использовался, но был заменен. Существующие токены с этим ключом подписи остаются действительными. |

Пожалуйста, помните, что ротация включает в себя следующие три действия:

1. **Создание нового ключа подписи**: Это потребует от всех ваших **приложений** и **API** принять новый ключ подписи.
2. **Ротация текущего ключа**: Существующий ключ будет обозначен как "предыдущий" после ротации и не будет использоваться новыми приложениями и API. Однако токены, подписанные этим ключом, останутся действительными.
3. **Удаление вашего предыдущего ключа**: Ключи, обозначенные как "предыдущие", будут отозваны и удалены из таблицы.

:::warning
Никогда не выполняйте ротацию ключей подписи подряд (два или более раза), так как это может сделать недействительными ВСЕ выданные токены.

- Для пользователей OSS, после ротации ключа подписи требуется перезапуск экземпляра Logto, чтобы новый ключ подписи вступил в силу.
- Для пользователей Cloud новый ключ подписи вступает в силу сразу после ротации, но, пожалуйста, убедитесь, что вы не выполняете ротацию ключа подписи несколько раз подряд.
  :::

## Связанные ресурсы \{#related-resources}

<Url href="https://blog.logto.io/introduction-to-ec-and-rsa-signing-algorithms-in-jwt">
  Введение в алгоритмы подписи EC и RSA в JWT
</Url>
