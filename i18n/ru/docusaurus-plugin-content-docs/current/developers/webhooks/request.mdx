---
id: webhooks-request
title: Webhooks request
sidebar_label: Webhooks request
sidebar_position: 4
---

# Запрос Webhooks

Когда генерируется действительное событие hook, Logto найдет соответствующие webhooks и отправит POST-запрос для каждой конфигурации hook.

## Заголовки запроса \{#request-headers}

| Key                     | Customizable | Примечания                                                                               |
| ----------------------- | ------------ | ---------------------------------------------------------------------------------------- |
| user-agent              | ✅           | По умолчанию `Logto (https://logto.io/)`.                                                |
| content-type            | ✅           | По умолчанию `application/json`.                                                         |
| logto-signature-sha-256 |              | подпись тела запроса, см. [защита ваших webhooks](/developers/webhooks/secure-webhooks). |

Вы можете перезаписать настраиваемые заголовки, [настраивая запрос](/developers/webhooks/configure-webhooks/#secure-webhook) заголовков с тем же ключом.

## Тело запроса событий взаимодействия hook \{#interaction-hook-events-request-body}

Доступные события: `PostRegister`, `PostSignIn`, `PostResetPassword`

Тело запроса — это JSON-объект, содержащий три типа полей данных:

```tsx
type UserEntity = {
  id: string;
  username?: string;
  primaryEmail?: string;
  primaryPhone?: string;
  name?: string;
  avatar?: string;
  customData?: object;
  identities?: object;
  lastSignInAt?: string;
  createdAt?: string;
  applicationId?: string;
  isSuspended?: boolean;
};
```

```tsx
type ApplicationEntity = {
  id: string;
  name: string;
  description?: string;
};
```

| Поле             | Тип                 | Необязательное | Примечания                                                                                |
| ---------------- | ------------------- | -------------- | ----------------------------------------------------------------------------------------- |
| hookId           | `string`            |                | Идентификатор в Logto.                                                                    |
| event            | `string`            |                | Какое событие вызывает этот hook.                                                         |
| createdAt        | `string`            |                | Время создания полезной нагрузки в формате ISO.                                           |
| interactionEvent | `string`            |                | Событие взаимодействия, которое вызывает этот hook.                                       |
| sessionId        | `string`            | ✅             | Идентификатор сессии (не идентификатор взаимодействия) для этого события, если применимо. |
| userAgent        | `string`            | ✅             | User-agent для запроса, который вызывает этот hook.                                       |
| userIp           | `string`            | ✅             | IP-адрес для запроса, который вызывает этот hook.                                         |
| userId           | `string`            | ✅             | Связанный идентификатор пользователя для этого события, если применимо.                   |
| user             | `UserEntity`        | ✅             | Связанная сущность пользователя для этого события, если применимо.                        |
| applicationId    | `string`            | ✅             | Связанный идентификатор приложения для этого события, если применимо.                     |
| application      | `ApplicationEntity` | ✅             | Связанная информация о приложении для этого события, если применимо.                      |

См. справочные материалы [Пользователи](/user-management/user-data) и [Приложения](/integrate-logto/application-data-structure) для подробных объяснений полей.

## Тело запроса событий мутации данных hook \{#data-mutation-hook-events-request-body}

### Стандартные поля тела запроса \{#standard-request-body-fields}

| Поле      | Тип      | Необязательное | Примечания                                      |
| --------- | -------- | -------------- | ----------------------------------------------- |
| hookId    | `string` |                | Идентификатор в Logto.                          |
| event     | `string` |                | Какое событие вызывает этот hook.               |
| createdAt | `string` |                | Время создания полезной нагрузки в формате ISO. |
| userAgent | `string` | ✅             | User-agent для запроса.                         |
| ip        | `string` | ✅             | IP-адрес для запроса.                           |

### Поля тела контекста Interaction API \{#interaction-api-context-body-fields}

События мутации данных hook, вызванные вызовами API взаимодействия с пользователем.

Доступные события: `User.Created`, `User.Data.Updated`

| Поле             | Тип                 | Необязательное | Примечания                                                                                |
| ---------------- | ------------------- | -------------- | ----------------------------------------------------------------------------------------- |
| interactionEvent | `string`            | ✅             | Событие взаимодействия, которое вызывает этот hook.                                       |
| sessionId        | `string`            | ✅             | Идентификатор сессии (не идентификатор взаимодействия) для этого события, если применимо. |
| applicationId    | `string`            | ✅             | Связанный идентификатор приложения для этого события, если применимо.                     |
| application      | `ApplicationEntity` | ✅             | Связанная информация о приложении для этого события, если применимо.                      |

### Поля тела контекста Management API \{#management-api-context-body-fields}

События мутации данных hook, вызванные вызовами Management API.

| Поле         | Тип      | Необязательное | Примечания                                                                                                                           |
| ------------ | -------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| path         | `string` | ✅             | Путь вызова API, который вызывает этот hook.                                                                                         |
| method       | `string` | ✅             | Метод вызова API, который вызывает этот hook.                                                                                        |
| status       | `number` | ✅             | Код состояния ответа вызова API, который вызывает этот hook.                                                                         |
| params       | `object` | ✅             | Параметры пути koa запроса вызова API, который вызывает этот hook.                                                                   |
| matchedRoute | `string` | ✅             | Совпадающий маршрут koa вызова API, который вызывает этот hook. Logto использует это поле для сопоставления включенных событий hook. |

### Поля тела полезной нагрузки данных \{#data-payload-body-fields}

**События пользователя**

| Событие           | Поле | Тип        | Необязательное | Примечания                                           |
| ----------------- | ---- | ---------- | -------------- | ---------------------------------------------------- |
| User.Created      | data | UserEntity |                | Созданная сущность пользователя для этого события.   |
| User.Data.Updated | data | UserEntity |                | Обновленная сущность пользователя для этого события. |
| User.Deleted      | data | null       | /              |                                                      |

**События роли**

```tsx
type Role = {
  id: string;
  name: string;
  description: string;
  type: 'User' | 'MachineToMachine';
  isDefault: boolean;
};
```

```tsx
type Scope = {
  id: string;
  name: string;
  description: string;
  resourceId: string;
  createdAt: number;
};
```

| Событие            | Поле   | Тип     | Необязательное | Примечания                                                                                                                                        |
| ------------------ | ------ | ------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| Role.Created       | data   | Role    |                | Созданная сущность роли для этого события.                                                                                                        |
| Role.Data.Updated  | data   | Role    |                | Обновленная сущность роли для этого события.                                                                                                      |
| Role.Deleted       | data   | null    |                |                                                                                                                                                   |
| Role.Scope.Updated | data   | Scope[] |                | Обновленные области, назначенные роли.                                                                                                            |
| Role.Scope.Updated | roleId | string  | ✅             | Идентификатор роли, к которой назначены области. (Доступно только, когда событие было вызвано созданием новой роли с предопределенными областями) |

**События разрешений (областей)**

| Событие            | Поле | Тип   | Необязательное | Примечания                                      |
| ------------------ | ---- | ----- | -------------- | ----------------------------------------------- |
| Scope.Created      | data | Scope |                | Созданная сущность области для этого события.   |
| Scope.Data.Updated | data | Scope |                | Обновленная сущность области для этого события. |
| Scope.Deleted      | data | null  | /              |                                                 |

**События организации**

```tsx
type Organization = {
  id: string;
  name: string;
  description?: string;
  customData: object;
  createdAt: number;
};
```

| Событие                         | Поле | Тип          | Необязательное | Примечания                                          |
| ------------------------------- | ---- | ------------ | -------------- | --------------------------------------------------- |
| Organization.Created            | data | Organization |                | Созданная сущность организации для этого события.   |
| Organization.Data.Updated       | data | Organization |                | Обновленная сущность организации для этого события. |
| Organization.Deleted            | data | null         | /              |                                                     |
| Organization.Membership.Updated | data | null         | /              |                                                     |

**События роли организации**

```tsx
type OrganizationRole = {
  id: string;
  name: string;
  description?: string;
};
```

```tsx
type OrganizationScope = {
  id: string;
  name: string;
  description?: string;
};
```

| Событие                        | Поле               | Тип              | Необязательное | Примечания                                                                                                                                        |
| ------------------------------ | ------------------ | ---------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| OrganizationRole.Created       | data               | OrganizationRole |                | Созданная сущность роли организации для этого события.                                                                                            |
| OrganizationRole.Data.Updated  | data               | OrganizationRole |                | Обновленная сущность роли организации для этого события.                                                                                          |
| OrganizationRole.Deleted       | data               | null             | /              |                                                                                                                                                   |
| OrganizationRole.Scope.Updated | data               | null             | /              |                                                                                                                                                   |
| OrganizationRole.Scope.Updated | organizationRoleId | string           | ✅             | Идентификатор роли, к которой назначены области. (Доступно только, когда событие было вызвано созданием новой роли с предопределенными областями) |

**События разрешений организации (областей организации)**

| Событие                        | Поле | Тип               | Необязательное | Примечания                                |
| ------------------------------ | ---- | ----------------- | -------------- | ----------------------------------------- |
| OrganizationScope.Created      | data | OrganizationScope |                | Созданная сущность области организации.   |
| OrganizationScope.Data.Updated | data | OrganizationScope |                | Обновленная сущность области организации. |
| OrganizationScope.Deleted      | data | null              | /              |                                           |
