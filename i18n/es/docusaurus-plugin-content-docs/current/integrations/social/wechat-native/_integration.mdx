## Crear una aplicaci贸n m贸vil en la Plataforma Abierta de WeChat \{#create-a-mobile-app-in-the-wechat-open-platform}

:::tip

Puedes omitir algunas secciones si ya las has completado.

:::

### Crear una cuenta \{#create-an-account}

Abre https://open.weixin.qq.com/, haz clic en el bot贸n "Sign Up" en la esquina superior derecha y completa el proceso de registro.

### Crear una aplicaci贸n m贸vil \{#create-a-mobile-app}

Inicia sesi贸n con la cuenta que acabas de crear. En la pesta帽a "Aplicaci贸n m贸vil" (绉诲ㄥ), haz clic en el gran bot贸n verde "Crear una aplicaci贸n m贸vil" (寤虹Щㄥ).

<img src="/img/assets/app-tabs.png" alt="Pesta帽as de la aplicaci贸n" />

Vamos a completar la informaci贸n requerida en el formulario de la aplicaci贸n.

<img src="/img/assets/create-mobile-app.png" alt="Crear aplicaci贸n m贸vil" />

#### Informaci贸n b谩sica \{#basic-info}

La mayor铆a de los campos son bastante sencillos, y aqu铆 tenemos algunos consejos:

- Si solo quieres probar el inicio de sesi贸n de WeChat y la app no est谩 en la App Store, en la secci贸n "La app est谩 disponible", elige "No" para omitir el "Enlace de descarga de la app".
- El "Diagrama de flujo de operaci贸n de la app" puede parecer complicado. Seg煤n nuestra experiencia, necesitas preparar un diagrama de flujo simple y varias capturas de pantalla de la app para aumentar la posibilidad de aprobar la revisi贸n.

Haz clic en "Siguiente paso" para continuar.

#### Informaci贸n de la plataforma \{#platform-info}

Puedes configurar una o ambas plataformas, iOS y Android, para integrar Logto con el inicio de sesi贸n nativo de WeChat.

**App iOS**

Marca "App iOS" (iOS 搴), luego selecciona el tipo de dispositivo objetivo de tu app seg煤n corresponda.

<img src="/img/assets/platform.png" alt="Plataforma de la app" />

Si elegiste "No" para la disponibilidad en la App Store, puedes omitir el campo "Direcci贸n de descarga de AppStore" aqu铆.

Completa _Bundle ID_, _Test version Bundle ID_ y _Universal Links_ (en realidad, solo se necesita un enlace ).

:::note

_Bundle ID_ y _Test version Bundle ID_ pueden tener el mismo valor.

:::

:::tip

WeChat requiere un universal link para el inicio de sesi贸n nativo. Si no lo has configurado o no sabes qu茅 es, consulta la [documentaci贸n oficial de Apple](https://developer.apple.com/ios/universal-links/).

:::

**App Android**

Marca "App Android" (Android 搴).

<img src="/img/assets/platform-android-app.png" alt="Plataforma de la app Android" />

Completa _Application Signing Signature_ (搴ㄧ惧) y _Application Package Name_ (搴ㄥ).

:::note

Necesitas firmar tu app para obtener una firma. Consulta [Firmar tu app](https://developer.android.com/studio/publish/app-signing) para m谩s informaci贸n.

:::

Despu茅s de firmar, puedes ejecutar la tarea `signingReport` para obtener la firma.

```bash
./gradlew your-android-project:signingReport
```

El valor `MD5` del informe de la variante de compilaci贸n correspondiente ser谩 la _Application Signing Signature_ (搴ㄧ惧), pero recuerda eliminar todos los puntos y comas del valor y ponerlo en min煤sculas.

Ejemplo: `1A:2B:3C:4D` -> `1a2b3c4d`.

#### Esperando el resultado de la revisi贸n \{#waiting-for-the-review-result}

Despu茅s de completar la informaci贸n de la plataforma, haz clic en "Enviar revisi贸n" para continuar. Normalmente, la revisi贸n es r谩pida y termina en 1-2 d铆as.

Sospechamos que el revisor se asigna aleatoriamente en cada env铆o, ya que el est谩ndar es variable. Puede que te rechacen la primera vez, 隆pero no te rindas! Explica tu situaci贸n y pregunta al revisor c贸mo modificarla.

## Habilitar el inicio de sesi贸n nativo de WeChat en tu app \{#enable-wechat-native-sign-in-in-your-app}

### iOS \{#ios}

Suponemos que ya has integrado el [Logto iOS SDK](/quick-starts/swift) en tu app. En este caso, las cosas son bastante simples y ni siquiera necesitas leer la documentaci贸n del SDK de WeChat:

**1. Configura el universal link y el esquema de URL en tu proyecto Xcode**

En el proyecto Xcode -> pesta帽a Signing & Capabilities, a帽ade la capacidad "Associated Domains" y el universal link que configuraste antes.

<img src="/img/assets/universal-link.png" alt="Universal link" />

Luego ve a la pesta帽a "Info", a帽ade un [esquema de URL personalizado](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) con el App ID de WeChat.

<img src="/img/assets/custom-url-scheme.png" alt="Esquema de URL personalizado" />

Finalmente, abre tu `Info.plist` y a帽ade `weixinULAPI` y `weixin` bajo `LSApplicationQueriesSchemes`.

<img src="/img/assets/plist.png" alt="Plist" />

:::note

Sabemos que estas acciones no son muy razonables, pero esta es la soluci贸n m铆nima que encontramos que funciona. Consulta la [gu铆a oficial m谩gica](https://developers.weixin.qq.com/doc/oplatform/en/Mobile_App/Access_Guide/iOS.html) para m谩s informaci贸n.

:::

**2. A帽ade `LogtoSocialPluginWechat` a tu proyecto Xcode**

A帽ade el framework:

<img src="/img/assets/add-framework.png" alt="A帽adir framework" />

Y a帽ade `-ObjC` en Build Settings > Linking > Other Linker Flags:

<img src="/img/assets/linker-flags.png" alt="Linker flags" />

:::note

El plugin incluye WeChat Open SDK 1.9.2. Puedes usar directamente `import WechatOpenSDK` una vez importado el plugin.

:::

**3. A帽ade el plugin a las opciones de inicializaci贸n de tu `LogtoClient`**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginWechat()]
)
```

**4. Maneja correctamente `onOpenURL`**

:::note

La funci贸n `LogtoClient.handle(url:)` gestionar谩 todos los conectores nativos que hayas habilitado. Solo necesitas llamarla una vez.

:::

```swift
// SwiftUI
YourRootView()
  .onOpenURL { url in
      LogtoClient.handle(url: url)
  }

// o AppDelegate
func application(_ app: UIApplication, open url: URL, options: /*...*/) -> Bool {
  LogtoClient.handle(url: url)
}
```

### Android \{#android}

Suponemos que ya has integrado el [Logto Android SDK](/quick-starts/android) en tu app. En este caso, las cosas son bastante simples y ni siquiera necesitas leer la documentaci贸n del SDK de WeChat:

**1. A帽ade `Wechat Open SDK` a tu proyecto**

Aseg煤rate de que el repositorio `mavenCentral()` est茅 en los repositorios de tu proyecto Gradle:

```kotlin
repositories {
  // ...
  mavenCentral()
}
```

A帽ade el Wechat Open SDK a tus dependencias:

```kotlin
dependencies {
  // ...
  api("com.tencent.mm.opensdk:wechat-sdk-android:6.8.0")  // kotlin-script
  // o
  api 'com.tencent.mm.opensdk:wechat-sdk-android:6.8.0'   // groovy-script
}
```

**2. Introduce `WXEntryActivity` en tu proyecto**

Crea un paquete `wxapi` bajo la ra铆z de tu paquete y a帽ade el `WXEntryActivity` en el paquete `wxapi` (Tomando `com.sample.app` como ejemplo):

```kotlin
// WXEntryActivity.kt
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

class WXEntryActivity: WechatSocialResultActivity()
```

```java
// WXEntryActivity.java
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

public class WXEntryActivity extends WechatSocialResultActivity {}
```

La ubicaci贸n final del `WXEntryActivity` en el proyecto deber铆a verse as铆 (tomando Kotlin como ejemplo):

```bash
src/main/kotlin/com/sample/app/wxapi/WXEntryActivity.kt
```

**3. Modifica el `AndroidManifest.xml`**

A帽ade la siguiente l铆nea a tu `AndroidManifest.xml`:

```xml
\<?xml version="1.0" encoding="utf-8"?>
\<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.sample.app">

  \<application>
    \<!-- l铆nea a a帽adir -->
    \<activity android:name=".wxapi.WXEntryActivity" android:exported="true"/>
  \</application>

\</manifest>
```
