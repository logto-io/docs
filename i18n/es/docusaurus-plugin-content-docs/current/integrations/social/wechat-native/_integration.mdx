## Crear una aplicación móvil en la Plataforma Abierta de WeChat \{#create-a-mobile-app-in-the-wechat-open-platform}

:::tip

Puedes omitir algunas secciones si ya las has completado.

:::

### Crear una cuenta \{#create-an-account}

Abre https://open.weixin.qq.com/, haz clic en el botón "Sign Up" en la esquina superior derecha y completa el proceso de registro.

### Crear una aplicación móvil \{#create-a-mobile-app}

Inicia sesión con la cuenta que acabas de crear. En la pestaña "Aplicación móvil" (移动应用), haz clic en el gran botón verde "Crear una aplicación móvil" (创建移动应用).

<img src="/img/assets/app-tabs.png" alt="Pestañas de la aplicación" />

Vamos a completar la información requerida en el formulario de la aplicación.

<img src="/img/assets/create-mobile-app.png" alt="Crear aplicación móvil" />

#### Información básica \{#basic-info}

La mayoría de los campos son bastante sencillos, y aquí tenemos algunos consejos:

- Si solo quieres probar el inicio de sesión de WeChat y la app no está en la App Store, en la sección "La app está disponible", elige "No" para omitir el "Enlace de descarga de la app".
- El "Diagrama de flujo de operación de la app" puede parecer complicado. Según nuestra experiencia, necesitas preparar un diagrama de flujo simple y varias capturas de pantalla de la app para aumentar la posibilidad de aprobar la revisión.

Haz clic en "Siguiente paso" para continuar.

#### Información de la plataforma \{#platform-info}

Puedes configurar una o ambas plataformas, iOS y Android, para integrar Logto con el inicio de sesión nativo de WeChat.

**App iOS**

Marca "App iOS" (iOS 应用), luego selecciona el tipo de dispositivo objetivo de tu app según corresponda.

<img src="/img/assets/platform.png" alt="Plataforma de la app" />

Si elegiste "No" para la disponibilidad en la App Store, puedes omitir el campo "Dirección de descarga de AppStore" aquí.

Completa _Bundle ID_, _Test version Bundle ID_ y _Universal Links_ (en realidad, solo se necesita un enlace 😂).

:::note

_Bundle ID_ y _Test version Bundle ID_ pueden tener el mismo valor.

:::

:::tip

WeChat requiere un universal link para el inicio de sesión nativo. Si no lo has configurado o no sabes qué es, consulta la [documentación oficial de Apple](https://developer.apple.com/ios/universal-links/).

:::

**App Android**

Marca "App Android" (Android 应用).

<img src="/img/assets/platform-android-app.png" alt="Plataforma de la app Android" />

Completa _Application Signing Signature_ (应用签名) y _Application Package Name_ (应用包名).

:::note

Necesitas firmar tu app para obtener una firma. Consulta [Firmar tu app](https://developer.android.com/studio/publish/app-signing) para más información.

:::

Después de firmar, puedes ejecutar la tarea `signingReport` para obtener la firma.

```bash
./gradlew your-android-project:signingReport
```

El valor `MD5` del informe de la variante de compilación correspondiente será la _Application Signing Signature_ (应用签名), pero recuerda eliminar todos los puntos y comas del valor y ponerlo en minúsculas.

Ejemplo: `1A:2B:3C:4D` -> `1a2b3c4d`.

#### Esperando el resultado de la revisión \{#waiting-for-the-review-result}

Después de completar la información de la plataforma, haz clic en "Enviar revisión" para continuar. Normalmente, la revisión es rápida y termina en 1-2 días.

Sospechamos que el revisor se asigna aleatoriamente en cada envío, ya que el estándar es variable. Puede que te rechacen la primera vez, ¡pero no te rindas! Explica tu situación y pregunta al revisor cómo modificarla.

## Habilitar el inicio de sesión nativo de WeChat en tu app \{#enable-wechat-native-sign-in-in-your-app}

### iOS \{#ios}

Suponemos que ya has integrado el [Logto iOS SDK](/quick-starts/swift) en tu app. En este caso, las cosas son bastante simples y ni siquiera necesitas leer la documentación del SDK de WeChat:

**1. Configura el universal link y el esquema de URL en tu proyecto Xcode**

En el proyecto Xcode -> pestaña Signing & Capabilities, añade la capacidad "Associated Domains" y el universal link que configuraste antes.

<img src="/img/assets/universal-link.png" alt="Universal link" />

Luego ve a la pestaña "Info", añade un [esquema de URL personalizado](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) con el App ID de WeChat.

<img src="/img/assets/custom-url-scheme.png" alt="Esquema de URL personalizado" />

Finalmente, abre tu `Info.plist` y añade `weixinULAPI` y `weixin` bajo `LSApplicationQueriesSchemes`.

<img src="/img/assets/plist.png" alt="Plist" />

:::note

Sabemos que estas acciones no son muy razonables, pero esta es la solución mínima que encontramos que funciona. Consulta la [guía oficial mágica](https://developers.weixin.qq.com/doc/oplatform/en/Mobile_App/Access_Guide/iOS.html) para más información.

:::

**2. Añade `LogtoSocialPluginWechat` a tu proyecto Xcode**

Añade el framework:

<img src="/img/assets/add-framework.png" alt="Añadir framework" />

Y añade `-ObjC` en Build Settings > Linking > Other Linker Flags:

<img src="/img/assets/linker-flags.png" alt="Linker flags" />

:::note

El plugin incluye WeChat Open SDK 1.9.2. Puedes usar directamente `import WechatOpenSDK` una vez importado el plugin.

:::

**3. Añade el plugin a las opciones de inicialización de tu `LogtoClient`**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginWechat()]
)
```

**4. Maneja correctamente `onOpenURL`**

:::note

La función `LogtoClient.handle(url:)` gestionará todos los conectores nativos que hayas habilitado. Solo necesitas llamarla una vez.

:::

```swift
// SwiftUI
YourRootView()
  .onOpenURL { url in
      LogtoClient.handle(url: url)
  }

// o AppDelegate
func application(_ app: UIApplication, open url: URL, options: /*...*/) -> Bool {
  LogtoClient.handle(url: url)
}
```

### Android \{#android}

Suponemos que ya has integrado el [Logto Android SDK](/quick-starts/android) en tu app. En este caso, las cosas son bastante simples y ni siquiera necesitas leer la documentación del SDK de WeChat:

**1. Añade `Wechat Open SDK` a tu proyecto**

Asegúrate de que el repositorio `mavenCentral()` esté en los repositorios de tu proyecto Gradle:

```kotlin
repositories {
  // ...
  mavenCentral()
}
```

Añade el Wechat Open SDK a tus dependencias:

```kotlin
dependencies {
  // ...
  api("com.tencent.mm.opensdk:wechat-sdk-android:6.8.0")  // kotlin-script
  // o
  api 'com.tencent.mm.opensdk:wechat-sdk-android:6.8.0'   // groovy-script
}
```

**2. Introduce `WXEntryActivity` en tu proyecto**

Crea un paquete `wxapi` bajo la raíz de tu paquete y añade el `WXEntryActivity` en el paquete `wxapi` (Tomando `com.sample.app` como ejemplo):

```kotlin
// WXEntryActivity.kt
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

class WXEntryActivity: WechatSocialResultActivity()
```

```java
// WXEntryActivity.java
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

public class WXEntryActivity extends WechatSocialResultActivity {}
```

La ubicación final del `WXEntryActivity` en el proyecto debería verse así (tomando Kotlin como ejemplo):

```bash
src/main/kotlin/com/sample/app/wxapi/WXEntryActivity.kt
```

**3. Modifica el `AndroidManifest.xml`**

Añade la siguiente línea a tu `AndroidManifest.xml`:

```xml
\<?xml version="1.0" encoding="utf-8"?>
\<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.sample.app">

  \<application>
    \<!-- línea a añadir -->
    \<activity android:name=".wxapi.WXEntryActivity" android:exported="true"/>
  \</application>

\</manifest>
```
