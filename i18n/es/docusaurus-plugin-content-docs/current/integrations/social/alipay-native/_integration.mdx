## Registra una cuenta de desarrollador de Alipay \{#register-alipay-developer-account}

[Registra una cuenta de desarrollador de Alipay](https://certifyweb.alipay.com/certify/reg/guide#/) si aún no tienes una.

## Crea y configura una aplicación de Alipay \{#create-and-configure-alipay-app}

1. Inicia sesión en la [consola de Alipay](https://open.alipay.com/) con la cuenta que acabas de registrar.
2. Ve a la pestaña "Web & Mobile Apps" (网页&移动应用) en el panel "My Application" (我的应用).
3. Haz clic en el botón "Create an App" (立即创建) para comenzar a configurar tu aplicación.
4. Nombra tu aplicación en "Application Name" (应用名称) siguiendo las convenciones de nombres y sube tu "Application Icon" (应用图标), asegúrate de elegir "mobile application" (移动应用) como "App type" (应用类型). Para construir una App iOS, se requiere un "Bundle ID" único. Además, se requieren la "application signature" (应用签名) y el "application package name" (应用包名) para aplicaciones Android.
5. Después de terminar de crear la aplicación, llegamos a la página de Resumen, donde debemos hacer clic en "add ability" (添加能力) para agregar "Third-party application authorization" (第三方应用授权), "Get member information" (获取会员信息) y "App Alipay login" (App 支付宝登录) antes de habilitar el inicio de sesión con Alipay.
6. Ve al [Centro de Atención al Cliente de Alipay](https://b.alipay.com/index2.htm), e inicia sesión con la cuenta de desarrollador de Alipay. Haz clic en "Account Center" (账号中心) en la barra superior y ve a "APPID binding" (APPID 绑定), cuya entrada se encuentra en la parte inferior de la barra lateral. "Add binding" (添加绑定) escribiendo el APPID de la aplicación móvil que acabas de crear en el paso 4.
7. Haz clic en el botón "Sign" de "App Alipay login", y completa el proceso de firma siguiendo la guía. Después de terminar este paso, deberías ver que las capacidades que agregaste en el paso 5 ya están activas.
8. Regresa a la página de la consola de la plataforma abierta de Alipay, y podrás encontrar "Interface signing method" (接口加签方式（密钥/证书）) en la sección "development information" (开发信息). Haz clic en el botón "set up" (设置), y te encontrarás en una página para configurar el método de firma. "Public Key" (公钥) es el modo de firma preferido, y debes rellenar el contenido del archivo de clave pública que has generado en el cuadro de texto.
9. Configura la "Authorization Redirect URI" (授权回调地址) haciendo clic en el botón "set up" (设置) en la parte inferior de la página de la consola de Alipay. `${your_logto_origin}/callback/${connector_id}` es la URI de redirección predeterminada utilizada en Logto core. El `connector_id` se puede encontrar en la barra superior de la página de detalles del conector en Logto Admin Console.
10. Después de completar todos estos pasos, vuelve a la esquina superior derecha de la página de la consola de Alipay y haz clic en "Submit for review" (提交审核). Una vez que la revisión sea aprobada, ya puedes disfrutar de un flujo de inicio de sesión con Alipay sin problemas.

:::note

Puedes usar _openssl_ para generar pares de claves en tu máquina local ejecutando el siguiente fragmento de código en la terminal.

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Al rellenar la clave pública en el sitio web de configuración de la app de Alipay, necesitas eliminar el encabezado y pie de página de `public.pem`, borrar todos los saltos de línea y pegar el resto del contenido en el cuadro de texto para "public key".
:::

## Configura los ajustes del conector Logto Alipay Native \{#set-up-the-logto-alipay-native-connector-settings}

1. En [el espacio de trabajo de la consola de Alipay](https://open.alipay.com/dev/workspace) ve al panel "My application" (我的应用) y haz clic en la pestaña "Web & Mobile Apps" (网页&移动应用), allí puedes encontrar el APPID de todas las aplicaciones.
2. En el paso 7 de la parte anterior, ya has generado un par de claves que incluye una clave privada y una clave pública.
3. Completa los ajustes del conector de Logto:
   - Rellena el campo `appId` con el APPID que obtuviste en el paso 1.
   - Rellena el campo `privateKey` con el contenido del archivo de clave privada mencionado en el paso 2. ASEGÚRATE de usar '\n' para reemplazar todos los saltos de línea. No necesitas eliminar el encabezado y pie de página en el archivo de clave privada.
   - Rellena el campo `signType` con 'RSA2' debido al modo de firma `Public key` que elegimos en el paso 7 de "Crear y configurar aplicaciones de Alipay".

### Tipos de configuración \{#config-types}

| Nombre     | Tipo        | Valores enum   |
| ---------- | ----------- | -------------- |
| appId      | string      | N/A            |
| privateKey | string      | N/A            |
| signType   | enum string | 'RSA' / 'RSA2' |

## Habilita el inicio de sesión nativo de Alipay en tu app \{#enable-alipay-native-sign-in-in-your-app}

### iOS \{#ios}

Suponemos que ya has integrado el [Logto iOS SDK](/quick-starts/swift) en tu app. En este caso, las cosas son bastante simples, y ni siquiera necesitas leer la documentación del SDK de Alipay:

**1. Añade `LogtoSocialPluginAlipay` a tu proyecto Xcode**

Agrega el framework:

<img src="/img/assets/add-framework.png" alt="Add framework" />

:::note

El plugin incluye el "minimalist SDK" (极简版 SDK) de Alipay. Puedes usar directamente `import AFServiceSDK` una vez importado el plugin.

:::

**2. Añade el plugin a las opciones de inicialización de tu `LogtoClient`**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginAlipay(callbackScheme: "your-scheme")]
)
```

Donde `callbackScheme` es uno de los [custom URL Schemes](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) que puede redirigir a tu app.

### Android \{#android}

Suponemos que ya has integrado el [Logto Android SDK](/quick-starts/android) en tu app. En este caso, las cosas son bastante simples, y ni siquiera necesitas leer la documentación del SDK de Alipay:

**1. Descarga el "minimalist SDK" de Alipay y agrégalo a tu proyecto**

Descarga el "minimalist SDK" (极简版 SDK) de Alipay desde [Logto 3rd-party Social SDKs](https://github.com/logto-io/social-sdks/blob/master/alipay/android/alipaySdk-15.7.9-20200727142846.aar) a la carpeta `app/libs` de tu proyecto:

```bash
project-path/app/libs/alipaySdk-15.7.9-20200727142846.aar
```

**2. Añade el "minimalist SDK" de Alipay como dependencia**

Abre tu archivo `build.gradle`:

```bash
project-path/app/build.gradle
```

Agrega la dependencia:

```kotlin
dependencies {
  // ...
  implementation(files("./libs/alipaySdk-15.7.9-20200727142846.aar"))  // kotlin-script
  // o
  implementation files('./libs/alipaySdk-15.7.9-20200727142846.aar')  // groovy-script
}
```
