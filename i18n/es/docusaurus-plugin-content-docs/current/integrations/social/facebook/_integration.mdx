## Paso 1: Configura una aplicación en el Panel de Aplicaciones de Facebook \{#step-1-set-up-an-app-on-facebook-app-dashboard}

Antes de poder usar Facebook como proveedor de autenticación, debes configurar una aplicación en la plataforma de desarrolladores de Facebook para obtener credenciales de OAuth 2.0.

1. [Regístrate como desarrollador de Facebook](https://developers.facebook.com/docs/development/register/) si aún no tienes una cuenta.
2. Visita la página de [Aplicaciones](https://developers.facebook.com/apps).
3. Haz clic en tu aplicación existente o [crea una nueva](https://developers.facebook.com/docs/development/create-an-app) si es necesario.

:::tip
Un caso de uso es la forma principal en que tu aplicación interactuará con Meta y determina qué APIs, funciones, permisos y productos están disponibles para tu aplicación. Si solo necesitas autenticación social (para obtener email y public_profile), selecciona "Authentication and request data from users with Facebook Login". Si deseas acceder a las APIs de Facebook, elige tus casos de uso preferidos; la mayoría también admite la integración de "Facebook Login for business" después de crear la aplicación.
:::

4. Después de crear la aplicación, en la página del panel de la aplicación, navega a **Casos de uso > Facebook Login > Configuración** o **Facebook Login for business > Configuración**.
5. Rellena el campo **Valid OAuth Redirect URIs** con el **Callback URI** de Logto (cópialo desde tu conector de Facebook en Logto). Después de que los usuarios inicien sesión con Facebook, serán redirigidos aquí con un código de autorización que Logto utiliza para finalizar la autenticación.
6. Navega a **Casos de uso** y haz clic en **Personalizar** de tu caso de uso para añadir los alcances (scopes). Recomendamos añadir `email` y `public_profile`, que son necesarios para implementar el inicio de sesión con Facebook en Logto.

## Paso 2: Configura el conector de Logto con las credenciales de cliente \{#step-2-set-up-logto-connector-with-client-credentials}

1. En el Panel de Aplicaciones de Facebook, haz clic en la barra lateral **Configuración de la aplicación > Básico**.
2. Verás el **App ID** y el **App secret** en el panel.
3. Haz clic en el botón **Mostrar** junto al cuadro de entrada de App secret para revelar y copiar su contenido.
4. Configura los ajustes de tu conector de Facebook en Logto:
   - Rellena el campo `clientId` con el **App ID**.
   - Rellena el campo `clientSecret` con el **App secret**.
   - Haz clic en **Guardar y Listo** en Logto para conectar tu sistema de identidad con Facebook.

## Paso 3: Configura los alcances (scopes) \{#step-3-configure-scopes}

Los alcances definen los permisos que tu aplicación solicita a los usuarios y controlan a qué datos privados puede acceder tu proyecto desde sus cuentas de Facebook.

### Configura los alcances en el Panel de Aplicaciones de Facebook \{#configure-scopes-in-facebook-app-dashboard}

1. Navega a **Panel de Aplicaciones de Facebook > Casos de uso** y haz clic en el botón **Personalizar**.
2. Añade solo los alcances que tu aplicación necesita. Los usuarios revisarán y autorizarán estos permisos en la pantalla de consentimiento de Facebook:
   - **Para autenticación (Requerido)**: `email` y `public_profile`.
   - **Para acceso a la API (Opcional)**: Cualquier alcance adicional que tu aplicación necesite (por ejemplo, `threads_content_publish`, `threads_read_replies` para acceder a la API de Threads). Consulta la [Documentación para desarrolladores de Meta](https://developers.facebook.com/docs/) para ver los servicios disponibles.

### Configura los alcances en Logto \{#configure-scopes-in-logto}

Elige uno o más de los siguientes enfoques según tus necesidades:

**Opción 1: No se necesitan alcances extra de API**

- Deja el campo `Scopes` en tu conector de Facebook en Logto en blanco.
- Se solicitará el alcance predeterminado `email public_profile` para asegurar que Logto pueda obtener correctamente la información básica del usuario.

**Opción 2: Solicitar alcances adicionales al iniciar sesión**

- Ingresa todos los alcances deseados en el campo **Scopes**, separados por espacios.
- Cualquier alcance que incluyas aquí sobrescribe los valores predeterminados, así que asegúrate de incluir siempre los alcances de autenticación: `email public_profile`.

**Opción 3: Solicitar alcances incrementales más adelante**

- Después de que el usuario inicie sesión, puedes solicitar alcances adicionales bajo demanda reiniciando un flujo de autorización social federada y actualizando el conjunto de tokens almacenados del usuario.
- Estos alcances adicionales no necesitan ser incluidos en el campo `Scopes` de tu conector de Facebook en Logto, y pueden lograrse a través de la Social Verification API de Logto.

Siguiendo estos pasos, tu conector de Facebook en Logto solicitará exactamente los permisos que tu aplicación necesita, ni más ni menos.

:::tip
Si tu aplicación solicita estos alcances para acceder a la API de Facebook y realizar acciones, asegúrate de habilitar **Almacenar tokens para acceso persistente a la API** en el conector de Facebook de Logto. Consulta la siguiente sección para más detalles.
:::

## Paso 4: Configuración general \{#step-4-general-settings}

Aquí tienes algunas configuraciones generales que no bloquearán la conexión con Facebook, pero pueden afectar la experiencia de autenticación del usuario final.

### Sincronizar información de perfil \{#sync-profile-information}

En el conector de Facebook, puedes establecer la política para sincronizar la información de perfil, como nombres de usuario y avatares. Elige entre:

- **Sincronizar solo al registrarse**: La información del perfil se obtiene una vez cuando el usuario inicia sesión por primera vez.
- **Sincronizar siempre al iniciar sesión**: La información del perfil se actualiza cada vez que el usuario inicia sesión.

### Almacenar tokens para acceder a las APIs de Facebook (Opcional) \{#store-tokens-to-access-facebook-apis-optional}

Si deseas acceder a las APIs de Facebook y realizar acciones con la autorización del usuario (ya sea mediante inicio de sesión social o vinculación de cuentas), Logto necesita obtener alcances específicos de API y almacenar los tokens.

1. Añade los alcances requeridos siguiendo el tutorial anterior.
2. Habilita **Almacenar tokens para acceso persistente a la API** en el conector de Facebook de Logto. Logto almacenará de forma segura los tokens de acceso de Facebook en el Secret Vault.

:::note
Facebook no proporciona tokens de actualización (refresh tokens). Sin embargo, cuando el almacenamiento de tokens está habilitado, Logto solicita automáticamente un token de acceso de larga duración (60 días) al autenticar al usuario. Durante este período, los usuarios pueden revocar manualmente los tokens de acceso, pero de lo contrario no necesitarán volver a autorizar para acceder a las APIs de Facebook. Nota: No añadas `offline_access` al campo `Scope`, ya que esto puede causar errores.
:::

## Paso 5: Prueba el inicio de sesión con usuarios de prueba de Facebook (Opcional) \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

Puedes usar cuentas de usuario de prueba, desarrollador y administrador para probar el inicio de sesión con la aplicación. También puedes publicar la aplicación directamente para que cualquier usuario de Facebook pueda iniciar sesión.

1. En el Panel de Aplicaciones de Facebook, haz clic en la barra lateral **Roles de la aplicación > Usuarios de prueba**.
2. Haz clic en el botón **Crear usuarios de prueba** para crear un usuario de prueba.
3. Haz clic en el botón **Opciones** de un usuario de prueba existente para ver más operaciones, como "Cambiar nombre y contraseña".

## Paso 6: Publica la configuración de inicio de sesión con Facebook \{#step-6-publish-facebook-sign-in-settings}

Normalmente, solo los usuarios de prueba, administradores y desarrolladores pueden iniciar sesión con la aplicación. Para permitir que los usuarios normales de Facebook inicien sesión con la aplicación en el entorno de producción, es posible que debas publicar esta aplicación.

1. En el Panel de Aplicaciones de Facebook, haz clic en la barra lateral **Publicar**.
2. Rellena los campos **Privacy Policy URL** y **User data deletion** si es necesario.
3. Haz clic en el botón **Guardar cambios** en la esquina inferior derecha.
4. Haz clic en el botón de cambio **Live** en la barra superior de la aplicación.
