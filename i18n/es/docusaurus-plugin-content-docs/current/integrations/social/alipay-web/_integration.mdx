## Registrar cuenta de desarrollador de Alipay \{#register-alipay-developer-account}

[Registra una cuenta de desarrollador de Alipay](https://certifyweb.alipay.com/certify/reg/guide#/) si aún no tienes una.

## Crear y configurar una aplicación de Alipay \{#create-and-configure-alipay-app}

1. Inicia sesión en la [consola de Alipay](https://open.alipay.com/) con la cuenta que acabas de registrar.
2. Ve a la pestaña "Aplicaciones web y móviles" (网页&移动应用) en el panel "Mi aplicación" (我的应用).
3. Haz clic en el botón "Crear una aplicación" (立即创建) para comenzar a configurar tu aplicación.
4. Nombra tu aplicación en "Nombre de la aplicación" (应用名称) siguiendo las convenciones de nombres y sube tu "Icono de la aplicación" (应用图标), asegúrate de elegir "aplicación web" (网页应用) como "Tipo de aplicación" (应用类型).
5. Después de terminar de crear la aplicación, llegarás a la página de Resumen, donde debes hacer clic en "añadir capacidad" (添加能力) para agregar "Autorización de aplicación de terceros" (第三方应用授权), "Obtener información del miembro" (获取会员信息) y "Inicio de sesión de Alipay en la aplicación" (App 支付宝登录) antes de habilitar el inicio de sesión con Alipay.
6. Ve al [Centro de atención al cliente de Alipay](https://b.alipay.com/index2.htm), e inicia sesión con la cuenta de desarrollador de Alipay. Haz clic en "Centro de cuentas" (账号中心) en la barra superior y ve a "Vinculación de APPID" (APPID 绑定), cuya entrada se encuentra en la parte inferior de la barra lateral. "Agregar vinculación" (添加绑定) escribiendo el APPID de la aplicación web que acabas de crear en el paso 4.
7. Haz clic en el botón "Firmar" de "Inicio de sesión de Alipay en la aplicación", y completa el proceso de firma siguiendo la guía. Después de terminar este paso, deberías ver que las capacidades que agregaste en el paso 5 están activas.
8. Regresa a la página de la consola de la plataforma abierta de Alipay, y podrás encontrar "Método de firma de la interfaz" (接口加签方式（密钥/证书）) en la sección "información de desarrollo" (开发信息). Haz clic en el botón "configurar" (设置), y llegarás a una página para configurar el método de firma. "Clave pública" (公钥) es el modo de firma preferido, y debes rellenar el contenido del archivo de clave pública que has generado en el cuadro de texto.
9. Configura la "URI de redirección de autorización" (授权回调地址) haciendo clic en el botón "configurar" (设置) en la parte inferior de la página de la consola de Alipay. `${your_logto_origin}/callback/${connector_id}` es la URI de redirección predeterminada utilizada en Logto core. El `connector_id` se puede encontrar en la barra superior de la página de detalles del conector en la Consola de administración de Logto.
10. Después de completar todos estos pasos, vuelve a la esquina superior derecha de la página de la consola de Alipay y haz clic en "Enviar para revisión" (提交审核). Una vez que la revisión sea aprobada, ya puedes disfrutar de un flujo de inicio de sesión con Alipay sin problemas.

:::note
Puedes usar _openssl_ para generar pares de claves en tu máquina local ejecutando el siguiente fragmento de código en la terminal.

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Al rellenar la clave pública en el sitio web de configuración de la aplicación de Alipay, debes eliminar el encabezado y el pie de página de `public.pem`, borrar todos los saltos de línea y pegar el resto del contenido en el cuadro de texto para la "clave pública".

:::

## Configurar los ajustes del conector Logto Alipay Web \{#set-up-the-logto-alipay-web-connector-settings}

1. En [el espacio de trabajo de la consola de Alipay](https://open.alipay.com/dev/workspace) ve al panel "Mi aplicación" (我的应用) y haz clic en la pestaña "Aplicaciones web y móviles" (网页&移动应用), allí puedes encontrar el APPID de todas las aplicaciones.
2. En el paso 7 de la parte anterior, ya has generado un par de claves que incluye una clave privada y una clave pública.
3. Completa la configuración del conector de Logto:
   - Rellena el campo `appId` con el APPID que obtuviste en el paso 1.
   - Rellena el campo `privateKey` con el contenido del archivo de clave privada mencionado en el paso 2. ASEGÚRATE de usar '\n' para reemplazar todos los saltos de línea y no elimines el encabezado ni el pie de página en el archivo de clave privada.
   - Rellena el campo `signType` con 'RSA2' debido al modo de firma de `Clave pública` que elegimos en el paso 7 de "Crear y configurar aplicaciones de Alipay".
   - Rellena el campo `charset` con 'gbk' o 'utf8'. Puedes dejar este campo en blanco ya que es OPCIONAL. El valor predeterminado es 'utf8'.
   - Rellena el campo `scope` con 'auth_base' o 'auth_user'. Puedes dejar este campo en blanco ya que es OPCIONAL. El valor predeterminado es 'auth_user'. Puedes consultar la [diferencia](https://opendocs.alipay.com/fw/api/105942) entre los diferentes valores.

### Tipos de configuración \{#config-types}

| Nombre     | Tipo                   | Valores enumerados           |
| ---------- | ---------------------- | ---------------------------- |
| appId      | string                 | N/A                          |
| privateKey | string                 | N/A                          |
| signType   | enum string            | 'RSA' \| 'RSA2'              |
| charset    | enum string (OPCIONAL) | 'gbk' \| 'utf8' \| undefined |
| scope      | enum string (OPCIONAL) | 'auth_user' \| 'auth_base'   |
