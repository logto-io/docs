---
sidebar_label: iOS
---

import AppNote from './fragments/_app-note.mdx';
import SignInNote from './fragments/_sign-in-note.mdx';
import FurtherReadings from './fragments/_further-readings.md';
import ConfigureRedirectUri from './fragments/_configure-redirect-uri.mdx';
import redirectUriFigure from '@site/docs/docs/recipes/integrate-logto/assets/ios-redirect-uri.png';

# 在 iOS 应用中集成 Logto Swift SDK

<AppNote type="原生应用" />

## 将 Logto SDK 添加至依赖

使用如下的 URL 将 Logto SDK 添加至 Swift Package Manager 的依赖中。

```bash
https://github.com/logto-io/swift.git
```

从 Xcode 11 开始，无需任何额外工具你就可以 [引入一个 Swift package](https://developer.apple.com/documentation/swift_packages/adding_package_dependencies_to_your_app)。

因为一些技术原因，我们暂时不支持 **Carthage** 和 **CocoaPods**。

<details>
  <summary>Carthage</summary>

Carthage [needs a `xcodeproj` file to build](https://github.com/Carthage/Carthage/issues/1226#issuecomment-290931385), but `swift package generate-xcodeproj` will report a failure since we are using binary targets
for native social plugins. We will try to find a workaround later.

</details>

<details>
  <summary>CocoaPods</summary>

CocoaPods [does not support local dependency](https://github.com/CocoaPods/CocoaPods/issues/3276) and monorepo, thus it's hard to create a `.podspec` for this repo.

</details>

## 初始化 `LogtoClient`

```swift
import Logto

let config = try? LogtoConfig(
  endpoint: "<your-logto-endpoint>", // 例如 http://localhost:3001
  appId: "<your-app-id>"
)
let logtoClient = LogtoClient(useConfig: config)
```

我们默认会把例如 ID Token 和 Refresh Token 这样的凭据存储在 Keychain 中；如此一来用户在重新打开应用的时候无需再次登录。

如果需要禁用这个行为，可将 `usingPersistStorage` 设置成 `false`：

```swift
let config = try? LogtoConfig(
  // ...
  usingPersistStorage: false
)
```

## 登录

### 配置 Redirect URI

<ConfigureRedirectUri figureSrc={redirectUriFigure} redirectUri="logto://callback" />

:::info
iOS SDK 中的 Redirect URI 仅用于内部。除非连接器有要求，_无需_ 在项目中添加 [Custom URL Scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app)。
:::

### 通过浏览器登录

<SignInNote calling=".signInWithBrowser(redirectUri:)" />

回到 Xcode，使用下面的代码实现登录：

```swift
do {
  try await client.signInWithBrowser(redirectUri: "logto://callback")
  print(client.isAuthenticated) // true
} catch let error as LogtoClientErrors.SignIn {
  // 登录过程中有错误发生
}
```

## 退出登录

调用 `.signOut()` 将清除 Keychain 中所有 Logto 的数据（如果有）。

```swift
await client.signOut()
```

## 延展阅读

<FurtherReadings />
