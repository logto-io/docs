---
sidebar_label: Android
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import redirectUriFigure from './assets/android-redirect-uri.png';
import JavaSetupCode from './fragments/_android_sdk_setup_code_java.md';
import KotlinSetupCode from './fragments/_android_sdk_setup_code_kotlin.md';
import AppNote from './fragments/_app-note.mdx';
import ApplyAuthorizationToken from './fragments/_apply_authorization_token.md';
import ConfigureRedirectUri from './fragments/_configure-redirect-uri.mdx';
import FetchUserInformation from './fragments/_fetch-user-information.mdx';
import FurtherReadings from './fragments/_further-readings.md';
import GetAuthorizationToken from './fragments/_get_authorization_token.md';
import SignInNote from './fragments/_sign-in-note.mdx';

# Android：集成 Logto Android SDK

<AppNote type="原生应用" />

## 将 Logto SDK 添加至依赖

:::note
Logto Andorid SDK 支持的最小 Android API 级别为 24。
:::

将 `mavenCentral()` 添加到构建脚本中：

```kotlin
repositories {
    mavenCentral()
}
```

添加 Logto Android SDK 依赖：

<Tabs>

<TabItem value="kotlin" label="Kotlin">

```kotlin
dependencies {
    implementation("io.logto.sdk:android:1.0.0-alpha.0")
}
```

</TabItem>

<TabItem value="groovy" label="Groovy">

```groovy
dependencies {
    implementation 'io.logto.sdk:android:1.0.0-alpha.0'
}
```

</TabItem>

</Tabs>

## 初始化 LogtoClient

:::note
创建 LogtoClient 前，需要确保 Application 已经初始化。
:::

<Tabs>

<TabItem value="kotlin" label="Kotlin">

<KotlinSetupCode />

</TabItem>

<TabItem value="java" label="Java">

<JavaSetupCode />

</TabItem>

</Tabs>

## 登录

### 配置 Redirect URI

在 Andorid 中，Redirect URI 的格式应为：`$(LOGTO_REDIRECT_SCHEME)://$(YOUR_APP_PACKAGE)/callback`。

:::note
`LOGTO_REDIRECT_SCHEME` 应为自定义的反向域名格式的一串字符。  
`YOUR_APP_PACKAGE` 为你的应用包名。
:::

假设你将 `io.logto.android` 设定为你自定义的 `LOGTO_REDIRECT_SCHEME`，`io.logto.sample` 是你的应用包名，那么 Redirect URI 就是 `io.logto.android://io.logto.sample/callback`。

现在你可以在管理控制台中配置 Redirect URI 了（以 `io.logto.android://io.logto.sample/callback` 为例）。

<ConfigureRedirectUri
  figureSrc={redirectUriFigure}
  redirectUri="io.logto.android://io.logto.sample/callback"
/>

### 登录

<SignInNote calling=".signIn(context, redirectUri, completion)" />

<Tabs>

<TabItem value="kotlin" label="Kotlin">

```kotlin
logtoClient.signIn(this, "<your-redirect-uri>") { logtoException: LogtoException? ->
    // 当 `logtoException` 为 null 时，则登录成功。
}
```

</TabItem>

<TabItem value="java" label="Java">

```java
logtoClient.signIn(this, "<your-redirect-uri>", logtoException -> {
    // 当 `logtoException` 为 null 时，则登录成功。
});
```

</TabItem>

</Tabs>

当成功登录后，`logtoClient.isAuthenticated` 的值将为 `true`。

## 退出登录

调用 `.signOut(completion)` 操作会清除本地存储的用户相关凭据，即使在退出登录过程中发生了异常。

<Tabs>

<TabItem value="kotlin" label="Kotlin">

```kotlin
logtoClient.signOut { logtoException: LogtoException? ->
    // 无论是否存在 `logtoException`，本地存储的用户相关凭据都已清除。
}
```

</TabItem>

<TabItem value="java" label="Java">

```java
logtoClient.signOut(logtoException -> {
    // 无论是否存在 `logtoException`，本地存储的用户相关凭据都已清除。
});
```

</TabItem>

</Tabs>

## 获取用户信息

<FetchUserInformation apiCodeFragment="logtoClient.fetchUserInfo()" />

## 为后端 API 请求授权

<GetAuthorizationToken />

在启动时将这些资源的 **API Identifier** 作为配置传给 SDK。

<Tabs>
<TabItem value="kotlin" label="Kotlin">

```kotlin
override fun onCreate(savedInstanceState: Bundle?) {
  val logtoConfig = LogtoConfig(
    endpoint = "<your-logto-endpoint>",
    appId = "<your-app-id>",
    scopes = null,
     // 所有需要请求的 API resource
    resources = listOf("<your-resource-indicators>"),
    usingPersistStorage = true,
    prompt = PromptValue.CONSENT,
  )

  logtoClient = LogtoClient(logtoConfig, application)
}

```

</TabItem>
<TabItem value="java" label="Java">

```java
@Override
protected void onCreate(Bundle savedInstanceState) {
    // 所有需要请求的 API resource
    ArrayList<String> resources = new ArrayList<String>(Arrays.asList("<your-resource-indicators>"));

    LogtoConfig logtoConfig = new LogtoConfig(
        "<your-logto-endpoint>",  // E.g. http://localhost:3001
        "<your-app-id>",
        null,
        resources,
        true,
        PromptValue.CONSENT
    );

    logtoClient = new LogtoClient(logtoConfig, getApplication());
}
```

</TabItem>
</Tabs>

在发出 API 请求之前，你需要从 Logto 处获取授权令牌：

<Tabs>
<TabItem value="kotlin" label="Kotlin">

```kotlin
logtoClient.getAccessToken("<resource-indicator>", { logtoException, accessToken ->
    // 回掉处理
})
```

</TabItem>
<TabItem value="java" label="Java">

```java
logtoClient.getAccessToken("<resource-indicator>", (logtoException, accessToken) -> {
    // 回掉处理
});
```

</TabItem>

</Tabs>

<ApplyAuthorizationToken />

## 延展阅读

<FurtherReadings />
