---
sidebar_position: 1
sidebar_label: å®è·µä¸­çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
description: 'åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) å®è·µæŒ‡å—ï¼šå­¦ä¹ å¦‚ä½•è®¾è®¡æƒé™ã€ç®¡ç†è§’è‰²ï¼Œå¹¶åœ¨ä½ çš„ CMS ä¸­è®¾ç½®å®‰å…¨çš„æˆæƒ (Authorization)ã€‚'
---

<head>
  <link rel="canonical" href="https://blog.logto.io/rbac-in-practice" />
</head>

# å®è·µä¸­çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼šä¸ºä½ çš„åº”ç”¨å®ç°å®‰å…¨çš„æˆæƒ (Authorization)

ä½ æ˜¯å¦åœ¨ä¸ºä½ çš„åº”ç”¨å®ç°ä¸€ä¸ªå®‰å…¨ä¸”å¯æ‰©å±•çš„æˆæƒ (Authorization) ç³»ç»Ÿè€Œè‹¦æ¼ï¼ŸåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) æ˜¯ç®¡ç†ç”¨æˆ·æƒé™çš„è¡Œä¸šæ ‡å‡†ï¼Œä½†æ­£ç¡®å®ç°å®ƒå¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ã€‚æœ¬æ•™ç¨‹å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„å†…å®¹ç®¡ç†ç³»ç»Ÿ (CMS) ç¤ºä¾‹ï¼Œæ•™ä½ å¦‚ä½•æ„å»ºä¸€ä¸ªå¼ºå¤§çš„ RBAC ç³»ç»Ÿã€‚

é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å°†å­¦åˆ°ï¼š

- âœ¨ å¦‚ä½•è®¾è®¡å’Œå®ç°ç»†ç²’åº¦æƒé™ï¼Œå®ç°ç²¾ç¡®æ§åˆ¶
- ğŸ”’ å¦‚ä½•å°†æƒé™æœ‰åºåœ°ç»„ç»‡åˆ°æœ‰æ„ä¹‰çš„è§’è‰²ä¸­
- ğŸ‘¤ æœ‰æ•ˆå¤„ç†èµ„æºæ‰€æœ‰æƒçš„æŠ€å·§
- ğŸš€ è®©ä½ çš„æˆæƒ (Authorization) ç³»ç»Ÿå…·å¤‡å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§çš„æ–¹æ³•
- ğŸ’¡ é€šè¿‡çœŸå® CMS ç¤ºä¾‹çš„å®é™…å®ç°

æœ¬æ•™ç¨‹çš„å®Œæ•´æºç å¯åœ¨ [GitHub](https://github.com/logto-io/rbac-sample) è·å–ã€‚

## ç†è§£ RBAC åŸºç¡€ \{#understanding-rbac-fundamentals}

åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) ä¸ä»…ä»…æ˜¯ä¸ºç”¨æˆ·åˆ†é…æƒé™ã€‚å®ƒæ˜¯å…³äºåˆ›å»ºä¸€ç§ç»“æ„åŒ–çš„æˆæƒ (Authorization) æ–¹æ³•ï¼Œåœ¨å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ä¹‹é—´å–å¾—å¹³è¡¡ã€‚

ä½ å¯ä»¥åœ¨ Auth Wiki äº†è§£æ›´å¤š [ä»€ä¹ˆæ˜¯ RBAC](https://auth-wiki.logto.io/rbac)ã€‚

ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨å®ç°ä¸­éµå¾ªçš„å…³é”®åŸåˆ™ï¼š

### ç»†ç²’åº¦æƒé™è®¾è®¡ \{#fine-grained-permission-design}

ç»†ç²’åº¦æƒé™è®©ä½ å¯ä»¥ç²¾ç¡®æ§åˆ¶ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„æ“ä½œã€‚æˆ‘ä»¬ä¸å†ä»…ä»…ç”¨â€œç®¡ç†å‘˜â€æˆ–â€œç”¨æˆ·â€è¿™æ ·çš„å®½æ³›æƒé™ï¼Œè€Œæ˜¯å®šä¹‰ç”¨æˆ·å¯ä»¥å¯¹èµ„æºæ‰§è¡Œçš„å…·ä½“æ“ä½œã€‚ä¾‹å¦‚ï¼š

- `read:articles` - æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ä»»æ„æ–‡ç« 
- `create:articles` - åˆ›å»ºæ–°æ–‡ç« 
- `update:articles` - ä¿®æ”¹å·²æœ‰æ–‡ç« 
- `publish:articles` - æ›´æ”¹æ–‡ç« çš„å‘å¸ƒçŠ¶æ€

### èµ„æºæ‰€æœ‰æƒä¸è®¿é—®æ§åˆ¶ \{#resource-ownership-and-access-control}

èµ„æºæ‰€æœ‰æƒæ˜¯æˆ‘ä»¬ CMS æˆæƒ (Authorization) è®¾è®¡ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µã€‚RBAC å®šä¹‰äº†ä¸åŒè§’è‰²å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œè€Œæ‰€æœ‰æƒä¸ºè®¿é—®æ§åˆ¶å¢åŠ äº†ä¸ªäººç»´åº¦ï¼š

- ä½œè€…è‡ªåŠ¨æ‹¥æœ‰ä»–ä»¬åˆ›å»ºçš„æ–‡ç« çš„è®¿é—®æƒé™
- è¿™ç§è‡ªç„¶çš„æ‰€æœ‰æƒæ¨¡å‹æ„å‘³ç€ä½œè€…å§‹ç»ˆå¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘è‡ªå·±çš„å†…å®¹
- ç³»ç»Ÿåœ¨å¤„ç†æ–‡ç« æ“ä½œæ—¶ä¼šåŒæ—¶æ£€æŸ¥è§’è‰²æƒé™æˆ–æ‰€æœ‰æƒ
- ä¾‹å¦‚ï¼Œå³ä½¿æ²¡æœ‰ `update:articles` æƒé™ï¼Œä½œè€…ä»ç„¶å¯ä»¥ç¼–è¾‘è‡ªå·±çš„æ–‡ç« 
- è¿™ç§è®¾è®¡å‡å°‘äº†é¢å¤–è§’è‰²æƒé™çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¿è¯äº†å®‰å…¨æ€§

è¿™ç§åŒå±‚æœºåˆ¶ï¼ˆè§’è‰² + æ‰€æœ‰æƒï¼‰è®©ç³»ç»Ÿæ›´ç›´è§‚ã€æ›´å®‰å…¨ã€‚å‘å¸ƒè€…å’Œç®¡ç†å‘˜ä¾ç„¶å¯ä»¥é€šè¿‡å…¶è§’è‰²æƒé™ç®¡ç†æ‰€æœ‰å†…å®¹ï¼Œè€Œä½œè€…åˆ™å¯¹è‡ªå·±çš„ä½œå“æ‹¥æœ‰æ§åˆ¶æƒã€‚

## è®¾è®¡å®‰å…¨çš„ API \{#designing-a-secure-apis}

è®©æˆ‘ä»¬ä»é€šè¿‡ API ç«¯ç‚¹è®¾è®¡ CMS çš„æ ¸å¿ƒåŠŸèƒ½å¼€å§‹ï¼š

```
GET    /api/articles         # åˆ—å‡ºæ‰€æœ‰æ–‡ç« 
GET    /api/articles/:id     # è·å–æŒ‡å®šæ–‡ç« 
POST   /api/articles        # åˆ›å»ºæ–°æ–‡ç« 
PATCH  /api/articles/:id    # æ›´æ–°æ–‡ç« 
DELETE /api/articles/:id    # åˆ é™¤æ–‡ç« 
PATCH  /api/articles/:id/published  # æ›´æ”¹å‘å¸ƒçŠ¶æ€
```

### ä¸º API å®ç°è®¿é—®æ§åˆ¶ \{#implement-access-control-for-your-api}

å¯¹äºæ¯ä¸ªç«¯ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è®¿é—®æ§åˆ¶çš„ä¸¤ä¸ªæ–¹é¢ï¼š

1. èµ„æºæ‰€æœ‰æƒ â€”â€” ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è¯¥èµ„æºï¼Ÿ
2. åŸºäºè§’è‰²çš„æƒé™ â€”â€” ç”¨æˆ·çš„è§’è‰²æ˜¯å¦å…è®¸è¯¥æ“ä½œï¼Ÿ

ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¯¹æ¯ä¸ªç«¯ç‚¹çš„è®¿é—®æ§åˆ¶å¤„ç†æ–¹å¼ï¼š

| ç«¯ç‚¹                              | è®¿é—®æ§åˆ¶é€»è¾‘                                                |
| --------------------------------- | ----------------------------------------------------------- |
| GET /api/articles                 | - å…·æœ‰ `list:articles` æƒé™çš„ç”¨æˆ·ï¼Œæˆ–ä½œè€…å¯ä»¥çœ‹åˆ°è‡ªå·±çš„æ–‡ç«  |
| GET /api/articles/:id             | - å…·æœ‰ `read:articles` æƒé™çš„ç”¨æˆ·ï¼Œæˆ–è¯¥æ–‡ç« çš„ä½œè€…           |
| POST /api/articles                | - å…·æœ‰ `create:articles` æƒé™çš„ç”¨æˆ·                         |
| PATCH /api/articles/:id           | - å…·æœ‰ `update:articles` æƒé™çš„ç”¨æˆ·ï¼Œæˆ–è¯¥æ–‡ç« çš„ä½œè€…         |
| DELETE /api/articles/:id          | - å…·æœ‰ `delete:articles` æƒé™çš„ç”¨æˆ·ï¼Œæˆ–è¯¥æ–‡ç« çš„ä½œè€…         |
| PATCH /api/articles/:id/published | - ä»…å…·æœ‰ `publish:articles` æƒé™çš„ç”¨æˆ·                      |

### æ„å»ºå¯æ‰©å±•çš„æƒé™ç³»ç»Ÿ \{#creating-a-permission-system-that-scales}

åŸºäºæˆ‘ä»¬çš„ API è®¿é—®éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹æƒé™ï¼š

| æƒé™             | æè¿°                     |
| ---------------- | ------------------------ |
| list:articles    | æŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ç« çš„åˆ—è¡¨ |
| read:articles    | é˜…è¯»ä»»æ„æ–‡ç« çš„å®Œæ•´å†…å®¹   |
| create:articles  | åˆ›å»ºæ–°æ–‡ç«                |
| update:articles  | ä¿®æ”¹ä»»æ„æ–‡ç«              |
| delete:articles  | åˆ é™¤ä»»æ„æ–‡ç«              |
| publish:articles | æ›´æ”¹å‘å¸ƒçŠ¶æ€             |

æ³¨æ„ï¼Œè¿™äº›æƒé™åªåœ¨è®¿é—®ä½ ä¸æ‹¥æœ‰çš„èµ„æºæ—¶éœ€è¦ã€‚æ–‡ç« æ‰€æœ‰è€…å¯ä»¥è‡ªåŠ¨ï¼š

- æŸ¥çœ‹è‡ªå·±çš„æ–‡ç« ï¼ˆæ— éœ€ `read:articles` æƒé™ï¼‰
- ç¼–è¾‘è‡ªå·±çš„æ–‡ç« ï¼ˆæ— éœ€ `update:articles` æƒé™ï¼‰
- åˆ é™¤è‡ªå·±çš„æ–‡ç« ï¼ˆæ— éœ€ `delete:articles` æƒé™ï¼‰

## æ„å»ºæœ‰æ•ˆçš„è§’è‰² \{#building-effective-roles}

ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº† API å’Œæƒé™ï¼Œå¯ä»¥é€»è¾‘åœ°å°†è¿™äº›æƒé™åˆ†ç»„åˆ›å»ºè§’è‰²ï¼š

| æƒé™/è§’è‰²        | ğŸ‘‘ ç®¡ç†å‘˜ (Admin)    | ğŸ“ å‘å¸ƒè€… (Publisher)        | âœï¸ ä½œè€… (Author)     |
| ---------------- | -------------------- | ---------------------------- | -------------------- |
| **æè¿°**         | æ‹¥æœ‰å®Œæ•´å†…å®¹ç®¡ç†æƒé™ | å¯æŸ¥çœ‹æ‰€æœ‰æ–‡ç« å¹¶ç®¡ç†å‘å¸ƒçŠ¶æ€ | å¯åœ¨ç³»ç»Ÿä¸­åˆ›å»ºæ–°æ–‡ç«  |
| list:articles    | âœ…                   | âœ…                           | âŒ                   |
| read:articles    | âœ…                   | âœ…                           | âŒ                   |
| create:articles  | âœ…                   | âŒ                           | âœ…                   |
| update:articles  | âœ…                   | âŒ                           | âŒ                   |
| delete:articles  | âœ…                   | âŒ                           | âŒ                   |
| publish:articles | âœ…                   | âœ…                           | âŒ                   |

**æ³¨æ„**ï¼šä½œè€…æ— è®ºè§’è‰²æƒé™å¦‚ä½•ï¼Œè‡ªåŠ¨æ‹¥æœ‰å¯¹è‡ªå·±æ–‡ç« çš„è¯»å– / æ›´æ–° / åˆ é™¤æƒé™ã€‚

æ¯ä¸ªè§’è‰²éƒ½é’ˆå¯¹ç‰¹å®šèŒè´£è¿›è¡Œè®¾è®¡ï¼š

- **ç®¡ç†å‘˜ (Admin)**ï¼šå¯¹ CMS æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒï¼ŒåŒ…æ‹¬æ‰€æœ‰æ–‡ç« æ“ä½œ
- **å‘å¸ƒè€… (Publisher)**ï¼šä¸“æ³¨äºå†…å®¹å®¡æ ¸å’Œå‘å¸ƒç®¡ç†
- **ä½œè€… (Author)**ï¼šä¸“æ³¨äºå†…å®¹åˆ›ä½œ

è¿™ç§è§’è‰²ç»“æ„å®ç°äº†å…³æ³¨ç‚¹çš„æ¸…æ™°åˆ†ç¦»ï¼š

- ä½œè€…ä¸“æ³¨äºå†…å®¹åˆ›ä½œ
- å‘å¸ƒè€…ç®¡ç†å†…å®¹è´¨é‡å’Œå¯è§æ€§
- ç®¡ç†å‘˜ç»´æŠ¤æ•´ä½“ç³»ç»Ÿæ§åˆ¶

## åœ¨ Logto ä¸­é…ç½® RBAC \{#config-rbac-in-logto}

åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦åœ¨ [Logto Cloud](https://cloud.logto.io) åˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥é€šè¿‡ [Logto OSS ç‰ˆæœ¬](/logto-oss) ä½¿ç”¨è‡ªæ‰˜ç®¡çš„ Logto å®ä¾‹ã€‚

ä½†æœ¬æ•™ç¨‹ä¸ºç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Logto Cloudã€‚

### è®¾ç½®ä½ çš„åº”ç”¨ \{#setting-up-your-application}

1. åœ¨ Logto æ§åˆ¶å°çš„â€œåº”ç”¨ç¨‹åºâ€ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ React åº”ç”¨
   - åº”ç”¨åç§°ï¼šå†…å®¹ç®¡ç†ç³»ç»Ÿ
   - åº”ç”¨ç±»å‹ï¼šä¼ ç»Ÿ Web åº”ç”¨
   - é‡å®šå‘ URIï¼šhttp://localhost:5173/callback

![CMS React åº”ç”¨](https://uploads.strapi.logto.io/cms_application_3ed42f2256.png)

### é…ç½® API èµ„æºå’Œæƒé™ \{#configuring-api-resources-and-permissions}

1. åœ¨ Logto æ§åˆ¶å°çš„â€œAPI èµ„æºâ€ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ API èµ„æº
   - API åç§°ï¼šCMS API
   - API æ ‡è¯†ç¬¦ï¼šhttps://api.cms.com
   - ä¸º API èµ„æºæ·»åŠ æƒé™
     - `list:articles`
     - `read:articles`
     - `create:articles`
     - `update:articles`
     - `publish:articles`
     - `delete:articles`

![CMS API èµ„æºè¯¦æƒ…](https://uploads.strapi.logto.io/cms_api_resource_b15ae2b91a.png)

### åˆ›å»ºè§’è‰² \{#creating-roles}

åœ¨ Logto æ§åˆ¶å°çš„â€œè§’è‰²â€ä¸­ä¸º CMS åˆ›å»ºä»¥ä¸‹è§’è‰²

- ç®¡ç†å‘˜ (Admin)
  - æ‹¥æœ‰æ‰€æœ‰æƒé™
- å‘å¸ƒè€… (Publisher)
  - æ‹¥æœ‰ `read:articles`ã€`list:articles`ã€`publish:articles`
- ä½œè€… (Author)
  - æ‹¥æœ‰ `create:articles`

![ç®¡ç†å‘˜è§’è‰²](https://uploads.strapi.logto.io/admin_role_53edb35ecf.png)

![å‘å¸ƒè€…è§’è‰²](https://uploads.strapi.logto.io/publisher_role_2ac205cc32.png)

![ä½œè€…è§’è‰²](https://uploads.strapi.logto.io/author_role_f89cd99543.png)

### åˆ†é…è§’è‰²ç»™ç”¨æˆ· \{#assigning-roles-to-users}

åœ¨ Logto æ§åˆ¶å°çš„â€œç”¨æˆ·ç®¡ç†â€éƒ¨åˆ†åˆ›å»ºç”¨æˆ·ã€‚

åœ¨ç”¨æˆ·è¯¦æƒ…çš„â€œè§’è‰²â€æ ‡ç­¾é¡µä¸­ï¼Œä½ å¯ä»¥ä¸ºç”¨æˆ·åˆ†é…è§’è‰²ã€‚

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 3 ä¸ªç”¨æˆ·å¹¶åˆ†é…å¦‚ä¸‹è§’è‰²ï¼š

- Alexï¼šç®¡ç†å‘˜ (Admin)
- Bobï¼šå‘å¸ƒè€… (Publisher)
- Charlieï¼šä½œè€… (Author)

![ç”¨æˆ·ç®¡ç†](https://uploads.strapi.logto.io/user_management_c0bc17119f.png)

![ç”¨æˆ·è¯¦æƒ… - Alex](https://uploads.strapi.logto.io/user_details_alex_702f96ef9a.png)

:::note
ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬é€šè¿‡ Logto æ§åˆ¶å°åˆ›å»ºè¿™äº›èµ„æºå’Œé…ç½®ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ Logto æä¾›çš„ [Management API](/integrate-logto/interact-with-management-api) ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºè¿™äº›èµ„æºå’Œé…ç½®ã€‚
:::

## å‰ç«¯é›†æˆ Logto RBAC \{#integrate-your-frontend-with-logto-rbac}

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åœ¨ Logto ä¸­é…ç½®å¥½äº† RBACï¼Œå¯ä»¥å¼€å§‹å°†å…¶é›†æˆåˆ°å‰ç«¯ã€‚

é¦–å…ˆï¼ŒæŒ‰ç…§ [Logto å¿«é€Ÿå¼€å§‹](/quick-starts) å°† Logto é›†æˆåˆ°ä½ çš„åº”ç”¨ä¸­ã€‚

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ [React](/quick-starts/react) è¿›è¡Œæ¼”ç¤ºã€‚

åœ¨ä½ çš„åº”ç”¨ä¸­é…ç½®å¥½ Logto åï¼Œæˆ‘ä»¬éœ€è¦ä¸º Logto æ·»åŠ  RBAC é…ç½®ã€‚

```tsx
// frontend/src/App.tsx

const logtoConfig: LogtoConfig = {
  appId: LOGTO_APP_ID, // ä½ åœ¨ Logto æ§åˆ¶å°åˆ›å»ºçš„åº”ç”¨ ID
  endpoint: LOGTO_ENDPOINT, // ä½ åœ¨ Logto æ§åˆ¶å°åˆ›å»ºçš„ endpoint
  resources: [API_RESOURCE], // ä½ åœ¨ Logto æ§åˆ¶å°åˆ›å»ºçš„ API èµ„æºæ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ https://api.cms.com
  // å‰ç«¯å¯èƒ½éœ€è¦ä» API èµ„æºè¯·æ±‚çš„æ‰€æœ‰æƒé™ (scopes)
  scopes: [
    'list:articles',
    'create:articles',
    'read:articles',
    'update:articles',
    'delete:articles',
    'publish:articles',
  ],
};
```

å¦‚æœä½ å·²ç»ç™»å½•ï¼Œè®°å¾—å…ˆé€€å‡ºå†é‡æ–°ç™»å½•ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚

å½“ç”¨æˆ·é€šè¿‡ Logto ç™»å½•å¹¶ä¸ºä¸Šè¿° API èµ„æºè¯·æ±‚è®¿é—®ä»¤ç‰Œ (Access token) æ—¶ï¼ŒLogto ä¼šå°†ä¸ç”¨æˆ·è§’è‰²ç›¸å…³çš„æƒé™ (scopes) æ·»åŠ åˆ°è®¿é—®ä»¤ç‰Œ (Access token) ä¸­ã€‚

ä½ å¯ä»¥é€šè¿‡ `useLogto` hook çš„ `getAccessTokenClaims` è·å–è®¿é—®ä»¤ç‰Œ (Access token) ä¸­çš„æƒé™ (scopes)ã€‚

```tsx
// frontend/src/hooks/use-user-data.ts

import { useLogto } from '@logto/react';
import { API_RESOURCE } from '../config';
import { useState, useEffect } from 'react';

export const useUserData = () => {
  const { getAccessTokenClaims } = useLogto();
  const [userScopes, setUserScopes] = useState<string[]>([]);
  const [userId, setUserId] = useState<string>();

  useEffect(() => {
    const fetchScopes = async () => {
      const token = await getAccessTokenClaims(API_RESOURCE);
      setUserScopes(token?.scope?.split(' ') ?? []);
      setUserId(token?.sub);
    };

    fetchScopes();
  }, [getAccessTokenClaims]);

  return { userId, userScopes };
};
```

ä½ å¯ä»¥ä½¿ç”¨ `userScopes` æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èµ„æºã€‚

```tsx
// frontend/src/pages/Dashboard.tsx

const Dashboard = () => {
  const { userId, userScopes } = useUserData();
  // ...

  return (
    <div>
      {/* ... */}
      {(userScopes.includes('delete:articles') || article.ownerId === userId) && (
        <button
          onClick={() => handleDelete(article.id)}
          className="text-red-600 hover:text-red-900"
        >
          åˆ é™¤
        </button>
      )}
    </div>
  );
};
```

## åç«¯é›†æˆ Logto RBAC \{#integrate-your-backend-with-logto-rbac}

ç°åœ¨ï¼Œæ˜¯æ—¶å€™å°† Logto RBAC é›†æˆåˆ°ä½ çš„åç«¯äº†ã€‚

### åç«¯æˆæƒ (Authorization) ä¸­é—´ä»¶ \{#backend-authorization-middleware}

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨åç«¯æ·»åŠ ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç”¨äºæ£€æŸ¥ç”¨æˆ·æƒé™ã€éªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œå¹¶åˆ¤æ–­å…¶æ˜¯å¦æœ‰æƒé™è®¿é—®æŸäº› APIã€‚

```javascript
// backend/src/middleware/auth.js

const { createRemoteJWKSet, jwtVerify } = require('jose');

const getTokenFromHeader = (headers) => {
  const { authorization } = headers;
  const bearerTokenIdentifier = 'Bearer';

  if (!authorization) {
    throw new Error('Authorization header missing');
  }

  if (!authorization.startsWith(bearerTokenIdentifier)) {
    throw new Error('Authorization token type not supported');
  }

  return authorization.slice(bearerTokenIdentifier.length + 1);
};

const hasScopes = (tokenScopes, requiredScopes) => {
  if (!requiredScopes || requiredScopes.length === 0) {
    return true;
  }
  const scopeSet = new Set(tokenScopes);
  return requiredScopes.every((scope) => scopeSet.has(scope));
};

const verifyJwt = async (token) => {
  const JWKS = createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL));

  const { payload } = await jwtVerify(token, JWKS, {
    issuer: process.env.LOGTO_ISSUER,
    audience: process.env.LOGTO_API_RESOURCE,
  });

  return payload;
};

const requireAuth = (requiredScopes = []) => {
  return async (req, res, next) => {
    try {
      // æå–ä»¤ç‰Œ
      const token = getTokenFromHeader(req.headers);

      // éªŒè¯ä»¤ç‰Œ
      const payload = await verifyJwt(token);

      // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚
      req.user = {
        id: payload.sub,
        scopes: payload.scope?.split(' ') || [],
      };

      // éªŒè¯æ‰€éœ€æƒé™
      if (!hasScopes(req.user.scopes, requiredScopes)) {
        throw new Error('Insufficient permissions');
      }

      next();
    } catch (error) {
      res.status(401).json({ error: 'Unauthorized' });
    }
  };
};

module.exports = {
  requireAuth,
  hasScopes,
};
```

å¦‚ä½ æ‰€è§ï¼Œåœ¨è¿™ä¸ªä¸­é—´ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šéªŒè¯å‰ç«¯è¯·æ±‚æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œ (Access token)ï¼Œå¹¶æ£€æŸ¥è®¿é—®ä»¤ç‰Œ (Access token) çš„å—ä¼—æ˜¯å¦ä¸æˆ‘ä»¬åœ¨ Logto æ§åˆ¶å°åˆ›å»ºçš„ API èµ„æºä¸€è‡´ã€‚

éªŒè¯ API èµ„æºçš„åŸå› åœ¨äºï¼Œæˆ‘ä»¬çš„ API èµ„æºå®é™…ä¸Šä»£è¡¨äº† CMS åç«¯çš„èµ„æºï¼Œæ‰€æœ‰ CMS æƒé™éƒ½ä¸è¯¥ API èµ„æºç›¸å…³è”ã€‚

ç”±äºè¯¥ API èµ„æºåœ¨ Logto ä¸­ä»£è¡¨ CMS èµ„æºï¼Œåœ¨å‰ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨å‘åç«¯å‘èµ· API è¯·æ±‚æ—¶ä¼šæºå¸¦ç›¸åº”çš„è®¿é—®ä»¤ç‰Œ (Access token)ï¼š

```typescript
// frontend/src/hooks/use-api.ts
export const useApi = () => {
  const { getAccessToken } = useLogto();

  return useMemo(
    () =>
      async (endpoint: string, options: RequestInit = {}) => {
        try {
          // è·å– API èµ„æºçš„è®¿é—®ä»¤ç‰Œ (Access token)
          const token = await getAccessToken(API_RESOURCE);

          if (!token) {
            throw new ApiRequestError('Failed to get access token');
          }

          const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            ...options,
            headers: {
              'Content-Type': 'application/json',
              // åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ è®¿é—®ä»¤ç‰Œ (Access token)
              Authorization: `Bearer ${token}`,
              ...options.headers,
            },
          });

          // ... å¤„ç†å“åº”

          return await response.json();
        } catch (error) {
          // ... é”™è¯¯å¤„ç†
        }
      },
    [getAccessToken]
  );
};
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `requireAuth` ä¸­é—´ä»¶æ¥ä¿æŠ¤æˆ‘ä»¬çš„ API ç«¯ç‚¹ã€‚

### ä¿æŠ¤ API ç«¯ç‚¹ \{#protecting-api-endpoints}

å¯¹äºåªå…è®¸å…·æœ‰ç‰¹å®šæƒé™çš„ç”¨æˆ·è®¿é—®çš„ APIï¼Œå¯ä»¥ç›´æ¥åœ¨ä¸­é—´ä»¶ä¸­æ·»åŠ é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ–‡ç« åˆ›å»º API åªå…è®¸å…·æœ‰ `create:articles` æƒé™çš„ç”¨æˆ·è®¿é—®ï¼š

```javascript
// backend/src/routes/articles.js

const { requireAuth } = require('../middleware/auth');

router.post('/articles', requireAuth(['create:articles']), async (req, res) => {
  // ...
});
```

å¯¹äºéœ€è¦åŒæ—¶æ£€æŸ¥æƒé™å’Œèµ„æºæ‰€æœ‰æƒçš„ APIï¼Œå¯ä»¥ä½¿ç”¨ `hasScopes` å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨æ–‡ç« åˆ—è¡¨ API ä¸­ï¼Œå…·æœ‰ `list:articles` æƒé™çš„ç”¨æˆ·å¯ä»¥è®¿é—®æ‰€æœ‰æ–‡ç« ï¼Œè€Œä½œè€…åªèƒ½è®¿é—®è‡ªå·±åˆ›å»ºçš„æ–‡ç« ï¼š

```javascript
// backend/src/routes/articles.js

const { requireAuth, hasScopes } = require('../middleware/auth');

router.get('/articles', requireAuth(), async (req, res) => {
  try {
    // å¦‚æœç”¨æˆ·æœ‰ list:articles æƒé™ï¼Œè¿”å›æ‰€æœ‰æ–‡ç« 
    if (hasScopes(req.user.scopes, ['list:articles'])) {
      const articles = await articleDB.list();
      return res.json(articles);
    }

    // å¦åˆ™ï¼Œä»…è¿”å›ç”¨æˆ·è‡ªå·±çš„æ–‡ç« 
    const articles = await articleDB.listByOwner(req.user.id);
    res.json(articles);
  } catch (error) {
    res.status(500).json({ error: 'Failed to fetch articles' });
  }
});
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† RBAC çš„å®ç°ã€‚ä½ å¯ä»¥æŸ¥çœ‹ [å®Œæ•´æºç ](https://github.com/logto-io/rbac-sample) äº†è§£å…¨éƒ¨å®ç°ç»†èŠ‚ã€‚

## æµ‹è¯• CMS RBAC å®ç° \{#test-the-cms-rbac-implementation}

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨åˆšåˆšåˆ›å»ºçš„ä¸‰ä¸ªç”¨æˆ·æ¥æµ‹è¯•æˆ‘ä»¬çš„ CMS RBAC å®ç°ã€‚

:::note
å¦‚æœä½ å‘ç°æ— æ³•ä½¿ç”¨â€œç”¨æˆ·ç®¡ç†â€ä¸­åˆ›å»ºçš„ç”¨æˆ·å‡­æ®ç™»å½•ï¼Œéœ€è¦å…ˆå¯ç”¨ç›¸åº”çš„ç™»å½•æ–¹å¼ã€‚è¯·å‰å¾€ Logto æ§åˆ¶å°çš„â€œç™»å½•ä½“éªŒâ€ï¼Œå¯ç”¨ä½ å–œæ¬¢çš„è®¤è¯ (Authentication) æ–¹å¼ï¼ˆå¦‚é‚®ç®± + å¯†ç æˆ–ç”¨æˆ·å + å¯†ç ï¼‰ã€‚
:::

é¦–å…ˆï¼Œåˆ†åˆ«ä»¥ Alex å’Œ Charles ç™»å½•å¹¶åˆ›å»ºä¸€äº›æ–‡ç« ã€‚

ç”±äº Alex æ‹¥æœ‰ç®¡ç†å‘˜ (Admin) è§’è‰²ï¼Œä»–å¯ä»¥åˆ›å»ºã€åˆ é™¤ã€æ›´æ–°ã€å‘å¸ƒå¹¶æŸ¥çœ‹æ‰€æœ‰æ–‡ç« ã€‚

![CMS æ§åˆ¶å° - Alex](https://uploads.strapi.logto.io/cms_dashboard_alex_a11863a94b.png)

Charles æ‹¥æœ‰ä½œè€… (Author) è§’è‰²ï¼Œåªèƒ½åˆ›å»ºè‡ªå·±çš„æ–‡ç« ï¼Œå¹¶ä¸”åªèƒ½æŸ¥çœ‹ã€æ›´æ–°å’Œåˆ é™¤è‡ªå·±æ‹¥æœ‰çš„æ–‡ç« ã€‚

![CMS æ§åˆ¶å° - Charles - æ–‡ç« åˆ—è¡¨](https://uploads.strapi.logto.io/cms_dashboard_charles_05f610066a.png)

Bob æ‹¥æœ‰å‘å¸ƒè€… (Publisher) è§’è‰²ï¼Œå¯ä»¥æŸ¥çœ‹å’Œå‘å¸ƒæ‰€æœ‰æ–‡ç« ï¼Œä½†ä¸èƒ½åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ–‡ç« ã€‚

![CMS æ§åˆ¶å° - Bob](https://uploads.strapi.logto.io/cms_dashboard_bob_421a429b69.png)

## æ€»ç»“ \{#conclusion}

æ­å–œä½ ï¼ä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•åœ¨åº”ç”¨ä¸­å®ç°ä¸€ä¸ªå¼ºå¤§çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) ç³»ç»Ÿã€‚

å¯¹äºæ›´å¤æ‚çš„åœºæ™¯ï¼Œæ¯”å¦‚æ„å»ºå¤šç§Ÿæˆ·åº”ç”¨ï¼ŒLogto æä¾›äº†å®Œå–„çš„ç»„ç»‡ (Organization) æ”¯æŒã€‚ä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„æŒ‡å— [æ„å»ºå¤šç§Ÿæˆ· SaaS åº”ç”¨ï¼šä»è®¾è®¡åˆ°å®ç°çš„å®Œæ•´æŒ‡å—](https://blog.logto.io/build-multi-tenant-saas) äº†è§£å¦‚ä½•å®ç°ç»„ç»‡çº§åˆ«çš„è®¿é—®æ§åˆ¶ã€‚

ç¥ä½ ç¼–ç æ„‰å¿«ï¼ğŸš€
