### 可选：处理用户权限变更 \{#optional-handle-user-permission-change}

用户权限随时可能发生变化。由于 Logto 为基于角色的访问控制 (RBAC) 签发 JWT，权限更新只会出现在新签发的令牌中，永远不会修改已有的 JWT。

:::info 权限 (Scope) 子集规则
访问令牌 (Access token) 只能包含在原始 OAuth 授权 (Authorization) 流程中请求的权限 (Scopes)。
即使用户获得了新的权限 (Permissions)，之后签发的令牌也只能包含最初请求权限 (Scopes) 的子集。
要访问最初未请求的新权限 (Scopes)，客户端必须重新发起授权 (Authorization) 流程。
:::

#### 权限收缩 \{#downscoped-permissions}

当用户失去权限时：

- 新签发的令牌会立即反映减少后的权限 (Scopes)。
- 已有的 JWT 会保留旧的权限 (Scopes)，直到过期为止。
- 你的 API 应始终校验权限 (Scopes)，并依赖较短的令牌有效期。

如果你需要更快的响应，可以实现自己的信号机制，通知客户端刷新令牌。

#### 权限扩大 \{#enlarged-permissions}

{props.type === "global" && <p>对于全局 API 资源，当用户获得新权限时，权限扩大不会通过刷新立即体现。客户端必须重新执行 OAuth 授权 (Authorization) 流程，才能获取包含新权限 (Scopes) 的令牌。如果用户有活跃的 Logto 会话，这一过程可以静默完成。</p>}

{props.type === "organization" && <p>对于组织令牌 (Organization token)，当用户获得新权限时，权限扩大会在下次签发（刷新或令牌请求）时体现。仍然需要获取新令牌，但除非新权限 (Scopes) 超出最初请求集，否则无需完全重新认证 (Authentication)。</p>}

#### 建议 \{#recommendations}

- 在每次 API 调用时校验权限 (Scopes)。
- 保持令牌过期时间较短。
- 如需权限变更即时生效，可增加可选通知机制。
