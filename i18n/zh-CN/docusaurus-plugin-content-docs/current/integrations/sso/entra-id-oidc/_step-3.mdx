Scope（权限）定义了你的应用从用户那里请求的权限，并控制你的应用可以从他们的 Microsoft Entra ID 账户访问哪些数据。请求 Microsoft Graph 权限需要在两端进行配置：

**在 Microsoft Entra 管理中心：**

1. 导航到 **Microsoft Entra ID > 应用注册**，并选择你的应用程序。
2. 前往 **API 权限 > 添加权限 > Microsoft Graph > 委托权限**。
3. 只选择你的应用所需的权限：
   - OpenID 权限：
     - `openid`（必需）- 登录用户
     - `profile`（必需）- 查看用户的基本资料
     - `email`（必需）- 查看用户的电子邮件地址
     - `offline_access`（可选）- 仅当你在 Logto 连接器中启用[为持久 API 访问存储令牌](#step-4-store-tokens-to-access-microsoft-apis-optional)并需要获取用于长期访问 Microsoft Graph API 的刷新令牌 (Refresh token) 时才需要。
   - API 访问（可选）：添加你的应用所需的其他权限。常见的 Microsoft Graph 权限包括 `Mail.Read`、`Calendars.Read`、`Files.Read` 等。浏览 [Microsoft Graph 权限参考](https://docs.microsoft.com/en-us/graph/permissions-reference) 以查找可用权限。
4. 点击 **添加权限** 以确认选择。
5. 如果你的应用需要某些权限的管理员同意，点击 **为[你的组织]授予管理员同意**。

<center>
  <img src="/img/assets/entra_id_oidc_add_api_permissions.webp" alt="添加 Microsoft API 权限" />
</center>

**在 Logto Microsoft Entra ID 连接器中：**

1. Logto 会自动包含 `openid`、`profile` 和 `email` scope（权限），以获取基本的用户身份信息。如果你只需要基本的用户信息，可以将 `Scopes` 字段留空。
2. 如果你计划为持久 API 访问存储令牌，请在 `Scopes` 字段中添加 `offline_access`。此 scope（权限）可启用用于长期 API 访问的刷新令牌 (Refresh token)。
3. 若需从 Microsoft Graph 请求更多数据，在 `Scopes` 字段中添加额外的 scope（权限）（用空格分隔）。请使用标准 scope 名称，例如：`User.Read Mail.Read Calendars.Read`

:::tip

如果你的应用请求这些 scope（权限）以访问 Microsoft Graph API 并执行操作，请确保在 Logto Microsoft Entra ID 连接器中启用**为持久 API 访问存储令牌**。详见下一节。

:::
