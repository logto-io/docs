## 前置条件 \{#prerequisites}

- 一个 [Mailgun](https://www.mailgun.com/) 账户
- 你 Mailgun 账户中的 API key，需要有发送消息（邮件）的权限。详见 [Where Can I Find My API Key and SMTP Credentials?](https://help.mailgun.com/hc/en-us/articles/203380100-Where-Can-I-Find-My-API-Key-and-SMTP-Credentials-) 获取更多信息。

## 基本配置 \{#basic-configuration}

- 当你使用不同的 Mailgun API endpoint 时，请填写 `endpoint` 字段，例如，欧盟地区应为 `https://api.eu.mailgun.net`。默认值为 `https://api.mailgun.net`。
- 在 `domain` 字段填写你在 Mailgun 账户中注册的域名。该值可在 Mailgun 控制台的 **Domains** 部分找到。域名格式应为 `example.com`，不带 `https://` 或 `http://` 前缀。
- 在 `apiKey` 字段填写你在 Mailgun 账户中生成的 API key。
- 在 `from` 字段填写你希望用来发送邮件的邮箱地址。该邮箱地址必须已在你的 Mailgun 账户中注册。邮箱格式应为 `Sender Name <sender@example.com>`。

## 邮件内容配置 \{#deliveries}

### 配置对象 \{#config-object}

“Deliveries” 部分允许你为不同场景配置要发送邮件的内容。它是一个 JSON 键值映射，其中 key 是使用类型，value 是包含要发送邮件内容配置的对象。

```json
{
  "<usage-type>": {
    // ...
  }
}
```

### 使用类型 \{#usage-types}

支持以下使用类型：

- `Register`：用户注册时发送的邮件。
- `SignIn`：用户登录时发送的邮件。
- `ForgotPassword`：用户重置密码时发送的邮件。
- `Generic`：用户执行通用操作（如测试邮件连接器）时发送的邮件。

:::note
如果在 deliveries 配置中未指定使用类型，将发送通用邮件。如果未指定通用邮件，连接器将返回错误。
:::

### 内容配置 \{#content-config}

连接器支持直接 HTML 内容和 Mailgun 模板，你可以为每种使用类型选择其中一种方式。

在主题和内容中，你可以使用 `{{code}}` 占位符插入验证码。

如需使用直接 HTML 内容，请填写以下字段：

- `subject`：要发送邮件的主题。
- `replyTo`：用作回复地址的邮箱。
- `html`：（必填）要发送邮件的 HTML 内容。
- `text`：要发送邮件的纯文本版本。

如需使用 Mailgun 模板，请填写以下字段：

- `subject`：要发送邮件的主题。
- `replyTo`：用作回复地址的邮箱。
- `template`：（必填）要使用的 Mailgun 模板名称。
- `variables`：要传递给 Mailgun 模板的变量。应为 JSON 键值映射，因为发送到 Mailgun 前会被字符串化。注意无需包含 `code` 变量，连接器会自动添加。

### 示例 \{#example}

以下是 deliveries 配置的示例：

```json
{
  "Register": {
    "subject": "{{code}} is your verification code",
    "replyTo": "Foo <foo@bar.com>",
    "html": "<h1>Welcome to Logto</h1><p>Your verification code is {{code}}.</p>",
    "text": "Welcome to Logto. Your verification code is {{code}}."
  },
  "SignIn": {
    "subject": "Welcome back to Logto",
    "replyTo": "Foo <foo@bar.com>",
    "template": "logto-sign-in",
    "variables": {
      "bar": "baz"
    }
  }
}
```
