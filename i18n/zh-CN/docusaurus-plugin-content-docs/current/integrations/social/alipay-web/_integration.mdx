## 注册支付宝开发者账号 \{#register-alipay-developer-account}

[注册支付宝开发者账号](https://certifyweb.alipay.com/certify/reg/guide#/)（如果你还没有的话）。

## 创建并配置支付宝应用 \{#create-and-configure-alipay-app}

1. 使用你刚刚注册的账号登录 [支付宝控制台](https://open.alipay.com/)。
2. 在“我的应用”面板中，进入“网页&移动应用”标签页。
3. 点击“立即创建”按钮，开始配置你的应用。
4. 在“应用名称”中为你的应用命名（遵循命名规范），并上传“应用图标”，确保你选择“网页应用”作为“应用类型”。
5. 完成应用创建后，进入概览页面，在这里你需要点击“添加能力”，添加“第三方应用授权”、“获取会员信息”和“App 支付宝登录”，以便后续启用支付宝登录。
6. 前往 [支付宝商家中心](https://b.alipay.com/index2.htm)，并使用支付宝开发者账号登录。点击顶部栏的“账号中心”，进入“APPID 绑定”，入口在侧边栏底部。通过输入你在第 4 步创建的网页应用的 APPID，点击“添加绑定”。
7. 在“App 支付宝登录”处点击“签约”按钮，并按照指引完成签约流程。完成后，你会发现第 5 步添加的能力已经生效。
8. 回到支付宝开放平台控制台页面，在“开发信息”部分可以找到“接口加签方式（密钥/证书）”。点击“设置”按钮，进入签名方式设置页面。推荐选择“公钥”作为签名模式，并将你生成的公钥文件内容填入文本输入框。
9. 在支付宝控制台页面底部，点击“设置”按钮，设置“授权回调地址”。`${your_logto_origin}/callback/${connector_id}` 是 Logto 核心默认使用的回调地址。`connector_id` 可以在 Logto 管理后台连接器详情页顶部栏找到。
10. 完成上述所有步骤后，回到支付宝控制台页面右上角，点击“提交审核”。审核通过后，你就可以顺利使用支付宝登录流程了。

:::note
你可以在本地通过以下命令使用 _openssl_ 生成密钥对。

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

在支付宝应用设置网站填写公钥时，需要去除 `public.pem` 的头部和尾部，删除所有换行符，并将剩余内容粘贴到“公钥”文本输入框中。

:::

## 设置 Logto 支付宝 Web 连接器配置 \{#set-up-the-logto-alipay-web-connector-settings}

1. 在 [支付宝控制台工作区](https://open.alipay.com/dev/workspace) 的“我的应用”面板，点击“网页&移动应用”标签页，可以找到所有应用的 APPID。
2. 在前面第 7 步，你已经生成了一对密钥，包括私钥和公钥。
3. 填写 Logto 连接器配置：
   - 在 `appId` 字段填写你在第 1 步获得的 APPID。
   - 在 `privateKey` 字段填写第 2 步中提到的私钥文件内容。请确保用 '\n' 替换所有换行符，并且不要移除私钥文件的头部和尾部。
   - 在 `signType` 字段填写 'RSA2'，因为我们在“创建并配置支付宝应用”第 7 步选择了 `公钥` 签名模式。
   - 在 `charset` 字段填写 'gbk' 或 'utf8'。该字段为可选项，可以留空，默认值为 'utf8'。
   - 在 `scope` 字段填写 'auth_base' 或 'auth_user'。该字段为可选项，可以留空，默认值为 'auth_user'。你可以查看[不同取值的区别](https://opendocs.alipay.com/fw/api/105942)。

### 配置类型 \{#config-types}

| 名称       | 类型               | 枚举值                     |
| ---------- | ------------------ | -------------------------- |
| appId      | string             | N/A                        |
| privateKey | string             | N/A                        |
| signType   | enum string        | 'RSA' / 'RSA2'             |
| charset    | enum string (可选) | 'gbk' / 'utf8' / undefined |
| scope      | enum string (可选) | 'auth_user' / 'auth_base'  |
