## 注册支付宝开发者账号 \{#register-alipay-developer-account}

[注册支付宝开发者账号](https://certifyweb.alipay.com/certify/reg/guide#/)（如果你还没有的话）。

## 创建并配置支付宝应用 \{#create-and-configure-alipay-app}

1. 使用你刚注册的账号登录 [支付宝控制台](https://open.alipay.com/)。
2. 在“我的应用”面板中，进入“网页&移动应用”标签页。
3. 点击“立即创建”按钮，开始配置你的应用。
4. 在“应用名称”中为你的应用命名（遵循命名规范），并上传“应用图标”，确保“应用类型”选择为“移动应用”。如果是构建 iOS 应用，需要填写唯一的“Bundle ID”。同时，Android 应用需要填写“应用签名”和“应用包名”。
5. 完成应用创建后，进入概览页面，点击“添加能力”，添加“第三方应用授权”、“获取会员信息”和“App 支付宝登录”，以便后续启用支付宝登录。
6. 前往 [支付宝商家中心](https://b.alipay.com/index2.htm)，用支付宝开发者账号登录。点击顶部栏的“账号中心”，进入“APPID 绑定”，入口在侧边栏底部。通过输入你在第 4 步创建的移动应用的 APPID，点击“添加绑定”。
7. 在“App 支付宝登录”处点击“签约”按钮，并按照指引完成签约流程。完成后，你会发现第 5 步添加的能力已经生效。
8. 回到支付宝开放平台控制台页面，在“开发信息”部分可以找到“接口加签方式（密钥/证书）”。点击“设置”按钮，进入签名方式设置页面。推荐选择“公钥”作为签名方式，并将你生成的公钥文件内容填入文本框。
9. 在支付宝控制台页面底部，点击“设置”按钮，设置“授权回调地址”。`${your_logto_origin}/callback/${connector_id}` 是 Logto 核心默认使用的回调地址。`connector_id` 可在 Logto 管理控制台连接器详情页顶部找到。
10. 完成以上所有步骤后，回到支付宝控制台页面右上角，点击“提交审核”。审核通过后，你就可以顺利使用支付宝登录流程了。

:::note

你可以在本地通过以下命令使用 _openssl_ 生成密钥对：

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

在支付宝应用设置网站填写公钥时，需要去掉 `public.pem` 的头部和尾部，删除所有换行符，并将剩余内容粘贴到“公钥”文本框中。
:::

## 设置 Logto 支付宝原生连接器配置 \{#set-up-the-logto-alipay-native-connector-settings}

1. 在 [支付宝控制台工作区](https://open.alipay.com/dev/workspace) 的“我的应用”面板，点击“网页&移动应用”标签页，可以找到所有应用的 APPID。
2. 在前面第 7 步，你已经生成了一对密钥，包括私钥和公钥。
3. 填写 Logto 连接器配置：
   - `appId` 字段填写第 1 步获得的 APPID。
   - `privateKey` 字段填写第 2 步生成的私钥文件内容。请确保用 '\n' 替换所有换行符。私钥文件无需去除头部和尾部。
   - `signType` 字段填写 'RSA2'，因为我们在“创建并配置支付宝应用”第 7 步选择了 `公钥` 签名方式。

### 配置类型 \{#config-types}

| 名称       | 类型        | 枚举值         |
| ---------- | ----------- | -------------- |
| appId      | string      | N/A            |
| privateKey | string      | N/A            |
| signType   | enum string | 'RSA' / 'RSA2' |

## 在你的应用中启用支付宝原生登录 \{#enable-alipay-native-sign-in-in-your-app}

### iOS \{#ios}

假设你已经在应用中集成了 <MainSiteUrl href="/quick-starts/swift">Logto iOS SDK</MainSiteUrl>。在这种情况下，操作非常简单，甚至无需阅读支付宝 SDK 文档：

**1. 将 `LogtoSocialPluginAlipay` 添加到你的 Xcode 项目中**

添加框架：

<img src="/img/assets/add-framework.png" alt="Add framework" />

:::note

该插件已包含支付宝“极简版 SDK”。导入插件后可直接使用 `import AFServiceSDK`。

:::

**2. 在 `LogtoClient` 初始化选项中添加插件**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginAlipay(callbackScheme: "your-scheme")]
)
```

其中 `callbackScheme` 是 [自定义 URL Scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) 之一，可用于跳转回你的应用。

### Android \{#android}

假设你已经在应用中集成了 <MainSiteUrl href="/quick-starts/android">Logto Android SDK</MainSiteUrl>。在这种情况下，操作非常简单，甚至无需阅读支付宝 SDK 文档：

**1. 下载支付宝“极简版 SDK”并添加到你的项目中**

从 [Logto 第三方社交 SDK](https://github.com/logto-io/social-sdks/blob/master/alipay/android/alipaySdk-15.7.9-20200727142846.aar) 下载支付宝“极简版 SDK”到你的项目 `app/libs` 文件夹：

```bash
project-path/app/libs/alipaySdk-15.7.9-20200727142846.aar
```

**2. 将支付宝“极简版 SDK”作为依赖添加**

打开你的 `build.gradle` 文件：

```bash
project-path/app/build.gradle
```

添加依赖：

```kotlin
dependencies {
  // ...
  implementation(files("./libs/alipaySdk-15.7.9-20200727142846.aar"))  // kotlin-script
  // or
  implementation files('./libs/alipaySdk-15.7.9-20200727142846.aar')  // groovy-script
}
```
