## 第一步：在 Facebook App Dashboard 上创建应用 \{#step-1-set-up-an-app-on-facebook-app-dashboard}

在你可以将 Facebook 作为认证 (Authentication) 提供商之前，必须在 Facebook 开发者平台上创建一个应用，以获取 OAuth 2.0 凭据。

1. 如果你还没有账号，请[注册成为 Facebook 开发者](https://developers.facebook.com/docs/development/register/)。
2. 访问 [Apps](https://developers.facebook.com/apps) 页面。
3. 点击你已有的应用，或[创建一个新应用](https://developers.facebook.com/docs/development/create-an-app)。

:::tip
用例是你的应用与 Meta 交互的主要方式，并决定了你的应用可以使用哪些 API、功能、权限和产品。如果你只需要社交认证 (Authentication)（获取 email 和 public_profile），请选择“Authentication and request data from users with Facebook Login”。如果你想访问 Facebook API，请选择你偏好的用例——大多数用例在应用创建后也支持集成“Facebook Login for business”。
:::

4. 应用创建后，在应用仪表盘页面，导航到 **Use cases > Facebook Login > Settings** 或 **Facebook Login for business > Settings**。
5. 在 **Valid OAuth Redirect URIs** 中填写 Logto 的 **Callback URI**（从你的 Logto Facebook 连接器中复制）。用户通过 Facebook 登录后，会被重定向到这里，Logto 会用授权码完成认证 (Authentication)。
6. 前往 **Use cases**，点击你的用例下的 **Customize**，添加权限 (Scopes)。建议添加 `email` 和 `public_profile`，这是在 Logto 实现 Facebook 登录所必需的。

## 第二步：用客户端凭据配置 Logto 连接器 \{#step-2-set-up-logto-connector-with-client-credentials}

1. 在 Facebook App Dashboard，点击侧边栏的 **App settings > Basic**。
2. 你会在面板上看到 **App ID** 和 **App secret**。
3. 点击 App secret 输入框旁的 **Show** 按钮，显示并复制其内容。
4. 配置你的 Logto Facebook 连接器设置：
   - 在 `clientId` 字段填写 **App ID**。
   - 在 `clientSecret` 字段填写 **App secret**。
   - 在 Logto 中点击 **Save and Done**，将你的身份系统与 Facebook 连接。

## 第三步：配置权限 (Scopes) \{#step-3-configure-scopes}

权限 (Scopes) 定义了你的应用向用户请求的权限，并控制你的项目可以从他们的 Facebook 账户访问哪些私有数据。

### 在 Facebook App Dashboard 配置权限 (Scopes) \{#configure-scopes-in-facebook-app-dashboard}

1. 前往 **Facebook App Dashboard > Use cases**，点击 **Customize** 按钮。
2. 只添加你的应用所需的权限 (Scopes)。用户会在 Facebook 用户授权页面 (Consent screen) 上审核并授权这些权限：
   - **用于认证 (Authentication)（必需）**：`email` 和 `public_profile`。
   - **用于 API 访问（可选）**：你的应用需要的其他权限 (Scopes)（如访问 Threads API 的 `threads_content_publish`、`threads_read_replies`）。可浏览 [Meta Developer Documentation](https://developers.facebook.com/docs/) 获取可用服务。

### 在 Logto 中配置权限 (Scopes) \{#configure-scopes-in-logto}

根据你的需求选择以下一种或多种方式：

**方式一：不需要额外 API 权限 (Scopes)**

- 在 Logto Facebook 连接器的 `Scopes` 字段留空。
- 默认会请求 `email public_profile` 权限 (Scopes)，以确保 Logto 能正确获取基础用户信息。

**方式二：登录时请求额外权限 (Scopes)**

- 在 **Scopes** 字段输入所有需要的权限 (Scopes)，用空格分隔。
- 你在这里填写的权限 (Scopes) 会覆盖默认值，所以请务必包含认证 (Authentication) 权限：`email public_profile`。

**方式三：后续按需增量请求权限 (Scopes)**

- 用户登录后，你可以通过重新发起联合社交授权 (Authorization) 流程并更新用户存储的令牌集，按需请求更多权限 (Scopes)。
- 这些额外权限 (Scopes) 无需在 Logto Facebook 连接器的 `Scopes` 字段填写，可通过 Logto 的 Social Verification API 实现。

按照这些步骤操作后，你的 Logto Facebook 连接器只会请求你的应用所需的权限 (Scopes)，不多也不少。

:::tip
如果你的应用请求这些权限 (Scopes) 以访问 Facebook API 并执行操作，请确保在 Logto Facebook 连接器中启用 **Store tokens for persistent API access**。详情见下一节。
:::

## 第四步：通用设置 \{#step-4-general-settings}

以下是一些不会阻止 Facebook 连接但可能影响终端用户认证 (Authentication) 体验的通用设置。

### 同步用户资料信息 \{#sync-profile-information}

在 Facebook 连接器中，你可以设置同步用户资料（如用户名和头像）的策略。可选项包括：

- **仅在注册时同步**：用户首次登录时获取一次资料信息。
- **每次登录时都同步**：用户每次登录时都会更新资料信息。

### 存储令牌以访问 Facebook API（可选） \{#store-tokens-to-access-facebook-apis-optional}

如果你希望访问 Facebook API 并在用户授权下执行操作（无论是社交登录还是账号绑定），Logto 需要获取特定 API 权限 (Scopes) 并存储令牌。

1. 按照上方教程添加所需权限 (Scopes)。
2. 在 Logto Facebook 连接器中启用 **Store tokens for persistent API access**。Logto 会将 Facebook 访问令牌安全地存储在 Secret Vault 中。

:::note
Facebook 不提供刷新令牌 (Refresh tokens)。但当启用令牌存储后，Logto 会在用户认证 (Authentication) 时自动请求一个长期有效的访问令牌（60 天）。在此期间，用户可以手动撤销访问令牌，否则无需重新授权即可访问 Facebook API。注意：不要在 `Scope` 字段添加 `offline_access`，否则可能导致错误。
:::

## 第五步：用 Facebook 测试用户测试登录（可选） \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

你可以使用测试、开发者和管理员账号测试应用登录。你也可以直接发布应用，让任何 Facebook 用户都能登录。

1. 在 Facebook App Dashboard，点击侧边栏 **App roles > Test Users**。
2. 点击 **Create test users** 按钮创建测试用户。
3. 点击已有测试用户的 **Options** 按钮查看更多操作，如“更改姓名和密码”。

## 第六步：发布 Facebook 登录设置 \{#step-6-publish-facebook-sign-in-settings}

通常，只有测试、管理员和开发者用户可以登录应用。要让普通 Facebook 用户在生产环境中登录应用，你可能需要发布该应用。

1. 在 Facebook App Dashboard，点击侧边栏 **Publish**。
2. 如有需要，填写 **Privacy Policy URL** 和 **User data deletion** 字段。
3. 点击右下角的 **Save changes** 按钮。
4. 点击应用顶部栏的 **Live** 开关按钮。
