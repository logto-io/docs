---
id: email-connectors
title: 邮箱连接器
sidebar_label: 邮箱连接器
sidebar_position: 1
---

# 邮箱连接器

邮箱连接器将你的邮件发送服务与 Logto 集成，实现通过邮箱进行安全的用户验证。配置完成后，你可以为用户 [注册](/end-user-flows/sign-up-and-sign-in/sign-up)、[登录](/end-user-flows/sign-up-and-sign-in/sign-in)、[重置密码](/end-user-flows/sign-up-and-sign-in/reset-password)、[账号关联](/end-user-flows/sign-up-and-sign-in/social-sign-in#account-linking)、[成员邀请](/end-user-flows/organization-experience/invite-organization-members) 和 [高风险操作验证](/end-user-flows/security-verification) 发送 [一次性密码 (OTPs)](https://auth.wiki/otp)。

## 选择你的邮箱连接器 \{#choose-your-email-connector}

Logto 提供三种类型的邮箱连接器选项：

### 免费 Logto 邮箱服务（仅限 Cloud）\{#free-logto-email-service-cloud-only}

这个内置邮箱服务选项非常适合快速开始 [测试](/logto-cloud/tenant-settings#development) 和 [生产](/logto-cloud/tenant-settings#production) 环境。它无需第三方集成，提供免费且可靠的邮件发送服务。你只需为预设的邮件模板自定义基础品牌信息即可。

Logto 邮箱服务连接器现已支持品牌定制功能，包括 logo、公司信息和发件人名称。

不过，虽然方便，但也有一些限制需要注意 —— 你无法自定义发件人邮箱地址、域名或具体邮件内容。

```mdx-code-block
import DocCardList from '@theme/DocCardList';
import LogtoEmailService from '@site/docs/connectors/assets/icons/logto-email-service.svg';
import AwsDm from '@site/docs/connectors/assets/icons/aws-direct-mail.svg';
import SendGrid from '@site/docs/connectors/assets/icons/sendgrid.svg';
import Mailgun from '@site/docs/connectors/assets/icons/mailgun.svg';
import Postmark from '@site/docs/connectors/assets/icons/postmark.svg';
import AliyunDm from '@site/docs/connectors/assets/icons/aliyun-direct-mail.svg';
import Smtp from '@site/docs/connectors/assets/icons/smtp.svg';
import Http from '@site/docs/connectors/assets/icons/http.svg';

<DocCardList
  items={[
    {
      type: 'link',
      label: 'Logto Email Service',
      href: '/connectors/email-connectors/built-in-email-service',
      description: 'Logto 邮箱服务官方连接器。',
      customProps: {
        icon: <LogtoEmailService />,
      }
    },
  ]}
/>
```

### 主流邮箱服务商 \{#popular-email-providers}

通过 Logto 的分步指南，连接你喜欢的邮箱服务提供商（ESP）。

这些选项允许你完全 [自定义邮件模板](/connectors/email-connectors/email-templates)、发件人名称、添加变量等，以更好地展现你的品牌。

我们为以下邮箱服务商提供开箱即用的支持：

```mdx-code-block
<DocCardList
  items={[
    {
      type: 'link',
      label: 'AWS Direct Mail',
      href: '/integrations/aws-ses',
      description: 'AWS 直邮服务的 Logto 官方连接器。',
      customProps: {
        icon: <AwsDm />,
      }
    },
    {
      type: 'link',
      label: 'Mailgun',
      href: '/integrations/mailgun',
      description: 'Mailgun 邮箱服务的 Logto 官方连接器。',
      customProps: {
        icon: <Mailgun />,
      }
    },
    {
      type: 'link',
      label: 'SendGrid Email',
      href: '/integrations/sendgrid-email',
      description: 'SendGrid 邮箱服务的 Logto 官方连接器。',
      customProps: {
        icon: <SendGrid />,
      }
    },
    {
      type: 'link',
      label: 'Aliyun Direct Mail',
      href: '/integrations/aliyun-dm',
      description: '阿里云直邮服务的 Logto 官方连接器。',
      customProps: {
        icon: <AliyunDm />,
      }
    },
    {
      type: 'link',
      label: 'Postmark Mail',
      href: '/integrations/postmark',
      description: 'Postmark 邮箱服务的 Logto 连接器。',
      customProps: {
        icon: <Postmark />,
      }
    },
  ]}
/>
```

### 自定义你的邮箱连接器 \{#customize-your-email-connector}

如果以上方案都无法满足你的需求，你也可以选择通过简单邮件传输协议（SMTP）连接你想要的邮箱服务。

```mdx-code-block
<DocCardList
  items={[
    {
      type: 'link',
      label: 'SMTP',
      href: '/integrations/smtp',
      description: 'SMTP 的 Logto 官方连接器。',
      customProps: {
        icon: <Smtp />,
      }
    },
  ]}
/>
```

如果你已经拥有自己的邮件服务且不适合使用 SMTP 连接，我们还提供了 “HTTP 邮箱连接器”。

当需要发送邮件时，它会向配置的 `endpoint` 发送 API 调用，以完成依赖邮件的认证流程。注意，为防止认证流程出错，配置的 endpoint 在收到 WebHook 后需要返回 200 响应，以告知 Logto 已收到发送邮件的通知。在这种情况下，你需要自行监控邮件服务以确保邮件成功送达。

```mdx-code-block
<DocCardList
  items={[
    {
      type: 'link',
      label: 'HTTP email connector',
      href: '/integrations/http-email',
      description: 'HTTP 邮箱的 Logto 官方连接器。',
      customProps: {
        icon: <Http />,
      }
    },
  ]}
/>
```

如果我们的标准连接器无法满足你的特定需求，欢迎 [联系我们](https://feedback.logto.io/roadmap)。对于 OSS 用户，如果需求紧急，你可以 [自行实现连接器 (OSS)](/logto-oss/develop-your-connector/implement-connectors#build-a-passwordless-connector)。我们始终欢迎 [贡献](/logto-oss/contribution)；你的努力也许能帮助有相同需求的社区成员。

## 配置步骤 \{#configure-steps}

按照以下步骤添加邮箱连接器：

1. 进入 <CloudLink to="/connectors/passwordless">控制台 > 连接器 > 邮箱和短信连接器</CloudLink>。
2. 若要添加新的邮箱连接器，点击“设置”按钮并选择你想要的邮箱服务商。
3. 阅读 README 文档，按步骤为所选服务商进行配置。
4. 点击“保存并完成”以结束配置。

:::note

为确保重要邮件（如验证码）可靠送达用户收件箱并避免被判为垃圾邮件，请关注以下两点：

- **设置邮件认证（SPF、DKIM、DMARC）**
  邮箱服务商（Gmail、Outlook 等）会用这些协议验证你不是垃圾邮件发送者。缺少这些设置可能导致邮件进垃圾箱或被拒收。
  - SPF（发件人策略框架）：列出允许为你的域发送邮件的服务器 / IP。
  - DKIM（域密钥识别邮件）：为邮件添加数字签名，证明邮件未被篡改。
  - DMARC（基于域的消息认证）：告知收件方如何处理 SPF / DKIM 认证失败的邮件。
- **分离认证 (Authentication) 邮件和营销邮件**
  营销邮件常常引发垃圾投诉或高退信率。如果认证 (Authentication) 邮件与其共用域名 / IP，送达率会受影响。
  - 使用专用域名：如用 `@auth.yourdomain.com` 发送验证码邮件，`@marketing.yourdomain.com` 发送营销邮件。
  - 专用 IP：为认证 (Authentication) 邮件申请独立 IP，并逐步“养暖”。
  - 匹配“发件人”地址：确保发件人域名与 SPF / DKIM / DMARC 记录一致。

:::

## 更换邮箱连接器 \{#change-email-connector}

你可能会注意到只能添加一个邮箱连接器。

当你已有邮箱连接器时，只能选择“更换邮箱连接器”。在控制台执行此操作时，保存后会立即生效，因此请务必在保存前测试你的配置。

为确保服务稳定，Cloud 用户可以为开发环境创建一个 [开发租户](/logto-cloud/tenant-settings#development)。在开发环境测试配置后，将配置“迁移”到 [生产环境](/logto-cloud/tenant-settings#production)，再进行保存。

## 为终端用户流程启用邮箱地址 \{#enable-email-address-for-end-user-flows}

添加并配置邮箱连接器后，你可以启用基于邮箱的认证 (Authentication) 流程：

- [**设置注册方式**](/end-user-flows/sign-up-and-sign-in/sign-up)：进入 <CloudLink to="/sign-in-experience/sign-up-and-sign-in">登录体验 > 注册与登录</CloudLink>。在注册部分，添加“邮箱地址”或“邮箱地址或手机号”作为标识符。注意：注册时邮箱地址验证为必选项。
- [**设置登录方式**](/end-user-flows/sign-up-and-sign-in/sign-in)：在登录部分，添加“邮箱地址”作为登录方式。可选择密码或邮箱验证码进行认证 (Authentication)。点击“添加其他”可配置更多选项。
- [**设置忘记密码**](/end-user-flows/sign-up-and-sign-in/reset-password)：在登录部分，若启用了密码登录，将看到“忘记密码”设置。启用“邮箱验证码”即可通过邮箱重置密码。
- [**为 MFA 设置邮箱**](/end-user-flows/mfa/email-mfa)：进入 <CloudLink to="/mfa">登录体验 > 多因素认证 (MFA)</CloudLink>。启用“邮箱验证码”作为第二重安全验证。
- [**设置账号管理**](/end-user-flows/account-settings/by-account-api#update-or-link-new-email)：通过 [Account API](/end-user-flows/account-settings/by-account-api) 自定义账号中心，允许用户管理邮箱地址。

:::warning
由于我们的配置会立即生效，删除现有邮箱连接器可能会影响终端用户的正常登录和注册流程。

例如，如果登录标识符包含“邮箱 + 验证码”组合，删除现有邮箱连接器后，用户将无法通过邮箱收到验证码，登录流程会报错。

操作连接器时请注意潜在风险。
:::

## 常见问题 \{#faqs}

<details>
<summary>

### 如何自定义邮件发件人名称？\{#how-to-customize-the-email-sender-name}

</summary>

我们仍在开发更多连接器。如果你有进一步需求，请在 Discord 告诉我们并在 [GitHub](https://github.com/logto-io/logto/issues) 提交功能请求。如果需要进一步帮助，也可以 [通过邮件联系我们](mailto:contact@logto.io)。

对于贡献者，我们提供了易于扩展的连接器创建方式，允许你根据具体场景 [自定义自己的连接器](/logto-oss/develop-your-connector)。欢迎随时向 Logto 提交 pull request，让更多社区成员受益。

</details>

<details>
<summary>

### 如何限制 Logto 邮箱连接器的邮件请求 IP 地址？\{#how-can-i-restrict-ip-addresses-for-email-requests-in-logto-email-connectors}

</summary>

一种变通方法是使用 Logto HTTP 邮箱连接器。

你可以在服务器上实现一个 API endpoint，调用相关邮件服务，并通过 Logto 的 [HTTP 邮箱连接器](/integrations/http-email) 触发该 API endpoint。这样你就可以完全控制 API endpoint 的 IP 地址，并在邮件服务商配置中将对应 IP 加入白名单。

</details>
