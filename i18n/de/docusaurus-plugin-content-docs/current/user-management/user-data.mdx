---
sidebar_position: 1
---

# Benutzer-Datenstruktur

Benutzer sind die Kerneinheiten im Identitätsdienst. In Logto umfassen sie grundlegende Authentifizierungsdaten basierend auf dem [OpenID Connect](https://auth.wiki/openid-connect)-Protokoll sowie benutzerdefinierte Daten.

## Benutzerprofil \{#user-profile}

Jeder Benutzer hat ein Profil, das [alle Benutzerinformationen](#property-reference) enthält.

Es besteht aus folgenden Datentypen:

- [Basisdaten](/user-management/user-data#basic-data): sind die Basisinformationen aus dem Benutzerprofil. Sie speichern alle anderen _Benutzer_-Eigenschaften außer sozialen `identities` und `custom_data`, wie Benutzer-ID, Benutzername, E-Mail, Telefonnummer und wann sich der Benutzer zuletzt angemeldet hat.
- [Soziale Identitäten](/user-management/user-data#social-identities): speichert die Benutzerinformationen, die durch Social Sign-in (d. h. Anmeldung mit einem Social Connector) abgerufen wurden, wie Facebook, GitHub und WeChat.
- [Benutzerdefinierte Daten](/user-management/user-data#custom-data): speichert zusätzliche Benutzerinformationen, die nicht in den vordefinierten Benutzereigenschaften aufgeführt sind, wie bevorzugte Farbe und Sprache des Benutzers.

Hier ist ein Beispiel für die Daten eines Benutzers, die durch eine Anmeldung bei Facebook abgerufen wurden:

```json
{
  "id": "iHXPuSb9eMzt",
  "username": null,
  "primaryEmail": null,
  "primaryPhone": null,
  "name": "John Doe",
  "avatar": "https://example.com/avatar.png",
  "customData": {
    "preferences": {
      "language": "en",
      "color": "#f236c9"
    }
  },
  "identities": {
    "facebook": {
      "userId": "106077000000000",
      "details": {
        "id": "106077000000000",
        "name": "John Doe",
        "email": "johndoe@logto.io",
        "avatar": "https://example.com/avatar.png"
      }
    }
  },
  "lastSignInAt": 1655799453171,
  "applicationId": "admin_console"
}
```

Du kannst das Benutzerprofil über die <CloudLink to="/users">Logto Console</CloudLink> oder die Logto Management API abfragen, z. B. [`GET /api/users/:userId`](https://openapi.logto.io/operation/operation-getuser).

## Basisdaten \{#basic-data}

Gehen wir alle Eigenschaften der _Basisdaten_ eines Benutzers durch.

### id \{#id}

_id_ ist ein eindeutig generierter Schlüssel zur Identifizierung des Benutzers in Logto.

### username \{#username}

_username_ wird für die Anmeldung mit _Benutzername_ und Passwort verwendet.

Der Wert stammt vom Benutzernamen, mit dem sich der Benutzer erstmals registriert hat. Er kann `null` sein. Ein nicht-null Wert darf maximal 128 Zeichen lang sein, nur Buchstaben, Zahlen und Unterstriche (`_`) enthalten und NICHT mit einer Zahl beginnen. Die Groß- und Kleinschreibung wird beachtet.

### primary_email \{#primary_email}

_primary_email_ ist die E-Mail-Adresse des Benutzers, die für die Anmeldung mit E-Mail und Passwort / Verifizierungscode verwendet wird.

Der Wert stammt in der Regel von der E-Mail-Adresse, mit der sich der Benutzer erstmals registriert hat. Er kann `null` sein. Die maximale Länge beträgt 128.

### primary_phone \{#primary_phone}

_primary_phone_ ist die Telefonnummer des Benutzers, die für die Anmeldung mit Telefonnummer und Passwort / Verifizierungscode aus SMS verwendet wird.

Der Wert stammt in der Regel von der Telefonnummer, mit der sich der Benutzer erstmals registriert hat. Er kann `null` sein. Ein nicht-null Wert sollte Zahlen enthalten, die mit dem [Ländervorwahl-Code](https://en.wikipedia.org/wiki/List_of_country_calling_codes) (ohne das Pluszeichen `+`) beginnen.

### name \{#name}

_name_ ist der vollständige Name des Benutzers. Die maximale Länge beträgt 128.

### avatar \{#avatar}

_avatar_ ist die URL, die auf das Avatarbild des Benutzers zeigt. Die maximale Länge beträgt 2048.

Wenn sich der Benutzer mit einem Social Connector wie Google oder Facebook registriert, kann der Wert aus den sozialen Benutzerinformationen übernommen werden.

:::note

Diese Eigenschaft wird dem `picture`-Anspruch im [OpenID Connect](https://openid.net/connect/)-Standard zugeordnet.

:::

### profile \{#profile}

_profile_ speichert zusätzliche OpenID Connect [Standardansprüche](https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims), die nicht in den Benutzereigenschaften enthalten sind.

Die Typdefinition findest du in [dieser Datei](https://github.com/logto-io/logto/blob/HEAD/packages/schemas/src/foundations/jsonb-types/users.ts#L6). Hier eine Kopie der Typdefinition:

```tsx
type UserProfile = Partial<{
  familyName: string;
  givenName: string;
  middleName: string;
  nickname: string;
  preferredUsername: string;
  profile: string;
  website: string;
  gender: string;
  birthdate: string;
  zoneinfo: string;
  locale: string;
  address: Partial<{
    formatted: string;
    streetAddress: string;
    locality: string;
    region: string;
    postalCode: string;
    country: string;
  }>;
}>;
```

:::note

`Partial` bedeutet, dass alle Eigenschaften optional sind.

:::

Ein Unterschied zu anderen Standardansprüchen ist, dass die Eigenschaften in `profile` nur dann im [ID-Token](https://auth.wiki/id-token) oder in der Antwort des userinfo-Endpunkts enthalten sind, wenn ihre Werte nicht leer sind, während andere Standardansprüche `null` zurückgeben, wenn die Werte leer sind.

### application_id \{#application_id}

Der Wert von _application_id_ stammt von der Anwendung, bei der sich der Benutzer erstmals angemeldet hat. Er kann `null` sein.

### last_sign_in_at \{#last_sign_in_at}

_last_sign_in_at_ ist der Zeitstempel mit Zeitzone, wann sich der Benutzer zuletzt angemeldet hat.

### created_at \{#created_at}

_created_at_ ist der Zeitstempel mit Zeitzone, wann der Benutzer das Konto registriert hat.

### updated_at \{#updated_at}

_updated_at_ ist der Zeitstempel mit Zeitzone, wann die Profilinformationen des Benutzers zuletzt aktualisiert wurden.

### has_password \{#has_password}

_has_password_ ist ein boolescher Wert, der angibt, ob der Benutzer ein Passwort hat. Du kannst diesen Status anzeigen und verwalten, einschließlich Festlegen eines neuen oder Zurücksetzen des Passworts auf der Detailseite von <CloudLink to="/users">Console > Benutzerverwaltung</CloudLink>.

### password_encrypted \{#password_encrypted}

_password_encrypted_ wird verwendet, um das verschlüsselte Passwort des Benutzers zu speichern.

Der Wert stammt vom Passwort, mit dem sich der Benutzer erstmals registriert hat. Er kann `null` sein. Wenn der Wert nicht null ist, sollte der ursprüngliche Inhalt vor der Verschlüsselung mindestens sechs Zeichen lang sein.

### password_encryption_method \{#password_encryption_method}

_password_encryption_method_ wird verwendet, um das Passwort des Benutzers zu verschlüsseln. Der Wert wird initialisiert, wenn sich der Benutzer mit Benutzername und Passwort registriert. Er kann `null` sein.

Logto verwendet standardmäßig die [Argon2](https://en.wikipedia.org/wiki/Argon2)-Implementierung [node-argon2](https://github.com/ranisalt/node-argon2) als Verschlüsselungsmethode; siehe die Referenz für Details, falls du interessiert bist.

Beispiel für _password_encrypted_ und _password_encryption_method_ von einem Benutzer, dessen Passwort `123456` ist:

```json
{
  "password_encryption_method": "Argon2i",
  "password_encrypted": "$argon2i$v=19$m=4096,t=10,p=1$aZzrqpSX45DOo+9uEW6XVw$O4MdirF0mtuWWWz68eyNAt2u1FzzV3m3g00oIxmEr0U"
}
```

### is_suspended \{#is_suspended}

_is_suspended_ ist ein boolescher Wert, der angibt, ob ein Benutzer gesperrt ist oder nicht. Der Wert kann durch Aufruf der [Logto Management API](https://openapi.logto.io/operation/operation-updateuserissuspended) oder über die Logto Console verwaltet werden.

Sobald ein Benutzer gesperrt ist, werden die zuvor gewährten Auffrischungstokens sofort widerrufen und der Benutzer kann sich nicht mehr bei Logto authentifizieren.

### mfa_verification_factors \{#mfa_verification_factors}

_mfa_verification_factors_ ist ein Array, das die mit dem Benutzerkonto verknüpften [Multi-Faktor-Authentifizierung (MFA)](/end-user-flows/mfa)-Methoden auflistet. Mögliche Werte sind: _Totp_ (Authenticator-App OTP), _WebAuthn_ (Passkey) und _BackupCode_.

```tsx
mfaVerificationFactors: ("Totp" | "WebAuthn" | "BackupCode")[];
```

## Soziale Identitäten \{#social-identities}

_identities_ enthält die durch [Social Sign-in](/end-user-flows/sign-up-and-sign-in/social-sign-in) (d. h. Anmeldung mit einem [Social Connector](/connectors/social-connectors)) abgerufenen Benutzerinformationen. Die _identities_ jedes Benutzers werden in einem eigenen JSON-Objekt gespeichert.

Die Benutzerinformationen variieren je nach Anbieter sozialer Identitäten (d. h. soziales Netzwerk) und umfassen typischerweise Folgendes:

- _target_ des Identitätsanbieters, wie "facebook" oder "google"
- Eindeutiger Benutzeridentifikator für diesen Anbieter
- Name des Benutzers
- Verifizierte E-Mail des Benutzers
- Avatar des Benutzers

Das Benutzerkonto kann über Social Sign-in mit mehreren Anbietern sozialer Identitäten verknüpft sein; die entsprechenden Benutzerinformationen, die von diesen Anbietern abgerufen werden, werden im _identities_-Objekt gespeichert.

Beispiel für _identities_ eines Benutzers, der sich sowohl mit Google als auch mit Facebook angemeldet hat:

```json
{
  "facebook": {
    "userId": "5110888888888888",
    "details": {
      "id": "5110888888888888",
      "name": "John Doe",
      "email": "johndoe@logto.io",
      "avatar": "https://example.com/avatar.png"
    }
  },
  "google": {
    "userId": "111000000000000000000",
    "details": {
      "id": "111000000000000000000",
      "name": "John Doe",
      "email": "johndoe@gmail.com",
      "avatar": "https://example.com/avatar.png"
    }
  }
}
```

## SSO-Identitäten \{#sso-identities}

_sso_identities_ enthält die durch [Enterprise SSO](/end-user-flows/enterprise-sso) (d. h. Single Sign-On-Anmeldung mit einem Enterprise Connector](/connectors/enterprise-connectors)) abgerufenen Benutzerinformationen. Die _ssoIdentities_ jedes Benutzers werden in einem eigenen JSON-Objekt gespeichert.

Die von der SSO-Identitätsquelle synchronisierten Daten hängen von den im Enterprise Connector konfigurierten Berechtigungen ab. Hier ist eine Kopie der TypeScript-Typdefinition:

```ts
type SSOIdentity = {
  issuer: string;
  identityId: string;
  detail: JsonObject; // Siehe https://github.com/withtyped/withtyped/blob/master/packages/server/src/types.ts#L12
};
```

## Benutzerdefinierte Daten \{#custom-data}

_custom_data_ speichert zusätzliche Benutzerinformationen, die nicht in den vordefinierten Benutzereigenschaften aufgeführt sind.

Du kannst _custom_data_ für folgende Zwecke verwenden:

- Erfassen, ob bestimmte Aktionen vom Benutzer durchgeführt wurden, z. B. ob die Willkommensseite gesehen wurde.
- Anwendungsspezifische Daten im Benutzerprofil speichern, z. B. bevorzugte Sprache und Erscheinungsbild des Benutzers pro Anwendung.
- Andere beliebige, benutzerbezogene Daten pflegen.

Beispiel für _custom_data_ eines Admin-Benutzers in Logto:

```json
{
  "adminConsolePreferences": {
    "language": "en",
    "appearanceMode": "system",
    "experienceNoticeConfirmed": true
  },
  "customDataFoo": {
    "foo": "foo"
  },
  "customDataBar": {
    "bar": "bar"
  }
}
```

Das _custom_data_ jedes Benutzers wird in einem eigenen JSON-Objekt gespeichert.

:::note

Lege KEINE sensiblen Daten in _custom_data_ ab.

:::

Benutzerdefinierte Daten können nach der Benutzeranmeldung über [benutzerdefinierte JWT-Token-Ansprüche](/developers/custom-token-claims) abgerufen werden, und JWT-Tokens sind base64-codiert (nicht verschlüsselt) und werden häufig über Netzwerke übertragen, wodurch sensible Daten leicht offengelegt werden können.

Du kannst ein Benutzerprofil mit _custom_data_ über die [Management API](https://openapi.logto.io/operation/operation-listusercustomdata) abrufen und an Frontend-Apps oder externe Backend-Dienste senden. Daher kann das Ablegen sensibler Informationen in _custom_data_ zu Datenlecks führen.

Wenn du dennoch sensible Informationen in _custom_data_ speichern möchtest, empfehlen wir, diese zuerst zu verschlüsseln. Verschlüssele/entschlüssele sie nur in einer vertrauenswürdigen Instanz wie deinen Backend-Diensten und vermeide dies in Frontend-Apps. Dadurch wird der Schaden minimiert, falls die _custom_data_ deiner Benutzer versehentlich offengelegt wird.

**So sammelst und aktualisierst du benutzerdefinierte Daten**

- Verwende die Funktion [Benutzerprofil erfassen](/end-user-flows/collect-user-profile), um benutzerdefinierte Daten während der Benutzerregistrierung zu sammeln.
- Verwende die [Account API](/end-user-flows/account-settings/by-account-api), um Endbenutzerprofil- oder Kontoeinstellungen zu implementieren.
  - Verwende [`GET /api/my-account`](https://openapi.logto.io/operation/operation-getprofile), um alle Benutzerdaten abzurufen.
  - Verwende [`PATCH /api/my-account`](https://openapi.logto.io/operation/operation-updateprofile), um die _custom_data_ eines Benutzers zu aktualisieren.
- Verwende die [Management API](/user-management/manage-users/#manage-via-logto-management-api) für Benutzerverwaltung oder erweiterte benutzerdefinierte Abläufe:
  - Verwende [`GET /api/users/{userId}`](https://openapi.logto.io/operation/operation-getuser), um alle Benutzerdaten abzurufen.
  - Verwende [`PATCH /api/users/{userId}/custom-data`](https://openapi.logto.io/operation/operation-updateusercustomdata), um die _custom_data_ eines Benutzers zu aktualisieren.
- Dein Support-Team kann die _custom_data_ eines Benutzers direkt in <CloudLink to="/users">Console > Benutzerverwaltung</CloudLink> aktualisieren. Erfahre mehr über das [Anzeigen und Aktualisieren von Benutzerprofilen](/user-management/manage-users/#view-and-update-the-user-profile).

Sei vorsichtig beim Aktualisieren. Das Aktualisieren der _custom_data_ eines Benutzers überschreibt den ursprünglichen Inhalt im Speicher vollständig.

Wenn dein Eingabewert beim Aufruf der Update-_custom_data_-API wie folgt aussieht (angenommen, die ursprünglichen _custom_data_ sind die zuvor gezeigten Beispieldaten):

```json
{
  "customDataBaz": {
    "baz": "baz"
  }
}
```

dann sieht der neue _custom_data_-Wert nach dem Update so aus:

```json
{
  "customDataBaz": {
    "baz": "baz"
  }
}
```

Das heißt, der aktualisierte Feldwert hat nichts mehr mit dem vorherigen Wert zu tun.

## Eigenschaftsreferenz \{#property-reference}

Die folgenden Spalten der Benutzer-DB-Tabelle (außer _password_encrypted_ und _password_encryption_method_) sind im Benutzerprofil sichtbar, was bedeutet, dass du sie über die [Management API](https://openapi.logto.io/operation/operation-getuser) abfragen kannst.

| Name                                                                                | Typ       | Beschreibung                                                    | Eindeutig | Erforderlich |
| ----------------------------------------------------------------------------------- | --------- | --------------------------------------------------------------- | --------- | ------------ |
| [id](/user-management/user-data#id)                                                 | string    | Eindeutiger Identifikator                                       | ✅        | ✅           |
| [username](/user-management/user-data#username)                                     | string    | Benutzername für Anmeldung                                      | ✅        | ❌           |
| [primary_email](/user-management/user-data#primary_email)                           | string    | Primäre E-Mail                                                  | ✅        | ❌           |
| [primary_phone](/user-management/user-data#primary_phone)                           | string    | Primäre Telefonnummer                                           | ✅        | ❌           |
| [name](/user-management/user-data#name)                                             | string    | Vollständiger Name                                              | ❌        | ❌           |
| [avatar](/user-management/user-data#avatar)                                         | string    | URL zum Avatarbild des Benutzers                                | ❌        | ❌           |
| [profile](/user-management/user-data#profile)                                       | object    | Benutzerprofil                                                  | ❌        | ✅           |
| [identities](/user-management/user-data#social-identities)                          | object    | Durch Social Sign-in abgerufene Benutzerinfos                   | ❌        | ✅           |
| [custom_data](/user-management/user-data#custom-data)                               | object    | Zusätzliche Infos in anpassbaren Feldern                        | ❌        | ✅           |
| [application_id](/user-management/user-data#application_id)                         | string    | Anwendungs-ID, bei der sich der Benutzer zuerst registriert hat | ❌        | ✅           |
| [last_sign_in_at](/user-management/user-data#last_sign_in_at)                       | date time | Zeitstempel der letzten Anmeldung                               | ❌        | ✅           |
| [password_encrypted](/user-management/user-data#password_encrypted)                 | string    | Verschlüsseltes Passwort                                        | ❌        | ❌           |
| [password_encryption_method](/user-management/user-data#password_encryption_method) | string    | Passwort-Verschlüsselungsmethode                                | ❌        | ❌           |
| [is_suspended](/user-management/user-data#is_suspended)                             | bool      | Benutzer-Sperrmarkierung                                        | ❌        | ✅           |
| [mfa_verifications](/user-management/user-data#mfa_verification_factors)            | object[]  | MFA-Verifizierungsfaktoren                                      | ❌        | ✅           |

- **Eindeutig**: Stellt die [Eindeutigkeit](https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-UNIQUE-CONSTRAINTS) der in eine Eigenschaft einer Datenbanktabelle eingegebenen Werte sicher.
- **Erforderlich**: Stellt sicher, dass die in eine Eigenschaft einer Datenbanktabelle eingegebenen Werte NICHT `null` sein können.

## Verwandte Ressourcen \{#related-resources}

<Url href="https://blog.logto.io/secure-hub-for-user-data/">
  Sicheres Zentrum für Benutzerdaten in Bewegung
</Url>
