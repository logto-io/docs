## Schritt 1: Eine App im Facebook App Dashboard einrichten \{#step-1-set-up-an-app-on-facebook-app-dashboard}

Bevor du Facebook als Authentifizierungsanbieter verwenden kannst, musst du eine App auf der Facebook-Entwicklerplattform einrichten, um OAuth 2.0-Zugangsdaten zu erhalten.

1. [Registriere dich als Facebook-Entwickler](https://developers.facebook.com/docs/development/register/), falls du noch kein Konto hast.
2. Besuche die Seite [Apps](https://developers.facebook.com/apps).
3. Klicke auf deine bestehende App oder [erstelle eine neue](https://developers.facebook.com/docs/development/create-an-app), falls nötig.

:::tip
Ein Anwendungsfall ist die primäre Art und Weise, wie deine App mit Meta interagiert und bestimmt, welche APIs, Funktionen, Berechtigungen und Produkte deiner App zur Verfügung stehen. Wenn du nur soziale Authentifizierung benötigst (um E-Mail & public_profile zu erhalten), wähle „Authentifizierung und Anfragedaten von Benutzern mit Facebook Login“. Wenn du auf Facebook-APIs zugreifen möchtest, wähle deine bevorzugten Anwendungsfälle – die meisten unterstützen auch die Integration von „Facebook Login for business“ nach der App-Erstellung.
:::

4. Nach der App-Erstellung navigiere im App-Dashboard zu **Use cases > Facebook Login > Settings** oder **Facebook Login for business > Settings**.
5. Fülle das Feld **Valid OAuth Redirect URIs** mit der Logto **Callback URI** aus (kopiere diese aus deinem Logto Facebook Connector). Nachdem sich Benutzer mit Facebook angemeldet haben, werden sie hierher mit einem Autorisierungscode weitergeleitet, den Logto zur Fertigstellung der Authentifizierung verwendet.
6. Navigiere zu **Use cases** und klicke auf **Customize** deines Anwendungsfalls, um die Berechtigungen (Scopes) hinzuzufügen. Wir empfehlen, `email` und `public_profile` hinzuzufügen, die für die Implementierung der Anmeldung mit Facebook in Logto erforderlich sind.

## Schritt 2: Logto Connector mit Client-Zugangsdaten einrichten \{#step-2-set-up-logto-connector-with-client-credentials}

1. Klicke im Facebook App Dashboard in der Seitenleiste auf **App settings > Basic**.
2. Du siehst die **App ID** und das **App secret** im Panel.
3. Klicke auf die Schaltfläche **Show** neben dem Eingabefeld für das App secret, um den Inhalt anzuzeigen und zu kopieren.
4. Konfiguriere deine Logto Facebook Connector-Einstellungen:
   - Trage in das Feld `clientId` die **App ID** ein.
   - Trage in das Feld `clientSecret` das **App secret** ein.
   - Klicke in Logto auf **Save and Done**, um dein Identitätssystem mit Facebook zu verbinden.

## Schritt 3: Berechtigungen (Scopes) konfigurieren \{#step-3-configure-scopes}

Berechtigungen (Scopes) definieren, welche Zugriffsrechte deine App von den Benutzern anfordert und steuern, auf welche privaten Daten dein Projekt aus deren Facebook-Konten zugreifen kann.

### Berechtigungen im Facebook App Dashboard konfigurieren \{#configure-scopes-in-facebook-app-dashboard}

1. Navigiere zu **Facebook App Dashboard > Use cases** und klicke auf die Schaltfläche **Customize**.
2. Füge nur die Berechtigungen hinzu, die deine App benötigt. Die Benutzer werden diese Berechtigungen auf dem Facebook Zustimmungsbildschirm (Consent screen) überprüfen und autorisieren:
   - **Für Authentifizierung (erforderlich)**: `email` und `public_profile`.
   - **Für API-Zugriff (optional)**: Alle zusätzlichen Berechtigungen, die deine App benötigt (z. B. `threads_content_publish`, `threads_read_replies` für den Zugriff auf die Threads API). Siehe die [Meta Developer Documentation](https://developers.facebook.com/docs/) für verfügbare Dienste.

### Berechtigungen in Logto konfigurieren \{#configure-scopes-in-logto}

Wähle je nach Bedarf eine oder mehrere der folgenden Vorgehensweisen:

**Option 1: Keine zusätzlichen API-Berechtigungen benötigt**

- Lasse das Feld `Scopes` in deinem Logto Facebook Connector leer.
- Die Standardberechtigungen `email public_profile` werden angefordert, damit Logto grundlegende Benutzerinformationen korrekt abrufen kann.

**Option 2: Zusätzliche Berechtigungen bei der Anmeldung anfordern**

- Gib alle gewünschten Berechtigungen im Feld **Scopes** ein, getrennt durch Leerzeichen.
- Alle hier aufgeführten Berechtigungen überschreiben die Standardwerte, daher immer auch die Authentifizierungsberechtigungen `email public_profile` angeben.

**Option 3: Spätere Anforderung zusätzlicher Berechtigungen**

- Nachdem sich der Benutzer angemeldet hat, kannst du bei Bedarf zusätzliche Berechtigungen anfordern, indem du einen föderierten sozialen Autorisierungsfluss erneut startest und das gespeicherte Token-Set des Benutzers aktualisierst.
- Diese zusätzlichen Berechtigungen müssen nicht im Feld `Scopes` deines Logto Facebook Connectors eingetragen werden und können über die Logto Social Verification API erreicht werden.

Wenn du diese Schritte befolgst, fordert dein Logto Facebook Connector genau die Berechtigungen an, die deine App benötigt – nicht mehr und nicht weniger.

:::tip
Wenn deine App diese Berechtigungen anfordert, um auf die Facebook API zuzugreifen und Aktionen auszuführen, aktiviere **Store tokens for persistent API access** im Logto Facebook Connector. Siehe den nächsten Abschnitt für Details.
:::

## Schritt 4: Allgemeine Einstellungen \{#step-4-general-settings}

Hier sind einige allgemeine Einstellungen, die die Verbindung zu Facebook nicht blockieren, aber die Authentifizierungserfahrung für Endbenutzer beeinflussen können.

### Profilinformationen synchronisieren \{#sync-profile-information}

Im Facebook Connector kannst du die Richtlinie für die Synchronisierung von Profilinformationen wie Benutzernamen und Avataren festlegen. Wähle aus:

- **Nur bei Registrierung synchronisieren**: Profilinformationen werden einmalig beim ersten Anmelden des Benutzers abgerufen.
- **Immer bei Anmeldung synchronisieren**: Profilinformationen werden bei jeder Anmeldung des Benutzers aktualisiert.

### Tokens speichern, um auf Facebook APIs zuzugreifen (optional) \{#store-tokens-to-access-facebook-apis-optional}

Wenn du auf Facebook APIs zugreifen und Aktionen mit Benutzerautorisierung durchführen möchtest (egal ob über soziale Anmeldung oder Kontoverknüpfung), muss Logto bestimmte API-Berechtigungen erhalten und Tokens speichern.

1. Füge die erforderlichen Berechtigungen gemäß obigem Tutorial hinzu.
2. Aktiviere **Store tokens for persistent API access** im Logto Facebook Connector. Logto speichert Facebook Zugangstokens sicher im Secret Vault.

:::note
Facebook stellt keine Auffrischungstokens (Refresh tokens) bereit. Wenn jedoch die Token-Speicherung aktiviert ist, fordert Logto bei der Benutzer-Authentifizierung automatisch ein langlebiges Zugangstoken (60 Tage) an. Während dieses Zeitraums können Benutzer Zugangstokens manuell widerrufen, müssen aber ansonsten keine erneute Autorisierung durchführen, um auf Facebook APIs zuzugreifen. Hinweis: Füge `offline_access` nicht zum Feld `Scope` hinzu, da dies zu Fehlern führen kann.
:::

## Schritt 5: Anmeldung mit Facebook-Testbenutzern testen (optional) \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

Du kannst Test-, Entwickler- und Administratorkonten verwenden, um die Anmeldung mit der App zu testen. Du kannst die App auch direkt veröffentlichen, sodass sich jeder Facebook-Benutzer anmelden kann.

1. Klicke im Facebook App Dashboard in der Seitenleiste auf **App roles > Test Users**.
2. Klicke auf die Schaltfläche **Create test users**, um einen Testbenutzer zu erstellen.
3. Klicke auf die Schaltfläche **Options** eines bestehenden Testbenutzers, um weitere Aktionen wie „Name und Passwort ändern“ anzuzeigen.

## Schritt 6: Facebook-Anmeldeeinstellungen veröffentlichen \{#step-6-publish-facebook-sign-in-settings}

In der Regel können sich nur Test-, Administrator- und Entwicklerbenutzer mit der App anmelden. Um normalen Facebook-Benutzern die Anmeldung mit der App in der Produktionsumgebung zu ermöglichen, musst du die App möglicherweise veröffentlichen.

1. Klicke im Facebook App Dashboard in der Seitenleiste auf **Publish**.
2. Fülle die Felder **Privacy Policy URL** und **User data deletion** aus, falls erforderlich.
3. Klicke auf die Schaltfläche **Save changes** unten rechts.
4. Klicke auf die **Live**-Umschaltschaltfläche in der oberen Leiste der App.
