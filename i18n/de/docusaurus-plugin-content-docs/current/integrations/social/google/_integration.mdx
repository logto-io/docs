## Schritt 1: Erstelle ein Projekt auf der Google Auth Platform \{#step-1-create-a-project-on-google-auth-platform}

Bevor du Google als Authentifizierungsanbieter verwenden kannst, musst du ein Projekt in der Google Cloud Console einrichten, um OAuth 2.0-Zugangsdaten zu erhalten. Wenn du bereits ein Projekt hast, kannst du diesen Schritt überspringen.

1. Besuche die [Google Cloud Console](https://console.cloud.google.com/) und melde dich mit deinem Google-Konto an.
2. Klicke auf die Schaltfläche **Projekt auswählen** in der oberen Menüleiste und dann auf **Neues Projekt**, um ein Projekt zu erstellen.
3. Navigiere in deinem neu erstellten Projekt zu **APIs & Dienste > OAuth-Zustimmungsbildschirm**, um deine App zu konfigurieren:
   - **App-Informationen**: Gib den **Anwendungsnamen** und die **Support-E-Mail** ein, die auf der Zustimmungsseite angezeigt werden sollen.
   - **Zielgruppe (Audience)**: Wähle deinen bevorzugten Zielgruppentyp:
     - **Intern** – Nur für Google Workspace-Nutzer innerhalb deiner Organisation
     - **Extern** – Für jeden Google-Nutzer (erfordert eine Überprüfung für den produktiven Einsatz)
   - **Kontaktinformationen**: Gib E-Mail-Adressen an, damit Google dich über Änderungen an deinem Projekt benachrichtigen kann.
   - Setze ein Häkchen bei **Ich stimme den Google-Richtlinien zu**, um die Grundeinrichtung abzuschließen.
4. Optional kannst du im Bereich **Branding** Produktinformationen bearbeiten und dein **App-Logo** hochladen, das auf dem OAuth-Zustimmungsbildschirm angezeigt wird, damit Nutzer deine App erkennen.

:::tip
Wenn du den Zielgruppentyp **Extern** wählst, musst du während der Entwicklung Testnutzer hinzufügen und deine App für den produktiven Einsatz veröffentlichen.
:::

## Schritt 2: Erstelle OAuth 2.0-Zugangsdaten \{#step-2-create-oauth-2-0-credentials}

Navigiere zur [Zugangsdaten](https://console.cloud.google.com/apis/credentials)-Seite in der Google Cloud Console und erstelle OAuth-Zugangsdaten für deine Anwendung.

1. Klicke auf **Zugangsdaten erstellen > OAuth-Client-ID**.
2. Wähle **Webanwendung** als Anwendungstyp.
3. Fülle den **Namen** deines OAuth-Clients aus. Dies hilft dir, die Zugangsdaten zu identifizieren und wird Endbenutzern nicht angezeigt.
4. Konfiguriere die autorisierten URIs:
   - **Autorisierte JavaScript-Quellen**: Füge den Ursprung deiner Logto-Instanz hinzu (z. B. `https://your-logto-domain.com`)
   - **Autorisierte Redirect-URIs**: Füge die Logto **Callback-URI** hinzu (kopiere diese aus deinem Logto Google Connector)
5. Klicke auf **Erstellen**, um den OAuth-Client zu generieren.

## Schritt 3: Konfiguriere den Logto-Connector mit Zugangsdaten \{#step-3-configure-logto-connector-with-credentials}

Nach dem Erstellen des OAuth-Clients zeigt Google ein Modal mit deinen Zugangsdaten an:

1. Kopiere die **Client-ID** und füge sie in das Feld `clientId` in Logto ein.
2. Kopiere das **Client-Secret** und füge es in das Feld `clientSecret` in Logto ein.
3. Klicke auf **Speichern und Fertig** in Logto, um dein Identitätssystem mit Google zu verbinden.

:::warning
Halte dein Client-Secret sicher und veröffentliche es niemals im Client-seitigen Code. Wenn es kompromittiert wird, generiere sofort ein neues.
:::

## Schritt 4: Konfiguriere Berechtigungen (Scopes) \{#step-4-configure-scopes}

Berechtigungen (Scopes) definieren, welche Zugriffsrechte deine App von den Nutzern anfordert und steuern, auf welche Daten deine App in deren Google-Konten zugreifen kann.

### Berechtigungen in der Google Cloud Console konfigurieren \{#configure-scopes-in-google-cloud-console}

1. Navigiere zu **APIs & Dienste > OAuth-Zustimmungsbildschirm > Berechtigungen (Scopes)**.
2. Klicke auf **Scopes hinzufügen oder entfernen** und wähle nur die Berechtigungen aus, die deine App benötigt:
   - **Authentifizierung (erforderlich)**:
     - `https://www.googleapis.com/auth/userinfo.email`
     - `https://www.googleapis.com/auth/userinfo.profile`
     - `openid`
   - **API-Zugriff (optional)**: Füge alle zusätzlichen Berechtigungen hinzu, die deine App benötigt (z. B. Drive, Kalender, YouTube). Durchsuche die [Google API-Bibliothek](https://console.cloud.google.com/apis/library), um verfügbare Dienste zu finden. Wenn deine App Zugriff auf Google APIs über die grundlegenden Berechtigungen hinaus benötigt, aktiviere zuerst die spezifischen APIs, die deine App verwenden wird (z. B. Google Drive API, Gmail API, Kalender API) in der Google API-Bibliothek.
3. Klicke auf **Aktualisieren**, um die Auswahl zu bestätigen.
4. Klicke auf **Speichern und Fortfahren**, um die Änderungen zu übernehmen.

### Berechtigungen in Logto konfigurieren \{#configure-scopes-in-logto}

Wähle je nach Bedarf eine oder mehrere der folgenden Vorgehensweisen:

**Option 1: Keine zusätzlichen API-Berechtigungen benötigt**

- Lasse das Feld `Scopes` in deinem Logto Google Connector leer.
- Die Standardberechtigungen `openid profile email` werden angefordert, damit Logto grundlegende Benutzerinformationen korrekt abrufen kann.

**Option 2: Zusätzliche Berechtigungen beim Anmelden anfordern**

- Gib alle gewünschten Berechtigungen im Feld **Scopes** ein, getrennt durch Leerzeichen.
- Alle hier aufgeführten Berechtigungen überschreiben die Standardwerte, daher immer die Authentifizierungs-Berechtigungen einfügen: `https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile openid`.
- Verwende vollständige Scope-URLs. Beispiel: `https://www.googleapis.com/auth/calendar.readonly`.

**Option 3: Zusätzliche Berechtigungen später inkrementell anfordern**

- Nachdem sich der Nutzer angemeldet hat, kannst du bei Bedarf zusätzliche Berechtigungen anfordern, indem du einen föderierten sozialen Autorisierungsfluss erneut initiierst und das gespeicherte Token-Set des Nutzers aktualisierst.
- Diese zusätzlichen Berechtigungen müssen nicht im Feld `Scopes` deines Logto Google Connectors eingetragen werden und können über die Social Verification API von Logto erreicht werden.

Wenn du diese Schritte befolgst, fordert dein Logto Google Connector genau die Berechtigungen an, die deine App benötigt – nicht mehr und nicht weniger.

:::tip
Wenn deine App diese Berechtigungen anfordert, um auf die Google API zuzugreifen und Aktionen auszuführen, stelle sicher, dass du **Tokens für dauerhaften API-Zugriff speichern** im Logto Google Connector aktivierst. Siehe den nächsten Abschnitt für Details.
:::

## Schritt 5: Authentifizierungsaufforderungen anpassen \{#step-5-customize-authentication-prompts}

Konfiguriere **Prompts** in Logto, um die Benutzererfahrung bei der Authentifizierung zu steuern. Prompts ist ein Array von Zeichenfolgen, das die Art der erforderlichen Benutzerinteraktion angibt:

- `none` – Der Autorisierungsserver zeigt keine Authentifizierungs- oder Zustimmungsbildschirme an. Gibt einen Fehler zurück, wenn der Nutzer noch nicht authentifiziert ist und keine vorherige Zustimmung für die angeforderten Berechtigungen erteilt hat. Verwende dies, um auf bestehende Authentifizierung und/oder Zustimmung zu prüfen.
- `consent` – Der Autorisierungsserver fordert den Nutzer zur Zustimmung auf, bevor Informationen an den Client zurückgegeben werden. Erforderlich, um **Offline-Zugriff** für den Google API-Zugriff zu aktivieren.
- `select_account` – Der Autorisierungsserver fordert den Nutzer auf, ein Benutzerkonto auszuwählen. Dies ermöglicht Nutzern mit mehreren Google-Konten, das gewünschte Konto für die Authentifizierung auszuwählen.

## Schritt 6: Allgemeine Einstellungen \{#step-6-general-settings}

Hier sind einige allgemeine Einstellungen, die die Verbindung zu Google nicht blockieren, aber die Authentifizierungserfahrung der Endnutzer beeinflussen können.

### Profilinformationen synchronisieren \{#sync-profile-information}

Im Google Connector kannst du die Richtlinie für das Synchronisieren von Profilinformationen wie Benutzernamen und Avataren festlegen. Wähle aus:

- **Nur bei Registrierung synchronisieren**: Profilinformationen werden einmalig abgerufen, wenn sich der Nutzer zum ersten Mal anmeldet.
- **Immer bei Anmeldung synchronisieren**: Profilinformationen werden jedes Mal aktualisiert, wenn sich der Nutzer anmeldet.

### Tokens speichern, um auf Google APIs zuzugreifen (Optional) \{#store-tokens-to-access-google-apis-optional}

Wenn du auf [Google APIs](https://console.cloud.google.com/apis/library) zugreifen und Aktionen mit Nutzerautorisierung durchführen möchtest (egal ob über soziale Anmeldung oder Kontoverknüpfung), muss Logto bestimmte API-Berechtigungen erhalten und Tokens speichern.

1. Füge die erforderlichen Berechtigungen in deiner Google Cloud Console OAuth-Zustimmungsbildschirm-Konfiguration und im Logto Google Connector hinzu.
2. Aktiviere **Tokens für dauerhaften API-Zugriff speichern** im Logto Google Connector. Logto speichert Google-Zugangs- und Auffrischungstokens sicher im Secret Vault.
3. Um sicherzustellen, dass Auffrischungstokens zurückgegeben werden, konfiguriere deinen Logto Google Connector wie folgt:
   - Setze **Prompts** so, dass `consent` enthalten ist.
   - Aktiviere **Offline-Zugriff**.

:::warning
Du musst `offline_access` nicht im Logto `Scope`-Feld hinzufügen – dies kann zu einem Fehler führen. Google verwendet automatisch `access_type=offline`, wenn Offline-Zugriff aktiviert ist.
:::

## Schritt 7: Google One Tap aktivieren (Optional) \{#step-7-enable-google-one-tap-optional}

[Google One Tap](https://developers.google.com/identity/gsi/web/guides/features) ist eine sichere und unkomplizierte Möglichkeit, Nutzern die Anmeldung auf deiner Website mit ihrem Google-Konto über eine Popup-Oberfläche zu ermöglichen.

Sobald du den Google Connector eingerichtet hast, siehst du eine Karte für Google One Tap auf der Connector-Detailseite. Aktiviere Google One Tap, indem du den Schalter umlegst.

### Google One Tap Konfigurationsoptionen \{#google-one-tap-configuration-options}

- **Anmeldedaten automatisch auswählen, wenn möglich** – Melde den Nutzer automatisch mit dem Google-Konto an, wenn [bestimmte Bedingungen erfüllt sind](https://developers.google.com/identity/gsi/web/guides/automatic-sign-in-sign-out).
- **Aufforderung abbrechen, wenn der Nutzer außerhalb klickt/tippt** – Schließe die Google One Tap-Aufforderung, wenn der Nutzer außerhalb des Prompts klickt oder tippt. Wenn deaktiviert, muss der Nutzer auf die Schaltfläche „Schließen“ klicken, um die Aufforderung zu schließen.
- **Verbesserte One Tap UX auf ITP-Browsern aktivieren** – Aktiviere die verbesserte Google One Tap-Benutzererfahrung auf Intelligent Tracking Prevention (ITP)-Browsern. Weitere Informationen findest du in [dieser Dokumentation](https://developers.google.com/identity/gsi/web/guides/features#upgraded_ux_on_itp_browsers).

:::warning
Stelle sicher, dass du deine Domain im Abschnitt **Autorisierte JavaScript-Quellen** deiner OAuth-Client-Konfiguration hinzufügst. Andernfalls kann Google One Tap nicht angezeigt werden.
:::

### Wichtige Einschränkungen bei Google One Tap \{#important-limitations-with-google-one-tap}

Wenn du **Tokens für dauerhaften API-Zugriff speichern** zusammen mit **Google One Tap** aktivierst, erhältst du nicht automatisch ein Zugangstoken oder die angeforderten Berechtigungen.

Die Google One Tap-Anmeldung (im Gegensatz zum Standard-Button „Mit Google anmelden“) stellt **kein** OAuth-Zugangstoken aus. Sie gibt nur ein ID-Token (ein signiertes JWT) zurück, das die Identität des Nutzers bestätigt, aber keinen API-Zugriff gewährt.

Um mit Google One Tap-Nutzern auf Google APIs zuzugreifen, kannst du die Social Verification API von Logto verwenden, um nach der Anmeldung mit Google One Tap einen föderierten sozialen Autorisierungsfluss erneut zu initiieren. So kannst du bei Bedarf zusätzliche Berechtigungen anfordern und das gespeicherte Token-Set des Nutzers aktualisieren, ohne dass die Berechtigungen im Logto Google Connector vorab eingetragen werden müssen. Dieser Ansatz ermöglicht eine inkrementelle Autorisierung, sodass Nutzer nur dann um zusätzliche Berechtigungen gebeten werden, wenn deine App sie tatsächlich benötigt.

Weitere Informationen zu [Google One Tap-Einschränkungen](https://developers.google.com/identity/gsi/web/guides/overview) findest du in der offiziellen Dokumentation.

## Schritt 8: Teste und veröffentliche deine App \{#step-8-test-and-publish-your-app}

### Für interne Apps \{#for-internal-apps}

Wenn dein **Zielgruppen**-Typ in Google auf **Intern** gesetzt ist, steht deine App nur Google Workspace-Nutzern innerhalb deiner Organisation zur Verfügung. Du kannst mit jedem Konto aus deiner Organisation testen.

### Für externe Apps \{#for-external-apps}

Wenn dein **Zielgruppen**-Typ **Extern** ist:

1. **Während der Entwicklung**: Navigiere zu **OAuth-Zustimmungsbildschirm > Testnutzer** und füge die E-Mail-Adressen der Testnutzer hinzu. Nur diese Nutzer können sich mit deiner App anmelden.
2. **Für den produktiven Einsatz**: Klicke im Bereich OAuth-Zustimmungsbildschirm auf **App veröffentlichen**, um sie für alle mit einem Google-Konto verfügbar zu machen.

:::note
Apps mit sensiblen oder eingeschränkten Berechtigungen müssen möglicherweise von Google überprüft werden, bevor sie veröffentlicht werden können. Dieser Prozess kann mehrere Wochen dauern.
:::
