## Erstelle eine mobile App in der WeChat Open Platform \{#create-a-mobile-app-in-the-wechat-open-platform}

:::tip

Du kannst einige Abschnitte überspringen, wenn du sie bereits abgeschlossen hast.

:::

### Erstelle ein Konto \{#create-an-account}

Öffne https://open.weixin.qq.com/, klicke auf die Schaltfläche „Sign Up“ oben rechts und schließe dann den Registrierungsprozess ab.

### Erstelle eine mobile App \{#create-a-mobile-app}

Melde dich mit dem gerade erstellten Konto an. Im Tab „Mobile Application“ (移动应用) klicke auf die große grüne Schaltfläche „Create a mobile app“ (创建移动应用).

<img src="/img/assets/app-tabs.png" alt="App tabs" />

Füllen wir die erforderlichen Informationen im Antragsformular aus.

<img src="/img/assets/create-mobile-app.png" alt="Create mobile app" />

#### Grundlegende Informationen \{#basic-info}

Die meisten Felder sind selbsterklärend, und wir haben hier einige Tipps:

- Wenn du nur WeChat-Anmeldung testen möchtest und die App nicht im App Store ist, wähle im Abschnitt „App is available“ die Option „No“, um den „App download link“ zu überspringen.
- Das „App operation flow chart“ sieht kompliziert aus. Nach unserer Erfahrung solltest du ein einfaches Flussdiagramm und einige App-Screenshots vorbereiten, um die Wahrscheinlichkeit zu erhöhen, die Überprüfung zu bestehen.

Klicke auf „Next step“, um fortzufahren.

#### Plattform-Informationen \{#platform-info}

Du kannst eine oder beide Plattformen, iOS und Android, konfigurieren, um Logto mit WeChat Native Sign-in zu integrieren.

**iOS-App**

Wähle „iOS app“ (iOS 应用) aus und dann entsprechend den Zielgerätetyp deiner App.

<img src="/img/assets/platform.png" alt="App platform" />

Wenn du „No“ für die App Store-Verfügbarkeit gewählt hast, kannst du das Feld „AppStore download address“ hier überspringen.

Fülle _Bundle ID_, _Test version Bundle ID_ und _Universal Links_ aus (tatsächlich wird nur ein Link benötigt 😂).

:::note

_Bundle ID_ und _Test version Bundle ID_ können denselben Wert haben.

:::

:::tip

WeChat verlangt einen Universal Link für die native Anmeldung. Wenn du ihn noch nicht eingerichtet hast oder nicht weißt, was das ist, siehe die [offizielle Apple-Dokumentation](https://developer.apple.com/ios/universal-links/).

:::

**Android-App**

Wähle „Android app“ (Android 应用) aus.

<img src="/img/assets/platform-android-app.png" alt="Android app platform" />

Fülle _Application Signing Signature_ (应用签名) und _Application Package Name_ (应用包名) aus.

:::note

Du musst deine App signieren, um eine Signatur zu erhalten. Weitere Informationen findest du unter [Sign your app](https://developer.android.com/studio/publish/app-signing).

:::

Nach dem Signieren kannst du die Aufgabe `signingReport` ausführen, um die Signatur zu erhalten.

```bash
./gradlew your-android-project:signingReport
```

Der `MD5`-Wert des Berichts der entsprechenden Build-Variante ist die _Application Signing Signature_ (应用签名), aber denke daran, alle Doppelpunkte aus dem Wert zu entfernen und ihn in Kleinbuchstaben zu schreiben.

Z.B. `1A:2B:3C:4D` -> `1a2b3c4d`.

#### Warten auf das Überprüfungsergebnis \{#waiting-for-the-review-result}

Nachdem du die Plattforminformationen ausgefüllt hast, klicke auf „Submit Review“, um fortzufahren. In der Regel geht die Überprüfung schnell und ist innerhalb von 1-2 Tagen abgeschlossen.

Wir vermuten, dass der Prüfer bei jeder Einreichung zufällig zugewiesen wird, da der Standard schwankt. Es kann sein, dass du beim ersten Mal abgelehnt wirst, aber gib nicht auf! Erkläre deine aktuelle Situation und frage den Prüfer, wie du sie ändern kannst.

## Aktiviere WeChat Native Sign-in in deiner App \{#enable-wechat-native-sign-in-in-your-app}

### iOS \{#ios}

Wir gehen davon aus, dass du das [Logto iOS SDK](/quick-starts/swift) in deiner App integriert hast. In diesem Fall ist alles ziemlich einfach und du musst nicht einmal die WeChat SDK-Dokumentation lesen:

**1. Konfiguriere Universal Link und URL Scheme in deinem Xcode-Projekt**

Im Xcode-Projekt -> Tab „Signing & Capabilities“, füge die Fähigkeit „Associated Domains“ und den zuvor konfigurierten Universal Link hinzu.

<img src="/img/assets/universal-link.png" alt="Universal link" />

Gehe dann zum Tab „Info“ und füge ein [benutzerdefiniertes URL-Schema](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) mit der WeChat App ID hinzu.

<img src="/img/assets/custom-url-scheme.png" alt="Custom URL scheme" />

Öffne abschließend deine `Info.plist` und füge `weixinULAPI` und `weixin` unter `LSApplicationQueriesSchemes` hinzu.

<img src="/img/assets/plist.png" alt="Plist" />

:::note

Wir wissen, dass diese Schritte nicht sehr sinnvoll erscheinen, aber dies ist die minimal funktionsfähige Lösung, die wir gefunden haben. Siehe den [magischen offiziellen Leitfaden](https://developers.weixin.qq.com/doc/oplatform/en/Mobile_App/Access_Guide/iOS.html) für weitere Informationen.

:::

**2. Füge `LogtoSocialPluginWechat` zu deinem Xcode-Projekt hinzu**

Füge das Framework hinzu:

<img src="/img/assets/add-framework.png" alt="Add framework" />

Und füge `-ObjC` zu deinen Build Settings > Linking > Other Linker Flags hinzu:

<img src="/img/assets/linker-flags.png" alt="Linker flags" />

:::note

Das Plugin enthält das WeChat Open SDK 1.9.2. Du kannst nach dem Importieren des Plugins direkt `import WechatOpenSDK` verwenden.

:::

**3. Füge das Plugin zu deinen `LogtoClient`-Init-Optionen hinzu**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginWechat()]
)
```

**4. Behandle `onOpenURL` korrekt**

:::note

Die Funktion `LogtoClient.handle(url:)` behandelt alle nativen Connectors, die du aktiviert hast. Du musst sie nur einmal aufrufen.

:::

```swift
// SwiftUI
YourRootView()
  .onOpenURL { url in
      LogtoClient.handle(url: url)
  }

// oder AppDelegate
func application(_ app: UIApplication, open url: URL, options: /*...*/) -> Bool {
  LogtoClient.handle(url: url)
}
```

### Android \{#android}

Wir gehen davon aus, dass du das [Logto Android SDK](/quick-starts/android) in deiner App integriert hast. In diesem Fall ist alles ziemlich einfach und du musst nicht einmal die WeChat SDK-Dokumentation lesen:

**1. Füge das `Wechat Open SDK` zu deinem Projekt hinzu**

Stelle sicher, dass das Repository `mavenCentral()` in deinen Gradle-Projekt-Repositories enthalten ist:

```kotlin
repositories {
  // ...
  mavenCentral()
}
```

Füge das Wechat Open SDK zu deinen Abhängigkeiten hinzu:

```kotlin
dependencies {
  // ...
  api("com.tencent.mm.opensdk:wechat-sdk-android:6.8.0")  // kotlin-script
  // oder
  api 'com.tencent.mm.opensdk:wechat-sdk-android:6.8.0'   // groovy-script
}
```

**2. Füge `WXEntryActivity` zu deinem Projekt hinzu**

Erstelle ein `wxapi`-Paket unter deinem Paket-Root und füge die `WXEntryActivity` im `wxapi`-Paket hinzu (Beispiel: `com.sample.app`):

```kotlin
// WXEntryActivity.kt
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

class WXEntryActivity: WechatSocialResultActivity()
```

```java
// WXEntryActivity.java
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

public class WXEntryActivity extends WechatSocialResultActivity {}
```

Die endgültige Position der `WXEntryActivity` im Projekt sollte wie folgt aussehen (Beispiel für Kotlin):

```bash
src/main/kotlin/com/sample/app/wxapi/WXEntryActivity.kt
```

**3. Ändere die `AndroidManifest.xml`**

Füge die folgende Zeile zu deiner `AndroidManifest.xml` hinzu:

```xml
\<?xml version="1.0" encoding="utf-8"?>
\<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.sample.app">

  \<application>
    \<!-- Zeile, die hinzugefügt werden muss -->
    \<activity android:name=".wxapi.WXEntryActivity" android:exported="true"/>
  \</application>

\</manifest>
```
