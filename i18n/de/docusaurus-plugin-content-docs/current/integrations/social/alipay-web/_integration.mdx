## Alipay-Entwicklerkonto registrieren \{#register-alipay-developer-account}

[Registriere ein Alipay-Entwicklerkonto](https://certifyweb.alipay.com/certify/reg/guide#/), falls du noch keines hast.

## Alipay-App erstellen und konfigurieren \{#create-and-configure-alipay-app}

1. Melde dich mit dem gerade registrierten Konto in der [Alipay-Konsole](https://open.alipay.com/) an.
2. Gehe zum Tab „Web & Mobile Apps“ (网页&移动应用) im Panel „Meine Anwendung“ (我的应用).
3. Klicke auf die Schaltfläche „App erstellen“ (立即创建), um mit der Konfiguration deiner Anwendung zu beginnen.
4. Benenne deine Anwendung im Feld „Anwendungsname“ (应用名称) gemäß den Namenskonventionen und lade dein „Anwendungssymbol“ (应用图标) hoch. Stelle sicher, dass du „Webanwendung“ (网页应用) als „App-Typ“ (应用类型) auswählst.
5. Nach dem Erstellen der Anwendung gelangst du zur Übersichtsseite. Dort solltest du auf „Fähigkeit hinzufügen“ (添加能力) klicken, um „Drittanbieter-Anwendungsautorisierung“ (第三方应用授权), „Mitgliedsinformationen abrufen“ (获取会员信息) und „App Alipay-Login“ (App 支付宝登录) hinzuzufügen, bevor du die Alipay-Anmeldung aktivierst.
6. Gehe zum [Alipay-Kundencenter](https://b.alipay.com/index2.htm) und melde dich mit dem Alipay-Entwicklerkonto an. Klicke auf „Konto-Center“ (账号中心) in der oberen Leiste und gehe zu „APPID-Bindung“ (APPID 绑定), deren Zugang sich unten in der Seitenleiste befindet. „Bindung hinzufügen“ (添加绑定), indem du die APPID der in Schritt 4 erstellten Webanwendung eingibst.
7. Klicke auf die Schaltfläche „Signieren“ von „App Alipay-Login“ und schließe den Signiervorgang gemäß der Anleitung ab. Nach Abschluss dieses Schritts sollten die in Schritt 5 hinzugefügten Fähigkeiten aktiv sein.
8. Kehre zur Alipay Open Platform-Konsole zurück. Im Abschnitt „Entwicklungsinformationen“ (开发信息) findest du die „Schnittstellen-Signaturmethode“ (接口加签方式（密钥/证书）). Klicke auf die Schaltfläche „Einrichten“ (设置), um zur Seite zur Auswahl der Signaturmethode zu gelangen. „Öffentlicher Schlüssel“ (公钥) ist die bevorzugte Signaturmethode. Trage den Inhalt der von dir generierten öffentlichen Schlüsseldatei in das Textfeld ein.
9. Richte die „Autorisierungs-Redirect-URI“ (授权回调地址) ein, indem du auf die Schaltfläche „Einrichten“ (设置) unten auf der Alipay-Konsole klickst. `${your_logto_origin}/callback/${connector_id}` ist die Standard-Redirect-URI, die im Logto-Core verwendet wird. Die `connector_id` findest du in der oberen Leiste der Logto Admin Console auf der Detailseite des Connectors.
10. Nachdem du alle diese Schritte abgeschlossen hast, gehe zurück in die obere rechte Ecke der Alipay-Konsole und klicke auf „Zur Überprüfung einreichen“ (提交审核). Sobald die Überprüfung genehmigt ist, kannst du einen reibungslosen Alipay-Anmeldeablauf nutzen.

:::note
Du kannst _openssl_ verwenden, um Schlüsselpaaren auf deinem lokalen Rechner zu generieren, indem du folgenden Code-Schnipsel im Terminal ausführst.

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Beim Ausfüllen des öffentlichen Schlüssels auf der Alipay-App-Einrichtungsseite musst du den Header und Footer von `public.pem` entfernen, alle Zeilenumbrüche löschen und den restlichen Inhalt in das Textfeld für den „öffentlichen Schlüssel“ einfügen.

:::

## Logto Alipay Web Connector-Einstellungen konfigurieren \{#set-up-the-logto-alipay-web-connector-settings}

1. Im [Alipay-Konsole-Arbeitsbereich](https://open.alipay.com/dev/workspace) gehe zum Panel „Meine Anwendung“ (我的应用) und klicke auf den Tab „Web & Mobile Apps“ (网页&移动应用). Dort findest du die APPID aller Anwendungen.
2. Im Schritt 7 des vorherigen Abschnitts hast du bereits ein Schlüsselpaar generiert, bestehend aus einem privaten und einem öffentlichen Schlüssel.
3. Fülle die Logto-Connector-Einstellungen aus:
   - Trage in das Feld `appId` die APPID aus Schritt 1 ein.
   - Trage in das Feld `privateKey` den Inhalt der privaten Schlüsseldatei aus Schritt 2 ein. STELLE SICHER, dass du '\n' für alle Zeilenumbrüche verwendest und entferne NICHT den Header und Footer der privaten Schlüsseldatei.
   - Trage in das Feld `signType` 'RSA2' ein, da wir im Schritt 7 von „Alipay-Apps erstellen und konfigurieren“ den Modus `Public key` gewählt haben.
   - Trage in das Feld `charset` entweder 'gbk' oder 'utf8' ein. Dieses Feld ist OPTIONAL und kann leer gelassen werden. Der Standardwert ist 'utf8'.
   - Trage in das Feld `scope` entweder 'auth_base' oder 'auth_user' ein. Auch dieses Feld ist OPTIONAL und kann leer gelassen werden. Der Standardwert ist 'auth_user'. Du kannst den [Unterschied](https://opendocs.alipay.com/fw/api/105942) zwischen den verschiedenen Werten nachlesen.

### Konfigurationstypen \{#config-types}

| Name       | Typ                    | Enum-Werte                   |
| ---------- | ---------------------- | ---------------------------- |
| appId      | string                 | N/A                          |
| privateKey | string                 | N/A                          |
| signType   | enum string            | 'RSA' \| 'RSA2'              |
| charset    | enum string (OPTIONAL) | 'gbk' \| 'utf8' \| undefined |
| scope      | enum string (OPTIONAL) | 'auth_user' \| 'auth_base'   |
