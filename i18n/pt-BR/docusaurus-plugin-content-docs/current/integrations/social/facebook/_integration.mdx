## Etapa 1: Configure um aplicativo no Painel do Facebook App \{#step-1-set-up-an-app-on-facebook-app-dashboard}

Antes de usar o Facebook como um provedor de autenticação, você deve configurar um aplicativo na plataforma de desenvolvedores do Facebook para obter credenciais OAuth 2.0.

1. [Registre-se como Desenvolvedor do Facebook](https://developers.facebook.com/docs/development/register/) se ainda não tiver uma conta.
2. Visite a página de [Apps](https://developers.facebook.com/apps).
3. Clique em seu aplicativo existente ou [crie um novo](https://developers.facebook.com/docs/development/create-an-app) se necessário.

:::tip
Um caso de uso é a principal forma como seu aplicativo irá interagir com a Meta e determina quais APIs, recursos, permissões e produtos estarão disponíveis para seu aplicativo. Se você precisa apenas de autenticação social (para obter email & public_profile), selecione "Authentication and request data from users with Facebook Login". Se quiser acessar APIs do Facebook, escolha seus casos de uso preferidos — a maioria deles também suporta a integração do "Facebook Login for business" após a criação do aplicativo.
:::

4. Após a criação do aplicativo, na página do painel do aplicativo, navegue até **Use cases > Facebook Login > Settings** ou **Facebook Login for business > Settings**.
5. Preencha o campo **Valid OAuth Redirect URIs** com o **Callback URI** do Logto (copie isso do seu conector Facebook do Logto). Após os usuários fazerem login com o Facebook, eles serão redirecionados para cá com um código de autorização que o Logto usa para finalizar a autenticação.
6. Navegue até **Use cases** e clique em **Customize** do seu caso de uso para adicionar os escopos. Recomendamos adicionar `email` e `public_profile`, que são necessários para implementar o login com Facebook no Logto.

## Etapa 2: Configure o conector Logto com as credenciais do cliente \{#step-2-set-up-logto-connector-with-client-credentials}

1. No Painel do Facebook App, clique na barra lateral em **App settings > Basic**.
2. Você verá o **App ID** e o **App secret** no painel.
3. Clique no botão **Show** ao lado do campo App secret para revelar e copiar seu conteúdo.
4. Configure as definições do seu conector Facebook do Logto:
   - Preencha o campo `clientId` com o **App ID**.
   - Preencha o campo `clientSecret` com o **App secret**.
   - Clique em **Save and Done** no Logto para conectar seu sistema de identidade ao Facebook.

## Etapa 3: Configure os escopos \{#step-3-configure-scopes}

Os escopos definem as permissões que seu aplicativo solicita aos usuários e controlam quais dados privados seu projeto pode acessar das contas do Facebook deles.

### Configure os escopos no Painel do Facebook App \{#configure-scopes-in-facebook-app-dashboard}

1. Navegue até **Facebook App Dashboard > Use cases** e clique no botão **Customize**.
2. Adicione apenas os escopos que seu aplicativo precisa. Os usuários irão revisar e autorizar essas permissões na tela de consentimento do Facebook:
   - **Para autenticação (Obrigatório)**: `email` e `public_profile`.
   - **Para acesso à API (Opcional)**: Quaisquer escopos adicionais que seu aplicativo necessite (por exemplo, `threads_content_publish`, `threads_read_replies` para acessar a API do Threads). Consulte a [Documentação do Desenvolvedor Meta](https://developers.facebook.com/docs/) para serviços disponíveis.

### Configure os escopos no Logto \{#configure-scopes-in-logto}

Escolha uma ou mais das abordagens abaixo conforme sua necessidade:

**Opção 1: Não precisa de escopos extras de API**

- Deixe o campo `Scopes` em branco no seu conector Facebook do Logto.
- O escopo padrão `email public_profile` será solicitado para garantir que o Logto possa obter corretamente as informações básicas do usuário.

**Opção 2: Solicitar escopos adicionais no login**

- Insira todos os escopos desejados no campo **Scopes**, separados por espaços.
- Quaisquer escopos listados aqui substituem os padrões, então sempre inclua os escopos de autenticação: `email public_profile`.

**Opção 3: Solicitar escopos incrementais posteriormente**

- Após o usuário fazer login, você pode solicitar escopos adicionais sob demanda reiniciando um fluxo de autorização social federado e atualizando o conjunto de tokens armazenados dos usuários.
- Esses escopos adicionais não precisam ser preenchidos no campo `Scopes` do seu conector Facebook do Logto, e podem ser obtidos através da Social Verification API do Logto.

Seguindo esses passos, seu conector Facebook do Logto solicitará exatamente as permissões que seu aplicativo precisa — nem mais, nem menos.

:::tip
Se seu aplicativo solicitar esses escopos para acessar a API do Facebook e realizar ações, certifique-se de habilitar **Store tokens for persistent API access** no conector Facebook do Logto. Veja a próxima seção para detalhes.
:::

## Etapa 4: Configurações gerais \{#step-4-general-settings}

Aqui estão algumas configurações gerais que não bloqueiam a conexão com o Facebook, mas podem afetar a experiência de autenticação do usuário final.

### Sincronizar informações do perfil \{#sync-profile-information}

No conector do Facebook, você pode definir a política para sincronizar informações do perfil, como nomes de usuário e avatares. Escolha entre:

- **Sincronizar apenas no cadastro**: As informações do perfil são buscadas uma vez quando o usuário faz login pela primeira vez.
- **Sempre sincronizar no login**: As informações do perfil são atualizadas toda vez que o usuário faz login.

### Armazenar tokens para acessar APIs do Facebook (Opcional) \{#store-tokens-to-access-facebook-apis-optional}

Se você deseja acessar APIs do Facebook e realizar ações com autorização do usuário (seja via login social ou vinculação de conta), o Logto precisa obter escopos específicos de API e armazenar tokens.

1. Adicione os escopos necessários seguindo o tutorial acima.
2. Habilite **Store tokens for persistent API access** no conector Facebook do Logto. O Logto armazenará com segurança os tokens de acesso do Facebook no Secret Vault.

:::note
O Facebook não fornece tokens de atualização. No entanto, quando o armazenamento de tokens está habilitado, o Logto solicita automaticamente um token de acesso de longa duração (60 dias) na autenticação do usuário. Durante esse período, os usuários podem revogar manualmente os tokens de acesso, mas, caso contrário, não precisarão de nova autorização para acessar as APIs do Facebook. Observação: Não adicione `offline_access` ao campo `Scope`, pois isso pode causar erros.
:::

## Etapa 5: Teste o login com usuários de teste do Facebook (Opcional) \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

Você pode usar contas de usuário de teste, desenvolvedor e administrador para testar o login com o aplicativo. Você também pode publicar o aplicativo diretamente para que qualquer usuário do Facebook possa fazer login.

1. No Painel do Facebook App, clique na barra lateral em **App roles > Test Users**.
2. Clique no botão **Create test users** para criar um usuário de teste.
3. Clique no botão **Options** de um usuário de teste existente para ver mais operações, como "Change name and password".

## Etapa 6: Publique as configurações de login do Facebook \{#step-6-publish-facebook-sign-in-settings}

Normalmente, apenas usuários de teste, administradores e desenvolvedores podem fazer login com o aplicativo. Para permitir que usuários normais do Facebook façam login com o aplicativo em ambiente de produção, pode ser necessário publicar este aplicativo.

1. No Painel do Facebook App, clique na barra lateral em **Publish**.
2. Preencha os campos **Privacy Policy URL** e **User data deletion** se necessário.
3. Clique no botão **Save changes** no canto inferior direito.
4. Clique no botão **Live** na barra superior do aplicativo.
