## Crie seu aplicativo OAuth \{#create-your-oauth-app}

Ao abrir esta página, presumimos que você já sabe qual provedor de identidade social deseja conectar. A primeira coisa a fazer é confirmar se o provedor de identidade suporta o protocolo OAuth, que é um pré-requisito para configurar um conector válido. Em seguida, siga as instruções do provedor de identidade para registrar e criar o aplicativo relevante para autorização OAuth.

## Configure seu conector \{#configure-your-connector}

SOMENTE suportamos o tipo de concessão "Authorization Code" por questões de segurança e ele se encaixa perfeitamente no cenário do Logto.

`clientId` e `clientSecret` podem ser encontrados na página de detalhes do seu aplicativo OAuth.

_clientId_: O client ID é um identificador único que identifica o aplicativo cliente durante o registro com o servidor de autorização. Esse ID é usado pelo servidor de autorização para verificar a identidade do aplicativo cliente e associar quaisquer tokens de acesso autorizados a esse aplicativo específico.

_clientSecret_: O client secret é uma chave confidencial emitida para o aplicativo cliente pelo servidor de autorização durante o registro. O aplicativo cliente usa essa chave secreta para se autenticar com o servidor de autorização ao solicitar tokens de acesso. O client secret é considerado informação confidencial e deve ser mantido seguro o tempo todo.

_tokenEndpointAuthMethod_: O método de autenticação do endpoint de token é usado pelo aplicativo cliente para se autenticar com o servidor de autorização ao solicitar tokens de acesso. Para descobrir os métodos suportados, consulte o campo `token_endpoint_auth_methods_supported` disponível no endpoint de descoberta OpenID Connect do provedor de serviço OAuth 2.0, ou consulte a documentação relevante fornecida pelo provedor de serviço OAuth 2.0.

_clientSecretJwtSigningAlgorithm (Opcional)_: Só é necessário quando `tokenEndpointAuthMethod` é `client_secret_jwt`. O algoritmo de assinatura JWT do client secret é usado pelo aplicativo cliente para assinar o JWT que é enviado ao servidor de autorização durante a solicitação de token.

_scope_: O parâmetro scope é usado para especificar o conjunto de recursos e permissões que o aplicativo cliente está solicitando acesso. O parâmetro scope é normalmente definido como uma lista de valores separados por espaço que representam permissões específicas. Por exemplo, um valor de escopo "read write" pode indicar que o aplicativo cliente está solicitando acesso de leitura e escrita aos dados de um usuário.

Você deve encontrar `authorizationEndpoint`, `tokenEndpoint` e `userInfoEndpoint` na documentação do fornecedor social.

_authenticationEndpoint_: Este endpoint é usado para iniciar o processo de autenticação. O processo de autenticação normalmente envolve o usuário fazendo login e concedendo autorização para o aplicativo cliente acessar seus recursos.

_tokenEndpoint_: Este endpoint é usado pelo aplicativo cliente para obter um token de acesso que pode ser usado para acessar os recursos solicitados. O aplicativo cliente normalmente envia uma solicitação ao endpoint de token com um tipo de concessão e código de autorização para receber um token de acesso.

_userInfoEndpoint_: Este endpoint é usado pelo aplicativo cliente para obter informações adicionais sobre o usuário, como nome completo, endereço de e-mail ou foto de perfil. O endpoint de informações do usuário normalmente é acessado após o aplicativo cliente obter um token de acesso do endpoint de token.

O Logto também fornece um campo `profileMap` que os usuários podem personalizar para mapear os perfis dos fornecedores sociais, que geralmente não são padronizados. As chaves são os nomes dos campos padrão do perfil de usuário do Logto e os valores correspondentes devem ser os nomes dos campos dos perfis sociais. No estágio atual, o Logto só se preocupa com 'id', 'name', 'avatar', 'email' e 'phone' do perfil social, sendo apenas 'id' obrigatório e os demais campos opcionais.

`responseType` e `grantType` SÓ podem ser valores FIXOS com o tipo de concessão authorization code, então os tornamos opcionais e os valores padrão serão preenchidos automaticamente.

Por exemplo, você pode encontrar a [resposta do perfil de usuário do Google](https://developers.google.com/identity/openid-connect/openid-connect#an-id-tokens-payload) e, portanto, seu `profileMap` deve ser assim:

```json
{
  "id": "sub",
  "avatar": "picture"
}
```

:::note

Fornecemos uma chave OPCIONAL `customConfig` para colocar seus parâmetros personalizados.
Cada provedor de identidade social pode ter sua própria variação no protocolo padrão OAuth. Se o seu provedor de identidade social desejado seguir estritamente o protocolo padrão OAuth, então você não precisa se preocupar com o `customConfig`.

:::

## Tipos de configuração \{#config-types}

| Nome                      | Tipo                    | Obrigatório |
| ------------------------- | ----------------------- | ----------- |
| authorizationEndpoint     | string                  | true        |
| userInfoEndpoint          | string                  | true        |
| clientId                  | string                  | true        |
| clientSecret              | string                  | true        |
| tokenEndpointResponseType | enum                    | false       |
| responseType              | string                  | false       |
| grantType                 | string                  | false       |
| tokenEndpoint             | string                  | false       |
| scope                     | string                  | false       |
| customConfig              | Record\<string, string> | false       |
| profileMap                | ProfileMap              | false       |

| Campos do ProfileMap | Tipo   | Obrigatório | Valor padrão |
| -------------------- | ------ | ----------- | ------------ |
| id                   | string | false       | id           |
| name                 | string | false       | name         |
| avatar               | string | false       | avatar       |
| email                | string | false       | email        |
| phone                | string | false       | phone        |

## Configurações gerais \{#general-settings}

Aqui estão algumas configurações gerais que não bloqueiam a conexão com seu provedor de identidade, mas podem afetar a experiência de autenticação do usuário final.

### Nome e logo do botão social \{#social-button-name-and-logo}

Se você deseja exibir um botão social na sua página de login, pode definir o **nome** e o **logo** (modo escuro e modo claro) do provedor de identidade social. Isso ajudará os usuários a reconhecerem a opção de login social.

### Nome do provedor de identidade \{#identity-provider-name}

Cada conector social possui um nome exclusivo de Provedor de Identidade (IdP) para diferenciar as identidades dos usuários. Enquanto conectores comuns usam um nome de IdP fixo, conectores personalizados exigem um valor exclusivo. Saiba mais sobre [nomes de IdP](https://docs.logto.io/connectors/connector-data-structure#target-identity-provider-name) para mais detalhes.

### Sincronizar informações do perfil \{#sync-profile-information}

No conector OAuth, você pode definir a política para sincronizar informações do perfil, como nomes de usuário e avatares. Escolha entre:

- **Sincronizar apenas no cadastro**: As informações do perfil são buscadas uma vez quando o usuário faz login pela primeira vez.
- **Sempre sincronizar no login**: As informações do perfil são atualizadas toda vez que o usuário faz login.

### Armazenar tokens para acessar APIs de terceiros (Opcional) \{#store-tokens-to-access-third-party-apis-optional}

Se você deseja acessar as APIs do Provedor de Identidade e realizar ações com autorização do usuário (seja via login social ou vinculação de conta), o Logto precisa obter escopos de API específicos e armazenar tokens.

1. Adicione os escopos necessários no campo **scope** seguindo as instruções acima
2. Ative **Armazenar tokens para acesso persistente à API** no conector OAuth do Logto. O Logto armazenará tokens de acesso com segurança no Cofre de Segredos.
3. Para provedores de identidade OAuth/OIDC **padrão**, o escopo `offline_access` deve ser incluído para obter um token de atualização, evitando solicitações repetidas de consentimento do usuário.

:::warning
Mantenha seu client secret seguro e nunca o exponha em código do lado do cliente. Se for comprometido, gere um novo imediatamente nas configurações do aplicativo do seu provedor de identidade.
:::

## Utilize o conector OAuth \{#utilize-the-oauth-connector}

Depois de criar um conector OAuth e conectá-lo ao seu provedor de identidade, você pode incorporá-lo aos seus fluxos de usuário final. Escolha as opções que atendem às suas necessidades:

### Ativar botão de login social \{#enable-social-sign-in-button}

1. No Logto Console, vá para <CloudLink to="/sign-in-experience/sign-up-and-sign-in">Experiência de login > Cadastro e login</CloudLink>.
2. Adicione o conector OAuth na seção **Login social** para permitir que os usuários se autentiquem com seu provedor de identidade.

Saiba mais sobre a [experiência de login social](https://docs.logto.io/end-user-flows/sign-up-and-sign-in/social-sign-in).

### Vincular ou desvincular uma conta social \{#link-or-unlink-a-social-account}

Use a Account API para construir um Centro de Conta personalizado em seu aplicativo que permita aos usuários autenticados vincular ou desvincular suas contas sociais. [Siga o tutorial da Account API](https://docs.logto.io/end-user-flows/account-settings/by-account-api#link-a-new-social-connection)

:::tip
É permitido ativar o conector OAuth apenas para vinculação de conta e acesso à API, sem ativá-lo para login social.
:::

### Acessar APIs do provedor de identidade e realizar ações \{#access-identity-provider-apis-and-perform-actions}

Seu aplicativo pode recuperar tokens de acesso armazenados no Cofre de Segredos para chamar as APIs do seu provedor de identidade e automatizar tarefas de backend. As capacidades específicas dependem do seu provedor de identidade e dos escopos solicitados. Consulte o guia sobre como recuperar tokens armazenados para acesso à API.

## Gerenciar a identidade social do usuário \{#manage-user-s-social-identity}

Depois que um usuário vincula sua conta social, os administradores podem gerenciar essa conexão no Logto Console:

1. Navegue até <CloudLink to="/users">Logto console > Gerenciamento de usuários</CloudLink> e abra o perfil do usuário.
2. Em **Conexões sociais**, localize o item do provedor de identidade e clique em **Gerenciar**.
3. Nesta página, os administradores podem gerenciar a conexão social do usuário, ver todas as informações de perfil concedidas e sincronizadas da conta social e verificar o status do token de acesso.

:::note
Algumas respostas de token de acesso do Provedor de Identidade não incluem informações específicas de escopo, então o Logto não pode exibir diretamente a lista de permissões concedidas pelo usuário. No entanto, desde que o usuário tenha consentido com os escopos solicitados durante a autorização, seu aplicativo terá as permissões correspondentes ao acessar a API OAuth.
:::
