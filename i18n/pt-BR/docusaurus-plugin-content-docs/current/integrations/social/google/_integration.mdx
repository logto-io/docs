## Etapa 1: Crie um projeto na Plataforma de Autenticação do Google \{#step-1-create-a-project-on-google-auth-platform}

Antes de usar o Google como um provedor de autenticação, você deve configurar um projeto no Google Cloud Console para obter credenciais OAuth 2.0. Se você já possui um projeto, pode pular esta etapa.

1. Acesse o [Google Cloud Console](https://console.cloud.google.com/) e faça login com sua conta Google.
2. Clique no botão **Selecionar um projeto** na barra de menu superior e, em seguida, clique no botão **Novo projeto** para criar um projeto.
3. No seu projeto recém-criado, navegue até **APIs e serviços > Tela de consentimento OAuth** para configurar seu aplicativo:
   - **Informações do aplicativo**: Insira o **Nome do aplicativo** e o **E-mail de suporte** que serão exibidos na página de consentimento
   - **Público (Audience)**: Selecione o tipo de público preferido:
     - **Interno** - Apenas para usuários do Google Workspace dentro da sua organização
     - **Externo** - Para qualquer usuário Google (requer verificação para uso em produção)
   - **Informações de contato**: Forneça endereços de e-mail para que o Google possa notificá-lo sobre quaisquer alterações em seu projeto
   - Marque **Concordo com as políticas do Google** para finalizar a configuração básica
4. Opcionalmente, vá até a seção **Branding** para editar as informações do produto e fazer upload do **Logo do aplicativo**, que aparecerá na tela de consentimento OAuth para ajudar os usuários a reconhecerem seu app.

:::tip
Se você escolher o tipo de público **Externo**, será necessário adicionar usuários de teste durante o desenvolvimento e publicar seu app para uso em produção.
:::

## Etapa 2: Crie credenciais OAuth 2.0 \{#step-2-create-oauth-2-0-credentials}

Navegue até a página de [Credenciais](https://console.cloud.google.com/apis/credentials) no Google Cloud Console e crie credenciais OAuth para seu aplicativo.

1. Clique em **Criar credenciais > ID do cliente OAuth**.
2. Selecione **Aplicativo da Web** como o tipo de aplicativo.
3. Preencha o **Nome** do seu cliente OAuth. Isso ajuda a identificar as credenciais e não é exibido para os usuários finais.
4. Configure os URIs autorizados:
   - **Origens JavaScript autorizadas**: Adicione a origem da sua instância Logto (ex: `https://seu-dominio-logto.com`)
   - **URIs de redirecionamento autorizados**: Adicione o **Callback URI** do Logto (copie isso do seu conector Google do Logto)
5. Clique em **Criar** para gerar o cliente OAuth.

## Etapa 3: Configure o conector Logto com as credenciais \{#step-3-configure-logto-connector-with-credentials}

Após criar o cliente OAuth, o Google exibirá um modal com suas credenciais:

1. Copie o **Client ID** e cole no campo `clientId` no Logto
2. Copie o **Client secret** e cole no campo `clientSecret` no Logto
3. Clique em **Salvar e Concluir** no Logto para conectar seu sistema de identidade ao Google

:::warning
Mantenha seu client secret seguro e nunca o exponha em código do lado do cliente. Se for comprometido, gere um novo imediatamente.
:::

## Etapa 4: Configure os escopos \{#step-4-configure-scopes}

Os escopos definem as permissões que seu app solicita dos usuários e controlam quais dados seu app pode acessar das contas Google deles.

### Configure os escopos no Google Cloud Console \{#configure-scopes-in-google-cloud-console}

1. Navegue até **APIs e serviços > Tela de consentimento OAuth > Escopos**.
2. Clique em **Adicionar ou remover escopos** e selecione apenas os escopos que seu app necessita:
   - **Autenticação (Authentication) (Obrigatório)**:
     - `https://www.googleapis.com/auth/userinfo.email`
     - `https://www.googleapis.com/auth/userinfo.profile`
     - `openid`
   - **Acesso à API (Opcional)**: Adicione quaisquer escopos adicionais necessários para seu app (ex: Drive, Calendar, YouTube). Navegue pela [Biblioteca de APIs do Google](https://console.cloud.google.com/apis/library) para encontrar serviços disponíveis. Se seu app precisar acessar APIs do Google além das permissões básicas, primeiro ative as APIs específicas que seu app usará (ex: Google Drive API, Gmail API, Calendar API) na Biblioteca de APIs do Google.
3. Clique em **Atualizar** para confirmar a seleção.
4. Clique em **Salvar e continuar** para aplicar as alterações.

### Configure os escopos no Logto \{#configure-scopes-in-logto}

Escolha uma ou mais das abordagens abaixo conforme sua necessidade:

**Opção 1: Nenhum escopo extra de API necessário**

- Deixe o campo `Scopes` em branco no seu conector Google do Logto.
- Os escopos padrão `openid profile email` serão solicitados para garantir que o Logto possa obter corretamente as informações básicas do usuário.

**Opção 2: Solicitar escopos adicionais no login**

- Insira todos os escopos desejados no campo **Scopes**, separados por espaços.
- Quaisquer escopos listados aqui substituem os padrões, então sempre inclua os escopos de autenticação: `https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile openid`.
- Use URLs completas dos escopos. Exemplo: `https://www.googleapis.com/auth/calendar.readonly`.

**Opção 3: Solicitar escopos incrementais posteriormente**

- Após o usuário fazer login, você pode solicitar escopos adicionais sob demanda reiniciando um fluxo de autorização social federado e atualizando o conjunto de tokens armazenados do usuário.
- Esses escopos adicionais não precisam ser preenchidos no campo `Scopes` do seu conector Google do Logto, e podem ser obtidos através da Social Verification API do Logto.

Seguindo essas etapas, seu conector Google do Logto solicitará exatamente as permissões que seu app precisa — nem mais, nem menos.

:::tip
Se seu app solicitar esses escopos para acessar a API do Google e realizar ações, certifique-se de habilitar **Armazenar tokens para acesso persistente à API** no conector Google do Logto. Veja a próxima seção para detalhes.
:::

## Etapa 5: Personalize os prompts de autenticação \{#step-5-customize-authentication-prompts}

Configure **Prompts** no Logto para controlar a experiência de autenticação do usuário. Prompts é um array de strings que especifica o tipo de interação do usuário necessária:

- `none` - O servidor de autorização não exibe nenhuma tela de autenticação ou consentimento. Retorna um erro se o usuário ainda não estiver autenticado e não tiver consentimento pré-configurado para os escopos solicitados. Use isso para verificar autenticação e/ou consentimento existentes.
- `consent` - O servidor de autorização solicita consentimento do usuário antes de retornar informações ao cliente. Necessário para habilitar **acesso offline** para acesso à API do Google.
- `select_account` - O servidor de autorização solicita ao usuário que selecione uma conta. Isso permite que usuários com várias contas Google escolham qual conta usar para autenticação.

## Etapa 6: Configurações gerais \{#step-6-general-settings}

Aqui estão algumas configurações gerais que não bloqueiam a conexão com o Google, mas podem afetar a experiência de autenticação do usuário final.

### Sincronizar informações do perfil \{#sync-profile-information}

No conector Google, você pode definir a política para sincronização das informações do perfil, como nomes de usuário e avatares. Escolha entre:

- **Sincronizar apenas no cadastro**: As informações do perfil são buscadas uma vez quando o usuário faz login pela primeira vez.
- **Sempre sincronizar no login**: As informações do perfil são atualizadas toda vez que o usuário faz login.

### Armazenar tokens para acessar APIs do Google (Opcional) \{#store-tokens-to-access-google-apis-optional}

Se você deseja acessar [APIs do Google](https://console.cloud.google.com/apis/library) e realizar ações com autorização do usuário (seja via login social ou vinculação de conta), o Logto precisa obter escopos específicos de API e armazenar tokens.

1. Adicione os escopos necessários na configuração da tela de consentimento OAuth do Google Cloud Console e no conector Google do Logto.
2. Habilite **Armazenar tokens para acesso persistente à API** no conector Google do Logto. O Logto armazenará com segurança os tokens de acesso e atualização do Google no Cofre de Segredos.
3. Para garantir que tokens de atualização sejam retornados, configure seu conector Google do Logto da seguinte forma:
   - Defina **Prompts** para incluir `consent`
   - Habilite **Acesso offline**

:::warning
Você não precisa adicionar `offline_access` no campo `Scope` do Logto — fazer isso pode causar um erro. O Google usa `access_type=offline` automaticamente quando o acesso offline está habilitado.
:::

## Etapa 7: Habilite o Google One Tap (Opcional) \{#step-7-enable-google-one-tap-optional}

[Google One Tap](https://developers.google.com/identity/gsi/web/guides/features) é uma forma segura e simplificada de permitir que usuários façam login no seu site com a conta Google usando uma interface pop-up.

Depois de configurar o conector Google, você verá um cartão para o Google One Tap na página de detalhes do conector. Habilite o Google One Tap ativando o interruptor.

### Opções de configuração do Google One Tap \{#google-one-tap-configuration-options}

- **Selecionar credencial automaticamente se possível** - Faz login automático do usuário com a conta Google se [certas condições forem atendidas](https://developers.google.com/identity/gsi/web/guides/automatic-sign-in-sign-out)
- **Cancelar o prompt se o usuário clicar/tocar fora** - Fecha o prompt do Google One Tap se o usuário clicar ou tocar fora do prompt. Se desabilitado, o usuário deve clicar no botão de fechar para dispensar o prompt.
- **Habilitar UX aprimorado do One Tap em navegadores ITP** - Habilita a experiência aprimorada do Google One Tap em navegadores com Intelligent Tracking Prevention (ITP). Consulte [esta documentação](https://developers.google.com/identity/gsi/web/guides/features#upgraded_ux_on_itp_browsers) para mais informações.

:::warning
Certifique-se de adicionar seu domínio na seção **Origens JavaScript autorizadas** na configuração do seu cliente OAuth. Caso contrário, o Google One Tap não poderá ser exibido.
:::

### Limitações importantes com o Google One Tap \{#important-limitations-with-google-one-tap}

Se você habilitar **Armazenar tokens para acesso persistente à API** junto com o **Google One Tap**, você não receberá automaticamente um token de acesso ou os escopos solicitados.

O login pelo Google One Tap (diferente do botão padrão "Entrar com o Google") **não** emite um token de acesso OAuth. Ele retorna apenas um token de ID (um JWT assinado) que verifica a identidade do usuário, mas não concede acesso à API.

Para acessar APIs do Google com usuários do Google One Tap, você pode usar a Social Verification API do Logto para reiniciar um fluxo de autorização social federado após o usuário fazer login com o Google One Tap. Isso permite solicitar escopos adicionais conforme necessário e atualizar o conjunto de tokens armazenados do usuário, sem exigir que os escopos estejam pré-preenchidos no conector Google do Logto. Essa abordagem permite autorização incremental, então os usuários só são solicitados para permissões extras quando seu app realmente precisa delas.

Saiba mais sobre as [limitações do Google One Tap](https://developers.google.com/identity/gsi/web/guides/overview) na documentação oficial.

## Etapa 8: Teste e publique seu app \{#step-8-test-and-publish-your-app}

### Para apps internos \{#for-internal-apps}

Se o tipo de **Público (Audience)** no Google estiver definido como **Interno**, seu app estará disponível apenas para usuários do Google Workspace dentro da sua organização. Você pode testar usando qualquer conta da sua organização.

### Para apps externos \{#for-external-apps}

Se o tipo de **Público (Audience)** for **Externo**:

1. **Durante o desenvolvimento**: Navegue até **Tela de consentimento OAuth > Usuários de teste** e adicione os endereços de e-mail dos usuários de teste. Apenas esses usuários poderão fazer login com seu app.
2. **Para produção**: Clique em **Publicar app** na seção da tela de consentimento OAuth para disponibilizá-lo para qualquer pessoa com uma Conta Google.

:::note
Apps com escopos sensíveis ou restritos podem exigir verificação do Google antes de serem publicados. Esse processo pode levar várias semanas.
:::
