---
sidebar_position: 3
---

# 認証アプリ OTP

## 概念 \{#concepts}

認証アプリ（Authenticator app）、またはソフトウェアトークン（Software Token）は、最も広く採用されている [多要素認証 (MFA)](https://auth.wiki/mfa) 方法の一つです。これは一時的な [ワンタイムパスワード (OTP)](https://auth.wiki/otp) を生成し、オンラインサービスの認証 (Authentication) のセキュリティを強化します。物理的なハードウェアトークンとは異なり、ソフトウェアトークンは通常、ユーザーがスマートフォンやコンピュータのブラウザなどのデバイスにインストールするアプリケーションやプラグインです。ソフトウェアトークンは、認証アプリの機能やユーザーの設定に応じて、単一デバイス上でローカルに動作したり、さまざまなデバイス間で同期したりできます。

代表的なソフトウェアトークンには、Google Authenticator、Microsoft Authenticator、Duo、1Password、Authy などがあります。

## MFA 用認証アプリ OTP の設定 \{#configure-authenticator-app-otp-for-mfa}

1. <CloudLink to="/mfa">コンソール > 多要素認証 (MFA)</CloudLink>
2. 「認証アプリ OTP」要素を有効化します。認証アプリ OTP は、他の MFA 要素（パスキー、SMS、バックアップコード）と組み合わせて使用することを推奨します。これにより単一要素への依存を減らせます。
3. 希望する MFA ポリシー（必須 / 任意）を設定します。
4. 設定変更を保存します。

## 認証アプリ OTP 管理の設定 \{#configure-authenticator-app-otp-management}

Account API を利用して、ユーザーが認証アプリ OTP 設定を追加・表示・削除できるカスタムアカウント管理インターフェースを構築できます。これは、個別のアカウントセンターの作成やデバイス間バックアップシナリオの実現に役立ちます。

詳細な実装手順や API エンドポイントについては、[Account API によるアカウント設定](/end-user-flows/account-settings/by-account-api#link-a-new-totp) を参照してください。

## 認証アプリ OTP 設定フロー \{#authentication-app-otp-setup-flows}

1. **QR コードまたはシークレットキー**：サービスからユーザーに QR コードまたはシークレットキーが提供されます。
2. **アカウント追加**：ユーザーは認証アプリを使い、QR コードをスキャンするかシークレットキーを手動で入力してアカウントを追加します。
3. **動的ワンタイムパスワード**：認証アプリは、追加されたアカウント用に 1～2 分ごとに更新される 6 桁のコードを表示します。
4. **MFA 設定完了**：ユーザーはこのコードを有効期限内に MFA 設定ページへ入力し、認証アプリ OTP の MFA 設定を完了します。

<img src="/img/assets/otp-set-up-flow.png" alt="OTP set up flow" />

## 認証アプリ OTP 検証フロー \{#authentication-app-otp-verification-flows}

1. **ログイン試行**：ログイン時にユーザーへ MFA の入力が求められます。
2. **OTP 取得**：認証アプリを開き、該当アカウントの OTP を取得します。
3. **OTP 入力**：アプリに表示された OTP を有効期限内に 2 段階認証ページへ入力します。
4. **認証 (Authentication)**：システムが OTP を検証し、認証に成功するとアクセスが許可されます。

<img src="/img/assets/otp-verification-flow.png" alt="OTP verification flow" />
