---
sidebar_position: 7
---

import Availability from '@components/Availability';

# ユーザープロファイルの収集

<Availability cloud oss="comingSoon" />

ユーザーサインインに必要な認証 (Authentication) 識別子や認証情報に加えて、アプリケーションでパーソナライズされた製品体験を提供するために、Logto に保存された追加のユーザープロファイル情報を収集し、JWT クレームや API を通じて簡単に取得できるようにすることができます。ユーザーデータは以下の方法で収集できます：

- **新規ユーザー登録時**： [ユーザープロファイルの収集](#quick-start) 機能を利用して、サインアップ時に追加のユーザープロファイル情報を収集する「あなたについて教えてください」ステップを簡単に追加できます。新規ユーザーは、登録が完了する前にすべての必須項目を入力する必要があります。本ドキュメントではこの方法に焦点を当てています。

- **ユーザー登録後**： [Account API](/end-user-flows/account-settings/by-account-api) を利用して、オンボーディングフローやアカウントセンター、または製品利用中にセルフサービスでユーザープロファイル情報を更新できる体験を実装できます。

## 主なメリット \{#key-benefits}

**ユーザープロファイルの収集** 機能により、エンドユーザーの登録体験中に追加のユーザー情報を収集できます。登録フローが長くなりユーザーのコンバージョン率に影響しないよう、製品に必要な最小限の情報のみを収集することを推奨します。

この機能でできること：

- **包括的なユーザーデータの取得**： [ユーザーデータ](/user-management/user-data) をビジネスやコンプライアンス目的で収集できます。 [OIDC 標準ユーザープロパティ](#basic-user-data-fields) や [カスタムデータ](#custom-user-data-fields) も含みます。

- **柔軟なフィールドカスタマイズ**： テキスト、数値、日付、チェックボックス、ドロップダウン（セレクト）、URL、正規表現バリデーションなど、さまざまな [フィールドタイプ](#field-types) から選択でき、要件に合わせて設定できます。

- **最適化されたユーザー体験**： ラベル、説明、プレースホルダー、バリデーションルールで表示をカスタマイズ可能。ビジネス要件に応じて必須／任意フィールドを設定できます。

- **組み込みフィールド設定**： よく使われるユーザープロパティ用の基本データフィールドをプラグアンドプレイで利用可能。複合フィールド（住所、氏名）を使えば、構造化データを効率的に一度に収集できます。

## クイックスタート \{#quick-start}

1. <CloudLink to="/sign-in-experience/collect-user-profile">
     Logto コンソール > サインイン体験 > ユーザープロファイルの収集
   </CloudLink>
   にアクセスします。
2. 「プロフィールフィールドを追加」をクリックし、 [組み込みフィールド](#basic-user-data-fields) を選択するか、 [カスタムデータ](#custom-user-data-fields)（英数字キー）を定義して作成します。
3. フィールド詳細を開き、フィールドタイプ、ラベル、説明、必須フラグ、タイプ固有の設定（長さ、範囲、フォーマット、選択肢など）を設定し、「変更を保存」をクリックします。
4. サインイン体験 > ユーザープロファイルの収集画面に戻り、ドラッグ＆ドロップでフィールドの順序を変更できます。変更は自動的に適用されます。
5. [Logto ライブプレビュー](/customization/live-preview) やテストアプリでユーザー体験をテストしましょう。 [識別子（メール／電話番号／ユーザー名）](/end-user-flows/sign-up-and-sign-in/sign-up)、 [ソーシャルサインイン](/end-user-flows/sign-up-and-sign-in/social-sign-in)、 [エンタープライズシングルサインオン (SSO)](/end-user-flows/enterprise-sso) いずれの方法で新規アカウントを作成しても、登録時に「あなたについて教えてください」ページが表示されます。

<img
  src="/img/assets/collect-user-profile-during-sign-up.png"
  alt="サインアップ時のユーザープロファイル収集"
/>

## ユーザーデータの種類 \{#user-data-types}

ユーザーデータは各 [ユーザープロファイル](/user-management/manage-users) で確認できます。すべてのユーザーデータカテゴリの概要は [ユーザーデータ構造](/user-management/user-data) ドキュメントを参照してください。ユーザープロファイルの収集機能では、登録時に基本ユーザーデータとカスタムユーザーデータの両方を収集できます。

### 基本ユーザーデータフィールド \{#basic-user-data-fields}

Logto が提供する基本ユーザーデータフィールドは `user` または `user.profile` プロパティに直接保存されます。これらのフィールドはデフォルト設定値と i18n 翻訳が用意されており、作成後すぐに利用できます。要件に応じてフィールドタイプやパラメータをカスタマイズすることも可能です。

| フィールド名 (13%) | ユーザーデータキー (44%)                                                                                                                                                                                                                                                                        | 説明                                                                                                                                                                  |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name               | <code>user.name</code>                                                                                                                                                                                                                                                                          | すべての名前要素を含む表示用のフルネーム（例：「Jane Doe」）。                                                                                                        |
| Fullname           | <code>user.profile.givenName</code><br /><code>user.profile.middleName</code><br /><code>user.profile.familyName</code>                                                                                                                                                                         | ユーザーの正式な氏名。設定に応じて familyName, givenName, middleName を柔軟に組み合わせます。                                                                         |
| Nickname           | <code>user.profile.nickname</code>                                                                                                                                                                                                                                                              | 法的な名前とは異なる、カジュアルまたは親しい間柄で使う名前。                                                                                                          |
| Birthdate          | <code>user.profile.birthdate</code>                                                                                                                                                                                                                                                             | 指定フォーマットでの生年月日（例：「MM-dd-yyyy」）。                                                                                                                  |
| Gender             | <code>user.profile.gender</code>                                                                                                                                                                                                                                                                | ユーザーが自己申告する性別（例：「女性」「男性」「回答しない」など）。                                                                                                |
| Profile            | <code>user.profile.profile</code>                                                                                                                                                                                                                                                               | ユーザーの人間が読めるプロフィールページの URL（例：SNS プロフィール）。                                                                                              |
| Website            | <code>user.profile.website</code>                                                                                                                                                                                                                                                               | ユーザーの個人ウェブサイトやブログの URL。                                                                                                                            |
| Address            | <code>user.profile.address.formatted</code><br /><code>user.profile.address.streetAddress</code><br /><code>user.profile.address.region</code><br /><code>user.profile.address.zoneinfo</code><br /><code>user.profile.address.postalCode</code><br /><code>user.profile.address.country</code> | ユーザーの住所（例：「123 Main St, Anytown, USA 12345」）。 <code>address.formatted</code> の単一行または、構成要素（通り、都市、州、郵便番号、国）を個別に設定可能。 |

### カスタムユーザーデータフィールド \{#custom-user-data-fields}

カスタムユーザーデータフィールドは、基本フィールドでカバーされない追加情報（例：好み、興味、会社規模、その他ビジネス固有属性など）を収集するためのユーザー定義フィールドです。

カスタムフィールド作成時は、ユーザーデータキーに英数字のみを使用してください（例： `customData.companySize`）。その後、 [フィールドタイプ](#field-types) を設定し、追加プロパティをカスタマイズできます。

ユーザー作成後にカスタムユーザーデータを取得・更新する方法については [ユーザーデータ構造](/user-management/user-data#custom-data) を参照してください。

## フィールドタイプ \{#field-types}

フィールドはシンプルさで大別できます：

- プリミティブ型：テキスト、数値、日付、チェックボックス（ブール値）、ドロップダウン（単一選択）、URL、正規表現。
- 複合型：氏名、住所。

### 共通プロパティ \{#common-properties}

| プロパティ (14%) | 対象 (36%)           | 備考                                                                                       |
| ---------------- | -------------------- | ------------------------------------------------------------------------------------------ |
| ラベル           | すべて               | ユーザーに表示される名称。値が入力済みまたはフォーカス時は上部に浮かびます。必須項目です。 |
| プレースホルダー | チェックボックス以外 | ラベルが浮いているときに表示されるヒント（例文や書式ガイド）。                             |
| 説明             | チェックボックス以外 | フィールド下部に表示される補足説明や長めの指示文。                                         |
| 必須             | チェックボックス以外 | 有効時は未入力で送信不可。無効時はラベルに「（任意）」タグが付きます。                     |

### タイプ固有の設定 \{#type-specific-configurations}

| タイプ (14%)               | 設定可能項目 (36%)                       | 備考                                                                                                                                                                                                                                                |
| -------------------------- | ---------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| テキスト                   | 最小／最大長さ                           | 入力テキストの最小・最大長さを制限します。                                                                                                                                                                                                          |
| 数値                       | 最小／最大値                             | 入力値の数値範囲を制限します。                                                                                                                                                                                                                      |
| 日付                       | 日付フォーマット（プリセット／カスタム） | プリセット（MM/dd/yyyy, dd/MM/yyyy, yyyy-MM-dd）から選択。プレースホルダー変更でデフォルト動作を上書き。完全カスタマイズは <a href="https://date-fns.org/v2.30.0/docs/format" target="_blank" rel="noopener noreferrer">date-fns</a> パターン対応。 |
| チェックボックス           | デフォルト値                             | チェック済み（True）／未チェック（False）。                                                                                                                                                                                                         |
| ドロップダウン（セレクト） | 選択肢リスト（1つ以上）                  | 1行ごとに <code>値:ラベル</code> 形式。ラベル省略時は値が表示されます。                                                                                                                                                                             |
| URL                        | N/A                                      | N/A                                                                                                                                                                                                                                                 |
| 正規表現                   | 正規表現パターン                         | バリデーションパターン（先頭／末尾スラッシュ不要）。例：SSN 用 <code>^\d{3}-\d{2}-\d{4}$</code>。                                                                                                                                                   |
| 住所                       | 構成要素                                 | 単一行または複数行。サブ要素：通り、都市、州、郵便番号、国。                                                                                                                                                                                        |
| 氏名                       | 構成要素                                 | サブ要素：名、ミドルネーム、姓。                                                                                                                                                                                                                    |

## バリデーション \{#validation}

バリデーションは登録の最終ステップでユーザー送信時に実行されます。以下のチェックが適用されます：

- 必須項目の入力（チェックボックス以外）。
- 長さの制限（テキスト）。
- 数値範囲（数値）。
- パターン一致（正規表現、日付フォーマット、URL、選択肢）。
- URL 構造（基本的な構文チェック、到達性は未検証）。

また、複合フィールド（ `address` と `fullname` ）のサブ要素にも同様のバリデーションが適用されます。

## ローカライズ \{#localization}

Logto は `firstName`、`lastName`、`gender`、`birthdate` などの基本ユーザーデータフィールドに対してシステムレベルの翻訳を提供しています。これらのフィールドのラベルは Logto コンソールで設定可能です。
独自の翻訳を提供したい場合は [Logto > サインイン体験 > コンテンツ](https://cloud.logto.io/to/sign-in-experience/content) で上書きできます。

カスタムフィールドは、指定したラベル・プレースホルダー・説明文のみが表示されます。カスタムフィールドのローカライズには [独自 UI の持ち込み](/customization/bring-your-ui) を利用するか、 [お問い合わせ](https://logto.io/contact) でフィードバックをお寄せください。

## Management API (主要エンドポイント) \{#management-api-key-endpoints}

| メソッド (10%) | エンドポイント                                               | 目的                                     |
| -------------- | ------------------------------------------------------------ | ---------------------------------------- |
| GET            | <code>/api/custom-profile-fields</code>                      | すべてのフィールド一覧を取得。           |
| GET            | <code>/api/custom-profile-fields/:name</code>                | 名前で単一フィールド定義を取得。         |
| POST           | <code>/api/custom-profile-fields</code>                      | フィールドを作成。                       |
| POST           | <code>/api/custom-profile-fields/batch</code>                | 一括作成（1リクエスト最大20件）。        |
| PUT            | <code>/api/custom-profile-fields/:name</code>                | 名前と全データセットでフィールドを更新。 |
| DELETE         | <code>/api/custom-profile-fields/:name</code>                | フィールドを削除。                       |
| POST           | <code>/api/custom-profile-fields/properties/sie-order</code> | サインイン体験でのフィールド順序を更新。 |

## ベストプラクティス \{#best-practices}

- サインアップ時は必要最小限のデータのみ収集し、任意情報は後からプロフィール完成時に取得しましょう。
- 構造化データ（住所、氏名）は複合フィールドを使い、整合性とローカライズ性を高めましょう。
- 書式依存フィールド（正規表現、日付、数値範囲）には明確な例やプレースホルダーを用意しましょう。

## よくある質問 \{#faqs}

<details>

<summary>

### プロフィールフィールドは既存ユーザーデータも収集しますか？ \{#do-the-profile-fields-collect-existing-user-data}

</summary>

いいえ、新規ユーザー登録の最終ステップでのみ情報を収集します。

</details>

<details>

<summary>

### フィールドを削除した場合、ユーザーデータも削除されますか？ \{#what-if-i-delete-a-field-does-it-remove-the-user-data}

</summary>

いいえ、既存のユーザーデータは削除されません。エンドユーザー体験のサインアップフォームからフィールドが削除されるだけです。

</details>

<details>

<summary>

### 国名を通常のテキストフィールドではなく、選択肢リストで収集できますか？ \{#can-i-collect-country-with-a-controlled-list-instead-of-a-regular-text-field}

</summary>

はい、「国」コンポーネントを標準化された選択肢付きの「ドロップダウン（単一選択）」フィールドに切り替えられます。

</details>
