---
sidebar_position: 7
sidebar_label: エラーページ
---

# カスタムサインイン体験のエラーページ

サインインフロー中、エンドユーザーがデフォルトのエラーページを見る場合があります。よくあるシナリオは次の通りです：

- **セッションの有効期限切れ**：サインインに時間がかかりすぎて、セッションがタイムアウトした場合。
- **サインイン URL への直接アクセス**：ユーザーがブックマークを開いたり、`/sign-in` URL を共有した場合（通常のサインインボタンを経由せずにアクセス）。
- **存在しないルート**：認証フローに存在しないパスへ遷移した場合。
- **ソーシャルサインインコールバックの問題**：ソーシャルコールバックページでソーシャルセッションが見つからない場合。
- **無効なマジックリンク**：[ワンタイムトークン（マジックリンク）](/end-user-flows/one-time-token)（組織招待やパスワードレスサインインなど）の有効期限切れや既に使用済みの場合。

デフォルトでは、Logto はこれらのシナリオで汎用的なエラーページ（例：404「不明なセッション」ページ）を表示します。エラー発生時のエンドユーザー体験を向上させるため、以下のパラメーターを設定する必要があります：

- **不明なセッションリダイレクト URL**：セッションが見つからない場合にユーザーを送るフォールバック URL。
- **サポートメール & サポートウェブサイト**：エラーページに表示される連絡先情報。

## 不明なセッションリダイレクト URL \{#unknown-session-redirect-url}

Logto は認証 (Authentication) に [OpenID Connect (OIDC)](https://auth.wiki/openid-connect) フローを使用しています。有効な OIDC 認可 (Authorization) フローは、アプリケーションから開始される必要があります。例えば、アプリの「サインイン」ボタンをクリックすると、OIDC 認可 (Authorization) リクエストが Logto に送信され、セキュアなセッション（Cookie）がセットされます。

しかし、ユーザーが `/sign-in` に直接アクセスし、セッション検証をバイパスした場合、次のようなときに「不明なセッション」404 エラーが発生します：

- セッションが期限切れ
- サインインリンクをブックマーク・共有した場合
- 認可 (Authorization) コンテキストが欠落している場合

これに対応するため、Logto では `unknownSessionRedirectUrl` 設定が導入されました。この URL を設定すると、Logto は 404 エラーを表示する代わりに、指定したページへ自動的にリダイレクトし、新しいサインインフローを再開します。

設定方法：

1. <CloudLink to="/sign-in-experience/sign-up-and-sign-in">
     コンソール > サインイン体験 > サインアップとサインイン > 詳細設定
   </CloudLink>
   へ移動
2. 「不明なセッションリダイレクト URL」にサービスアドレスやプロダクトのホームページを設定します。例：Logto Cloud では「https://cloud.logto.io」と設定します。

## サポート連絡先情報 \{#support-contact-info}

その他のエラー（無効なパスへのアクセス、セッションのないソーシャルコールバック、有効期限切れのマジックリンクのオープンなど）が発生した場合、Logto はデフォルトのエラーページを表示します。ユーザーをサポートするため、これら避けられないエラーページに連絡先情報を表示できます。

<img
  src="/img/assets/sign-in-error-pages.png"
  alt="認証 (Authentication) エラーページとサポート連絡先情報"
/>

設定方法：

1. <CloudLink to="/sign-in-experience/content">
     コンソール > サインイン体験 > コンテンツ > サポート
   </CloudLink>
   へ移動
2. サポートメールアドレスを設定
3. サポートまたは公式ウェブサイトの URL を設定

これにより、何か問題が発生した場合でも、ユーザーが明確にサポートを受けられる手段を持つことができます。
