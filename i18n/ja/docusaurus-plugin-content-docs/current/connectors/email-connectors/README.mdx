---
id: email-connectors
title: メールコネクター
sidebar_label: メールコネクター
sidebar_position: 1
---

# メールコネクター

メールコネクターは、メール配信サービスと Logto を統合し、メールによる安全なユーザー認証を可能にします。設定が完了すると、ユーザーの [サインアップ](/end-user-flows/sign-up-and-sign-in/sign-up)、[サインイン](/end-user-flows/sign-up-and-sign-in/sign-in)、[パスワードリセット](/end-user-flows/sign-up-and-sign-in/reset-password)、[アカウント連携](/end-user-flows/sign-up-and-sign-in/social-sign-in#account-linking)、[メンバー招待](/end-user-flows/organization-experience/invite-organization-members)、[高リスク操作の検証](/end-user-flows/security-verification) のために [ワンタイムパスワード (OTP)](https://auth.wiki/otp) を送信できます。

## メールコネクターを選択する \{#choose-your-email-connector}

Logto では、3 種類のメールコネクターオプションを提供しています：

### 無料 Logto メールサービス（Cloud のみ） \{#free-logto-email-service-cloud-only}

この組み込みメールサービスオプションは、[テスト](/logto-cloud/tenant-settings#development) や [本番](/logto-cloud/tenant-settings#production) の両方で素早く始めたい場合に最適です。サードパーティとの連携が不要で、無料かつ信頼性の高いメール配信を提供します。あらかじめデザインされたメールテンプレートに対して、基本的なブランディングをカスタマイズするだけで利用できます。

Logto メールサービスコネクターは、ロゴ、会社情報、送信者名などのブランディングカスタマイズ機能を提供しています。

ただし、便利な一方で、送信者のメールアドレスやドメイン、メール本文の詳細なカスタマイズはできないという制限があります。

```mdx-code-block
import DocCardList from '@theme/DocCardList';
import LogtoEmailService from '@site/docs/connectors/assets/icons/logto-email-service.svg';
import AwsDm from '@site/docs/connectors/assets/icons/aws-direct-mail.svg';
import SendGrid from '@site/docs/connectors/assets/icons/sendgrid.svg';
import Mailgun from '@site/docs/connectors/assets/icons/mailgun.svg';
import Postmark from '@site/docs/connectors/assets/icons/postmark.svg';
import AliyunDm from '@site/docs/connectors/assets/icons/aliyun-direct-mail.svg';
import Smtp from '@site/docs/connectors/assets/icons/smtp.svg';
import Http from '@site/docs/connectors/assets/icons/http.svg';

<DocCardList
  items={[
    {
      type: 'link',
      label: 'Logto Email Service',
      href: '/connectors/email-connectors/built-in-email-service',
      description: 'Logto メールサービスの公式コネクターです。',
      customProps: {
        icon: <LogtoEmailService />,
      }
    },
  ]}
/>
```

### 人気のメールプロバイダー \{#popular-email-providers}

Logto のステップバイステップガイドを使って、お好みのメールサービスプロバイダー（ESP）と連携できます。

これらのオプションでは、[メールテンプレートのカスタマイズ](/connectors/email-connectors/email-templates)、送信者名、変数の追加など、ブランドに合わせて柔軟に設定できます。

以下のメールサービスプロバイダーに対して、すぐに使えるサポートを提供しています：

```mdx-code-block
<DocCardList
  items={[
    {
      type: 'link',
      label: 'AWS Direct Mail',
      href: '/integrations/aws-ses',
      description: 'AWS のダイレクトメールサービス用 Logto 公式コネクターです。',
      customProps: {
        icon: <AwsDm />,
      }
    },
    {
      type: 'link',
      label: 'Mailgun',
      href: '/integrations/mailgun',
      description: 'Mailgun メールサービス用 Logto 公式コネクターです。',
      customProps: {
        icon: <Mailgun />,
      }
    },
    {
      type: 'link',
      label: 'SendGrid Email',
      href: '/integrations/sendgrid-email',
      description: 'SendGrid メールサービス用 Logto 公式コネクターです。',
      customProps: {
        icon: <SendGrid />,
      }
    },
    {
      type: 'link',
      label: 'Aliyun Direct Mail',
      href: '/integrations/aliyun-dm',
      description: 'Aliyun のダイレクトメールサービス用 Logto 公式コネクターです。',
      customProps: {
        icon: <AliyunDm />,
      }
    },
    {
      type: 'link',
      label: 'Postmark Mail',
      href: '/integrations/postmark',
      description: 'Postmark メールサービス用 Logto コネクターです。',
      customProps: {
        icon: <Postmark />,
      }
    },
  ]}
/>
```

### メールコネクターをカスタマイズする \{#customize-your-email-connector}

上記のいずれのソリューションも要件を満たさない場合は、Simple Mail Transfer Protocol (SMTP) を利用して希望のメールサービスと接続することもできます。

```mdx-code-block
<DocCardList
  items={[
    {
      type: 'link',
      label: 'SMTP',
      href: '/integrations/smtp',
      description: 'SMTP 用 Logto 公式コネクターです。',
      customProps: {
        icon: <Smtp />,
      }
    },
  ]}
/>
```

すでに独自のメールサービスをお持ちで、SMTP 接続が利用できない場合は、「HTTP メールコネクター」もご利用いただけます。

メール送信が必要な場合、設定した `endpoint` へ API コールを行い、メール依存の認証フローを完了します。認証フローのエラーを防ぐため、設定したエンドポイントは WebHook 受信後に 200 レスポンスを返し、Logto にメール送信通知を受け取ったことを知らせる必要があります。この場合、メールサービスの配信状況はご自身で監視してください。

```mdx-code-block
<DocCardList
  items={[
    {
      type: 'link',
      label: 'HTTP email connector',
      href: '/integrations/http-email',
      description: 'HTTP メール用 Logto 公式コネクターです。',
      customProps: {
        icon: <Http />,
      }
    },
  ]}
/>
```

標準コネクターで要件を満たせない場合は、[お問い合わせ](https://feedback.logto.io/roadmap) ください。OSS ユーザーの場合、要件が緊急の場合は [コネクターの実装 (OSS)](/logto-oss/develop-your-connector/implement-connectors#build-a-passwordless-connector) も可能です。[コントリビューション](/logto-oss/contribution) も常に歓迎しています。あなたの取り組みが、同じニーズを持つ他のコミュニティメンバーの助けになるかもしれません。

## 設定手順 \{#configure-steps}

以下の手順でメールコネクターを追加できます：

1. <CloudLink to="/connectors/passwordless">
     コンソール > コネクター > メール / SMS コネクター
   </CloudLink>
   に移動します。
2. 新しいメールコネクターを追加するには、「セットアップ」ボタンをクリックし、希望するメールプロバイダーを選択します。
3. README ドキュメントを確認し、選択したプロバイダーの手順に従って設定します。
4. 「保存して完了」をクリックして終了します。

:::note

重要なメール（認証コードなど）が確実にユーザーの受信箱に届き、迷惑メールフィルターを回避するためには、次の 2 点が重要です：

- **メール認証（SPF、DKIM、DMARC）の設定**
  メールプロバイダー（Gmail、Outlook など）は、これらのプロトコルを使ってスパム送信者でないことを確認します。設定がない場合、メールが迷惑メールに振り分けられたり拒否されたりします。
  - SPF（Sender Policy Framework）：自ドメインからメール送信を許可するサーバー / IP をリスト化します。
  - DKIM（DomainKeys Identified Mail）：メールが改ざんされていないことを証明するデジタル署名を付与します。
  - DMARC（Domain-based Message Authentication）：SPF / DKIM に失敗したメールの扱い方を受信側に指示します。
- **認証メールとマーケティングメールの分離**
  マーケティングメールはスパム報告や高いバウンス率を引き起こしやすく、同じドメイン / IP で認証メールを送ると配信率が下がります。
  - 専用ドメインの利用：認証メールは `@auth.yourdomain.com`、マーケティングは `@marketing.yourdomain.com` から送信します。
  - 専用 IP の利用：認証メール用にユニークな IP を取得し、徐々にウォームアップします。
  - 「From」アドレスの一致：送信者ドメインが SPF / DKIM / DMARC レコードと一致していることを確認します。

:::

## メールコネクターの変更 \{#change-email-connector}

追加できるメールコネクターは 1 つのみです。

すでにメールコネクターがある場合は、「メールコネクターの変更」のみ選択できます。この操作はコンソールで保存後すぐに反映されるため、保存前に必ず設定をテストしてください。

サービスの安定性を確保するため、Cloud ユーザーは [開発用テナント](/logto-cloud/tenant-settings#development) を作成し、開発環境で設定をテストした後、[本番環境](/logto-cloud/tenant-settings#production) へ「移行」してから設定を保存することをおすすめします。

## エンドユーザーフローでメールアドレスを有効化する \{#enable-email-address-for-end-user-flows}

メールコネクターを追加・設定した後、メール認証フローを有効化できます：

- [**サインアップ方法の設定**](/end-user-flows/sign-up-and-sign-in/sign-up)：<CloudLink to="/sign-in-experience/sign-up-and-sign-in">サインイン体験 > サインアップ / サインイン</CloudLink> に移動し、サインアップ欄で「メールアドレス」または「メールアドレスまたは電話番号」を識別子として追加します。※サインアップ時のメールアドレス認証は必須です。
- [**サインイン方法の設定**](/end-user-flows/sign-up-and-sign-in/sign-in)：サインイン欄で「メールアドレス」をサインイン方法として追加します。パスワードまたはメール認証コードによる認証を選択できます。「別の方法を追加」で追加オプションも設定可能です。
- [**パスワードを忘れた場合の設定**](/end-user-flows/sign-up-and-sign-in/reset-password)：サインイン欄でパスワードサインインが有効な場合、「パスワードを忘れた場合」設定が表示されます。「メール認証コード」を有効にすると、メール経由でパスワードリセットが可能です。
- [**MFA 用メール設定**](/end-user-flows/mfa/email-mfa)：<CloudLink to="/mfa">サインイン体験 > 多要素認証</CloudLink> に移動し、「メール認証コード」を第 2 要素として有効化できます。
- [**アカウント設定のメール利用**](/end-user-flows/account-settings/by-account-api#update-or-link-new-email)：[Account API](/end-user-flows/account-settings/by-account-api) を利用してアカウントセンターをカスタマイズし、ユーザーがメールアドレスを管理できるようにします。

:::warning
設定は即時反映されるため、既存のメールコネクターを削除するとエンドユーザーの通常のログインや登録に影響が出る場合があります。

たとえば、サインイン識別子に「メール + 認証コード」の組み合わせが含まれている場合、既存のメールコネクターを削除すると、ユーザーはメールで認証コードを受け取れなくなり、サインインフローでエラーが発生します。

コネクター操作時はリスクにご注意ください。
:::

## よくある質問 \{#faqs}

<details>
<summary>

### メール送信者名をカスタマイズするには？ \{#how-to-customize-the-email-sender-name}

</summary>

さらに多くのコネクターを開発中です。追加のオプションが必要な場合は、Discord でご要望をお知らせいただき、[GitHub](https://github.com/logto-io/logto/issues) でフィーチャーリクエストを提出してください。さらにサポートが必要な場合は、[メールでお問い合わせ](mailto:contact@logto.io) いただくことも可能です。

コントリビューター向けには、シナリオに応じて [独自コネクターのカスタマイズ](/logto-oss/develop-your-connector) ができる拡張しやすいコネクター作成方法を提供しています。Logto へのプルリクエストも歓迎していますので、コミュニティの他の方々にも役立つかもしれません。

</details>

<details>
<summary>

### Logto メールコネクターでメールリクエストの IP アドレスを制限するには？ \{#how-can-i-restrict-ip-addresses-for-email-requests-in-logto-email-connectors}

</summary>

一つの方法として、Logto HTTP メールコネクターを利用することが挙げられます。

サーバー側でメールサービスを呼び出す API エンドポイントを実装し、Logto の [HTTP メールコネクター](/integrations/http-email) を通じてこの API エンドポイントをトリガーします。これにより、API エンドポイントの IP アドレスを完全にコントロールでき、メールサービスプロバイダーの設定で該当 IP アドレスをホワイトリストに追加できます。

</details>
