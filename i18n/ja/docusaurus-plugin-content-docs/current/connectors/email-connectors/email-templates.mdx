---
id: email-templates
title: メールテンプレート
sidebar_label: メールテンプレート
sidebar_position: 3
---

Logto では、用途ごとに分類されたメール内容をカスタマイズするためのさまざまなテンプレートを提供しています。

異なるシナリオで異なるテンプレートを使用することを強く推奨します。そうしないと、ユーザーが現在の操作と一致しないメール内容を受け取り、混乱を招く可能性があります。また、未設定のテンプレートがある場合、そのテンプレートに依存するフローエラーが発生し、ビジネスの正常な進行に影響を与えることがあります。

## メールテンプレートのカスタマイズオプション \{#email-template-customization-options}

Logto では、メールテンプレート管理のために 3 つの異なるアプローチを提供しています：

1. **Logto 内でテンプレートをカスタマイズ**

   - **コネクター**:
     - [SMTP](/integrations/smtp)
     - [SendGrid](/integrations/sendgrid-email)
     - [Mailgun](/integrations/mailgun)
     - [AWS Direct Mail](/integrations/aws-ses)
     - [Aliyun Direct Mail](/integrations/aliyun-dm)
   - **機能**:
     - ✅ テンプレート内に多様な変数を柔軟に挿入可能
     - ✅ Management API を通じてカスタム多言語テンプレートを作成可能
     - ✅ Logto 内でテンプレートを完全編集可能

2. **プロバイダー側プラットフォームでテンプレートをカスタマイズ**

   - **コネクター**:
     - [Postmark](/integrations/postmark)
     - [HTTP Email](/integrations/http-email)
   - **機能**:
     - ✅ 変数をプロバイダープラットフォームへ渡すことが可能
     - ✅ `locale` パラメーターをプロバイダープラットフォームへ渡してローカライズ可能
     - ✅ プロバイダーのダッシュボードでテンプレートを完全編集可能（Logto Management API を利用）

3. **プリセットテンプレート（カスタマイズ不可）**

   - **コネクター**:
     - [Logto 組み込みメールサービス](/connectors/email-connectors/built-in-email-service)
   - **機能**:
     - ✅ ネイティブ変数サポート
     - ✅ 多言語テンプレート
     - ❌ テンプレート / UI の変更不可

## メールテンプレートの種類 \{#email-template-types}

| usageType                | シナリオ                                                                                                                                                                                                                                                                          | 変数                                                                                  |
| ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| SignIn                   | ユーザーが [メールでサインイン](/end-user-flows/sign-up-and-sign-in/sign-in) し、パスワードの代わりに認証コードを入力して認証します。                                                                                                                                             | code: string<br/>application: `ApplicationInfo`<br/>organization?: `OrganizationInfo` |
| Register                 | ユーザーが [メールでアカウントを作成](/end-user-flows/sign-up-and-sign-in/sign-up) し、Logto から送信された認証コードを入力して認証します。                                                                                                                                       | code: string<br/>application: `ApplicationInfo`<br/>organization?: `OrganizationInfo` |
| ForgotPassword           | ログイン時にパスワードを忘れた場合、まずメールで本人確認を行い [パスワードをリセット](/end-user-flows/sign-up-and-sign-in/reset-password) できます。                                                                                                                              | code: string<br/>application: `ApplicationInfo`<br/>organization?: `OrganizationInfo` |
| Generic                  | このテンプレートは、コネクター設定のテストや [サインイン後のメール認証やリンク](/end-user-flows/account-settings/by-management-api#email-and-phone-number-verification) など、さまざまなシナリオの汎用バックアップオプションとして利用できます。                                  | code: string                                                                          |
| OrganizationInvitation   | このテンプレートを使用して、ユーザーに [組織への招待リンク](/end-user-flows/organization-experience/invite-organization-members#configure-your-email-connector) を送信します。                                                                                                    | link: string<br/>organization: `OrganizationInfo`<br/>inviter?: `UserInfo`            |
| UserPermissionValidation | アプリ利用中に、銀行振込やリソース削除、会員解約など [追加のユーザー認証が必要な高リスク操作](/end-user-flows/account-settings/by-account-api#verify-by-sending-a-verification-code-to-the-users-email-or-phone) の際に、このテンプレートで認証コードメールの内容を定義できます。 | code: string<br/>user: `UserInfo`<br/>application?: `ApplicationInfo`                 |
| BindNewIdentifier        | ユーザーがプロフィールを変更する際に [現在のアカウントにメールアドレスを紐付ける](/end-user-flows/account-settings/by-account-api#update-or-link-new-email) 場合、このテンプレートで認証メールの内容をカスタマイズできます。                                                      | code: string<br/>user: `UserInfo`<br/>application?: `ApplicationInfo`                 |
| MfaVerification          | [メール MFA](/end-user-flows/mfa/email-mfa) が有効な場合、多要素認証プロセス中にユーザーへ認証コードを送信する際にこのテンプレートが使用されます。                                                                                                                                | code: string<br/>application: `ApplicationInfo`<br/>organization?: `OrganizationInfo` |
| BindMfa                  | [メール MFA](/end-user-flows/mfa/email-mfa) が有効な場合、MFA 用のメール認証コード設定時にこのテンプレートが使用されます。ユーザーがメールアドレスを MFA 要素として紐付ける際に認証コードを受け取ります。                                                                         | code: string<br/>user: `UserInfo`<br/>application?: `ApplicationInfo`                 |

## メールテンプレートの変数 \{#email-template-variables}

### Code \{#code}

ユーザーが認証プロセスを完了するために入力する必要がある認証コードです。`SignIn`、`Register`、`ForgotPassword`、`Generic`、`UserPermissionValidation`、`BindNewIdentifier` テンプレートで利用可能です。

- 認証コードの有効期限は 10 分です。現時点では認証コードの有効期限カスタマイズはサポートしていません。
- テンプレート内に `{{code}}` プレースホルダーを必ず残してください。認証コード送信時、このプレースホルダーがランダム生成コードで置き換えられます。

### ApplicationInfo \{#applicationinfo}

ユーザーが操作しているクライアントアプリケーションの公開情報です。`SignIn`、`Register`、`ForgotPassword`、`UserPermissionValidation`、`BindNewIdentifier` テンプレートで利用可能です。

```ts
type ApplicationInfo = {
  id: string;
  name: string;
  displayName?: string;
  branding?: {
    logoUrl?: string;
    darkLogoUrl?: string;
    favicon?: string;
    darkFavicon?: string;
  };
};
```

- ネストされたアプリケーション情報の各フィールドはドット記法でテンプレートから参照できます。例：`{{application.name}}` は設定されたアプリケーション名に置き換えられます。
- ルートの `application` 変数が提供されていない場合、handlebars プレースホルダーは無視され、置換されません。
- 提供された `application` オブジェクトに必要なフィールドが含まれていない、または値が undefined の場合、handlebars プレースホルダーは空文字列で置換されます。例：`{{application.foo.bar}}` は `` に置換されます。

### OrganizationInfo \{#organizationinfo}

ユーザーが操作している組織の公開情報です。

```ts
type OrganizationInfo = {
  id: string;
  name: string;
  branding?: {
    logoUrl?: string;
    darkLogoUrl?: string;
    favicon?: string;
    darkFavicon?: string;
  };
};
```

- `SignIn`、`Register`、`ForgotPassword` テンプレートでは `organization` 変数はオプションです。`organization_id` パラメーターが認可リクエストに含まれている場合のみ利用可能です。詳細は [組織固有のブランディング](/customization/match-your-brand#organization-specific-branding) を参照してください。
- `OrganizationInvitation` テンプレートでは `organization` 変数は必須です。

### UserInfo \{#userinfo}

メール送信先ユーザーの公開情報です。`UserPermissionValidation`、`BindNewIdentifier`、`OrganizationInvitation` テンプレートで利用可能です。

```ts
type UserInfo = {
  id: string;
  name?: string;
  username?: string;
  primaryEmail?: string;
  primaryPhone?: string;
  avatar?: string;
  profile?: Profile;
};
```

- `Profile` 型の詳細は [profile](/user-management/user-data#profile) を参照してください。
- `user` 変数は `UserPermissionValidation` および `BindNewIdentifier` テンプレートで必須です。
- `inviter` 変数は `OrganizationInvitation` テンプレートでオプションです。`inviterId` が組織招待リクエストで指定された場合のみ利用可能です。

### UI Locales \{#ui-locales}

現在のインタラクションを開始した OIDC 認証リクエストで提供された元の `ui_locales` 値です。

- 型: `string`（OIDC 仕様に準拠した BCP 47 言語タグのスペース区切りリスト）、例: `"fr-CA fr en"`
- 利用可能条件: 現在のサインインインタラクションが `ui_locales` 付きで開始された場合。未指定の場合、この変数は省略されます。
- 主な用途: メール本文や件名に含めて、ユーザーがリクエストした UI 言語を i18n サポートや監査目的で記録するなど。例：`Requested languages: {{uiLocales}}`

## メールテンプレート例 \{#email-template-examples}

以下のメールテンプレートコード例をカスタマイズの出発点として利用できます。次のような UI を作成したい場合：

<img
  src="/img/assets/built-in-email-template-sample.jpeg"
  alt="組み込みメールテンプレートのサンプル"
/>

Logto の各シナリオで使用されるメールテンプレートは非常に似ており、異なるのはシナリオや操作の説明だけです。

ここではすべてのテンプレートの HTML コードを詳細には掲載せず、**サインイン** シナリオのみ例示します。他のシナリオ（サインアップやパスワード忘れなど）も下記サンプルとほぼ同様です。

このテンプレートを参考に、実際の状況に合わせて調整してください。

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>サインイン用メール認証</title>
    <style>
      .auth-service-by:hover .mini-logo {
        display: none !important;
      }
      .auth-service-by:hover .mini-logo-color {
        display: block !important;
      }
      body {
        font-family:
          'SF Pro Text',
          -apple-system,
          system-ui,
          BlinkMacSystemFont,
          'Segoe UI',
          Roboto,
          Arial,
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-smooth: always;
        background-color: #fff;
        color: #191c1d;
        max-width: 640px;
        padding: 32px 0;
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
      }
      h1 {
        font-size: 24px;
        font-weight: 700;
        line-height: 32px;
        margin-top: 32px;
      }
      .verification-code {
        margin: 20px 0;
        background: #eff1f1;
        border-radius: 12px;
        padding: 36px;
        font-size: 32px;
        font-weight: 600;
        line-height: 40px;
      }
      .footer {
        text-align: center;
        color: #a9acac;
        margin-top: 48px;
      }
    </style>
  </head>
  <body>
    <div style="max-width: 698px; border-radius: 16px; border: 1px solid #E0E3E3;">
      <div style="padding: 0 24px;">
        <center>
          <img src="{{logoUrl}}" alt="Logo" width="auto" height="40" />
          <h1>サインイン用メール認証</h1>
          <p>
            以下のコードでサインインリクエストを受け付けました。開いているページでこのコードを入力し、サインインを完了してください。
          </p>
          <div class="verification-code">000000</div>
          <p style="color: #747778;">
            サインインを試みていない場合は、このメールを無視してください。コードの有効期限は 10
            分間です。
          </p>
          <hr style="margin: 64px 0 24px; max-width: 420px;" />
          <p style="color: #747778; margin: 16px 0 0;">{{companyInfo}}</p>
        </center>
      </div>
    </div>
    <div class="footer">
      <hr />
      <p style="font-size: 14px; line-height: 20px; margin: 20px 0;">
        <a href="https://logto.io" style="color: #A9ACAC; text-decoration: underline;">Logto</a>:
        開発者のためのより良いアイデンティティ基盤。
      </p>
      <table style="margin: 0 auto; width: auto; border-spacing: 0;">
        <tbody>
          <tr>
            <td style="vertical-align: middle;">
              <a href="{{discordServerUrl}}" style="display: block; margin: 0 12px;">
                <img src="{{discordLogoUrl}}" style="width: 20px;" />
              </a>
            </td>
            <td style="vertical-align: middle;">
              <a href="{{githubUrl}}" style="display: block; margin: 0 12px;">
                <img src="{{githubLogoUrl}}" style="width: 20px;" />
              </a>
            </td>
            <td style="vertical-align: middle;">
              <a href="{{twitterUrl}}" style="display: block; margin: 0 12px;">
                <img src="{{twitterLogoUrl}}" style="width: 20px;" />
              </a>
            </td>
            <td style="vertical-align: middle;">
              <a href="{{mailToUrl}}" style="display: block; margin: 0 12px;">
                <img src="{{emailIconUrl}}" style="width: 20px;" />
              </a>
            </td>
          </tr>
        </tbody>
      </table>
      <p style="font-size: 12px; line-height: 16px;">
        © Silverhand, Inc., 2810 North Church Street, Wilmington, DE 19802
      </p>
      <p style="color: #A9ACAC; font-size: 12px; line-height: 16px;">
        ご質問やサポートが必要な場合は
        <a href="{{mailToUrl}}" style="color: #A9ACAC; text-decoration: underline;">お問い合わせ</a>
      </p>
    </div>
  </body>
</html>
```

上記の HTML コードをエスケープし、コネクター設定の「Template」フィールドに次のように追加できます（SendGrid コネクター利用例）：

```json
{
  "subject": "<sign-in-template-subject>",
  "content": "<table cellpadding=\"0\" cellspacing=\"0\" ...",
  "usageType": "SignIn",
  "type": "text/html"
}
```

## メールテンプレートのローカライズ \{#email-template-localization}

### 言語ごとのカスタムメールテンプレート \{#custom-email-templates-for-different-languages}

Logto では Management API を通じて言語ごとのカスタムメールテンプレート作成をサポートしています。異なる言語やテンプレートタイプごとにカスタムメールテンプレートを作成し、ユーザーにローカライズされた体験を提供できます。

```ts
type EmailTemplate = {
  languageTag: string;
  templateType: TemplateType;
  details: {
    subject: string;
    content: string;
    contentType?: 'text/html' | 'text/plain';
    replyTo?: string;
    sendFrom?: string;
  };
};
```

| フィールド  | 説明                                                                                                                                                                         |
| ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| subject     | メールの件名テンプレート。                                                                                                                                                   |
| content     | メールの本文テンプレート。                                                                                                                                                   |
| contentType | 一部のメールプロバイダーは contentType によってテンプレートのレンダリング方法が異なります（例：Sendgrid、Mailgun）。このフィールドでメールテンプレートのタイプを指定します。 |
| replyTo     | メールの返信先アドレス。このフィールドがサポートされているかはメールプロバイダーにご確認ください。                                                                           |
| sendFrom    | メール送信者の表示名。このフィールドがサポートされているかはメールプロバイダーにご確認ください。                                                                             |

メールテンプレート作成後、Logto はまずユーザーの言語設定を解決し、最適なテンプレートを自動選択します。

言語設定の解決順序：

1. OIDC 認証リクエストに `ui_locales` が含まれている場合、Logto はテナントの言語ライブラリでサポートされている最初のタグを選択します。詳細は [ui_locales](/end-user-flows/authentication-parameters/ui-locales) を参照してください。
2. それ以外の場合、クライアントサイドの [体験 API](/end-user-flows/sign-up-and-sign-in) や [ユーザーアカウント API](/end-user-flows/account-settings/by-account-api) では `Accept-Language` ヘッダーを使用します。Management API（例：[組織招待](/end-user-flows/organization-experience/invite-organization-members)）では `messagePayload` の `locale` フィールドで指定できます。
3. どちらも指定されていない場合、Logto はサインイン体験で設定されたテナントのデフォルト言語を使用します。設定方法は [ローカライズ言語](/customization/localized-languages#customization-steps-in-logto-console) を参照してください。

テンプレート選択：

4. 解決された言語で、`languageTag` と `templateType` に一致するカスタムメールテンプレートを検索し、存在すればそれを使用します。
5. 一致するカスタムテンプレートがない場合、コネクター設定で定義されたデフォルトのメールテンプレートを使用します。

**対応メールコネクター**:

- [Aliyun Direct Mail](/integrations/aliyun-dm)
- [Amazon Direct Mail](/integrations/aws-ses)
- [Mailgun](/integrations/mailgun)
- [SendGrid](/integrations/sendgrid-email)
- [SMTP](/integrations/smtp)

### プロバイダー側メールテンプレートのローカライズ \{#provider-side-email-template-localization}

メールテンプレートがプロバイダー側で管理されているコネクターを利用する場合：

- [HTTP Email](/integrations/http-email)
- [Postmark](/integrations/postmark)

ユーザーの希望言語はテンプレートペイロードの `locale` パラメーターとしてプロバイダーに渡されます。プロバイダーのコンソールで複数言語用テンプレートを作成し、`locale` パラメーターで言語を指定できます。

:::note

認証リクエストに `ui_locales` が含まれている場合、テンプレートコンテキストで `locale` と `uiLocales` の両方の変数が利用可能です。
`uiLocales` 変数には認証リクエストの元の `ui_locales` 値が入り、`locale` 変数は `ui_locales` から解決された最初のサポートタグに基づきます。`ui_locales` が指定されていない場合、`locale` は標準の解決ルール（例：`Accept-Language`、次にデフォルト言語）に従います。

:::

## よくある質問 \{#faqs}

<details>
<summary>

### Logto でテンプレートを設定していない場合、サードパーティのメールテンプレートサービスを利用するには？ \{#how-to-use-third-party-email-template-services-if-templates-are-not-configured-in-logto}

</summary>

独自の Web サービスにメール送信用のエンドポイントを追加し、[Logto HTTP メールコネクター](/integrations/http-email) でそのエンドポイントを呼び出すことができます。

これにより、メールテンプレートのロジックを自分のサーバー側で管理できます。

</details>

<details>
<summary>

### Logto のメールでカスタマイズした「ウェルカムメール」をユーザーに送信する方法は？ \{#is-there-a-way-to-use-logto-email-for-sending-our-users-a-customized-welcome-email}

</summary>

[Webhook](/developers/webhooks) 機能を提供しています。Logto Webhook から送信される `User.Created` イベントを受信する独自の API エンドポイントを実装し、Webhook ハンドラー内でカスタムウェルカムメール送信ロジックを追加できます。

Logto のメールコネクターは認証フロー関連イベントの通知のみを提供します。ウェルカムメールはビジネス要件であり、メールコネクターでは標準サポートされていませんが、Webhook を通じて実現可能です。

</details>

## 関連リソース \{#related-resources}

<Url href="https://blog.logto.io/verification-email-delivery">
  認証メールの到達率を最大化し、ユーザーアクセスを保証する
</Url>
