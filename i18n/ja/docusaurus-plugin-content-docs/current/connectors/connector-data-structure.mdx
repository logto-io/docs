---
sidebar_position: 5
---

# コネクターデータ構造

## はじめに

### コネクターとは？

_コネクター_ は Logto において重要な役割を果たします。これにより、Logto はエンドユーザーがパスワードレス登録またはサインインを行い、ソーシャルアカウントでのサインイン機能を利用できるようにします。ウェブサイトやアプリケーションの人気が高まる中、パスワードレスおよびソーシャルサインインは、ユーザーが多数のアカウントやパスワードを管理する手間を省くことができます。

既存のコネクターを設定したい場合は、[コネクターガイド](/connectors) を参照してください。設定したいコネクターが見つからない場合は、[コネクターの開発](/logto-oss/develop-your-connector) のガイドに従ってコネクターを開発することができます。

## 構成

コネクターデータには多くのプロパティがあります。

データの読み込みと更新をより効率的にするために、頻繁に変更される部分のコネクターデータを DB に保存し、残りをローカルに保存します。

- _ローカルストレージ_、別名 [_ConnectorMetadata_](./#connectors-remote-storage-connector-db) は、ロゴやコネクタータイプなどの固定プロパティを含むオブジェクトです。 (:face_with_monocle: これらのプロパティを理解するのが難しいですか？心配ありません、詳細な説明が後であります！)
- _リモートストレージ_ は、これらのデータの比較的頻繁な変更のために DB に保存されます。

## コネクターのローカルストレージ: _ConnectorMetadata_

### id

_id_ は Logto 内でコネクターを識別するための _一意_ の文字列型キーです。

各コネクターの開発者によって割り当てられ、DB にアップロードされます。

### target (アイデンティティプロバイダー名)

_target_ は、ソーシャルコネクターのソーシャルアイデンティティのソースを区別するための小文字の文字列です。

Logto ユーザーは、この変数を「アイデンティティプロバイダー名」として理解することができます。

例えば、Google アカウントで Logto にサインインする場合、_target_ は _google_ であるべきです。_target_ の値は任意の非空文字列にすることができますが、一度設定すると変更できないため、簡潔に保つことをお勧めします。同じ _target_ とプラットフォームを持つ複数のコネクターの存在は許可されていません。一方で、異なるプラットフォームのソーシャルコネクターが同じ _target_ を共有することは可能です。例えば、ユーザーが電話で _WeChat_ を介してログインしたい場合、_WeChat_ の TOU に従ってネイティブ _WeChat_ アプリが必要です。同時に、ウェブアプリケーションにログインするためにウェブ _WeChat_ アプリも必要です。これらの 2 つの _WeChat_ アプリは同じアイデンティティプロバイダーを共有し、同じターゲットを持つべきです。

_target_ は複雑な概念であるため、異なるユースケースとユーザーへの提案をまとめました。

|                              | 例                                                                                                 | シナリオ                                                                                                                   | 結果                                                                                                                                                                    | 推奨                                                                                                                                                                                                              |
| ---------------------------- | -------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 異なる IdP と異なる _target_ | 1. GitHub コネクター (target: `github`) <br /> 2. Google コネクター (target: `google`)             | GitHub と Google アカウントの両方でログインをサポートするアプリ。                                                          | 最も一般的なユースケース。                                                                                                                                              | ✅                                                                                                                                                                                                                |
| 異なる IdP と同じ _target_   | 1. GitHub コネクター (target: `github`) <br /> 2. Google コネクター (target: `github`)             | 該当なし                                                                                                                   | 別のユーザーの GitHub アカウントを使用して作成された Logto アカウントにサインインすることが可能です。                                                                   | ❌                                                                                                                                                                                                                |
| 同じ IdP と異なる _target_   | 1. GitHub コネクター (target: `github`) <br /> 2. OAuth GitHub コネクター (target: `github_oauth`) | GitHub コネクターはアプリケーション A 用に使用され、OAuth GitHub コネクターはアプリケーション B 用に特別に作成されました。 | これらの 2 つの異なるコネクターを使用して Logto にサインインすると、ユーザーが同じ GitHub アカウントを使用している場合でも、常に別々の Logto アカウントが作成されます。 | ユーザープールを分割することが唯一のシナリオであり、この場合には両方のコネクターを使用する必要があります。ただし、このユースケースを処理するために 2 つの別々のテナントを作成することが最善の方法とされています。 |
| 同じ IdP と同じ _target_     | 1. GitHub コネクター (target: `github`) <br /> 2. OAuth GitHub コネクター (target: `github`)       | 該当なし                                                                                                                   | これらの 2 つのコネクターのいずれかを使用すると、まったく同じ結果が得られる可能性があります。                                                                           | 本質的に同じことを行う 2 つのコネクターを作成することは、エンドユーザーにとって混乱を招く可能性があり、あまり意味がありません。特定のユースケースに適した 1 つのコネクターを使用する方が良いです。                |

### type

_type_ はコネクターのタイプを記録するプロパティです。

その機能に基づいて、コネクターを 3 つの異なるタイプに分類します：

- _Social_：エンドユーザーの認可 (Authorization) により、任意のサードパーティのソーシャルメディアからユーザー情報にアクセスできるコネクター。
- _SMS_：エンドユーザーが携帯電話でテキストメッセージを受信できるようにするコネクター。
- _Email_：エンドユーザーにメールを送信するのを助けるコネクター。

### platform

_platform_ は、コネクターがどのプラットフォーム用に構築されているかを識別するために使用されます。

_platform_ は `null` または次の文字列型の値のいずれかである必要があります：

- _Native_：ネイティブモバイルアプリでのみ動作するコネクター。
- _Web_：デスクトップウェブアプリケーションでのみ動作するコネクター。
- _Universal_：モバイルウェブアプリとデスクトップウェブアプリの両方で動作するコネクター。

:::note
_email コネクター_ と _SMS コネクター_ の _platform_ は常に `null` であるべきです。<br/>
非 NULL の _platform_ 値を持つことができるのは _social コネクター_ のみです。
:::

### name

_name_ は、キーが i18n 国コードで、値がコネクターの表示名であるオブジェクトです。

### description

_description_ も、キーが i18n 国コードで、値がコネクターの簡単な説明であるオブジェクトです。

:::note
クライアント側での i18n 表示をサポートするために、_name_（および _description_）プロパティをマップとして保存し、国コードをキーとして使用し、ローカル文字での名前（または説明）を値として使用します。
:::

### logo

_logo_ はコネクターのロゴの URL または相対パスです。

### logoDark

_logoDark_ はコネクターのダークモードロゴの _nullable_ な URL または相対パスです。

:::note
_logo_ は常に必要であり、_logoDark_ はオプションです。

_light モードでは \_logo_ を表示し、_dark モードでは \_logoDark_ を表示します。存在しない場合は、_dark モードで \_logo_ を表示します。
:::

### isStandard

_isStandard_ は、ソーシャルコネクターが「標準」コネクターであるかどうかを識別するためのオプションのブール属性です。`isStandard` 属性が真であることで「標準」コネクターを識別できます。

:::note
Logto は「標準」ソーシャルコネクターのみをサポートしています。つまり、Logto のすべての Email または SMS コネクターは「標準」ではありません。

Logto は、オープンで標準的なプロトコル（例：OAuth、OIDC、SAML など）に基づいて構築されたコネクターを「標準」コネクターと呼びます。Logto のユーザーは、このコンテキストに基づいて各標準コネクターに複数のインスタンスを構築することが期待されています。例えば、Logto がすでに OAuth 標準コネクターを提供している場合、ユーザーは「OAuth GitHub コネクター」、「OAuth Google コネクター」、「OAuth Facebook コネクター」インスタンスを構築できます。これらはすべて Logto OAuth 標準コネクターに基づいています。

Logto のコネクターデザインに精通している場合、同時に存在できる Email または SMS コネクターは最大で 1 つであるため、Logto は現在の段階で「標準」Email または SMS コネクターを必要としません。
:::

### readme

_readme_ は、コネクターの README マークダウンファイルの相対パスであり、そのコンテキストはコネクターのセットアップ中に「管理コンソール」に表示されます。

### configTemplate

_configTemplate_ は、コネクターの設定例の相対パスです。

## コネクターのリモートストレージ: _Connector DB_

### id

_id_ は、コネクター DB の主キーとして機能し、DB 内でコネクターを識別するためのランダムに生成された文字列型キーです。

### connectorId

_connectorId_ は文字列型キーであり、_Connector DB_ と _ConnectorMetadata_ を一致させる唯一の橋渡しです。各一致するコネクター DB データとコネクターコードモジュールのペアに対して、_connectorId_ は常にコードモジュールの [metadata._id_](#id) と等しいです。

### metadata

_metadata_ は、構成可能な属性を含む [ConnectorMetadata](#connectors-local-storage-connectormetadata) のサブセットであり、すなわち [_logo_](#logo)、[_logoDark_](#logodark)、[_target_](#target)、[_name_](#name) です。

### syncProfile

_syncProfile_ は、ユーザープロファイルの更新スキームを決定するブール値で、デフォルトは FALSE です。

_syncProfile_ が FALSE の場合、Logto ユーザーの基本情報（名前やアバターを含む）は、このコネクターを介して初めて Logto にサインアップしたときにのみ更新されます。それ以外の場合、ユーザーがコネクターを介して Logto にサインインするたびに、Logto アカウントプロファイルが更新されます。

### config

_config_ は任意の非空オブジェクトです。

これはコネクターがその設定を保存する場所です。各コネクターは _config_ に異なるプロパティを持ち、DB に保存される前に有効であることが義務付けられています（コネクターには「有効」のための異なる基準があります）。有効性チェックを通過した _config_ のみが DB に更新されることができ、そうでなければエラーがスローされます。

独自のコネクターを開発する際には、_config_ ガードを実装する必要があります。詳細については、[コネクターの開発](/logto-oss/develop-your-connector) を参照してください。

_config_ サンプルを見たいですか？[コネクター](/connectors) または各コネクターの設定ページに移動してください。

:::note
現在の Logto バージョンでは、同時に存在できる _Email/SMS_ コネクターは 1 つだけであり、同じタイプの他のすべてのコネクターは自動的に削除されます。

このルール、つまり唯一の動作する Email または SMS コネクターは、_Social_ コネクターには適用されません。<br/>
言い換えれば、複数の _Social_ コネクターを追加することができます。
:::

### createdAt

_createdAt_ は、DB にコネクターが作成された時刻を追跡するために自動生成されるタイムスタンプ文字列です。
