## Aliyun SMS コンソールでショートメッセージサービスを設定する \{#set-up-a-short-message-service-in-aliyun-sms-console}

### Aliyun アカウントを作成する \{#create-an-aliyun-account}

[Aliyun のウェブサイト](https://cn.aliyun.com/) にアクセスし、まだアカウントをお持ちでない場合は登録してください。

### Aliyun ショートメッセージサービスを有効化・設定する \{#enable-and-configure-aliyun-short-message-service}

1. [Aliyun のウェブサイト](https://cn.aliyun.com/) で Aliyun アカウントにサインインし、[SMS サービスコンソールページ](https://www.aliyun.com/product/sms) にアクセスします。
2. SMS サービスページ左上の「無料開通 (Open for free)」ボタンをクリックし、設定プロセスを開始します。
3. 「短信サービス開通条款 (SMS service activation Agreement)」を読み、同意した上で「开通服务 (Subscribe to a service)」をクリックして次へ進みます。
4. [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) に移動したら、用途に応じてサイドバーの「国内消息 (Mainland China)」または「国际/港澳台消息 (Outside Mainland China)」ボタンを選択します。
5. ガイドラインに従ってシグネチャとテンプレートを追加し、審査に必要な資料や情報を提出します。
   - シグネチャ申請時の「适用场景 (Scenario)」には「验证码 (Verification Code Message)」を、テンプレート申請時の「模板类型 (Type)」にも「验证码 (Verification Code Message)」を選択してください。これは認証コード送信用のシグネチャとテンプレートを利用するためです。現時点では認証コード関連以外の SMS メッセージ送信はサポートしていません。
   - テンプレート本文で認証コードを挿入したい箇所には `{{code}}` をプレースホルダーとして使用してください。
6. SMS シグネチャとテンプレートの申請を提出したら、反映されるまでしばらく待つ必要があります。この時点で [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) に戻り、テスト SMS を送信できます。シグネチャとテンプレートが利用可能であれば直接試せますし、まだ反映されていない場合は Aliyun のテスト用テンプレートも利用できます。
   - テストメッセージ送信前に少額のチャージが必要な場合があります。
   - テストメッセージ送信前にテスト用電話番号の登録を求められる場合もあります。詳細は [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) サイドバーの「快速学习 (Quick Start)」タブをご覧ください。

## コネクター JSON を作成する \{#compose-the-connector-json}

1. [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) で右上のアバターにカーソルを合わせ、「AccessKey 管理 (AccessKey Management)」に進み、「创建 AccessKey (Create AccessKey)」をクリックします。セキュリティ認証後、「AccessKey ID」と「AccessKey Secret」のペアが発行されますので、大切に保管してください。
2. 先ほどアクセスした「国内消息 (Mainland China)」または「国际/港澳台消息 (Outside Mainland China)」タブで、「签名名称 (Signature)」と「模板 CODE (Template Code)」を確認できます。
   - テスト専用のシグネチャとテンプレートを利用したい場合は、「快速学习 (Quick Start)」タブに進み、「Signature & Templates (For Test Only)」の下に表示されます。
3. Aliyun SMS コネクターの設定を入力します：
   - `accessKeyId` と `accessKeySecret` フィールドには、手順 1 で取得したアクセスキーのペアを入力します。
   - `signName` フィールドには、手順 2 で確認した「签名名称 (Signature)」を入力します。すべてのテンプレートでこのシグネチャ名を共有します。
   - 用途ごとに複数の SMS コネクターテンプレートを追加できます。単一テンプレートを追加する例は以下の通りです：
     - `templateCode` フィールドには、手順 2 で取得した「模板 CODE (Template Code)」を入力します。これが SMS の内容を制御します。
     - `usageType` フィールドには、用途に応じて `Register`、`SignIn`、`ForgotPassword`、`Generic` のいずれかを入力します。（`usageType` は Logto 独自のプロパティで、用途を識別します。）すべてのユーザーフローを有効にするには、`Register`、`SignIn`、`ForgotPassword`、`Generic` の usageType を持つテンプレートが必要です。

### Aliyun SMS コネクターのテスト \{#test-aliyun-sms-connector}

電話番号を入力し「送信 (Send)」をクリックすることで、「保存して完了 (Save and Done)」前に設定が機能するか確認できます。

以上です。<MainSiteUrl href="/connectors/sms-connectors/#enable-phone-number-sign-up-or-sign-in">サインイン体験でコネクターを有効化</MainSiteUrl> するのをお忘れなく。

### 設定タイプ \{#config-types}

| 名前            | 型         |
| --------------- | ---------- |
| accessKeyId     | string     |
| accessKeySecret | string     |
| signName        | string     |
| templates       | Template[] |

| テンプレートプロパティ | 型          | 列挙値                                               |
| ---------------------- | ----------- | ---------------------------------------------------- |
| templateCode           | string      | N/A                                                  |
| usageType              | enum string | 'Register' / 'SignIn' / 'ForgotPassword' / 'Generic' |
