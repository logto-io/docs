---
slug: /integrations/aliyun-sms
sidebar_label: Aliyun ショートメッセージ
sidebar_custom_props:
  description: Aliyun はオンラインビジネス向けにクラウドコンピューティングサービスを提供しています。
  logoFilename: 'aliyun.svg'
---

import GuideTip from '../../fragments/_guide-tip.mdx';

# Aliyun Short Message Service を使用して SMS 認証を設定する

Aliyun ショートメッセージサービス用の公式 Logto コネクターです。

<GuideTip />

## はじめに \{#get-started}

Aliyun はアジアの主要なクラウドサービスプロバイダーであり、SMS（ショートメッセージサービス）を含む多くのクラウドサービスを提供しています。Aliyun SMS コネクターは、Logto チームが提供するプラグインで、Aliyun SMS サービスを呼び出すことができます。これにより、Logto のエンドユーザーは SMS 認証コードを使って Logto アカウントの登録やサインインが可能になります。

## Aliyun SMS コンソールでショートメッセージサービスを設定する \{#set-up-a-short-message-service-in-aliyun-sms-console}

### Aliyun アカウントを作成する \{#create-an-aliyun-account}

[Aliyun のウェブサイト](https://cn.aliyun.com/) にアクセスし、まだアカウントをお持ちでない場合は登録してください。

### Aliyun ショートメッセージサービスを有効化・設定する \{#enable-and-configure-aliyun-short-message-service}

1. [Aliyun のウェブサイト](https://cn.aliyun.com/) で Aliyun アカウントにサインインし、[SMS サービスコンソールページ](https://www.aliyun.com/product/sms) にアクセスします。
2. SMS サービスページ左上の「無料開通」ボタンをクリックして設定を開始します。
3. 「短信サービス開通条款」を読み同意し、「開通サービス」をクリックして次に進みます。
4. [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) に移動したら、利用ケースに応じてサイドバーの「国内消息」または「国际/港澳台消息」ボタンを選択します。
5. ガイドラインに従ってシグネチャとテンプレートを追加し、審査に必要な資料や情報を提出します。
   - シグネチャ申請時の「適用場景」には「验证码（認証コードメッセージ）」を、テンプレート審査申請時の「模板类型」にも「验证码（認証コードメッセージ）」を選択してください。これは認証コード送信用のシグネチャとテンプレートを利用するためです。現時点では認証コード関連以外の SMS メッセージ送信はサポートしていません。
   - テンプレート内容で認証コードを挿入したい箇所には `{{code}}` をプレースホルダーとして使用してください。
6. SMS シグネチャとテンプレート申請を提出した後、反映されるまでしばらく待つ必要があります。この時点で [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) に戻り、テスト SMS を送信できます。シグネチャとテンプレートが利用可能であれば直接試せます。まだ反映されていない場合は、Aliyun がテスト用テンプレートも提供しています。
   - テストメッセージ送信前に少額のチャージが必要な場合があります。
   - テストメッセージ送信前にテスト用電話番号の登録が求められる場合もあります。詳細は [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) のサイドバー「快速学习」タブをご覧ください。

## コネクター JSON の作成 \{#compose-the-connector-json}

1. [SMS サービスコンソールページ](https://dysms.console.aliyun.com/overview) で右上のアバターにカーソルを合わせ、「AccessKey 管理」に進み、「AccessKey 作成」をクリックします。セキュリティ認証後、「AccessKey ID」と「AccessKey Secret」のペアが発行されます。大切に保管してください。
2. 先ほどアクセスした「国内消息」または「国际/港澳台消息」タブで「签名名称（シグネチャ名）」と「模板 CODE（テンプレートコード）」を確認できます。
   - テスト専用のシグネチャとテンプレートを利用したい場合は、「快速学习」タブに移動し、「Signature & Templates (For Test Only)」の下に表示されます。
3. Aliyun SMS コネクターの設定を入力します：
   - `accessKeyId` と `accessKeySecret` フィールドには手順 1 で取得したアクセスキーを入力します。
   - `signName` フィールドには手順 2 で確認した「签名名称（シグネチャ名）」を入力します。すべてのテンプレートでこのシグネチャ名を共有します。
   - 異なる用途ごとに複数の SMS コネクターテンプレートを追加できます。単一テンプレート追加例は以下の通りです：
     - `templateCode` フィールドには手順 2 で取得した「模板 CODE（テンプレートコード）」を入力します。これが SMS の内容を制御します。
     - `usageType` フィールドには、用途に応じて `Register`、`SignIn`、`ForgotPassword`、`Generic` のいずれかを入力します。（`usageType` は Logto 独自のプロパティで用途を識別します。）すべてのユーザーフローを有効にするには、`Register`、`SignIn`、`ForgotPassword`、`Generic` の usageType を持つテンプレートが必要です。
4. 「厳格な電話番号地域コードチェック」の設定：
   - 海外（中国本土以外、例：米国、香港など）への SMS 送信が必要な場合は有効化してください。有効化すると、すべての電話番号に有効な地域コード（例：+1、+852）が含まれているとみなされ、中国本土かどうかを判定します。
   - **注意**：既存ユーザーの電話番号に地域コードが含まれていない場合、有効化するとサインインプロセスに影響する可能性があります。海外 SMS 配信が必要な場合のみ有効化してください。

### Aliyun SMS コネクターのテスト \{#test-aliyun-sms-connector}

電話番号を入力し「送信」をクリックすることで、「保存して完了」前に設定が機能するか確認できます。

以上です。<MainSiteUrl href="/connectors/sms-connectors/#enable-phone-number-sign-up-or-sign-in">サインイン体験でコネクターを有効化</MainSiteUrl> するのをお忘れなく。

### 設定タイプ \{#config-types}

| 名前            | 型         |
| --------------- | ---------- |
| accessKeyId     | string     |
| accessKeySecret | string     |
| signName        | string     |
| templates       | Template[] |

| テンプレートプロパティ | 型          | 列挙値                                               |
| ---------------------- | ----------- | ---------------------------------------------------- |
| templateCode           | string      | N/A                                                  |
| usageType              | enum string | 'Register' / 'SignIn' / 'ForgotPassword' / 'Generic' |

## 参考情報 \{#references}

<Url href="https://dysms.console.aliyun.com/quickstart">Aliyun SMS - クイックスタート</Url>
