スコープ (Scopes) は、アプリがユーザーから要求する権限 (Permissions) を定義し、アプリが Microsoft Entra ID アカウントからアクセスできるデータを制御します。Microsoft Graph の権限 (Permissions) を要求するには、両方の側で設定が必要です：

**Microsoft Entra 管理センターで：**

1. **Microsoft Entra ID > アプリ登録** に移動し、アプリケーションを選択します。
2. **API 権限 > 権限の追加 > Microsoft Graph > 委任された権限** に進みます。
3. アプリに必要な権限 (Permissions) のみを選択します：
   - OpenID 権限 (Permissions)：
     - `openid`（必須）- ユーザーのサインイン
     - `profile`（必須）- ユーザーの基本プロフィールの表示
     - `email`（必須）- ユーザーのメールアドレスの表示
     - `offline_access`（オプション）- Logto コネクターで [Microsoft API への永続的なアクセス用のトークン保存](#step-4-store-tokens-to-access-microsoft-apis-optional) を有効にし、Microsoft Graph API への長期間アクセスのためにリフレッシュ トークン (Refresh token) を取得する必要がある場合のみ必要です。
   - API アクセス（オプション）：アプリに必要な追加の権限 (Permissions) を追加します。一般的な Microsoft Graph 権限 (Permissions) には `Mail.Read`、`Calendars.Read`、`Files.Read` などがあります。利用可能な権限 (Permissions) については [Microsoft Graph permissions reference](https://docs.microsoft.com/en-us/graph/permissions-reference) を参照してください。
4. **権限の追加** をクリックして選択を確定します。
5. アプリが特定の権限 (Permissions) に管理者の同意が必要な場合は、**[組織名] のために管理者の同意を付与** をクリックします。

<center>
  <img src="/img/assets/entra_id_oidc_add_api_permissions.webp" alt="Microsoft API 権限の追加" />
</center>

**Logto Microsoft Entra ID コネクターで：**

1. Logto は、基本的なユーザーアイデンティティ情報を取得するために `openid`、`profile`、`email` スコープ (Scopes) を自動的に含めます。基本的なユーザー情報のみが必要な場合は、`Scopes` フィールドを空白のままにできます。
2. Microsoft API への永続的なアクセス用にトークンを保存する場合は、`Scopes` フィールドに `offline_access` を追加します。このスコープ (Scope) により、長期間の API アクセス用のリフレッシュ トークン (Refresh token) が有効になります。
3. Microsoft Graph からさらに多くのデータを要求する場合は、`Scopes` フィールドに追加のスコープ (Scopes)（スペース区切り）を追加します。標準のスコープ名を使用してください。例：`User.Read Mail.Read Calendars.Read`

:::tip

アプリがこれらのスコープ (Scopes) を要求して Microsoft Graph API へアクセスし操作を行う場合は、Logto Microsoft Entra ID コネクターで **Microsoft API への永続的なアクセス用のトークン保存** を有効にしてください。詳細は次のセクションを参照してください。

:::
