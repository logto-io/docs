## Alipay 開発者アカウントの登録 \{#register-alipay-developer-account}

[Alipay 開発者アカウントを登録](https://certifyweb.alipay.com/certify/reg/guide#/) してください（まだお持ちでない場合）。

## Alipay アプリの作成と設定 \{#create-and-configure-alipay-app}

1. [Alipay コンソール](https://open.alipay.com/) に、先ほど登録したアカウントでサインインします。
2. 「マイアプリケーション」(我的应用) パネルの「Web & Mobile Apps」(网页&移动应用) タブに移動します。
3. 「アプリを作成」(立即创建) ボタンをクリックして、アプリケーションの設定を開始します。
4. 「アプリケーション名」(应用名称) に命名規則に従って名前を入力し、「アプリケーションアイコン」(应用图标) をアップロードします。「アプリタイプ」(应用类型) には必ず「Web アプリケーション」(网页应用) を選択してください。
5. アプリケーションの作成が完了したら、概要ページに移動します。ここで「機能を追加」(添加能力) をクリックし、「サードパーティアプリ認可」(第三方应用授权)、「会員情報の取得」(获取会员信息)、「App Alipay ログイン」(App 支付宝登录) を追加してから、Alipay サインインを有効にします。
6. [Alipay カスタマーセンター](https://b.alipay.com/index2.htm) にアクセスし、Alipay 開発者アカウントでサインインします。トップバーの「アカウントセンター」(账号中心) をクリックし、サイドバー下部にある「APPID バインディング」(APPID 绑定) に進みます。手順 4 で作成した Web アプリケーションの APPID を入力して「バインディングを追加」(添加绑定) します。
7. 「App Alipay ログイン」の「署名」ボタンをクリックし、ガイドに従って署名プロセスを完了します。この手順が完了すると、手順 5 で追加した機能が有効になります。
8. Alipay オープンプラットフォームのコンソールページに戻り、「開発情報」(开发信息) セクションの「インターフェース署名方式（キー/証明書）」(接口加签方式（密钥/证书）) を見つけます。「設定」(设置) ボタンをクリックすると、署名方式の設定ページに移動します。「公開鍵」(公钥) が推奨される署名モードであり、生成した公開鍵ファイルの内容をテキスト入力欄に入力します。
9. Alipay コンソールページ下部の「設定」(设置) ボタンをクリックして「認可リダイレクト URI」(授权回调地址) を設定します。`${your_logto_origin}/callback/${connector_id}` は Logto コアで使用されるデフォルトのリダイレクト URI です。`connector_id` は Logto 管理コンソールのコネクター詳細ページのトップバーで確認できます。
10. すべての手順が完了したら、Alipay コンソールページ右上の「審査を提出」(提交审核) をクリックします。審査が承認されると、スムーズな Alipay サインインフローが利用可能になります。

:::note
ローカルマシンで _openssl_ を使ってキーペアを生成するには、以下のコードスニペットをターミナルで実行してください。

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Alipay アプリの設定サイトで公開鍵を入力する際は、`public.pem` のヘッダーとフッターを削除し、改行をすべて削除して、残りの内容を「公開鍵」入力欄に貼り付けてください。

:::

## Logto Alipay Web コネクター設定のセットアップ \{#set-up-the-logto-alipay-web-connector-settings}

1. [Alipay コンソールワークスペース](https://open.alipay.com/dev/workspace) の「マイアプリケーション」(我的应用) パネルで「Web & Mobile Apps」(网页&移动应用) タブをクリックすると、すべてのアプリケーションの APPID を確認できます。
2. 前述の手順 7 で、秘密鍵と公開鍵を含むキーペアをすでに生成しています。
3. Logto コネクター設定を入力します：
   - `appId` フィールドには、手順 1 で取得した APPID を入力します。
   - `privateKey` フィールドには、手順 2 で生成した秘密鍵ファイルの内容を入力します。必ずすべての改行を '\n' に置き換え、秘密鍵ファイルのヘッダーとフッターは削除しないでください。
   - `signType` フィールドには、手順 7 の「Create And Configure Alipay Apps」で選択した「公開鍵」署名モードにより 'RSA2' を入力します。
   - `charset` フィールドには 'gbk' または 'utf8' を入力します。このフィールドは省略可能で、デフォルト値は 'utf8' です。
   - `scope` フィールドには 'auth_base' または 'auth_user' を入力します。このフィールドも省略可能で、デフォルト値は 'auth_user' です。異なる値の [違い](https://opendocs.alipay.com/fw/api/105942) を確認できます。

### 設定タイプ \{#config-types}

| Name       | Type                   | Enum values                |
| ---------- | ---------------------- | -------------------------- |
| appId      | string                 | N/A                        |
| privateKey | string                 | N/A                        |
| signType   | enum string            | 'RSA' / 'RSA2'             |
| charset    | enum string (OPTIONAL) | 'gbk' / 'utf8' / undefined |
| scope      | enum string (OPTIONAL) | 'auth_user' / 'auth_base'  |
