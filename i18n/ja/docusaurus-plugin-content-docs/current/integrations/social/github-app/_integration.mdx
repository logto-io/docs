## ステップ 1: GitHub App を作成する \{#step-1-create-a-github-app}

GitHub を認証 (Authentication) プロバイダーとして利用する前に、GitHub 上で GitHub App を作成し、OAuth 2.0 資格情報を取得する必要があります。

1. [GitHub](https://github.com/) にアクセスし、アカウントでサインインします。必要に応じて新しいアカウントを作成してください。
2. [Settings > Developer settings > GitHub Apps](https://github.com/settings/apps) に移動します。
3. **New GitHub App** をクリックして新しいアプリケーションを登録します：
   - **GitHub App name**：アプリの一意な名前を入力します。名前は 34 文字以内で、GitHub 全体で一意である必要があります。
   - **Homepage URL**：アプリケーションのホームページ URL を入力します。
   - **Callback URL**：Logto の GitHub コネクターから **Callback URI** をコピーし、ここに貼り付けます。必要に応じて複数のコールバック URL を追加できます。ユーザーが GitHub でサインインした後、ここに認可コード付きでリダイレクトされ、Logto が認証 (Authentication) を完了します。
   - **Expire user authorization tokens**：この項目は **チェックしたまま**（推奨）にします。これにより、トークンの有効期限とリフレッシュ トークンが有効になり、セキュリティが強化されます。
   - **Request user authorization (OAuth) during installation**：インストール時にユーザーにアプリの認可を求めたい場合は、オプションでチェックします。
   - **Webhook**：Webhook イベントが不要な場合は **Active** のチェックを外します。認証 (Authentication) のみの用途では通常 Webhook は不要です。
4. **Permissions** でアプリに必要な権限を設定します（詳細は下記ステップ 2 を参照）。
5. **Where can this GitHub App be installed?** では、どの GitHub アカウントのユーザーでも認証 (Authentication) に利用できるようにしたい場合は **Any account** を選択します。
6. **Create GitHub App** をクリックして GitHub App を作成します。

:::note
OAuth Apps とは異なり、GitHub Apps は広範なスコープではなく細かな権限で管理されます。アプリ作成時に GitHub ダッシュボードで権限を設定し、ユーザーは認可 (Authorization) 時に特定のリポジトリへのアクセスを許可します。

GitHub Apps のセットアップ詳細については [Registering a GitHub App](https://docs.github.com/en/apps/creating-github-apps/registering-a-github-app/registering-a-github-app) を参照してください。
:::

## ステップ 2: GitHub で権限を設定する \{#step-2-configure-permissions-in-github}

GitHub Apps は OAuth スコープの代わりに細かな権限で管理されます。GitHub App の作成または編集時に **GitHub ダッシュボードで権限を設定** する必要があります。これらの権限によってアプリがアクセスできるデータが決まります。

### GitHub App の権限の理解 \{#understanding-github-app-permissions}

権限は 3 種類に分類されます：

- **リポジトリ権限**：リポジトリレベルのリソース（コード、課題、プルリクエストなど）へのアクセス
- **組織権限**：組織レベルのリソース（メンバー、チーム、プロジェクトなど）へのアクセス
- **アカウント権限**：ユーザーアカウントデータ（メール、プロフィール、フォロワーなど）へのアクセス

各権限ごとに次のいずれかを選択できます：

- **No access**：このリソースにアクセスできません
- **Read-only**：このリソースを読み取りのみ可能
- **Read & write**：このリソースの読み取りと変更が可能

### 認証 (Authentication) 用の推奨権限 \{#recommended-permissions-for-authentication}

基本的な「GitHub でサインイン」機能には、最低限次の **アカウント権限** を設定してください：

| 権限                | アクセスレベル | 目的                                                 |
| ------------------- | -------------- | ---------------------------------------------------- |
| **Email addresses** | Read-only      | アカウント作成のためにユーザーのメールアドレスを取得 |

:::tip
GitHub Apps は、ユーザーの代理で動作する場合、公開プロフィール情報の読み取り権限を暗黙的に持っています。ユーザー名、アバター、公開プロフィール URL などの基本的なプロフィールデータについては明示的な権限リクエストは不要です。
:::

### API アクセス用の追加権限 \{#additional-permissions-for-api-access}

認証 (Authentication) 以外で GitHub API へのアクセスが必要な場合は、GitHub ダッシュボードで該当する権限を追加してください。よくある例は以下の通りです：

| 権限タイプ     | 権限          | アクセスレベル           | ユースケース                                           |
| -------------- | ------------- | ------------------------ | ------------------------------------------------------ |
| **リポジトリ** | Contents      | Read-only / Read & write | リポジトリのファイルやコードへのアクセス               |
| **リポジトリ** | Issues        | Read & write             | 課題の作成と管理                                       |
| **リポジトリ** | Pull requests | Read & write             | プルリクエストの作成と管理                             |
| **リポジトリ** | Metadata      | Read-only                | リポジトリのメタデータへのアクセス（多くの操作で必須） |
| **組織**       | Members       | Read-only                | 組織メンバーの一覧取得                                 |
| **アカウント** | Followers     | Read-only                | ユーザーのフォロワーやフォロー中ユーザーへのアクセス   |

これは一部の例であり、GitHub Apps ではさらに多くの細かな権限がサポートされています。完全な一覧は [Permissions required for GitHub Apps](https://docs.github.com/en/rest/overview/permissions-required-for-github-apps) を参照してください。

:::tip[OAuth Apps との主な違い]
OAuth Apps では Logto コネクターでスコープを設定しますが、GitHub App の権限はすべて GitHub ダッシュボードで管理します。Logto の GitHub コネクターの `Scope` フィールドは空のままで構いません — GitHub Apps では従来の OAuth スコープは使用しません。

必要な権限を GitHub 側で設定し、ユーザーは認可 (Authorization) 時にアクセス許可を求められます。
:::

## ステップ 3: Logto コネクターを設定する \{#step-3-configure-your-logto-connector}

GitHub App を作成したら、その設定ページにリダイレクトされ、資格情報を取得できます。

1. GitHub App の設定ページで **Client ID** をコピーし、Logto の `clientId` フィールドに貼り付けます。
2. **Client secrets** で **Generate a new client secret** をクリックします。生成されたシークレットをコピーし、Logto の `clientSecret` フィールドに貼り付けます。
3. Logto で **Save and Done** をクリックし、アイデンティティシステムと GitHub を接続します。

:::warning
Client secret は安全に保管し、クライアントサイドのコードで絶対に公開しないでください。GitHub の client secret は紛失した場合に復元できません — 新たに生成する必要があります。
:::

:::note
GitHub App の Client ID は App ID とは異なります。必ず設定ページに「Client ID」と表示されているものを使用してください（App ID ではありません）。
:::

## ステップ 4: 一般設定 \{#step-4-general-settings}

GitHub への接続を妨げることはありませんが、エンドユーザーの認証 (Authentication) 体験に影響する一般的な設定をいくつか紹介します。

### プロフィール情報の同期 \{#sync-profile-information}

GitHub コネクターでは、GitHub のユーザー情報から Logto ユーザープロフィールへの同期方法（`name`、`avatar`、`email` など）を設定できます。次のオプションから選択してください：

- **サインアップ時のみ同期**：ユーザーが初めてサインインしたときにプロフィール情報を一度だけ取得します。
- **サインイン時に常に同期**：ユーザーがサインインするたびにプロフィール情報を更新します。

### GitHub API へのアクセス用トークンの保存（オプション） \{#store-tokens-to-access-github-apis-optional}

GitHub API へのアクセスやユーザー認可での操作（ソーシャルサインインやアカウント連携経由）を行いたい場合は、Logto でトークン保存を有効にしてください：

1. GitHub App の設定（ステップ 2）で必要な権限を設定します。
2. Logto の GitHub コネクターで **Store tokens for persistent API access** を有効にします。Logto はアクセストークンとリフレッシュ トークンの両方を Secret Vault に安全に保存します。

:::note
GitHub Apps は常にリフレッシュ トークンを発行するため、Logto は両方のトークンを自動的に保存します。アクセストークンは 8 時間で期限切れになりますが、Logto はリフレッシュ トークンを使って新しいアクセストークンを取得でき、最大 6 か月間 API アクセスが途切れません。
:::

## ステップ 5: 統合のテスト（オプション） \{#step-5-test-your-integration-optional}

本番運用前に、GitHub App 統合をテストしてください：

1. Logto の開発テナントでコネクターを利用します。
2. ユーザーが GitHub でサインインできることを確認します。
3. 認可 (Authorization) 時に正しい権限がユーザーに求められることを確認します。
4. トークン保存を有効にした場合、アクセストークン（およびリフレッシュ トークン）が正しく保存されていることを確認します。
5. 保存されたトークンを使って API コールをテストし、権限が期待通りに機能しているか確認します。

GitHub Apps は、どの GitHub ユーザーアカウントでもすぐに利用できます。他のプラットフォームのようにテストユーザーやアプリ承認は不要です。ただし、アプリが組織にインストールされている場合は、組織オーナーによるインストール承認が必要な場合があります。
