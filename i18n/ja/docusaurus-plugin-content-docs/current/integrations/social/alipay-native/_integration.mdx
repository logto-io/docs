## Alipay 開発者アカウントの登録 \{#register-alipay-developer-account}

[Alipay 開発者アカウントを登録](https://certifyweb.alipay.com/certify/reg/guide#/) してください。まだアカウントをお持ちでない場合は、こちらから登録できます。

## Alipay アプリの作成と設定 \{#create-and-configure-alipay-app}

1. [Alipay コンソール](https://open.alipay.com/) に、先ほど登録したアカウントでサインインします。
2. 「マイアプリケーション」(我的应用) パネルの「Web & モバイルアプリ」(网页&移动应用) タブに移動します。
3. 「アプリを作成」(立即创建) ボタンをクリックして、アプリケーションの設定を開始します。
4. 「アプリケーション名」(应用名称) に命名規則に従って名前を入力し、「アプリケーションアイコン」(应用图标) をアップロードします。「アプリタイプ」(应用类型) には必ず「モバイルアプリケーション」(移动应用) を選択してください。iOS アプリを構築する場合は、一意の「Bundle ID」が必要です。また、Android アプリの場合は「アプリケーション署名」(应用签名) と「アプリケーションパッケージ名」(应用包名) も必要です。
5. アプリケーションの作成が完了したら、概要ページに移動します。ここで「機能を追加」(添加能力) をクリックし、「サードパーティアプリ認可」(第三方应用授权)、「会員情報の取得」(获取会员信息)、「App Alipay ログイン」(App 支付宝登录) を追加してから、Alipay サインインを有効にします。
6. [Alipay カスタマーセンター](https://b.alipay.com/index2.htm) にアクセスし、Alipay 開発者アカウントでサインインします。トップバーの「アカウントセンター」(账号中心) をクリックし、「APPID バインディング」(APPID 绑定) に進みます（サイドバーの一番下に入口があります）。手順 4 で作成したモバイルアプリの APPID を入力して「バインディングを追加」(添加绑定) します。
7. 「App Alipay ログイン」の「署名」ボタンをクリックし、ガイドに従って署名プロセスを完了します。このステップが完了すると、手順 5 で追加した機能が有効になります。
8. Alipay オープンプラットフォームのコンソールページに戻り、「開発情報」(开发信息) セクションの「インターフェース署名方法（キー/証明書）」(接口加签方式（密钥/证书）) を見つけます。「設定」(设置) ボタンをクリックすると、署名方法の設定ページに移動します。「公開鍵」(公钥) が推奨される署名モードです。生成した公開鍵ファイルの内容をテキスト入力欄に入力してください。
9. Alipay コンソールページ下部の「設定」(设置) ボタンをクリックして「認可リダイレクト URI」(授权回调地址) を設定します。`${your_logto_origin}/callback/${connector_id}` が Logto コアで使用されるデフォルトのリダイレクト URI です。`connector_id` は Logto 管理コンソールのコネクター詳細ページのトップバーで確認できます。
10. すべての手順が完了したら、Alipay コンソールページ右上の「審査提出」(提交审核) をクリックします。審査が承認されると、スムーズな Alipay サインインフローを利用できます。

:::note

ローカルマシンで _openssl_ を使ってキーペアを生成するには、以下のコードスニペットをターミナルで実行してください。

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Alipay アプリ設定サイトで公開鍵を入力する際は、`public.pem` のヘッダーとフッターを削除し、すべての改行文字を削除して、残りの内容を「公開鍵」入力欄に貼り付けてください。
:::

## Logto Alipay Native コネクター設定のセットアップ \{#set-up-the-logto-alipay-native-connector-settings}

1. [Alipay コンソールワークスペース](https://open.alipay.com/dev/workspace) の「マイアプリケーション」(我的应用) パネルで「Web & モバイルアプリ」(网页&移动应用) タブをクリックすると、すべてのアプリケーションの APPID を確認できます。
2. 前述の手順 7 で、秘密鍵と公開鍵を含むキーペアをすでに生成しています。
3. Logto コネクター設定を入力します：
   - `appId` フィールドには手順 1 で取得した APPID を入力します。
   - `privateKey` フィールドには手順 2 で生成した秘密鍵ファイルの内容を入力します。必ずすべての改行文字を '\n' に置き換えてください。秘密鍵ファイルのヘッダーとフッターは削除する必要はありません。
   - `signType` フィールドには「RSA2」を入力します。これは「Create And Configure Alipay Apps」の手順 7 で選択した「公開鍵」署名モードに対応しています。

### 設定タイプ \{#config-types}

| Name       | Type        | Enum values    |
| ---------- | ----------- | -------------- |
| appId      | string      | N/A            |
| privateKey | string      | N/A            |
| signType   | enum string | 'RSA' / 'RSA2' |

## アプリで Alipay ネイティブサインインを有効にする \{#enable-alipay-native-sign-in-in-your-app}

### iOS \{#ios}

アプリに [Logto iOS SDK](/quick-starts/swift) を統合済みであることを前提とします。この場合、手順は非常にシンプルで、Alipay SDK のドキュメントを読む必要もありません：

**1. `LogtoSocialPluginAlipay` を Xcode プロジェクトに追加**

フレームワークを追加します：

<img src="/img/assets/add-framework.png" alt="Add framework" />

:::note

このプラグインには Alipay の「ミニマリスト SDK」(極簡版 SDK) が含まれています。プラグインをインポートした後、`import AFServiceSDK` を直接使用できます。

:::

**2. プラグインを `LogtoClient` の初期化オプションに追加**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginAlipay(callbackScheme: "your-scheme")]
)
```

ここで `callbackScheme` は [カスタム URL スキーム](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) の 1 つで、アプリに遷移できます。

### Android \{#android}

アプリに [Logto Android SDK](/quick-starts/android) を統合済みであることを前提とします。この場合、手順は非常にシンプルで、Alipay SDK のドキュメントを読む必要もありません：

**1. Alipay「ミニマリスト SDK」をダウンロードしてプロジェクトに追加**

[Logto 3rd-party Social SDKs](https://github.com/logto-io/social-sdks/blob/master/alipay/android/alipaySdk-15.7.9-20200727142846.aar) から Alipay「ミニマリスト SDK」(極簡版 SDK) をダウンロードし、プロジェクトの `app/libs` フォルダーに配置します：

```bash
project-path/app/libs/alipaySdk-15.7.9-20200727142846.aar
```

**2. Alipay「ミニマリスト SDK」を依存関係として追加**

`build.gradle` ファイルを開きます：

```bash
project-path/app/build.gradle
```

依存関係を追加します：

```kotlin
dependencies {
  // ...
  implementation(files("./libs/alipaySdk-15.7.9-20200727142846.aar"))  // kotlin-script
  // または
  implementation files('./libs/alipaySdk-15.7.9-20200727142846.aar')  // groovy-script
}
```
