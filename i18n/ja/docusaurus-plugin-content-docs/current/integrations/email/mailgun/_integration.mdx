## 前提条件 \{#prerequisites}

- [Mailgun](https://www.mailgun.com/) アカウント
- Mailgun アカウントから取得した API キー（メッセージ（メール）送信の権限が必要です）。詳細は [Where Can I Find My API Key and SMTP Credentials?](https://help.mailgun.com/hc/en-us/articles/203380100-Where-Can-I-Find-My-API-Key-and-SMTP-Credentials-) を参照してください。

## 基本設定 \{#basic-configuration}

- 異なる Mailgun API エンドポイントを使用する場合は、`endpoint` フィールドに入力してください。たとえば、EU リージョンの場合は `https://api.eu.mailgun.net` となります。デフォルト値は `https://api.mailgun.net` です。
- `domain` フィールドには、Mailgun アカウントで登録したドメインを入力してください。この値は Mailgun ダッシュボードの **Domains** セクションで確認できます。ドメインは `example.com` の形式で、`https://` や `http://` のプレフィックスは不要です。
- `apiKey` フィールドには、Mailgun アカウントで生成した API キーを入力してください。
- `from` フィールドには、メール送信元として使用するメールアドレスを入力してください。このメールアドレスは Mailgun アカウントに登録されている必要があります。メールアドレスは `Sender Name <sender@example.com>` の形式で入力してください。

## Deliveries \{#deliveries}

### Config オブジェクト \{#config-object}

「Deliveries」セクションでは、さまざまなシナリオで送信されるメールの内容を設定できます。これは JSON のキーと値のマップであり、キーは使用タイプ、値は送信するメールの内容設定を含むオブジェクトです。

```json
{
  "<usage-type>": {
    // ...
  }
}
```

### 使用タイプ \{#usage-types}

サポートされている使用タイプは次のとおりです：

- `Register`: ユーザーが登録する際に送信されるメール。
- `SignIn`: ユーザーがサインインする際に送信されるメール。
- `ForgotPassword`: ユーザーがパスワードをリセットする際に送信されるメール。
- `Generic`: ユーザーが汎用的なアクション（例：メールコネクターのテスト）を行う際に送信されるメール。

:::note
deliveries 設定で使用タイプが指定されていない場合、汎用メールが送信されます。汎用メールも指定されていない場合、コネクターはエラーを返します。
:::

### 内容設定 \{#content-config}

コネクターは、直接 HTML コンテンツまたは Mailgun テンプレートの両方をサポートしています。各使用タイプごとにいずれかを利用できます。

件名や内容には `{{code}}` プレースホルダーを使用して認証コードを挿入できます。

直接 HTML コンテンツを使用する場合は、次のフィールドを入力してください：

- `subject`: 送信するメールの件名。
- `replyTo`: 返信先として使用するメールアドレス。
- `html`: （必須）送信するメールの HTML コンテンツ。
- `text`: 送信するメールのプレーンテキスト版。

Mailgun テンプレートを使用する場合は、次のフィールドを入力してください：

- `subject`: 送信するメールの件名。
- `replyTo`: 返信先として使用するメールアドレス。
- `template`: （必須）使用する Mailgun テンプレート名。
- `variables`: Mailgun テンプレートに渡す変数。Mailgun へ送信する前に文字列化されるため、JSON のキーと値のマップで指定してください。`code` 変数はコネクターによって自動的に追加されるため、含める必要はありません。

### 例 \{#example}

以下は deliveries 設定の例です：

```json
{
  "Register": {
    "subject": "{{code}} is your verification code",
    "replyTo": "Foo <foo@bar.com>",
    "html": "<h1>Welcome to Logto</h1><p>Your verification code is {{code}}.</p>",
    "text": "Welcome to Logto. Your verification code is {{code}}."
  },
  "SignIn": {
    "subject": "Welcome back to Logto",
    "replyTo": "Foo <foo@bar.com>",
    "template": "logto-sign-in",
    "variables": {
      "bar": "baz"
    }
  }
}
```
