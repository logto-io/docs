Logto には組み込みの「Logto Management API」リソースが用意されています。これは Logto Management API への `all` 権限を持つ読み取り専用リソースであり、API リソース一覧から確認できます。
リソース API インジケーターは `https://{your-tenant-id}.logto.app/api` の形式となっており、これはアクセス トークン (Access token) リクエストボディで使用するリソース値となります。

<img alt="Logto Management API の詳細" src="/img/assets/logto-management-api.png" width="600px" />

Logto Management API へアクセスする前に、M2M アプリにこの組み込み「Logto Management API」リソースの `all` 権限を含む M2M ロールが割り当てられていることを確認してください。

:::info
Logto では、新しく作成されたテナント向けに事前設定済みの「Logto Management API access」M2M ロールも提供しています。このロールには Logto Management API リソースの all 権限がすでに割り当てられています。権限を手動で設定することなく、そのまま利用できます。この事前設定済みロールは必要に応じて編集・削除も可能です。
:::

それでは、これまでの内容をまとめてリクエストを送信しましょう：

:::info
v1.30.1 以降、Logto 公式の `@logto/api` Node.js SDK が提供されており、Logto Management API とのやり取りが簡単に行えます。
:::

<Tabs groupId="interact-with-m-api">

<TabItem value="with-@logto-api-sdk" label="Node.js with `@logto/api` SDK">

#### Logto Cloud \{#logto-cloud}

```js
import { createManagementApi } from '@logto/api/management';

const { apiClient, clientCredentials } = createManagementApi('your-tenant-id', {
  clientId: 'your-client-id',
  clientSecret: 'your-client-secret',
});

const { value } = await clientCredentials.getAccessToken();
console.log('Access token:', value);

// または、アクセス トークン (Access token) の取得を省略して直接 API コールも可能です
const response = await apiClient.GET('/api/users');
console.log(response.data);
```

#### セルフホスト / OSS \{#self-hosted-oss}

OSS ユーザーはテナント ID に `default` を使用し、`baseUrl` および `apiIndicator` の設定も必要です。

```js
const { apiClient, clientCredentials } = createManagementApi('default', {
  clientId: 'your-client-id',
  clientSecret: 'your-client-secret',
  // highlight-start
  baseUrl: 'https://your.logto.endpoint',
  apiIndicator: 'https://default.logto.app/api',
  // highlight-end
});
```

</TabItem>

<TabItem value="nodejs" label="Node.js">

```js
const logtoEndpoint = 'https://your.logto.endpoint'; // Logto エンドポイントに置き換えてください
const tokenEndpoint = `${logtoEndpoint}/oidc/token`;
const applicationId = 'your-application-id';
const applicationSecret = 'your-application-secret';
const tenantId = 'your-tenant-id';

const fetchAccessToken = async () => {
  return await fetch(tokenEndpoint, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      Authorization: `Basic ${Buffer.from(`${applicationId}:${applicationSecret}`).toString(
        'base64'
      )}`,
    },
    body: new URLSearchParams({
      grant_type: 'client_credentials',
      resource: `https://${tenantId}.logto.app/api`,
      scope: 'all',
    }).toString(),
  });
};
```

:::caution
Logto Cloud ユーザー向け注意：Logto Management API とのやり取り時はカスタムドメインは利用できません。デフォルトの Logto エンドポイント `https://{your_tenant_id}.logto.app/oidc/token` を使用してアクセス トークン (Access token) を取得してください。
:::

<AccessTokenResponse />
<M2mAccessTokenNote />

</TabItem>

<TabItem value="curl" label="cURL">

```bash
curl --location \
  --request POST 'https://your.logto.endpoint' \
  --header 'Authorization: Basic ${your_auth_string}' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'grant_type=client_credentials' \
  --data-urlencode 'resource=https://${tenantId}.logto.app/api' \
  --data-urlencode 'scope=all'
```

実際の値はご自身のものに置き換えてください。

:::caution
Logto Cloud ユーザー向け注意：Logto Management API とのやり取り時はカスタムドメインは利用できません。デフォルトの Logto エンドポイント `https://{your_tenant_id}.logto.app/oidc/token` を使用してアクセス トークン (Access token) を取得してください。
:::

<AccessTokenResponse />
<M2mAccessTokenNote />

</TabItem>

</Tabs>
