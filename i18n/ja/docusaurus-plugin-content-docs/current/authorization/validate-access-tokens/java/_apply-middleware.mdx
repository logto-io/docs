import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

<Tabs groupId="api-framework">
  <TabItem value="spring-boot" label="Spring Boot">

```java title="ProtectedController.java"
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.oauth2.jwt.Jwt;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import java.util.Arrays;
import java.util.List;
import java.util.Map;

@RestController
public class ProtectedController {

    @GetMapping("/api/protected")
    public Map<String, Object> protectedEndpoint(@AuthenticationPrincipal Jwt jwt) {
        // JWT から直接アクセストークン情報を取得
        String scopes = jwt.getClaimAsString("scope");
        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();

        return Map.of(
            "sub", jwt.getSubject(),
            "client_id", jwt.getClaimAsString("client_id"),
            "organization_id", jwt.getClaimAsString("organization_id"),
            "scopes", scopeList,
            "audience", jwt.getAudience()
        );
    }

    @GetMapping("/api/protected/detailed")
    public Map<String, Object> detailedEndpoint(@AuthenticationPrincipal Jwt jwt) {
        // 保護されたエンドポイントのロジック
        return Map.of(
            "sub", jwt.getSubject(),
            "client_id", jwt.getClaimAsString("client_id"),
            "organization_id", jwt.getClaimAsString("organization_id"),
            "scopes", jwt.getClaimAsString("scope"),
            "audience", jwt.getAudience(),
            "message", "保護されたデータへのアクセスに成功しました"
        );
    }
}
```

  </TabItem>
  <TabItem value="quarkus" label="Quarkus">

```java title="ProtectedResource.java"
import org.eclipse.microprofile.jwt.JsonWebToken;
import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;
import jakarta.ws.rs.core.Context;
import jakarta.ws.rs.container.ContainerRequestContext;
import java.util.Arrays;
import java.util.List;
import java.util.Map;

@Path("/api")
public class ProtectedResource {

    @Inject
    JsonWebToken jwt;

    @GET
    @Path("/protected")
    @Produces(MediaType.APPLICATION_JSON)
    public Map<String, Object> protectedEndpoint(@Context ContainerRequestContext requestContext) {
        // インジェクションまたはコンテキストから直接 JWT を取得
        JsonWebToken token = (JsonWebToken) requestContext.getProperty("auth");
        if (token == null) {
            token = jwt; // インジェクトされた JWT をフォールバックとして使用
        }

        String scopes = token.getClaim("scope");
        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();

        return Map.of(
            "sub", token.getSubject(),
            "client_id", token.<String>getClaim("client_id"),
            "organization_id", token.<String>getClaim("organization_id"),
            "scopes", scopeList,
            "audience", token.getAudience()
        );
    }

    @GET
    @Path("/protected/detailed")
    @Produces(MediaType.APPLICATION_JSON)
    public Map<String, Object> detailedEndpoint() {
        // 保護されたエンドポイントのロジック
        String scopes = jwt.getClaim("scope");
        return Map.of(
            "sub", jwt.getSubject(),
            "client_id", jwt.<String>getClaim("client_id"),
            "organization_id", jwt.<String>getClaim("organization_id"),
            "scopes", scopes,
            "audience", jwt.getAudience(),
            "message", "保護されたデータへのアクセスに成功しました"
        );
    }
}
```

  </TabItem>
  <TabItem value="micronaut" label="Micronaut">

```java title="ProtectedController.java"
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.security.annotation.Secured;
import io.micronaut.security.authentication.Authentication;
import io.micronaut.security.rules.SecurityRule;
import java.util.Arrays;
import java.util.List;
import java.util.Map;

@Controller("/api")
@Secured(SecurityRule.IS_AUTHENTICATED)
public class ProtectedController {

    @Get("/protected")
    public Map<String, Object> protectedEndpoint(Authentication authentication) {
        // Authentication から直接アクセストークン情報を取得
        String scopes = (String) authentication.getAttributes().get("scope");
        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();

        return Map.of(
            "sub", authentication.getName(),
            "client_id", authentication.getAttributes().get("client_id"),
            "organization_id", authentication.getAttributes().get("organization_id"),
            "scopes", scopeList,
            "audience", authentication.getAttributes().get("aud")
        );
    }

    @Get("/protected/detailed")
    public Map<String, Object> detailedEndpoint(Authentication authentication) {
        // 保護されたエンドポイントのロジック
        return Map.of(
            "sub", authentication.getName(),
            "client_id", authentication.getAttributes().get("client_id"),
            "organization_id", authentication.getAttributes().get("organization_id"),
            "scopes", authentication.getAttributes().get("scope"),
            "audience", authentication.getAttributes().get("aud"),
            "message", "保護されたデータへのアクセスに成功しました"
        );
    }
}
```

  </TabItem>
  <TabItem value="vertx-web" label="Vert.x Web">

```java title="MainVerticle.java"
import io.vertx.core.AbstractVerticle;
import io.vertx.core.Promise;
import io.vertx.core.json.JsonObject;
import io.vertx.ext.web.Router;
import io.vertx.ext.web.RoutingContext;

public class MainVerticle extends AbstractVerticle {

    @Override
    public void start(Promise<Void> startPromise) throws Exception {
        Router router = Router.router(vertx);

        // 保護されたルートにミドルウェアを適用
        router.route("/api/protected*").handler(new JwtAuthHandler(vertx));
        router.get("/api/protected").handler(this::protectedEndpoint);
        router.get("/api/protected/detailed").handler(this::detailedEndpoint);

        vertx.createHttpServer()
            .requestHandler(router)
            .listen(8080, result -> {
                if (result.succeeded()) {
                    startPromise.complete();
                } else {
                    startPromise.fail(result.cause());
                }
            });
    }

    private void protectedEndpoint(RoutingContext context) {
        // コンテキストから直接 JWT プリンシパルを取得
        JsonObject principal = context.get("auth");
        if (principal == null) {
            context.response()
                .setStatusCode(500)
                .putHeader("Content-Type", "application/json")
                .end("{\"error\": \"JWT principal not found\"}");
            return;
        }

        String scopes = principal.getString("scope");
        JsonObject response = new JsonObject()
            .put("sub", principal.getString("sub"))
            .put("client_id", principal.getString("client_id"))
            .put("organization_id", principal.getString("organization_id"))
            .put("scopes", scopes != null ? scopes.split(" ") : new String[0])
            .put("audience", principal.getJsonArray("aud"));

        context.response()
            .putHeader("Content-Type", "application/json")
            .end(response.encode());
    }

    private void detailedEndpoint(RoutingContext context) {
        // 保護されたエンドポイントのロジック
        JsonObject principal = context.get("auth");

        JsonObject response = new JsonObject()
            .put("sub", principal.getString("sub"))
            .put("client_id", principal.getString("client_id"))
            .put("organization_id", principal.getString("organization_id"))
            .put("scopes", principal.getString("scope"))
            .put("audience", principal.getJsonArray("aud"))
            .put("message", "保護されたデータへのアクセスに成功しました");

        context.response()
            .putHeader("Content-Type", "application/json")
            .end(response.encode());
    }
}
```

  </TabItem>
</Tabs>
