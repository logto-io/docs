### オプション: ユーザー権限の変更への対応 \{#optional-handle-user-permission-change}

ユーザーの権限はいつでも変更される可能性があります。Logto は RBAC のために JWT を発行しているため、権限の更新は新たに発行されたトークンにのみ反映され、既存の JWT が変更されることはありません。

:::info スコープ (Scope) サブセットルール
アクセス トークン (Access token) には、元の OAuth 認可 (Authorization) フローでリクエストされたスコープ (Scope) のみが含まれます。
ユーザーが新しい権限を獲得しても、後で発行されるトークンには、元のリクエストで要求されたスコープ (Scope) のサブセットしか含めることができません。
初回リクエストに含まれていなかった新しいスコープ (Scope) へアクセスするには、クライアントは新しい認可 (Authorization) フローを実行する必要があります。
:::

#### 権限の縮小（ダウンスコープ） \{#downscoped-permissions}

ユーザーが権限を失った場合：

- 新たに発行されたトークンは、即座に縮小されたスコープ (Scope) を反映します。
- 既存の JWT は、有効期限が切れるまで古いスコープ (Scope) を保持します。
- API では常にスコープ (Scope) を検証し、短いトークン有効期間に依存してください。

より迅速な対応が必要な場合は、クライアントにトークンのリフレッシュを促す独自のシグナルを実装してください。

#### 権限の拡大（アップスコープ） \{#enlarged-permissions}

{props.type === "global" && <p>グローバル API リソースの場合、ユーザーが権限を獲得しても、リフレッシュによって拡大した権限は反映されません。新しいスコープ (Scope) を含むトークンを取得するには、クライアントは新しい OAuth 認可 (Authorization) フローを実行する必要があります。ユーザーがアクティブな Logto セッションを持っていれば、これはサイレントに行われる場合があります。</p>}

{props.type === "organization" && <p>組織トークンの場合、ユーザーが権限を獲得すると、次回の発行（リフレッシュまたはトークンリクエスト）で拡大した権限が反映されます。新しいトークンは必要ですが、新しいスコープ (Scope) が元のリクエストセットを超えない限り、完全な再認証は不要です。</p>}

#### 推奨事項 \{#recommendations}

- API では毎回スコープ (Scope) を検証してください。
- トークンの有効期限は短く設定してください。
- 即時の権限変更伝播が必要な場合は、オプションで通知機能を追加してください。
