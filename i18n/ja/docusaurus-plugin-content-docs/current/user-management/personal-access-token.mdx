---
sidebar_position: 4
---

# パーソナルアクセストークン (Personal access token)

パーソナルアクセストークン (PAT) は、ユーザーが認証情報やインタラクティブなサインインを使用せずに [アクセス トークン (Access token)](https://auth.wiki/access-token) を付与するための安全な方法を提供します。これは、CI / CD、スクリプト、またはリソースへプログラム的にアクセスする必要があるアプリケーションに便利です。

## パーソナルアクセストークンの管理 \{#managing-personal-access-tokens}

### コンソールの利用 \{#using-console}

<CloudLink to="/users">コンソール > ユーザー管理</CloudLink> のユーザー詳細ページでパーソナルアクセストークンを管理できます。「認証
(Authentication)」カードで、パーソナルアクセストークンの一覧を確認したり、新規作成が可能です。

### Management API の利用 \{#using-management-api}

[Management API](/integrate-logto/interact-with-management-api/) をセットアップした後、[API エンドポイント](https://openapi.logto.io/operation/operation-listuserpersonalaccesstokens) を利用してパーソナルアクセストークンの作成、一覧取得、削除ができます。

## PAT を使ってアクセス トークン (Access tokens) を付与する \{#use-pats-to-grant-access-tokens}

PAT を作成した後、トークンエクスチェンジエンドポイントを利用してアプリケーションにアクセス トークン (Access token) を付与できます。

:::tip トークンフローの等価性

PAT を利用して取得したアクセス トークン (Access token) は、標準の `refresh_token` フローで取得したトークンと**同一の動作**をします。つまり：

- **組織コンテキスト**：PAT で取得したトークンは、リフレッシュ トークン (Refresh token) フローと同じ組織権限やスコープをサポートします
- **認可フロー**：PAT で交換したアクセス トークン (Access token) は [組織権限](/authorization/organization-permissions) や [組織レベルの API リソース](/authorization/organization-level-api-resources) に利用できます
- **トークン検証**：同じ検証ロジックが適用されます — 初期の grant type だけが異なります

組織を扱う場合、PAT でもリフレッシュ トークン (Refresh token) でもアクセスパターンや権限は同じです。

:::

### リクエスト \{#request}

アプリケーションは、HTTP POST メソッドを使い、特別な grant type でテナントの [トークンエンドポイント](/integrate-logto/application-data-structure#token-endpoint) へ [トークンエクスチェンジリクエスト](https://auth.wiki/authorization-code-flow#token-exchange-request) を送信します。HTTP リクエストのエンティティボディには `application/x-www-form-urlencoded` 形式で次のパラメータを含めます。

1. `client_id`: 必須。アプリケーションのクライアント ID。
2. `grant_type`: 必須。このパラメータの値は `urn:ietf:params:oauth:grant-type:token-exchange` で、トークンエクスチェンジを示します。
3. `resource`: 任意。他のトークンリクエストと同じリソースインジケーター。
4. `scope`: 任意。他のトークンリクエストと同じリクエストスコープ。
5. `subject_token`: 必須。ユーザーの PAT。
6. `subject_token_type`: 必須。`subject_token` パラメータで提供されるセキュリティトークンのタイプ。このパラメータの値は `urn:logto:token-type:personal_access_token` でなければなりません。

### レスポンス \{#response}

トークンエクスチェンジリクエストが成功すると、テナントのトークンエンドポイントはユーザーのアイデンティティを表すアクセス トークン (Access token) を返します。レスポンスは `application/json` 形式で、HTTP レスポンスのエンティティボディに次のパラメータを含みます。

1. `access_token`: 必須。ユーザーのアクセス トークン (Access token)。`authorization_code` や `refresh_token` など他のトークンリクエストと同じです。
2. `issued_token_type`: 必須。発行されたトークンのタイプ。このパラメータの値は `urn:ietf:params:oauth:token-type:access_token` でなければなりません。
3. `token_type`: 必須。トークンのタイプ。このパラメータの値は `Bearer` でなければなりません。
4. `expires_in`: 必須。アクセス トークン (Access token) の有効期間（秒）。
5. `scope`: 任意。アクセス トークン (Access token) のスコープ。

### トークンエクスチェンジ例 \{#example-token-exchange}

```
POST /oidc/token HTTP/1.1
Host: tenant.logto.app
Content-Type: application/x-www-form-urlencoded
Authorization: Basic <base64(client-id:client-secret)>

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Atoken-exchange
&scope=profile
&subject_token=pat_W51arOqe7nynW75nWhvYogyc
&subject_token_type=urn%3Alogto%3Atoken-type%3Apersonal_access_token
```

```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "access_token": "eyJhbGci...zg",
  "issued_token_type": "urn:ietf:params:oauth:token-type:access_token",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "profile"
}
```

アクセス トークン (Access token) のペイロード例：

```json
{
  "jti": "iFtbZBeh2M1cTTBuKbHk4",
  "sub": "123",
  "iss": "https://tenant.logto.app/oidc",
  "exp": 1672531200,
  "iat": 1672527600,
  "scope": "profile",
  "client_id": "client-id"
}
```

## 関連リソース \{#related-resources}

<Url href="https://blog.logto.io/api-authentication-with-personal-access-token">
  パーソナルアクセストークンとは？どんなときにパーソナルアクセストークンを使うべき？
</Url>

<Url href="https://blog.logto.io/pat-and-api-keys">
  パーソナルアクセストークン、マシン間通信 (Machine-to-Machine) 認証 (Authentication)、API
  キーの定義と実際の利用シナリオ
</Url>
