---
sidebar_position: 8
---

# Gérer les mises à jour de portée dans les jetons d’organisation

Avec la configuration ci-dessus, vous pouvez envoyer des invitations par e-mail, et les invités peuvent rejoindre l’organisation avec le rôle attribué.

Les utilisateurs ayant différents rôles d’organisation auront différentes portées (permissions) dans leurs jetons d’organisation. Votre application cliente et vos services backend doivent vérifier ces portées pour déterminer les fonctionnalités visibles et les actions autorisées.

Comme mentionné précédemment, le modèle d’organisation sert de couche clé de contrôle d’accès pour protéger les [permissions d’organisation](/authorization/organization-permissions) ou les [API de niveau organisation](/authorization/organization-level-api-resources). Veillez à consulter les sections sur l’autorisation et à choisir le modèle d’autorisation le mieux adapté à votre produit.

:::note

<Url href="/authorization/organization-permissions">
  Protéger les permissions d’organisation (non-API)
</Url>
<Url href="/authorization/organization-level-api-resources">
  Protéger les ressources API de niveau organisation
</Url>

:::

Ce chapitre se concentre sur la **gestion des permissions** et les bonnes pratiques pour **gérer les changements de portée et de permissions** dans les jetons d’organisation Logto.

## Gérer les mises à jour de portée dans les jetons d’organisation \{#handle-scope-updates-in-organization-tokens}

La gestion des mises à jour de portée dans les jetons d’organisation implique :

### Révoquer les portées existantes \{#revoke-existing-scopes}

Par exemple, rétrograder un administrateur en membre non-administrateur doit retirer des portées à l’utilisateur. Dans ce cas, effacez le jeton d’organisation mis en cache et récupérez-en un nouveau avec un jeton de rafraîchissement. Les portées réduites seront immédiatement reflétées dans le nouveau jeton d’organisation émis.

### Accorder de nouvelles portées \{#grant-new-scopes}

Cela peut être divisé en deux scénarios :

#### Accorder de nouvelles portées déjà définies dans votre système d’authentification \{#grant-new-scopes-that-are-already-defined-in-your-auth-system}

Comme pour la révocation de portées, si la nouvelle portée accordée est déjà enregistrée auprès du serveur d’authentification, émettez un nouveau jeton d’organisation et les nouvelles portées seront immédiatement reflétées.

#### Accorder de nouvelles portées nouvellement introduites dans votre système d’authentification \{#grant-new-scopes-that-are-newly-introduced-into-your-auth-system}

Dans ce cas, déclenchez un processus de reconnexion ou de re-consentement pour mettre à jour le jeton d’organisation de l’utilisateur. Par exemple, appelez la méthode `signIn` dans le SDK Logto.

## Vérifier les permissions en temps réel et mettre à jour le jeton d’organisation \{#check-permissions-in-real-time-and-update-the-organization-token}

Logto fournit une Management API pour récupérer en temps réel les permissions d’un utilisateur dans l’organisation.

- `GET /api/organizations/{id}/users/{userId}/scopes` ([Références API](https://openapi.logto.io/operation/operation-listorganizationuserscopes))

Comparez les portées dans le jeton d’organisation de l’utilisateur avec les permissions en temps réel pour déterminer si l’utilisateur a été promu ou rétrogradé.

- Si l’utilisateur est rétrogradé, effacez le jeton d’organisation mis en cache et le SDK émettra automatiquement un nouveau jeton avec les portées mises à jour.

  ```tsx
  const { clearAccessToken } = useLogto();

  ...
  // Si les portées récupérées en temps réel sont inférieures à celles du jeton d’organisation
  await clearAccessToken();

  ```

  Cela ne nécessite pas de reconnexion ni de re-consentement. De nouveaux jetons d’organisation seront émis automatiquement par le SDK Logto.

- Si une nouvelle portée est introduite dans votre système d’authentification, déclenchez un processus de reconnexion ou de re-consentement pour mettre à jour le jeton d’organisation de l’utilisateur. Par exemple, avec le SDK React :

  ```tsx
  const { clearAllTokens, signIn } = useLogto();

  ...
  // Si les portées récupérées en temps réel comportent de nouvelles portées attribuées par rapport au jeton d’organisation
  await clearAllTokens();
  signIn({
    redirectUri: '<your-sign-in-redirect-uri>',
    prompt: 'consent',
  });

  ```

  Le code ci-dessus déclenche une navigation vers l’écran de consentement et redirige automatiquement vers votre application avec les portées mises à jour dans le jeton d’organisation de l’utilisateur.
