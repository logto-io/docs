## Enregistrer un compte développeur Alipay \{#register-alipay-developer-account}

[Enregistrez un compte développeur Alipay](https://certifyweb.alipay.com/certify/reg/guide#/) si vous n'en avez pas encore.

## Créer et configurer une application Alipay \{#create-and-configure-alipay-app}

1. Connectez-vous à la [console Alipay](https://open.alipay.com/) avec le compte que vous venez de créer.
2. Allez dans l’onglet "Web & Mobile Apps" (网页&移动应用) du panneau "My Application" (我的应用).
3. Cliquez sur le bouton "Create an App" (立即创建) pour commencer à configurer votre application.
4. Nommez votre application dans "Application Name" (应用名称) en respectant les conventions de nommage et téléchargez votre "Application Icon" (应用图标), assurez-vous de choisir "web application" (网页应用) comme "App type" (应用类型).
5. Après avoir terminé la création de l’application, vous arrivez sur la page d’aperçu (Overview), où vous devez cliquer sur "add ability" (添加能力) pour ajouter "Third-party application authorization" (第三方应用授权), "Get member information" (获取会员信息) et "App Alipay login" (App 支付宝登录) avant d’activer la connexion Alipay.
6. Rendez-vous sur le [Centre client Alipay](https://b.alipay.com/index2.htm), et connectez-vous avec le compte développeur Alipay. Cliquez sur "Account Center" (账号中心) dans la barre supérieure et allez dans "APPID binding" (APPID 绑定), dont l’entrée se trouve en bas de la barre latérale. "Add binding" (添加绑定) en saisissant l’APPID de l’application web que vous venez de créer à l’étape 4.
7. Cliquez sur le bouton "Sign" de "App Alipay login", et terminez le processus de signature en suivant le guide. Après cette étape, vous devriez voir les capacités ajoutées à l’étape 5 actives.
8. Revenez à la page de la console de la plateforme ouverte Alipay, et vous trouverez "Interface signing method" (接口加签方式（密钥/证书）) dans la section "development information" (开发信息). Cliquez sur le bouton "set up" (设置), et vous arriverez sur une page de configuration de la méthode de signature. "Public Key" (公钥) est le mode de signature recommandé, et remplissez le champ avec le contenu du fichier de clé publique que vous avez généré.
9. Configurez "Authorization Redirect URI" (授权回调地址) en cliquant sur le bouton "set up" (设置) en bas de la page de la console Alipay. `${your_logto_origin}/callback/${connector_id}` est l’URI de redirection par défaut utilisé dans Logto core. Le `connector_id` se trouve dans la barre supérieure de la page de détails du connecteur dans la Logto Admin Console.
10. Après avoir terminé toutes ces étapes, retournez dans le coin supérieur droit de la page de la console Alipay, et cliquez sur "Submit for review" (提交审核). Une fois la validation approuvée, vous pouvez profiter d’un flux de connexion Alipay fluide.

:::note
Vous pouvez utiliser _openssl_ pour générer des paires de clés sur votre machine locale en exécutant le code suivant dans le terminal.

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Lorsque vous remplissez la clé publique sur le site de configuration de l’application Alipay, vous devez supprimer l’en-tête et le pied de page de `public.pem`, supprimer tous les retours à la ligne, puis coller le reste du contenu dans le champ de saisie de texte pour la "public key".

:::

## Configurer les paramètres du connecteur Logto Alipay Web \{#set-up-the-logto-alipay-web-connector-settings}

1. Dans [l’espace de travail de la console Alipay](https://open.alipay.com/dev/workspace), allez dans le panneau "My application" (我的应用) et cliquez sur l’onglet "Web & Mobile Apps" (网页&移动应用), vous trouverez l’APPID de toutes les applications.
2. À l’étape 7 de la partie précédente, vous avez déjà généré une paire de clés comprenant une clé privée et une clé publique.
3. Remplissez les paramètres du connecteur Logto :
   - Remplissez le champ `appId` avec l’APPID obtenu à l’étape 1.
   - Remplissez le champ `privateKey` avec le contenu du fichier de clé privée mentionné à l’étape 2. Veuillez VOUS ASSURER d’utiliser '\n' pour remplacer tous les retours à la ligne et de ne pas supprimer l’en-tête et le pied de page du fichier de clé privée.
   - Remplissez le champ `signType` avec 'RSA2' en raison du mode de signature `Public key` choisi à l’étape 7 de "Créer et configurer une application Alipay".
   - Remplissez le champ `charset` avec 'gbk' ou 'utf8'. Vous pouvez laisser ce champ vide car il est OPTIONNEL. La valeur par défaut est 'utf8'.
   - Remplissez le champ `scope` avec 'auth_base' ou 'auth_user'. Vous pouvez laisser ce champ vide car il est OPTIONNEL. La valeur par défaut est 'auth_user'. Vous pouvez consulter la [différence](https://opendocs.alipay.com/fw/api/105942) entre les différentes valeurs.

### Types de configuration \{#config-types}

| Nom        | Type                    | Valeurs énumérées          |
| ---------- | ----------------------- | -------------------------- |
| appId      | string                  | N/A                        |
| privateKey | string                  | N/A                        |
| signType   | enum string             | 'RSA' / 'RSA2'             |
| charset    | enum string (OPTIONNEL) | 'gbk' / 'utf8' / undefined |
| scope      | enum string (OPTIONNEL) | 'auth_user' / 'auth_base'  |
