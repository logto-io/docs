## Enregistrer un compte développeur Alipay \{#register-alipay-developer-account}

[Enregistrez un compte développeur Alipay](https://certifyweb.alipay.com/certify/reg/guide#/) si vous n'en avez pas encore.

## Créer et configurer une application Alipay \{#create-and-configure-alipay-app}

1. Connectez-vous à la [console Alipay](https://open.alipay.com/) avec le compte que vous venez de créer.
2. Allez dans l’onglet "Web & Mobile Apps" (网页&移动应用) du panneau "My Application" (我的应用).
3. Cliquez sur le bouton "Create an App" (立即创建) pour commencer à configurer votre application.
4. Nommez votre application dans "Application Name" (应用名称) en respectant les conventions de nommage et téléchargez votre "Application Icon" (应用图标). Assurez-vous de choisir "mobile application" (移动应用) comme "App type" (应用类型). Pour la création d’une application iOS, un "Bundle ID" unique est requis. De plus, la "application signature" (应用签名) et le "application package name" (应用包名) sont requis pour les applications Android.
5. Après avoir terminé la création de l’application, vous arrivez sur la page d’aperçu (Overview), où vous devez cliquer sur "add ability" (添加能力) pour ajouter "Third-party application authorization" (第三方应用授权), "Get member information" (获取会员信息) et "App Alipay login" (App 支付宝登录) avant d’activer la connexion Alipay.
6. Rendez-vous sur le [Centre client Alipay](https://b.alipay.com/index2.htm), et connectez-vous avec le compte développeur Alipay. Cliquez sur "Account Center" (账号中心) dans la barre supérieure puis allez dans "APPID binding" (APPID 绑定), dont l’entrée se trouve en bas de la barre latérale. "Add binding" (添加绑定) en saisissant l’APPID de l’application mobile que vous venez de créer à l’étape 4.
7. Cliquez sur le bouton "Sign" de "App Alipay login", et terminez le processus de signature en suivant le guide. Après cette étape, vous devriez constater que les capacités ajoutées à l’étape 5 sont activées.
8. Revenez à la page de la console de la plateforme ouverte Alipay, et vous trouverez "Interface signing method" (接口加签方式（密钥/证书）) dans la section "development information" (开发信息). Cliquez sur le bouton "set up" (设置), et vous accéderez à une page de configuration de la méthode de signature. "Public Key" (公钥) est le mode de signature préféré, et vous devez remplir le champ avec le contenu du fichier de clé publique que vous avez généré.
9. Configurez "Authorization Redirect URI" (授权回调地址) en cliquant sur le bouton "set up" (设置) en bas de la page de la console Alipay. `${your_logto_origin}/callback/${connector_id}` est l’URI de redirection par défaut utilisée dans Logto core. Le `connector_id` se trouve dans la barre supérieure de la page de détails du connecteur dans la Logto Admin Console.
10. Après avoir terminé toutes ces étapes, retournez dans le coin supérieur droit de la page de la console Alipay et cliquez sur "Submit for review" (提交审核). Une fois la validation approuvée, vous pouvez profiter d’un flux de connexion Alipay fluide.

:::note

Vous pouvez utiliser _openssl_ pour générer des paires de clés sur votre machine locale en exécutant le code suivant dans le terminal.

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Lorsque vous remplissez la clé publique sur le site de configuration de l’application Alipay, vous devez supprimer l’en-tête et le pied de page de `public.pem`, supprimer tous les retours à la ligne, puis coller le reste du contenu dans le champ de saisie de texte pour la "public key".
:::

## Configurer les paramètres du connecteur Logto Alipay Native \{#set-up-the-logto-alipay-native-connector-settings}

1. Dans [l’espace de travail de la console Alipay](https://open.alipay.com/dev/workspace), allez dans le panneau "My application" (我的应用) et cliquez sur l’onglet "Web & Mobile Apps" (网页&移动应用), vous trouverez l’APPID de toutes les applications.
2. À l’étape 7 de la partie précédente, vous avez déjà généré une paire de clés comprenant une clé privée et une clé publique.
3. Remplissez les paramètres du connecteur Logto :
   - Renseignez le champ `appId` avec l’APPID obtenu à l’étape 1.
   - Renseignez le champ `privateKey` avec le contenu du fichier de clé privée mentionné à l’étape 2. Veuillez VOUS ASSURER d’utiliser '\n' pour remplacer tous les retours à la ligne. Il n’est pas nécessaire de supprimer l’en-tête et le pied de page du fichier de clé privée.
   - Renseignez le champ `signType` avec 'RSA2' en raison du mode de signature `Public key` choisi à l’étape 7 de "Créer et configurer une application Alipay".

### Types de configuration \{#config-types}

| Nom        | Type        | Valeurs Enum   |
| ---------- | ----------- | -------------- |
| appId      | string      | N/A            |
| privateKey | string      | N/A            |
| signType   | enum string | 'RSA' / 'RSA2' |

## Activer la connexion native Alipay dans votre application \{#enable-alipay-native-sign-in-in-your-app}

### iOS \{#ios}

Nous supposons que vous avez intégré le [Logto iOS SDK](/quick-starts/swift) dans votre application. Dans ce cas, les choses sont très simples, et vous n’avez même pas besoin de lire la documentation du SDK Alipay :

**1. Ajoutez `LogtoSocialPluginAlipay` à votre projet Xcode**

Ajoutez le framework :

<img src="/img/assets/add-framework.png" alt="Ajouter un framework" />

:::note

Le plugin inclut le "minimalist SDK" (极简版 SDK) d’Alipay. Vous pouvez directement utiliser `import AFServiceSDK` une fois le plugin importé.

:::

**2. Ajoutez le plugin aux options d’initialisation de votre `LogtoClient`**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginAlipay(callbackScheme: "your-scheme")]
)
```

Où `callbackScheme` est l’un des [custom URL Schemes](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) qui permet de naviguer vers votre application.

### Android \{#android}

Nous supposons que vous avez intégré le [Logto Android SDK](/quick-starts/android) dans votre application. Dans ce cas, les choses sont très simples, et vous n’avez même pas besoin de lire la documentation du SDK Alipay :

**1. Téléchargez le "minimalist SDK" d’Alipay et ajoutez-le à votre projet**

Téléchargez le "minimalist SDK" d’Alipay (极简版 SDK) depuis [Logto 3rd-party Social SDKs](https://github.com/logto-io/social-sdks/blob/master/alipay/android/alipaySdk-15.7.9-20200727142846.aar) dans le dossier `app/libs` de votre projet :

```bash
project-path/app/libs/alipaySdk-15.7.9-20200727142846.aar
```

**2. Ajoutez le "minimalist SDK" d’Alipay comme dépendance**

Ouvrez votre fichier `build.gradle` :

```bash
project-path/app/build.gradle
```

Ajoutez la dépendance :

```kotlin
dependencies {
  // ...
  implementation(files("./libs/alipaySdk-15.7.9-20200727142846.aar"))  // kotlin-script
  // ou
  implementation files('./libs/alipaySdk-15.7.9-20200727142846.aar')  // groovy-script
}
```
