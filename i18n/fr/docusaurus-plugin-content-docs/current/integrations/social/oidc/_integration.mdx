## Créez votre application OIDC \{#create-your-oidc-app}

Lorsque vous ouvrez cette page, nous supposons que vous savez déjà quel fournisseur d'identité sociale vous souhaitez connecter. La première chose à faire est de confirmer que le fournisseur d'identité prend en charge le protocole OIDC, ce qui est une condition préalable pour configurer un connecteur valide. Ensuite, suivez les instructions du fournisseur d'identité pour enregistrer et créer l'application correspondante pour l'autorisation OIDC.

## Configurez votre connecteur \{#configure-your-connector}

Nous prenons UNIQUEMENT en charge le type de flux "Authorization Code" pour des raisons de sécurité, et il s'adapte parfaitement au scénario de Logto.

`clientId` et `clientSecret` peuvent être trouvés sur la page de détails de votre application OIDC.

_clientId_ : L'identifiant client est un identifiant unique qui identifie l'application cliente lors de l'enregistrement auprès du serveur d'autorisation. Cet identifiant est utilisé par le serveur d'autorisation pour vérifier l'identité de l'application cliente et pour associer tout jeton d’accès autorisé à cette application cliente spécifique.

_clientSecret_ : Le secret client est une clé confidentielle délivrée à l'application cliente par le serveur d'autorisation lors de l'enregistrement. L'application cliente utilise cette clé secrète pour s'authentifier auprès du serveur d'autorisation lors de la demande de jetons d’accès. Le secret client est considéré comme une information confidentielle et doit être conservé en sécurité à tout moment.

_tokenEndpointAuthMethod_ : La méthode d'authentification du point de terminaison de jeton est utilisée par l'application cliente pour s'authentifier auprès du serveur d'autorisation lors de la demande de jetons d’accès. Pour découvrir les méthodes prises en charge, consultez le champ `token_endpoint_auth_methods_supported` disponible sur le point de terminaison de découverte OpenID Connect du fournisseur de service OAuth 2.0, ou référez-vous à la documentation pertinente fournie par le fournisseur de service OAuth 2.0.

_clientSecretJwtSigningAlgorithm (Optionnel)_ : Nécessaire uniquement lorsque `tokenEndpointAuthMethod` est `client_secret_jwt`. L'algorithme de signature JWT du secret client est utilisé par l'application cliente pour signer le JWT envoyé au serveur d'autorisation lors de la demande de jeton.

_scope_ : Le paramètre scope est utilisé pour spécifier l'ensemble des ressources et permissions que l'application cliente demande à accéder. Le paramètre scope est généralement défini comme une liste de valeurs séparées par des espaces représentant des permissions spécifiques. Par exemple, une valeur de scope "read write" peut indiquer que l'application cliente demande un accès en lecture et en écriture aux données d'un utilisateur.

Vous devez trouver `authorizationEndpoint`, `tokenEndpoint`, `jwksUri` et `issuer` comme informations de configuration du fournisseur OpenID. Elles devraient être disponibles dans la documentation du fournisseur social.

_authenticationEndpoint_ : Ce point de terminaison est utilisé pour initier le processus d'authentification. Le processus d'authentification implique généralement que l'utilisateur se connecte et accorde l'autorisation à l'application cliente d'accéder à ses ressources.

_tokenEndpoint_ : Ce point de terminaison est utilisé par l'application cliente pour obtenir un jeton d’identifiant qui peut être utilisé pour accéder aux ressources demandées. L'application cliente envoie généralement une demande au point de terminaison de jeton avec un type de flux et un code d'autorisation pour recevoir un jeton d’identifiant.

_jwksUri_ : Il s'agit de l'URL où l'ensemble de clés Web JSON (JWKS) du fournisseur d'identité sociale (IdP) peut être obtenu. Le JWKS est un ensemble de clés cryptographiques que l'IdP utilise pour signer et vérifier les JSON Web Tokens (JWT) émis lors du processus d'authentification. Le `jwksUri` est utilisé par la partie de confiance (RP) pour obtenir les clés publiques utilisées par l'IdP pour signer les JWT, afin que la RP puisse vérifier l'authenticité et l'intégrité des JWT reçus de l'IdP.

_issuer_ : Il s'agit de l'identifiant unique de l'IdP utilisé par la RP pour vérifier les JWT reçus de l'IdP. Il est inclus dans les JWT comme [revendication (Claim)](https://www.rfc-editor.org/rfc/rfc7519#section-4) `iss` (le jeton d’identifiant est toujours un JWT). La valeur de l'émetteur doit correspondre à l'URL du serveur d'autorisation de l'IdP, et il doit s'agir d'un URI auquel la RP fait confiance. Lorsque la RP reçoit un JWT, elle vérifie la revendication `iss` pour s'assurer qu'il a été émis par un IdP de confiance, et que le JWT est destiné à être utilisé avec la RP.

Ensemble, `jwksUri` et `issuer` fournissent un mécanisme sécurisé permettant à la RP de vérifier l'identité de l'utilisateur final lors du processus d'authentification. En utilisant les clés publiques obtenues à partir du `jwksUri`, la RP peut vérifier l'authenticité et l'intégrité des JWT émis par l'IdP. La valeur de l'émetteur garantit que la RP n'accepte que les JWT émis par un IdP de confiance, et que les JWT sont destinés à être utilisés avec la RP.

Puisqu'une requête d’authentification (Authentication request) est toujours requise, un `authRequestOptionalConfig` est fourni pour regrouper toutes les configurations optionnelles. Vous pouvez trouver les détails sur [OIDC Authentication Request](https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest). Vous remarquerez peut-être que `nonce` est absent de cette configuration. Comme `nonce` doit être identique pour chaque requête, nous avons placé la génération de `nonce` dans l'implémentation du code. Donc, pas d'inquiétude ! Les `jwksUri` et `issuer` mentionnés précédemment sont également inclus dans `idTokenVerificationConfig`.

Vous vous demandez peut-être pourquoi un protocole OIDC standard prend en charge à la fois les flux implicite et hybride, alors que le connecteur Logto ne prend en charge que le flux d'autorisation. Il a été déterminé que les flux implicite et hybride sont moins sécurisés que le flux d'autorisation. En raison de l'accent mis par Logto sur la sécurité, seul le flux d'autorisation est pris en charge pour offrir le plus haut niveau de sécurité à ses utilisateurs, malgré une commodité légèrement moindre.

`responseType` et `grantType` ne peuvent être que des valeurs FIXES avec le flux "Authorization Code", nous les rendons donc optionnels et les valeurs par défaut seront automatiquement renseignées.

:::note

Pour tous les types de flux, nous avons fourni une clé OPTIONNELLE `customConfig` pour y placer vos paramètres personnalisés.
Chaque fournisseur d'identité sociale peut avoir sa propre variante du protocole standard OIDC. Si votre fournisseur d'identité sociale respecte strictement le protocole standard OIDC, vous n'avez pas à vous soucier de `customConfig`.

:::

## Types de configuration \{#config-types}

| Nom                       | Type                      | Obligatoire |
| ------------------------- | ------------------------- | ----------- |
| scope                     | string                    | Oui         |
| clientId                  | string                    | Oui         |
| clientSecret              | string                    | Oui         |
| authorizationEndpoint     | string                    | Oui         |
| tokenEndpoint             | string                    | Oui         |
| idTokenVerificationConfig | IdTokenVerificationConfig | Oui         |
| authRequestOptionalConfig | AuthRequestOptionalConfig | Non         |
| customConfig              | Record\<string, string>   | Non         |

| Propriétés AuthRequestOptionalConfig | Type   | Obligatoire |
| ------------------------------------ | ------ | ----------- |
| responseType                         | string | Non         |
| tokenEndpoint                        | string | Non         |
| responseMode                         | string | Non         |
| display                              | string | Non         |
| prompt                               | string | Non         |
| maxAge                               | string | Non         |
| uiLocales                            | string | Non         |
| idTokenHint                          | string | Non         |
| loginHint                            | string | Non         |
| acrValues                            | string | Non         |

| Propriétés IdTokenVerificationConfig | Type                               | Obligatoire |
| ------------------------------------ | ---------------------------------- | ----------- |
| jwksUri                              | string                             | Oui         |
| issuer                               | string \| string[]                 | Non         |
| audience                             | string \| string[]                 | Non         |
| algorithms                           | string[]                           | Non         |
| clockTolerance                       | string \| number                   | Non         |
| crit                                 | Record\<string, string \| boolean> | Non         |
| currentDate                          | Date                               | Non         |
| maxTokenAge                          | string \| number                   | Non         |
| subject                              | string                             | Non         |
| typ                                  | string                             | Non         |

Voir [ici](https://github.com/panva/jose/blob/main/docs/jwt/verify/interfaces/JWTVerifyOptions.md) pour plus de détails sur `IdTokenVerificationConfig`.

## Paramètres généraux \{#general-settings}

Voici quelques paramètres généraux qui ne bloqueront pas la connexion à votre fournisseur d'identité mais peuvent affecter l'expérience d'authentification de l'utilisateur final.

### Nom et logo du bouton social \{#social-button-name-and-logo}

Si vous souhaitez afficher un bouton social sur votre page de connexion, vous pouvez définir le **nom** et le **logo** (mode sombre et mode clair) du fournisseur d'identité sociale. Cela aidera les utilisateurs à reconnaître l'option de connexion sociale.

### Nom du fournisseur d'identité \{#identity-provider-name}

Chaque connecteur social possède un nom unique de Fournisseur d’identité (IdP) pour différencier les identités utilisateur. Alors que les connecteurs courants utilisent un nom d'IdP fixe, les connecteurs personnalisés nécessitent une valeur unique. En savoir plus sur les [noms d’IdP](https://docs.logto.io/connectors/connector-data-structure#target-identity-provider-name) pour plus de détails.

### Synchroniser les informations de profil \{#sync-profile-information}

Dans le connecteur OIDC, vous pouvez définir la politique de synchronisation des informations de profil, telles que les noms d'utilisateur et les avatars. Choisissez parmi :

- **Synchroniser uniquement lors de l'inscription** : Les informations de profil sont récupérées une seule fois lors de la première connexion de l'utilisateur.
- **Toujours synchroniser à la connexion** : Les informations de profil sont mises à jour à chaque connexion de l'utilisateur.

### Stocker les jetons pour accéder aux API tierces (Optionnel) \{#store-tokens-to-access-third-party-apis-optional}

Si vous souhaitez accéder aux API du fournisseur d'identité et effectuer des actions avec l'autorisation de l'utilisateur (que ce soit via la connexion sociale ou la liaison de compte), Logto doit obtenir des portées API spécifiques et stocker les jetons.

1. Ajoutez les portées requises dans le champ **scope** en suivant les instructions ci-dessus
2. Activez **Stocker les jetons pour un accès API persistant** dans le connecteur OIDC de Logto. Logto stockera en toute sécurité les jetons d’accès dans le Secret Vault.
3. Pour les fournisseurs d'identité OAuth/OIDC **standards**, la portée `offline_access` doit être incluse pour obtenir un jeton de rafraîchissement, évitant ainsi les demandes répétées de consentement utilisateur.

:::warning
Gardez votre secret client en sécurité et ne l'exposez jamais dans le code côté client. En cas de compromission, générez-en un nouveau immédiatement dans les paramètres de l'application de votre fournisseur d'identité.
:::

## Utiliser le connecteur OIDC \{#utilize-the-oidc-connector}

Une fois que vous avez créé un connecteur OIDC et que vous l'avez connecté à votre fournisseur d'identité, vous pouvez l'intégrer dans vos flux utilisateur finaux. Choisissez les options qui correspondent à vos besoins :

### Activer le bouton de connexion sociale \{#enable-social-sign-in-button}

1. Dans Logto Console, allez dans <CloudLink to="/sign-in-experience/sign-up-and-sign-in">Expérience de connexion > Inscription et connexion</CloudLink>.
2. Ajoutez le connecteur OIDC dans la section **Connexion sociale** pour permettre aux utilisateurs de s'authentifier avec votre fournisseur d'identité.

En savoir plus sur [l'expérience de connexion sociale](https://docs.logto.io/end-user-flows/sign-up-and-sign-in/social-sign-in).

### Lier ou délier un compte social \{#link-or-unlink-a-social-account}

Utilisez l’Account API pour créer un Centre de compte personnalisé dans votre application permettant aux utilisateurs connectés de lier ou délier leurs comptes sociaux. [Suivez le tutoriel Account API](https://docs.logto.io/end-user-flows/account-settings/by-account-api#link-a-new-social-connection)

:::tip
Il est possible d'activer le connecteur OIDC uniquement pour la liaison de compte et l'accès API, sans l'activer pour la connexion sociale.
:::

### Accéder aux API du fournisseur d'identité et effectuer des actions \{#access-identity-provider-apis-and-perform-actions}

Votre application peut récupérer les jetons d’accès stockés dans le Secret Vault pour appeler les API de votre fournisseur d'identité et automatiser des tâches backend. Les capacités spécifiques dépendent de votre fournisseur d'identité et des portées que vous avez demandées. Reportez-vous au guide sur la récupération des jetons stockés pour l'accès API.

## Gérer l'identité sociale de l'utilisateur \{#manage-user-s-social-identity}

Après qu'un utilisateur a lié son compte social, les administrateurs peuvent gérer cette connexion dans la Logto Console :

1. Accédez à <CloudLink to="/users">Logto console > Gestion des utilisateurs</CloudLink> et ouvrez le profil de l'utilisateur.
2. Sous **Connexions sociales**, localisez l'élément du fournisseur d'identité et cliquez sur **Gérer**.
3. Sur cette page, les administrateurs peuvent gérer la connexion sociale de l'utilisateur, voir toutes les informations de profil accordées et synchronisées depuis son compte social, et vérifier le statut du jeton d’accès.

:::note
Quelques réponses de jeton d’accès du fournisseur d'identité ne contiennent pas l'information de scope spécifique, donc Logto ne peut pas afficher directement la liste des permissions accordées par l'utilisateur. Cependant, tant que l'utilisateur a consenti aux portées demandées lors de l'autorisation, votre application disposera des permissions correspondantes lors de l'accès à l'API OIDC.
:::
