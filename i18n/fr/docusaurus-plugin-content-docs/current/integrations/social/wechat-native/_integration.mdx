## Cr√©er une application mobile sur la plateforme ouverte WeChat \{#create-a-mobile-app-in-the-wechat-open-platform}

:::tip

Vous pouvez passer certaines sections si vous les avez d√©j√† termin√©es.

:::

### Cr√©er un compte \{#create-an-account}

Ouvrez https://open.weixin.qq.com/, cliquez sur le bouton "Sign Up" en haut √† droite, puis terminez le processus d'inscription.

### Cr√©er une application mobile \{#create-a-mobile-app}

Connectez-vous avec le compte que vous venez de cr√©er. Dans l'onglet "Mobile Application" (ÁßªÂä®Â∫îÁî®), cliquez sur le gros bouton vert "Create a mobile app" (ÂàõÂª∫ÁßªÂä®Â∫îÁî®).

<img src="/img/assets/app-tabs.png" alt="Onglets de l'application" />

Remplissons les informations requises dans le formulaire de candidature.

<img src="/img/assets/create-mobile-app.png" alt="Cr√©er une application mobile" />

#### Informations de base \{#basic-info}

La plupart sont assez simples, et nous avons quelques conseils ici :

- Si vous souhaitez simplement tester la connexion WeChat et que l'application n'est pas sur l'App Store, dans la section "App is available", choisissez "No" pour ignorer le "App download link".
- Le "App operation flow chart" semble compliqu√©. D'apr√®s notre exp√©rience, vous devez pr√©parer un simple organigramme et plusieurs captures d'√©cran de l'application pour augmenter les chances de passer la validation.

Cliquez sur "Next step" pour continuer.

#### Informations sur la plateforme \{#platform-info}

Vous pouvez configurer une ou les deux plateformes iOS et Android pour int√©grer Logto avec la connexion native WeChat.

**Application iOS**

Cochez "iOS app" (iOS Â∫îÁî®), puis cochez le type d'appareil cible de votre application en cons√©quence.

<img src="/img/assets/platform.png" alt="Plateforme de l'application" />

Si vous avez choisi "No" pour la disponibilit√© sur l'App Store, vous pouvez ignorer le champ "AppStore download address" ici.

Renseignez _Bundle ID_, _Test version Bundle ID_ et _Universal Links_ (en r√©alit√©, un seul lien suffit üòÇ).

:::note

_Bundle ID_ et _Test version Bundle ID_ peuvent avoir la m√™me valeur.

:::

:::tip

WeChat exige un universal link pour la connexion native. Si vous ne l'avez pas configur√© ou ne savez pas ce que c'est, veuillez consulter la [documentation officielle Apple](https://developer.apple.com/ios/universal-links/).

:::

**Application Android**

Cochez "Android app" (Android Â∫îÁî®).

<img src="/img/assets/platform-android-app.png" alt="Plateforme application Android" />

Renseignez _Application Signing Signature_ (Â∫îÁî®Á≠æÂêç) et _Application Package Name_ (Â∫îÁî®ÂåÖÂêç).

:::note

Vous devez signer votre application pour obtenir une signature. Consultez [Signer votre application](https://developer.android.com/studio/publish/app-signing) pour plus d'informations.

:::

Apr√®s avoir termin√© la signature, vous pouvez ex√©cuter la t√¢che `signingReport` pour obtenir la signature.

```bash
./gradlew your-android-project:signingReport
```

La valeur `MD5` du rapport de la variante de build correspondante sera la _Application Signing Signature_ (Â∫îÁî®Á≠æÂêç), mais n'oubliez pas de retirer tous les points-virgules de la valeur et de la mettre en minuscules.

Ex. `1A:2B:3C:4D` -> `1a2b3c4d`.

#### En attente du r√©sultat de la validation \{#waiting-for-the-review-result}

Apr√®s avoir compl√©t√© les informations sur la plateforme, cliquez sur "Submit Review" pour continuer. En g√©n√©ral, la validation est rapide, elle se termine en 1 √† 2 jours.

Nous pensons que le r√©viseur est attribu√© al√©atoirement √† chaque soumission car le standard varie. Vous pouvez √™tre refus√© la premi√®re fois, mais ne baissez pas les bras ! Expliquez votre situation et demandez au r√©viseur comment la modifier.

## Activer la connexion native WeChat dans votre application \{#enable-wechat-native-sign-in-in-your-app}

### iOS \{#ios}

Nous supposons que vous avez int√©gr√© le <MainSiteUrl href="/quick-starts/swift">Logto iOS SDK</MainSiteUrl> dans votre application. Dans ce cas, les choses sont assez simples, et vous n'avez m√™me pas besoin de lire la documentation du SDK WeChat :

**1. Configurez l'universal link et le sch√©ma d'URL dans votre projet Xcode**

Dans le projet Xcode -> onglet Signing & Capabilities, ajoutez la capacit√© "Associated Domains" et l'universal link que vous avez configur√© pr√©c√©demment.

<img src="/img/assets/universal-link.png" alt="Universal link" />

Allez ensuite dans l'onglet "Info", ajoutez un [sch√©ma d'URL personnalis√©](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) avec l'App ID WeChat.

<img src="/img/assets/custom-url-scheme.png" alt="Sch√©ma d'URL personnalis√©" />

Enfin, ouvrez votre `Info.plist`, ajoutez `weixinULAPI` et `weixin` sous `LSApplicationQueriesSchemes`.

<img src="/img/assets/plist.png" alt="Plist" />

:::note

Nous savons que ces actions ne sont pas tr√®s logiques, mais c'est la solution minimale fonctionnelle que nous avons trouv√©e. Consultez le [guide officiel magique](https://developers.weixin.qq.com/doc/oplatform/en/Mobile_App/Access_Guide/iOS.html) pour plus d'informations.

:::

**2. Ajoutez `LogtoSocialPluginWechat` √† votre projet Xcode**

Ajoutez le framework :

<img src="/img/assets/add-framework.png" alt="Ajouter le framework" />

Et ajoutez `-ObjC` dans vos param√®tres de build > Linking > Other Linker Flags :

<img src="/img/assets/linker-flags.png" alt="Linker flags" />

:::note

Le plugin inclut WeChat Open SDK 1.9.2. Vous pouvez directement utiliser `import WechatOpenSDK` une fois le plugin import√©.

:::

**3. Ajoutez le plugin dans les options d'initialisation de votre `LogtoClient`**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginWechat()]
)
```

**4. G√©rez correctement `onOpenURL`**

:::note

La fonction `LogtoClient.handle(url:)` g√©rera tous les connecteurs natifs que vous avez activ√©s. Vous devez simplement l'appeler une seule fois.

:::

```swift
// SwiftUI
YourRootView()
  .onOpenURL { url in
      LogtoClient.handle(url: url)
  }

// ou AppDelegate
func application(_ app: UIApplication, open url: URL, options: /*...*/) -> Bool {
  LogtoClient.handle(url: url)
}
```

### Android \{#android}

Nous supposons que vous avez int√©gr√© le <MainSiteUrl href="/quick-starts/android">Logto Android SDK</MainSiteUrl> dans votre application. Dans ce cas, les choses sont assez simples, et vous n'avez m√™me pas besoin de lire la documentation du SDK WeChat :

**1. Ajoutez `Wechat Open SDK` √† votre projet**

Assurez-vous que le d√©p√¥t `mavenCentral()` est dans les repositories de votre projet Gradle :

```kotlin
repositories {
  // ...
  mavenCentral()
}
```

Ajoutez le Wechat Open SDK √† vos d√©pendances :

```kotlin
dependencies {
  // ...
  api("com.tencent.mm.opensdk:wechat-sdk-android:6.8.0")  // kotlin-script
  // ou
  api 'com.tencent.mm.opensdk:wechat-sdk-android:6.8.0'   // groovy-script
}
```

**2. Ajoutez `WXEntryActivity` √† votre projet**

Cr√©ez un package `wxapi` sous la racine de votre package et ajoutez la classe `WXEntryActivity` dans le package `wxapi` (Prenons `com.sample.app` comme exemple) :

```kotlin
// WXEntryActivity.kt
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

class WXEntryActivity: WechatSocialResultActivity()
```

```java
// WXEntryActivity.java
package com.sample.app.wxapi

import io.logto.sdk.android.auth.social.wechat.WechatSocialResultActivity

public class WXEntryActivity extends WechatSocialResultActivity {}
```

La position finale de `WXEntryActivity` dans le projet devrait ressembler √† ceci (exemple en Kotlin) :

```bash
src/main/kotlin/com/sample/app/wxapi/WXEntryActivity.kt
```

**3. Modifiez le `AndroidManifest.xml`**

Ajoutez la ligne suivante √† votre `AndroidManifest.xml` :

```xml
\<?xml version="1.0" encoding="utf-8"?>
\<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="com.sample.app">

  \<application>
    \<!-- ligne √† ajouter -->
    \<activity android:name=".wxapi.WXEntryActivity" android:exported="true"/>
  \</application>

\</manifest>
```
