## Créez votre application OAuth \{#create-your-oauth-app}

Lorsque vous ouvrez cette page, nous supposons que vous savez déjà quel fournisseur d'identité sociale vous souhaitez connecter. La première chose à faire est de confirmer que le fournisseur d'identité prend en charge le protocole OAuth, ce qui est une condition préalable pour configurer un connecteur valide. Ensuite, suivez les instructions du fournisseur d'identité pour enregistrer et créer l'application correspondante pour l'autorisation OAuth.

## Configurez votre connecteur \{#configure-your-connector}

Nous prenons UNIQUEMENT en charge le type de flux "Authorization Code" pour des raisons de sécurité, et il s'adapte parfaitement au scénario de Logto.

`clientId` et `clientSecret` se trouvent sur la page de détails de votre application OAuth.

_clientId_ : L'identifiant client est un identifiant unique qui identifie l'application cliente lors de l'enregistrement auprès du serveur d'autorisation. Cet identifiant est utilisé par le serveur d'autorisation pour vérifier l'identité de l'application cliente et associer tout jeton d’accès autorisé à cette application cliente spécifique.

_clientSecret_ : Le secret client est une clé confidentielle délivrée à l'application cliente par le serveur d'autorisation lors de l'enregistrement. L'application cliente utilise cette clé secrète pour s'authentifier auprès du serveur d'autorisation lors de la demande de jetons d’accès. Le secret client est considéré comme une information confidentielle et doit être conservé en sécurité en tout temps.

_tokenEndpointAuthMethod_ : La méthode d'authentification du point de terminaison du jeton est utilisée par l'application cliente pour s'authentifier auprès du serveur d'autorisation lors de la demande de jetons d’accès. Pour découvrir les méthodes prises en charge, consultez le champ `token_endpoint_auth_methods_supported` disponible sur le point de terminaison de découverte OpenID Connect du fournisseur de service OAuth 2.0, ou référez-vous à la documentation pertinente fournie par le fournisseur de service OAuth 2.0.

_clientSecretJwtSigningAlgorithm (Optionnel)_ : Nécessaire uniquement lorsque `tokenEndpointAuthMethod` est `client_secret_jwt`. L'algorithme de signature JWT du secret client est utilisé par l'application cliente pour signer le JWT envoyé au serveur d'autorisation lors de la demande de jeton.

_scope_ : Le paramètre scope est utilisé pour spécifier l'ensemble des ressources et permissions que l'application cliente demande à accéder. Le paramètre scope est généralement défini comme une liste de valeurs séparées par des espaces représentant des permissions spécifiques. Par exemple, une valeur de scope "read write" peut indiquer que l'application cliente demande un accès en lecture et écriture aux données d'un utilisateur.

Vous êtes censé trouver `authorizationEndpoint`, `tokenEndpoint` et `userInfoEndpoint` dans la documentation du fournisseur social.

_authenticationEndpoint_ : Ce point de terminaison est utilisé pour initier le processus d'authentification. Le processus d'authentification implique généralement que l'utilisateur se connecte et accorde l'autorisation à l'application cliente d'accéder à ses ressources.

_tokenEndpoint_ : Ce point de terminaison est utilisé par l'application cliente pour obtenir un jeton d’accès qui peut être utilisé pour accéder aux ressources demandées. L'application cliente envoie généralement une requête au point de terminaison du jeton avec un type de flux et un code d'autorisation pour recevoir un jeton d’accès.

_userInfoEndpoint_ : Ce point de terminaison est utilisé par l'application cliente pour obtenir des informations supplémentaires sur l'utilisateur, telles que son nom complet, son adresse e-mail ou sa photo de profil. Le point de terminaison user info est généralement accessible après que l'application cliente a obtenu un jeton d’accès depuis le point de terminaison du jeton.

Logto fournit également un champ `profileMap` que les utilisateurs peuvent personnaliser pour la correspondance des profils des fournisseurs sociaux, qui ne sont généralement pas standardisés. Les clés sont les noms de champs de profil utilisateur standard de Logto et les valeurs correspondantes doivent être les noms de champs des profils sociaux. À ce stade, Logto ne prend en compte que 'id', 'name', 'avatar', 'email' et 'phone' du profil social, seul 'id' est requis et les autres sont des champs optionnels.

`responseType` et `grantType` ne peuvent être que des valeurs FIXES avec le flux authorization code, donc nous les rendons optionnels et les valeurs par défaut seront automatiquement renseignées.

Par exemple, vous pouvez trouver [la réponse du profil utilisateur Google](https://developers.google.com/identity/openid-connect/openid-connect#an-id-tokens-payload) et donc son `profileMap` devrait ressembler à ceci :

```json
{
  "id": "sub",
  "avatar": "picture"
}
```

:::note

Nous avons fourni une clé `customConfig` OPTIONNELLE pour y placer vos paramètres personnalisés.
Chaque fournisseur d'identité sociale peut avoir sa propre variante du protocole standard OAuth. Si votre fournisseur d'identité sociale respecte strictement le protocole standard OAuth, alors vous n'avez pas à vous soucier de `customConfig`.

:::

## Types de configuration \{#config-types}

| Nom                       | Type                    | Requis |
| ------------------------- | ----------------------- | ------ |
| authorizationEndpoint     | string                  | true   |
| userInfoEndpoint          | string                  | true   |
| clientId                  | string                  | true   |
| clientSecret              | string                  | true   |
| tokenEndpointResponseType | enum                    | false  |
| responseType              | string                  | false  |
| grantType                 | string                  | false  |
| tokenEndpoint             | string                  | false  |
| scope                     | string                  | false  |
| customConfig              | Record\<string, string> | false  |
| profileMap                | ProfileMap              | false  |

| Champs ProfileMap | Type   | Requis | Valeur par défaut |
| ----------------- | ------ | ------ | ----------------- |
| id                | string | false  | id                |
| name              | string | false  | name              |
| avatar            | string | false  | avatar            |
| email             | string | false  | email             |
| phone             | string | false  | phone             |

## Paramètres généraux \{#general-settings}

Voici quelques paramètres généraux qui ne bloqueront pas la connexion à votre fournisseur d'identité mais peuvent affecter l'expérience d'authentification de l'utilisateur final.

### Nom et logo du bouton social \{#social-button-name-and-logo}

Si vous souhaitez afficher un bouton social sur votre page de connexion, vous pouvez définir le **nom** et le **logo** (mode sombre et mode clair) du fournisseur d'identité sociale. Cela aidera les utilisateurs à reconnaître l'option de connexion sociale.

### Nom du fournisseur d'identité \{#identity-provider-name}

Chaque connecteur social possède un nom unique de fournisseur d'identité (IdP) pour différencier les identités des utilisateurs. Alors que les connecteurs courants utilisent un nom IdP fixe, les connecteurs personnalisés nécessitent une valeur unique. En savoir plus sur les [noms IdP](https://docs.logto.io/connectors/connector-data-structure#target-identity-provider-name) pour plus de détails.

### Synchroniser les informations de profil \{#sync-profile-information}

Dans le connecteur OAuth, vous pouvez définir la politique de synchronisation des informations de profil, telles que les noms d'utilisateur et les avatars. Choisissez parmi :

- **Synchroniser uniquement lors de l'inscription** : Les informations de profil sont récupérées une seule fois lors de la première connexion de l'utilisateur.
- **Toujours synchroniser à la connexion** : Les informations de profil sont mises à jour à chaque connexion de l'utilisateur.

### Stocker les jetons pour accéder aux API tierces (Optionnel) \{#store-tokens-to-access-third-party-apis-optional}

Si vous souhaitez accéder aux API du fournisseur d'identité et effectuer des actions avec l'autorisation de l'utilisateur (que ce soit via la connexion sociale ou la liaison de compte), Logto doit obtenir des portées API spécifiques et stocker les jetons.

1. Ajoutez les portées requises dans le champ **scope** en suivant les instructions ci-dessus
2. Activez **Stocker les jetons pour un accès API persistant** dans le connecteur OAuth de Logto. Logto stockera en toute sécurité les jetons d’accès dans le Secret Vault.
3. Pour les fournisseurs d'identité OAuth/OIDC **standards**, la portée `offline_access` doit être incluse pour obtenir un jeton de rafraîchissement, évitant ainsi de demander à nouveau le consentement de l'utilisateur.

:::warning
Gardez votre secret client en sécurité et ne l'exposez jamais dans le code côté client. En cas de compromission, générez-en un nouveau immédiatement dans les paramètres de l'application de votre fournisseur d'identité.
:::

## Utiliser le connecteur OAuth \{#utilize-the-oauth-connector}

Une fois que vous avez créé un connecteur OAuth et que vous l'avez connecté à votre fournisseur d'identité, vous pouvez l'intégrer dans vos flux utilisateurs finaux. Choisissez les options qui correspondent à vos besoins :

### Activer le bouton de connexion sociale \{#enable-social-sign-in-button}

1. Dans la Console Logto, allez dans <CloudLink to="/sign-in-experience/sign-up-and-sign-in">Expérience de connexion > Inscription et connexion</CloudLink>.
2. Ajoutez le connecteur OAuth dans la section **Connexion sociale** pour permettre aux utilisateurs de s'authentifier avec votre fournisseur d'identité.

En savoir plus sur [l'expérience de connexion sociale](https://docs.logto.io/end-user-flows/sign-up-and-sign-in/social-sign-in).

### Lier ou délier un compte social \{#link-or-unlink-a-social-account}

Utilisez l’Account API pour créer un Centre de compte personnalisé dans votre application permettant aux utilisateurs connectés de lier ou délier leurs comptes sociaux. [Suivez le tutoriel Account API](https://docs.logto.io/end-user-flows/account-settings/by-account-api#link-a-new-social-connection)

:::tip
Il est possible d'activer le connecteur OAuth uniquement pour la liaison de compte et l'accès API, sans l'activer pour la connexion sociale.
:::

### Accéder aux API du fournisseur d'identité et effectuer des actions \{#access-identity-provider-apis-and-perform-actions}

Votre application peut récupérer les jetons d’accès stockés dans le Secret Vault pour appeler les API de votre fournisseur d'identité et automatiser des tâches backend. Les capacités spécifiques dépendent de votre fournisseur d'identité et des portées que vous avez demandées. Reportez-vous au guide sur la récupération des jetons stockés pour l'accès API.

## Gérer l'identité sociale de l'utilisateur \{#manage-user-s-social-identity}

Après qu'un utilisateur a lié son compte social, les administrateurs peuvent gérer cette connexion dans la Console Logto :

1. Accédez à <CloudLink to="/users">Console Logto > Gestion des utilisateurs</CloudLink> et ouvrez le profil de l'utilisateur.
2. Sous **Connexions sociales**, localisez l'élément du fournisseur d'identité et cliquez sur **Gérer**.
3. Sur cette page, les administrateurs peuvent gérer la connexion sociale de l'utilisateur, voir toutes les informations de profil accordées et synchronisées depuis son compte social, et vérifier le statut du jeton d’accès.

:::note
Quelques réponses de jeton d’accès de fournisseur d'identité ne contiennent pas l'information de portée spécifique, donc Logto ne peut pas afficher directement la liste des permissions accordées par l'utilisateur. Cependant, tant que l'utilisateur a consenti aux portées demandées lors de l'autorisation, votre application disposera des permissions correspondantes lors de l'accès à l'API OAuth.
:::
