Les portées (Scopes) définissent les permissions que votre application demande aux utilisateurs et contrôlent à quelles données votre application peut accéder depuis leurs comptes Microsoft Entra ID. La demande de permissions Microsoft Graph nécessite une configuration des deux côtés :

**Dans le centre d'administration Microsoft Entra :**

1. Accédez à **Microsoft Entra ID > Enregistrements d'applications** et sélectionnez votre application.
2. Allez dans **Permissions API > Ajouter une permission > Microsoft Graph > Permissions déléguées**.
3. Sélectionnez uniquement les permissions requises par votre application :
   - Permissions OpenID :
     - `openid` (Obligatoire) - Connecter les utilisateurs
     - `profile` (Obligatoire) - Voir le profil de base des utilisateurs
     - `email` (Obligatoire) - Voir l'adresse e-mail des utilisateurs
     - `offline_access` (Optionnel) - Nécessaire uniquement si vous activez [Stocker les jetons pour un accès API persistant](#step-4-store-tokens-to-access-microsoft-apis-optional) dans le connecteur Logto et que vous devez obtenir des jetons de rafraîchissement pour un accès longue durée aux API Microsoft Graph.
   - Accès API (Optionnel) : Ajoutez toutes les permissions supplémentaires nécessaires à votre application. Les permissions courantes de Microsoft Graph incluent `Mail.Read`, `Calendars.Read`, `Files.Read`, etc. Parcourez la [référence des permissions Microsoft Graph](https://docs.microsoft.com/en-us/graph/permissions-reference) pour trouver les permissions disponibles.
4. Cliquez sur **Ajouter des permissions** pour confirmer la sélection.
5. Si votre application nécessite un consentement administrateur pour certaines permissions, cliquez sur **Accorder le consentement administrateur pour [Votre organisation]**.

<center>
  <img
    src="/img/assets/entra_id_oidc_add_api_permissions.webp"
    alt="Ajouter des permissions API Microsoft"
  />
</center>

**Dans le connecteur Logto Microsoft Entra ID :**

1. Logto inclut automatiquement les portées `openid`, `profile` et `email` pour récupérer les informations d'identité de base de l'utilisateur. Vous pouvez laisser le champ `Scopes` vide si vous n'avez besoin que des informations de base de l'utilisateur.
2. Ajoutez `offline_access` au champ `Scopes` si vous prévoyez de stocker des jetons pour un accès API persistant. Cette portée permet d'obtenir des jetons de rafraîchissement pour un accès longue durée à l'API.
3. Ajoutez des portées supplémentaires (séparées par des espaces) dans le champ `Scopes` pour demander plus de données à Microsoft Graph. Utilisez les noms de portées standards, par exemple : `User.Read Mail.Read Calendars.Read`

:::tip

Si votre application demande ces portées pour accéder à l'API Microsoft Graph et effectuer des actions, assurez-vous d'activer **Stocker les jetons pour un accès API persistant** dans le connecteur Logto Microsoft Entra ID. Voir la section suivante pour plus de détails.

:::
