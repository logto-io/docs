---
slug: /quick-starts/next-app-router
sidebar_label: Next.js (App Router)
sidebar_custom_props:
  logoFilename: 'next.svg'
  darkLogoFilename: 'next-dark.svg'
  description: Next.js App Router est un nouveau paradigme pour construire des applications en utilisant les dernières fonctionnalités de React.
---

import ApiResourcesDescription from '../../fragments/_api-resources-description.md';
import FurtherReadings from '../../fragments/_further-readings.md';
import ExternalStorage from '../next/_external-storage.mdx';
import Installation from '../next/_installation.mdx';

import GetUserInformation from './_get-user-information.mdx';
import GuideTip from './_guide-tip.mdx';
import Integration from './_integration.mdx';
import ConfigApiResources from './api-resources/_config-api-resources.mdx';
import FetchAccessTokenForApiResources from './api-resources/_fetch-access-token-for-api-resources.mdx';
import FetchOrganizationTokenForUser from './api-resources/_fetch-organization-token-for-user.mdx';

# Ajoutez l’authentification à votre application Next.js (App Router)

<GuideTip />

## Prérequis \{#prerequisites}

- Un compte [Logto Cloud](https://cloud.logto.io) ou un [Logto auto-hébergé](/introduction/set-up-logto-oss).
- Une application traditionnelle Logto créée.

## Installation \{#installation}

<Installation />

## Intégration \{#integration}

<Integration />

## Récupérer les informations utilisateur \{#fetch-user-information}

<GetUserInformation />

## Ressources API \{#api-resources}

<ApiResourcesDescription />

### Configurer le client Logto \{#configure-logto-client}

<ConfigApiResources />

### Récupérer un jeton d’accès pour la ressource API \{#fetch-access-token-for-the-api-resource}

<FetchAccessTokenForApiResources />

Si vous avez besoin de récupérer un jeton d’accès dans le composant serveur, vous pouvez utiliser la fonction `getAccessTokenRSC` :

```tsx title="app/page.tsx"
// Importations et configuration identiques à l'exemple original
import { getAccessTokenRSC } from '@logto/next/server-actions';
import { logtoConfig } from './logto';

export default async function Home() {
  const accessToken = await getAccessTokenRSC(logtoConfig, 'https://shopping.your-app.com/api');

  return (
    <main>
      <p>Jeton d’accès : {accessToken}</p>
    </main>
  );
}
```

:::tip

HTTP n’autorise pas la définition de cookies après le début du streaming, `getAccessTokenRSC` ne peut donc pas mettre à jour la valeur du cookie. Ainsi, si le jeton d’accès est rafraîchi, il ne sera pas conservé dans la session. Il est recommandé d’utiliser la fonction `getAccessToken` côté client ou dans les gestionnaires de routes.

:::

### Récupérer des jetons d’organisation \{#fetch-organization-tokens}

<FetchOrganizationTokenForUser />

Si vous avez besoin de récupérer un jeton d’organisation dans le composant serveur, vous pouvez utiliser la fonction `getOrganizationTokenRSC` :

```tsx title="app/page.tsx"
// Importations et configuration identiques à l'exemple original
import { getOrganizationTokenRSC } from '@logto/next/server-actions';
import { logtoConfig } from './logto';

export default async function Home() {
  const token = await getOrganizationTokenRSC(logtoConfig, 'organization-id');

  return (
    <main>
      <p>Jeton d’organisation : {token}</p>
    </main>
  );
}
```

:::tip

HTTP n’autorise pas la définition de cookies après le début du streaming, `getOrganizationTokenRSC` ne peut donc pas mettre à jour la valeur du cookie. Ainsi, si le jeton d’accès est rafraîchi, il ne sera pas conservé dans la session. Il est recommandé d’utiliser la fonction `getOrganizationToken` côté client ou dans les gestionnaires de routes.

:::

## Utiliser un stockage de session externe \{#use-external-session-storage}

<ExternalStorage />

## Redirection automatique vers la connexion en cas d’accès non autorisé \{#automatic-sign-in-redirect\}

:::tip
Le helper `signIn` modifie les cookies pour établir la session de connexion, il ne peut donc pas être invoqué directement dans un React Server Component (RSC). Pour déclencher automatiquement la connexion lorsqu’un RSC détecte un utilisateur non autorisé, appelez `signIn` dans un gestionnaire de route dédié et redirigez vers cette route.
:::

```ts title="app/sign-in/route.ts"
// Importations et configuration identiques à l'exemple original
import { signIn } from '@logto/next/server-actions';
import { logtoConfig } from '../../logto';

export async function GET() {
  await signIn(logtoConfig);
}
```

```tsx title="app/protected/page.tsx"
// Importations et configuration identiques à l'exemple original
import { getLogtoContext } from '@logto/next/server-actions';
import { redirect } from 'next/navigation';
import { logtoConfig } from '../logto';

export default async function ProtectedPage() {
  const { isAuthenticated } = await getLogtoContext(logtoConfig);

  if (!isAuthenticated) {
    redirect('/sign-in');
  }

  return <div>Contenu protégé</div>;
}
```

## Pour aller plus loin \{#further-readings}

<FurtherReadings />
