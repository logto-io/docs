---
sidebar_position: 1
---

# Structure des données utilisateur

Les utilisateurs sont les entités principales du service d'identité. Dans Logto, ils incluent les données d'authentification de base basées sur le protocole [OpenID Connect](https://auth.wiki/openid-connect), ainsi que des données personnalisées.

## Profil utilisateur \{#user-profile}

Chaque utilisateur possède un profil contenant [toutes les informations utilisateur](#property-reference).

Il se compose des types de données suivants :

- [Données de base](/user-management/user-data#basic-data) : il s'agit des informations de base du profil utilisateur. Elles stockent toutes les autres propriétés de l’_utilisateur_ à l’exception des `identities` sociales et des `custom_data`, telles que l’identifiant utilisateur, le nom d’utilisateur, l’e-mail, le numéro de téléphone et la date de dernière connexion de l’utilisateur.
- [Identités sociales](/user-management/user-data#social-identities) : stocke les informations utilisateur récupérées lors de la connexion sociale (c’est-à-dire la connexion avec un connecteur social), telles que Facebook, GitHub et WeChat.
- [Données personnalisées](/user-management/user-data#custom-data) : stocke des informations utilisateur supplémentaires non listées dans les propriétés prédéfinies de l’utilisateur, telles que la couleur et la langue préférées de l’utilisateur.

Voici un exemple de données utilisateur récupérées lors d’une connexion à Facebook :

```json
{
  "id": "iHXPuSb9eMzt",
  "username": null,
  "primaryEmail": null,
  "primaryPhone": null,
  "name": "John Doe",
  "avatar": "https://example.com/avatar.png",
  "customData": {
    "preferences": {
      "language": "en",
      "color": "#f236c9"
    }
  },
  "identities": {
    "facebook": {
      "userId": "106077000000000",
      "details": {
        "id": "106077000000000",
        "name": "John Doe",
        "email": "johndoe@logto.io",
        "avatar": "https://example.com/avatar.png"
      }
    }
  },
  "lastSignInAt": 1655799453171,
  "applicationId": "admin_console"
}
```

Vous pouvez interroger le profil utilisateur via <CloudLink to="/users">Logto Console</CloudLink> ou Logto Management API, comme [`GET /api/users/:userId`](https://openapi.logto.io/operation/operation-getuser).

## Données de base \{#basic-data}

Passons en revue toutes les propriétés des _données de base_ de l’utilisateur.

### id \{#id}

_id_ est une clé unique générée automatiquement pour identifier l’utilisateur dans Logto.

### username \{#username}

_username_ est utilisé pour la connexion avec _username_ et mot de passe.

Sa valeur provient du nom d’utilisateur avec lequel l’utilisateur s’est inscrit pour la première fois. Elle peut être `null`. Sa valeur non nulle ne doit pas dépasser 128 caractères, ne contenir que des lettres, des chiffres et des underscores (`_`), et NE PAS commencer par un chiffre. Elle est sensible à la casse.

### primary_email \{#primary_email}

_primary_email_ est l’adresse e-mail de l’utilisateur, utilisée pour la connexion avec l’e-mail et le mot de passe / code de vérification.

Sa valeur provient généralement de l’adresse e-mail avec laquelle l’utilisateur s’est inscrit pour la première fois. Elle peut être `null`. Sa longueur maximale est de 128.

### primary_phone \{#primary_phone}

_primary_phone_ est le numéro de téléphone de l’utilisateur, utilisé pour la connexion avec le numéro de téléphone et le mot de passe / code de vérification reçu par SMS.

Sa valeur provient généralement du numéro de téléphone avec lequel l’utilisateur s’est inscrit pour la première fois. Elle peut être `null`. Sa valeur non nulle doit contenir des chiffres précédés de l’[indicatif téléphonique du pays](https://en.wikipedia.org/wiki/List_of_country_calling_codes) (sans le signe plus `+`).

### name \{#name}

_name_ est le nom complet de l’utilisateur. Sa longueur maximale est de 128.

### avatar \{#avatar}

_avatar_ est l’URL pointant vers l’image de l’avatar de l’utilisateur. Sa longueur maximale est de 2048.

Si l’utilisateur s’inscrit avec un connecteur social comme Google ou Facebook, sa valeur peut être récupérée à partir des informations sociales de l’utilisateur.

:::note

Cette propriété est mappée à la revendication `picture` dans la norme [OpenID Connect](https://openid.net/connect/).

:::

### profile \{#profile}

_profile_ stocke les [revendications standard](https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims) OpenID Connect supplémentaires qui ne sont pas incluses dans les propriétés de l’utilisateur.

Sa définition de type peut être trouvée dans [ce fichier](https://github.com/logto-io/logto/blob/HEAD/packages/schemas/src/foundations/jsonb-types/users.ts#L6). Voici une copie de la définition de type :

```tsx
type UserProfile = Partial<{
  familyName: string;
  givenName: string;
  middleName: string;
  nickname: string;
  preferredUsername: string;
  profile: string;
  website: string;
  gender: string;
  birthdate: string;
  zoneinfo: string;
  locale: string;
  address: Partial<{
    formatted: string;
    streetAddress: string;
    locality: string;
    region: string;
    postalCode: string;
    country: string;
  }>;
}>;
```

:::note

`Partial` signifie que toutes les propriétés sont optionnelles.

:::

Une différence par rapport aux autres revendications standard est que les propriétés dans `profile` ne seront incluses dans le [jeton d’identifiant (ID token)](https://auth.wiki/id-token) ou la réponse de l’endpoint userinfo que si leurs valeurs ne sont pas vides, tandis que les autres revendications standard retourneront `null` si les valeurs sont vides.

### application_id \{#application_id}

La valeur de _application_id_ provient de l’application à laquelle l’utilisateur s’est connecté pour la première fois. Elle peut être `null`.

### last_sign_in_at \{#last_sign_in_at}

_last_sign_in_at_ est l’horodatage avec le fuseau horaire de la dernière connexion de l’utilisateur.

### created_at \{#created_at}

_created_at_ est l’horodatage avec le fuseau horaire lors de l’inscription de l’utilisateur.

### updated_at \{#updated_at}

_updated_at_ est l’horodatage avec le fuseau horaire lors de la dernière mise à jour des informations du profil utilisateur.

### has_password \{#has_password}

_has_password_ est une valeur booléenne qui indique si l’utilisateur possède un mot de passe. Vous pouvez consulter et gérer ce statut, y compris définir ou réinitialiser le mot de passe sur la page de détail de <CloudLink to="/users">Console > Gestion des utilisateurs</CloudLink>.

### password_encrypted \{#password_encrypted}

_password_encrypted_ est utilisé pour stocker le mot de passe chiffré de l’utilisateur.

Sa valeur provient du mot de passe avec lequel l’utilisateur s’est inscrit pour la première fois. Elle peut être `null`. Si sa valeur est non nulle, son contenu original avant chiffrement doit comporter au moins six caractères.

### password_encryption_method \{#password_encryption_method}

_password_encryption_method_ est utilisé pour chiffrer le mot de passe de l’utilisateur. Sa valeur est initialisée lors de l’inscription de l’utilisateur avec un nom d’utilisateur et un mot de passe. Elle peut être `null`.

Logto utilise par défaut l’implémentation [node-argon2](https://github.com/ranisalt/node-argon2) d’[Argon2](https://en.wikipedia.org/wiki/Argon2) comme méthode de chiffrement ; voir la référence pour plus de détails si cela vous intéresse.

Exemple de _password_encrypted_ et _password_encryption_method_ pour un utilisateur dont le mot de passe est `123456` :

```json
{
  "password_encryption_method": "Argon2i",
  "password_encrypted": "$argon2i$v=19$m=4096,t=10,p=1$aZzrqpSX45DOo+9uEW6XVw$O4MdirF0mtuWWWz68eyNAt2u1FzzV3m3g00oIxmEr0U"
}
```

### is_suspended \{#is_suspended}

_is_suspended_ est une valeur booléenne qui indique si un utilisateur est suspendu ou non. La valeur peut être gérée en appelant la [Logto Management API](https://openapi.logto.io/operation/operation-updateuserissuspended) ou en utilisant Logto Console.

Une fois qu’un utilisateur est suspendu, les jetons de rafraîchissement préalablement accordés seront immédiatement révoqués et l’utilisateur ne pourra plus être authentifié par Logto.

### mfa_verification_factors \{#mfa_verification_factors}

_mfa_verification_factors_ est un tableau qui liste les méthodes d’[authentification multi-facteurs (MFA)](/end-user-flows/mfa) associées au compte de l’utilisateur. Les valeurs possibles incluent : _Totp_ (OTP via application d’authentification), _WebAuthn_ (Passkey), et _BackupCode_.

```tsx
mfaVerificationFactors: ("Totp" | "WebAuthn" | "BackupCode")[];
```

## Identités sociales \{#social-identities}

_identities_ contient les informations utilisateur récupérées lors de la [connexion sociale](/end-user-flows/sign-up-and-sign-in/social-sign-in) (c’est-à-dire la connexion avec un [connecteur social](/connectors/social-connectors)). Les _identities_ de chaque utilisateur sont stockées dans un objet JSON individuel.

Les informations utilisateur varient selon le fournisseur d’identité sociale (c’est-à-dire la plateforme de réseau social), et incluent généralement les éléments suivants :

- _target_ du fournisseur d’identité, tel que "facebook" ou "google"
- Identifiant unique de l’utilisateur pour ce fournisseur
- Nom de l’utilisateur
- E-mail vérifié de l’utilisateur
- Avatar de l’utilisateur

Le compte de l’utilisateur peut être lié à plusieurs fournisseurs d’identité sociale via la connexion sociale ; les informations utilisateur correspondantes récupérées auprès de ces fournisseurs seront stockées dans l’objet _identities_.

Exemple d’_identities_ pour un utilisateur connecté à la fois avec Google et Facebook :

```json
{
  "facebook": {
    "userId": "5110888888888888",
    "details": {
      "id": "5110888888888888",
      "name": "John Doe",
      "email": "johndoe@logto.io",
      "avatar": "https://example.com/avatar.png"
    }
  },
  "google": {
    "userId": "111000000000000000000",
    "details": {
      "id": "111000000000000000000",
      "name": "John Doe",
      "email": "johndoe@gmail.com",
      "avatar": "https://example.com/avatar.png"
    }
  }
}
```

## Identités SSO \{#sso-identities}

_sso_identities_ contient les informations utilisateur récupérées lors du [SSO d’entreprise](/end-user-flows/enterprise-sso) (c’est-à-dire connexion Single Sign-On avec un [connecteur d’entreprise](/connectors/enterprise-connectors)). Les _ssoIdentities_ de chaque utilisateur sont stockées dans un objet JSON individuel.

Les données synchronisées depuis le fournisseur d’identité SSO dépendent des portées configurées dans le connecteur d’entreprise à demander. Voici une copie de la définition de type TypeScript :

```ts
type SSOIdentity = {
  issuer: string;
  identityId: string;
  detail: JsonObject; // Voir https://github.com/withtyped/withtyped/blob/master/packages/server/src/types.ts#L12
};
```

## Données personnalisées \{#custom-data}

_custom_data_ stocke des informations utilisateur supplémentaires non listées dans les propriétés prédéfinies de l’utilisateur.

Vous pouvez utiliser _custom_data_ pour faire les choses suivantes :

- Enregistrer si des actions spécifiques ont été effectuées par l’utilisateur, comme avoir vu la page d’accueil.
- Stocker des données spécifiques à l’application dans le profil utilisateur, telles que la langue et l’apparence préférées de l’utilisateur par application.
- Maintenir d’autres données arbitraires liées à l’utilisateur.

Exemple de _custom_data_ pour un utilisateur administrateur dans Logto :

```json
{
  "adminConsolePreferences": {
    "language": "en",
    "appearanceMode": "system",
    "experienceNoticeConfirmed": true
  },
  "customDataFoo": {
    "foo": "foo"
  },
  "customDataBar": {
    "bar": "bar"
  }
}
```

Les _custom_data_ de chaque utilisateur sont stockées dans un objet JSON individuel.

:::note

NE METTEZ PAS de données sensibles dans _custom_data_.

:::

Les données personnalisées peuvent être accessibles via les [revendications personnalisées du jeton JWT](/developers/custom-token-claims) après la connexion de l’utilisateur, et les jetons JWT sont encodés en base64 (non chiffrés) et fréquemment transmis sur les réseaux, ce qui rend toute donnée sensible facilement exposée.

Vous pouvez récupérer un profil utilisateur contenant _custom_data_ via la [Management API](https://openapi.logto.io/operation/operation-listusercustomdata) et l’envoyer aux applications frontend ou aux services backend externes. Par conséquent, mettre des informations sensibles dans _custom_data_ peut entraîner des fuites de données.

Si vous souhaitez tout de même placer des informations sensibles dans _custom_data_, nous recommandons de les chiffrer au préalable. Chiffrez/déchiffrez-les uniquement dans une partie de confiance comme vos services backend, et évitez de le faire dans les applications frontend. Cela minimisera les pertes si les _custom_data_ de vos utilisateurs sont divulguées par erreur.

**Comment collecter et mettre à jour les données personnalisées utilisateur**

- Utilisez la fonctionnalité [Collecter le profil utilisateur](/end-user-flows/collect-user-profile) pour recueillir des données personnalisées lors de l’inscription de l’utilisateur.
- Utilisez l’[Account API](/end-user-flows/account-settings/by-account-api) pour implémenter le profil utilisateur ou les paramètres de compte côté utilisateur final.
  - Utilisez [`GET /api/my-account`](https://openapi.logto.io/operation/operation-getprofile) pour récupérer toutes les données utilisateur.
  - Utilisez [`PATCH /api/my-account`](https://openapi.logto.io/operation/operation-updateprofile) pour mettre à jour les _custom_data_ d’un utilisateur.
- Utilisez la [Management API](/user-management/manage-users/#manage-via-logto-management-api) pour la gestion des utilisateurs ou des flux personnalisés avancés :
  - Utilisez [`GET /api/users/{userId}`](https://openapi.logto.io/operation/operation-getuser) pour récupérer toutes les données utilisateur.
  - Utilisez [`PATCH /api/users/{userId}/custom-data`](https://openapi.logto.io/operation/operation-updateusercustomdata) pour mettre à jour les _custom_data_ d’un utilisateur.
- Votre équipe support peut directement mettre à jour les _custom_data_ utilisateur dans <CloudLink to="/users">Console > Gestion des utilisateurs</CloudLink>. En savoir plus sur [la consultation et la mise à jour des profils utilisateur](/user-management/manage-users/#view-and-update-the-user-profile).

Mettez à jour avec précaution. La mise à jour des _custom_data_ d’un utilisateur écrasera complètement son contenu original dans le stockage.

Par exemple, si votre entrée lors de l’appel de l’API de mise à jour _custom_data_ ressemble à ceci (supposons que le _custom_data_ original soit l’exemple de données précédent) :

```json
{
  "customDataBaz": {
    "baz": "baz"
  }
}
```

alors la nouvelle valeur de _custom_data_ après la mise à jour sera :

```json
{
  "customDataBaz": {
    "baz": "baz"
  }
}
```

C’est-à-dire que la valeur du champ mis à jour n’a rien à voir avec la valeur précédente.

## Référence des propriétés \{#property-reference}

Les colonnes suivantes de la table utilisateur en base de données (sauf _password_encrypted_ et _password_encryption_method_) sont visibles sur le profil utilisateur, ce qui signifie que vous pouvez les interroger via la [Management API](https://openapi.logto.io/operation/operation-getuser).

| Nom                                                                                 | Type      | Description                                                | Unique | Requis |
| ----------------------------------------------------------------------------------- | --------- | ---------------------------------------------------------- | ------ | ------ |
| [id](/user-management/user-data#id)                                                 | string    | Identifiant unique                                         | ✅     | ✅     |
| [username](/user-management/user-data#username)                                     | string    | Nom d’utilisateur pour la connexion                        | ✅     | ❌     |
| [primary_email](/user-management/user-data#primary_email)                           | string    | E-mail principal                                           | ✅     | ❌     |
| [primary_phone](/user-management/user-data#primary_phone)                           | string    | Numéro de téléphone principal                              | ✅     | ❌     |
| [name](/user-management/user-data#name)                                             | string    | Nom complet                                                | ❌     | ❌     |
| [avatar](/user-management/user-data#avatar)                                         | string    | URL de l’avatar de l’utilisateur                           | ❌     | ❌     |
| [profile](/user-management/user-data#profile)                                       | object    | Profil utilisateur                                         | ❌     | ✅     |
| [identities](/user-management/user-data#social-identities)                          | object    | Infos utilisateur issues de la connexion sociale           | ❌     | ✅     |
| [custom_data](/user-management/user-data#custom-data)                               | object    | Infos supplémentaires dans les propriétés personnalisables | ❌     | ✅     |
| [application_id](/user-management/user-data#application_id)                         | string    | ID de l’application à laquelle l’utilisateur s’est inscrit | ❌     | ✅     |
| [last_sign_in_at](/user-management/user-data#last_sign_in_at)                       | date time | Horodatage de la dernière connexion                        | ❌     | ✅     |
| [password_encrypted](/user-management/user-data#password_encrypted)                 | string    | Mot de passe chiffré                                       | ❌     | ❌     |
| [password_encryption_method](/user-management/user-data#password_encryption_method) | string    | Méthode de chiffrement du mot de passe                     | ❌     | ❌     |
| [is_suspended](/user-management/user-data#is_suspended)                             | bool      | Marque de suspension de l’utilisateur                      | ❌     | ✅     |
| [mfa_verifications](/user-management/user-data#mfa_verification_factors)            | object[]  | Facteurs de vérification MFA                               | ❌     | ✅     |

- **Unique** : Garantit l’[unicité](https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-UNIQUE-CONSTRAINTS) des valeurs saisies dans une propriété d’une table de base de données.
- **Requis** : Garantit que les valeurs saisies dans une propriété d’une table de base de données ne peuvent PAS être `null`.

## Ressources associées \{#related-resources}

<Url href="https://blog.logto.io/secure-hub-for-user-data/">
  Hub sécurisé pour les données utilisateur en mouvement
</Url>
