---
sidebar_position: 1
---

# ตั้งค่า MFA

## ตั้งค่าการยืนยันตัวตนหลายปัจจัย (MFA) ใน Logto \{#configure-mfa-settings-in-logto}

Logto มีตัวเลือกการตั้งค่า MFA ที่ยืดหยุ่นเพื่อตอบสนองความต้องการด้านความปลอดภัยที่แตกต่างกัน คุณสามารถตั้งค่า MFA ในระดับโกลบอลสำหรับผู้ใช้ทุกคน หรือเปิดใช้งานเป็นรายองค์กรสำหรับแอปพลิเคชันแบบหลายผู้เช่า (multi-tenant)

### การตั้งค่า MFA ระดับโกลบอล \{#global-mfa-configuration}

ทำตามขั้นตอนเหล่านี้เพื่อเปิดใช้งาน MFA ในขั้นตอนการลงชื่อเข้าใช้ของผู้ใช้ Logto:

1. ไปที่: <CloudLink to="/mfa">Console > Multi-factor auth</CloudLink>
2. เปิดใช้งานปัจจัยการยืนยันตัวตนที่รองรับสำหรับผู้ใช้ของคุณ
   1. ปัจจัยหลัก:
      - [Passkeys (WebAuthn)](/end-user-flows/mfa/webauthn): ตัวเลือกความปลอดภัยสูง เหมาะสำหรับผลิตภัณฑ์เว็บที่รองรับไบโอเมตริกซ์ของอุปกรณ์หรือกุญแจความปลอดภัย ฯลฯ เพื่อการปกป้องที่แข็งแกร่ง
      - [Authenticator App OTP](/end-user-flows/mfa/authenticator-app-otp): วิธีที่พบได้บ่อยและได้รับการยอมรับอย่างกว้างขวาง ใช้รหัสผ่านแบบใช้ครั้งเดียวตามเวลา (TOTP) ที่สร้างโดยแอปยืนยันตัวตน เช่น Google Authenticator หรือ Authy
      - [SMS verification](/end-user-flows/mfa/sms-mfa): วิธีที่สะดวก ส่งรหัสยืนยันแบบใช้ครั้งเดียวผ่าน SMS ไปยังหมายเลขโทรศัพท์ที่ลงทะเบียน เหมาะสำหรับผู้ใช้ที่ต้องการยืนยันตัวตนผ่านมือถือโดยไม่ต้องใช้แอปเพิ่มเติม
      - [Email verification](/end-user-flows/mfa/email-mfa): วิธีที่เข้าถึงได้ง่าย ส่งรหัสยืนยันแบบใช้ครั้งเดียวไปยังอีเมลที่ลงทะเบียน เหมาะกับผู้ใช้ทุกแพลตฟอร์มและอุปกรณ์
   2. ปัจจัยสำรอง:
      - [Backup codes](/end-user-flows/mfa/backup-codes): ใช้เป็นตัวเลือกสำรองเมื่อผู้ใช้ไม่สามารถยืนยันตัวตนด้วยปัจจัยหลักข้างต้น การเปิดใช้งานนี้ช่วยลดอุปสรรคในการเข้าถึงของผู้ใช้
3. เลือกว่าคุณต้องการเปิดใช้งาน **Require MFA** หรือไม่:
   - **Enable**: ผู้ใช้จะถูกบังคับให้ตั้งค่า MFA ในขั้นตอนการลงชื่อเข้าใช้และไม่สามารถข้ามได้ หากผู้ใช้ไม่ตั้งค่า MFA หรือทำการลบการตั้งค่า MFA จะไม่สามารถเข้าบัญชีได้จนกว่าจะตั้งค่า MFA ใหม่
   - **Disable**: ผู้ใช้สามารถข้ามขั้นตอนการตั้งค่า MFA ในขั้นตอนสมัครสมาชิกได้ และสามารถตั้งค่า MFA ภายหลังผ่านหน้าตั้งค่าบัญชีด้วยตนเอง [เรียนรู้เพิ่มเติม](/end-user-flows/account-settings/) เกี่ยวกับการสร้างหน้าตั้งค่าบัญชีผู้ใช้ และเลือกนโยบายสำหรับการแจ้งเตือนการตั้งค่า MFA ต่อไปนี้:
     - **Do not ask users to set up MFA**: จะไม่มีการแจ้งเตือนให้ผู้ใช้ตั้งค่า MFA ในขั้นตอนลงชื่อเข้าใช้
     - **Ask users to set up MFA during registration**: ผู้ใช้ใหม่จะถูกแจ้งให้ตั้งค่า MFA ระหว่างสมัครสมาชิก และผู้ใช้เดิมจะเห็นแจ้งเตือนนี้ในการลงชื่อเข้าใช้ครั้งถัดไป ผู้ใช้สามารถข้ามขั้นตอนนี้ได้ และจะไม่แสดงอีก
     - **Ask users to set up MFA on their sign-in after registration**: ผู้ใช้ใหม่จะถูกแจ้งให้ตั้งค่า MFA ในการลงชื่อเข้าใช้ครั้งที่สองหลังสมัครสมาชิก และผู้ใช้เดิมจะเห็นแจ้งเตือนนี้ในการลงชื่อเข้าใช้ครั้งถัดไป ผู้ใช้สามารถข้ามขั้นตอนนี้ได้ และจะไม่แสดงอีก

:::tip
หากคุณต้องการแจ้งเตือนผู้ใช้อีกครั้งหลังจากที่ข้ามการลงทะเบียน MFA ให้รีเซ็ตสถานะการข้ามของพวกเขาเพื่อให้หน้าตั้งค่าปรากฏในการลงชื่อเข้าใช้ครั้งถัดไป ผู้ดูแลระบบสามารถใช้ Management API (`PATCH /api/users/{userId}/logto-configs`) และนักพัฒนาที่สร้าง flow แบบ self-service สามารถเรียก Account API (`PATCH /api/my-account/logto-configs`) [Management API reference](https://openapi.logto.io/operation/operation-updateuserlogtoconfig) · [Account API reference](https://openapi.logto.io/operation/operation-updatelogtoconfig)
:::

<img src="/img/assets/configure-mfa.png" alt="MFA settings" />

### การตั้งค่า MFA ระดับองค์กร \{#organization-level-mfa-configuration}

สำหรับผลิตภัณฑ์ที่มีสถาปัตยกรรมแบบหลายผู้เช่าและรองรับ [องค์กร (Organizations)](/organizations) โดยส่วนใหญ่คุณไม่จำเป็นต้องบังคับใช้ MFA กับผู้ใช้ทุกคน แต่สามารถเปิดใช้งาน MFA เป็นรายองค์กรได้ เพื่อปรับแต่งตามความต้องการของลูกค้าแต่ละราย ดูวิธีเริ่มต้นได้ที่ [บังคับใช้ MFA สำหรับสมาชิกองค์กร](/organizations/organization-management#require-mfa-for-organization-members)

## กระบวนการใช้งาน MFA ของผู้ใช้ \{#mfa-user-flow}

### กระบวนการตั้งค่า MFA \{#mfa-set-up-flow}

เมื่อเปิดใช้งาน MFA แล้ว ผู้ใช้จะถูกแจ้งให้ตั้งค่า MFA ในขั้นตอนการลงชื่อเข้าใช้และสมัครสมาชิก ผู้ใช้สามารถเลือกข้ามขั้นตอนนี้ได้ก็ต่อเมื่อปิดใช้งานนโยบาย “Require MFA”

1. **เข้าสู่หน้าลงชื่อเข้าใช้หรือสมัครสมาชิก**: ผู้ใช้เข้าสู่หน้าลงชื่อเข้าใช้หรือสมัครสมาชิก
2. **ดำเนินการยืนยันตัวตนให้เสร็จสมบูรณ์**: ผู้ใช้ดำเนินการยืนยันตัวตนใน flow การลงชื่อเข้าใช้หรือสมัครสมาชิก
3. **ตั้งค่าปัจจัยหลักของ MFA**: ผู้ใช้จะถูกแจ้งให้ตั้งค่าปัจจัยหลักของ MFA (เช่น passkey, Authenticator app OTP, รหัส SMS หรือรหัสอีเมล)
   - หากเปิดใช้งานปัจจัยหลักหลายตัว ผู้ใช้สามารถเลือกตัวเลือกที่ต้องการได้
   - หากปัจจัยหลักตรงกับตัวระบุที่ใช้สมัคร (เช่น SMS หรืออีเมล) จะถือว่ายืนยันแล้ว ผู้ใช้สามารถข้ามขั้นตอนยืนยันและไปยังขั้นตอนถัดไปได้ทันที (เช่น “เพิ่มการยืนยัน 2 ขั้นตอนอื่น” หรือ “บันทึกปัจจัยสำรองของคุณ”)
   - หากปิดใช้งานนโยบาย “Require MFA” ผู้ใช้สามารถข้ามขั้นตอนนี้ได้โดยกดปุ่ม "ข้าม"
4. **ตั้งค่าปัจจัยสำรองของ MFA**: หากเปิดใช้งาน **Backup codes** ผู้ใช้จะถูกแจ้งให้บันทึก backup codes หลังตั้งค่าปัจจัยหลักสำเร็จ ระบบจะแสดง backup codes ที่สร้างอัตโนมัติให้ผู้ใช้ดาวน์โหลดและเก็บไว้อย่างปลอดภัย ผู้ใช้ต้องยืนยัน backup codes ด้วยตนเองเพื่อให้การตั้งค่า MFA เสร็จสมบูรณ์

<img src="/img/assets/link-mfa.png" alt="MFA set-up flow" />

### กระบวนการยืนยัน MFA \{#mfa-verification-flow}

ผู้ใช้ที่ตั้งค่า MFA แล้วจะถูกแจ้งให้ยืนยันตัวตนด้วยปัจจัย MFA ที่ตั้งค่าไว้ในขั้นตอนลงชื่อเข้าใช้ ปัจจัยที่ใช้ยืนยันขึ้นอยู่กับการตั้งค่า MFA ใน Logto และการตั้งค่าของผู้ใช้

- หากผู้ใช้ตั้งค่าเพียงปัจจัยเดียว จะต้องยืนยันปัจจัยนั้นโดยตรง
- หากผู้ใช้ตั้งค่าหลายปัจจัยสำหรับ 2FA ระบบจะนำเสนอทางเลือกการยืนยันตามลำดับความสำคัญดังนี้:
  - **Passkey priority**: หากผู้ใช้ตั้งค่า passkey จะถูกนำเสนอเป็นวิธีเริ่มต้น
  - **Last-used preference**: หากไม่มี passkey ระบบจะเลือกวิธีที่ผู้ใช้ใช้สำเร็จล่าสุด
  - **Selection list**: หากไม่เข้าเงื่อนไขข้างต้น หน้าการยืนยัน 2 ขั้นตอนจะแสดงวิธีที่ผูกไว้ทั้งหมดให้ผู้ใช้เลือก
  - ผู้ใช้สามารถคลิก "ลองวิธีอื่นเพื่อยืนยัน" เพื่อสลับวิธีการยืนยันได้ตลอดเวลา
- หากไม่มีปัจจัยหลักที่เปิดใช้งานเหลืออยู่ และเปิดใช้งาน backup code ผู้ใช้สามารถใช้ backup code แบบใช้ครั้งเดียวเพื่อยืนยันตัวตน

<img src="/img/assets/verify-mfa.png" alt="MFA verification flow" />

## การจัดการ MFA \{#mfa-management}

นอกเหนือจากการตั้งค่าเริ่มต้นในขั้นตอนลงชื่อเข้าใช้ / สมัครสมาชิก ผู้ใช้สามารถจัดการการตั้งค่า MFA ได้ด้วยตนเองผ่านศูนย์บัญชี (account center) เพื่อความยืดหยุ่นในการผูกหรือยกเลิกผูกปัจจัย MFA ตามต้องการ

### สร้างศูนย์บัญชี (Account Center) \{#building-an-account-center}

คุณสามารถสร้างศูนย์บัญชีที่ครบถ้วนโดยใช้ [Account API](/end-user-flows/account-settings/by-account-api) ของ Logto ซึ่งช่วยให้ผู้ใช้สามารถ:

- **ผูกปัจจัย MFA ใหม่**: เพิ่มแอปยืนยันตัวตน, passkey หรือสร้าง backup codes ใหม่
- **ยกเลิกผูกปัจจัย MFA ที่มีอยู่**: ลบวิธี MFA ที่ไม่ต้องการใช้งาน
- **ดูสถานะ MFA ปัจจุบัน**: ตรวจสอบว่าตั้งค่าปัจจัย MFA ใดไว้บ้าง

### แจ้งเตือนการตั้งค่า MFA หลังเข้าสู่ระบบ \{#post-login-mfa-setup-prompts}

สำหรับแอปที่ไม่บังคับใช้ MFA ในการสมัครสมาชิกครั้งแรก คุณสามารถสร้างการแจ้งเตือนอัจฉริยะเพื่อกระตุ้นให้ผู้ใช้ตั้งค่า MFA ได้ เช่น

- **Conditional prompts**: แนะนำการตั้งค่า MFA ตามพฤติกรรมหรือมูลค่าบัญชีของผู้ใช้
- **Security dashboards**: แสดงคะแนนความปลอดภัยที่เพิ่มขึ้นเมื่อเปิดใช้งาน MFA
- **Gradual onboarding**: นำเสนอการตั้งค่า MFA เป็นส่วนหนึ่งของ flow การเพิ่มความปลอดภัยแบบค่อยเป็นค่อยไป

เรียนรู้เพิ่มเติมเกี่ยวกับการใช้งานรูปแบบเหล่านี้ด้วย [Account API](/end-user-flows/account-settings/by-account-api)

### จัดการ MFA ของผู้ใช้ใน Console \{#manage-users-mfa-in-console}

ใน <CloudLink to="/user">Console > User management</CloudLink> ผู้ดูแลระบบสามารถจัดการการตั้งค่า MFA ของผู้ใช้ได้อย่างมีประสิทธิภาพ:

- **ดูสถานะ MFA ของผู้ใช้**: ตรวจสอบว่าผู้ใช้แต่ละคนเปิดใช้งานปัจจัย MFA ใดบ้าง
- **ลบ MFA ของผู้ใช้**: ลบปัจจัย MFA ทั้งหมดของผู้ใช้ ทำให้ต้องตั้งค่า MFA ใหม่

### คำถามที่พบบ่อย \{#faqs}

<details>
<summary>
### จะเกิดอะไรขึ้นเมื่อผู้ดูแลระบบลบปัจจัย MFA เดิมของผู้ใช้? \{#what-happens-when-administrators-remove-users-existing-mfa-factors}
</summary>
เมื่อผู้ดูแลระบบลบปัจจัย MFA หลักทั้งหมดของผู้ใช้ (passkey, authenticator app OTP, SMS หรืออีเมล) จะเกิดสถานการณ์ต่อไปนี้ในการลงชื่อเข้าใช้ครั้งถัดไปของผู้ใช้:

**สถานการณ์ที่ 1: ไม่มีปัจจัย MFA เหลืออยู่**

- หากไม่มีปัจจัย MFA ใด ๆ (รวมถึงไม่มี backup codes) และ [นโยบาย MFA](#global-mfa-configuration) กำหนดให้ต้องใช้ MFA ผู้ใช้จะสามารถลงชื่อเข้าใช้ได้โดยไม่ต้องยืนยัน MFA และจะถูกแจ้งให้ตั้งค่า MFA ใหม่ทันที

**สถานการณ์ที่ 2: ยังมี backup codes เหลืออยู่**

- หากยังมี backup codes ผู้ใช้ต้องยืนยันตัวตนด้วย backup code ก่อนในขั้นตอนลงชื่อเข้าใช้
- หลังจากยืนยัน backup code สำเร็จ ผู้ใช้จะถูกแจ้งให้ตั้งค่าปัจจัย MFA หลักใหม่
- ผู้ใช้จะสามารถข้ามขั้นตอนนี้ได้หรือไม่ขึ้นอยู่กับนโยบาย MFA ที่คุณตั้งค่าไว้
- วิธีนี้ช่วยป้องกันไม่ให้ผู้ใช้ถูกล็อกบัญชีเมื่อไม่มีปัจจัยหลักเหลืออยู่

 </details>
