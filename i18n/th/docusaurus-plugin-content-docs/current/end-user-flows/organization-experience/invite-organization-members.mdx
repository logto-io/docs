---
sidebar_position: 6
---

# เชิญสมาชิกองค์กร

ในแอปพลิเคชันแบบหลายผู้เช่า (multi-tenancy) ความต้องการที่พบบ่อยคือการเชิญสมาชิกเข้าสู่องค์กร คู่มือนี้จะแนะนำขั้นตอนและรายละเอียดทางเทคนิคในการนำฟีเจอร์นี้ไปใช้

## ภาพรวมของขั้นตอน \{#flow-overview}

กระบวนการโดยรวมแสดงในไดอะแกรมด้านล่าง:

```mermaid
sequenceDiagram
	Participant U as ผู้ใช้ปลายทาง
  Participant A as ผู้ดูแลองค์กร
  Participant C as แอปหลายองค์กรของคุณ
	Participant L as Logto

  A ->> C: กรอกอีเมลและบทบาทของผู้รับเชิญ
  C ->> L: สร้างคำเชิญองค์กรด้วย Management API
  L -->> C: ส่งคืน invitation ID
  C ->> C: สร้างลิงก์เชิญด้วย invitation ID
  C ->> L: ขอให้ส่งอีเมลเชิญพร้อมลิงก์เชิญ
  L -->> U: ส่งอีเมลเชิญพร้อมลิงก์เชิญ
  U ->> C: คลิกลิงก์เชิญและไปยังหน้า landing page ของคุณ,<br /> ยอมรับหรือปฏิเสธคำเชิญ
  C ->> L: อัปเดตสถานะคำเชิญด้วย Management API
```

## สร้างบทบาทองค์กร \{#create-organization-roles}

ก่อนเชิญสมาชิก ให้สร้างบทบาทองค์กร ดู [organization template](/authorization/organization-template) เพื่อเรียนรู้เพิ่มเติมเกี่ยวกับบทบาทและสิทธิ์ (permissions)

ในคู่มือนี้ เราจะสร้างบทบาทองค์กรทั่วไปสองแบบ: `admin` และ `member`

บทบาท `admin` มีสิทธิ์เข้าถึงทรัพยากรทั้งหมดในองค์กร ส่วนบทบาท `member` มีสิทธิ์จำกัด ตัวอย่างเช่น:

- บทบาท `admin`:
  - `read:data` - อ่านข้อมูลทรัพยากรทั้งหมดขององค์กร
  - `write:data` - เขียนข้อมูลทรัพยากรทั้งหมดขององค์กร
  - `delete:data` - ลบข้อมูลทรัพยากรทั้งหมดขององค์กร
  - `invite:member` - เชิญสมาชิกเข้าสู่องค์กร
  - `manage:member` - จัดการสมาชิกในองค์กร
  - `delete:member` - ลบสมาชิกออกจากองค์กร
- บทบาท `member`:
  - `read:data` - อ่านข้อมูลทรัพยากรทั้งหมดขององค์กร
  - `write:data` - เขียนข้อมูลทรัพยากรทั้งหมดขององค์กร
  - `invite:member` - เชิญสมาชิกเข้าสู่องค์กร

สามารถดำเนินการนี้ได้ง่าย ๆ ใน [Logto Console](https://cloud.logto.io/) หรือใช้ [Logto Management API](https://openapi.logto.io/operation/operation-createorganizationrole) เพื่อสร้างบทบาทองค์กรแบบโปรแกรม

## ตั้งค่าตัวเชื่อมต่ออีเมลของคุณ \{#configure-your-email-connector}

เนื่องจากการเชิญส่งผ่านอีเมล โปรดตรวจสอบให้แน่ใจว่า [ตัวเชื่อมต่ออีเมล](/connectors/email-connectors) ของคุณถูกตั้งค่าอย่างถูกต้อง ในการส่งคำเชิญ ให้ตั้งค่า [email template](/connectors/email-connectors/email-templates#email-template-types) โดยใช้ `usageType` เป็น `OrganizationInvitation` คุณสามารถใส่ตัวแปรองค์กร (เช่น ชื่อ, โลโก้) และผู้เชิญ (เช่น อีเมล, ชื่อ) [ตัวแปร](/connectors/email-connectors/email-templates#email-template-variables) ในเนื้อหา และปรับแต่ง [เทมเพลตภาษาท้องถิ่น](/connectors/email-connectors/email-templates#email-template-localization) ได้ตามต้องการ

ตัวอย่าง email template สำหรับ `OrganizationInvitation` มีดังนี้:

```json
{
  "subject": "ยินดีต้อนรับสู่องค์กรของฉัน",
  "content": "<p>เข้าร่วม {{organization.name}} ได้ที่ <a href=\"{{link}}\" target=\"_blank\">ลิงก์นี้</a>.</p>",
  "usageType": "OrganizationInvitation",
  "type": "text/html"
}
```

ตัวแปร `{{link}}` ในเนื้อหาอีเมลจะถูกแทนที่ด้วยลิงก์เชิญจริงเมื่อส่งอีเมล

:::note

บริการ “Logto email service” ที่มาพร้อม Logto Cloud ยังไม่รองรับ `OrganizationInvitation` ในขณะนี้ กรุณาตั้งค่าตัวเชื่อมต่ออีเมลของคุณเอง (เช่น SendGrid) และตั้งค่าเทมเพลต `OrganizationInvitation` แทน

:::

## จัดการคำเชิญด้วย Logto Management API \{#handle-invitations-with-logto-management-api}

:::note

หากคุณยังไม่ได้ตั้งค่า Logto Management API ดูรายละเอียดที่ [โต้ตอบกับ Management API](/integrate-logto/interact-with-management-api)

:::

### สร้างคำเชิญองค์กรด้วย Logto Management API \{#create-an-organization-invitation-with-logto-management-api}

มีชุด Management API ที่เกี่ยวข้องกับคำเชิญในฟีเจอร์องค์กร โดย API เหล่านี้ คุณสามารถ:

- `POST /api/organization-invitations`: สร้างคำเชิญองค์กรพร้อมกำหนดบทบาทองค์กร
- `POST /api/one-time-tokens`: สร้างโทเค็นใช้ครั้งเดียวสำหรับผู้รับเชิญเพื่อยืนยันตัวตนเมื่อยอมรับคำเชิญ [เรียนรู้เพิ่มเติม](/end-user-flows/one-time-token)
- `POST /api/organization-invitations/{id}/message`: ส่งคำเชิญองค์กรไปยังผู้รับเชิญทางอีเมล

:::note

payload รองรับ property `link` เพื่อให้คุณสร้างลิงก์เชิญเองโดยอิงจาก invitation ID ตัวอย่างเช่น:

:::

```json
{
  "link": "https://your-app.com/invitation/join?id=your-invitation-id&token=your-one-time-token&email=invitee-email"
}
```
