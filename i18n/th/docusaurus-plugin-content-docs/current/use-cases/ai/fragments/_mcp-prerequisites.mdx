import Mermaid from '@theme/Mermaid';

## ข้อกำหนดเบื้องต้น \{#prerequisites}

- [Logto Cloud](https://cloud.logto.io) (หรือแบบ self-hosted) เทนแนนต์
- สภาพแวดล้อม Node.js หรือ Python

### ทำความเข้าใจสถาปัตยกรรม \{#understanding-the-architecture}

- **เซิร์ฟเวอร์ MCP**: เซิร์ฟเวอร์ที่เปิดเผยเครื่องมือและทรัพยากรให้กับไคลเอนต์ MCP
- **ไคลเอนต์ MCP**: ไคลเอนต์ที่ใช้เริ่มต้นโฟลว์การยืนยันตัวตนและทดสอบการเชื่อมต่อ {<b>{props.isThirdParty ? 'AI agent ของบุคคลที่สามจะถูกใช้เป็นไคลเอนต์ในคู่มือนี้' : 'เราจะใช้ MCP Inspector เป็นไคลเอนต์ในคู่มือนี้'}</b>}
- **Logto**: ทำหน้าที่เป็นผู้ให้บริการ OpenID Connect (authorization server) และจัดการข้อมูลระบุตัวตนของผู้ใช้

ไดอะแกรมลำดับ (sequence diagram) ที่ไม่เป็นมาตรฐานนี้แสดงภาพรวมของกระบวนการทั้งหมด:

<Mermaid value={`sequenceDiagram
    participant Client as MCP Client<br/>${props.isThirdParty ? '(AI agent บุคคลที่สาม)' : '(MCP Inspector)'}
    participant Server as MCP Server
    participant Logto

    Server->>Logto: ขอรับการกำหนดค่า OpenID Connect
    Logto->>Server: ส่งคืนการกำหนดค่า
    Note over Server: แคชการกำหนดค่าไว้
    Client->>Server: ขอเข้าถึงเครื่องมือ
    Server->>Client: ยังไม่ได้รับการยืนยันตัวตน (401 Unauthorized)
    Client->>Server: ขอ OAuth 2.0 Authorization Server Metadata
    Note over Server: ในบริบทนี้ “การกำหนดค่า OpenID Connect” และ<br/>“OAuth 2.0 Authorization Server Metadata”<br/>หมายถึงสิ่งเดียวกัน
    Server->>Client: ส่งคืนการกำหนดค่า OpenID Connect ที่ดึงมาจาก Logto
    Client->>Logto: เปลี่ยนเส้นทางไปยัง Logto เพื่อยืนยันตัวตน
    Logto->>Logto: ผู้ใช้ยืนยันตัวตน
    ${props.isThirdParty ? 'Logto->>Logto: ผู้ใช้อนุญาต (consent) ขอบเขต<br/>ให้กับแอปบุคคลที่สาม' : ''}
    Logto->>Client: เปลี่ยนเส้นทางกลับไปยังเซิร์ฟเวอร์ MCP พร้อม authorization code
    Client->>Logto: ขอ access token โดยใช้ authorization code
    Logto->>Client: ส่งคืน access token
    Client->>Server: ขอใช้เครื่องมือพร้อม access token
    Server->>Logto: ขอข้อมูลผู้ใช้โดยใช้ access token
    Logto->>Server: ส่งคืนข้อมูลผู้ใช้
    Server->>Client: ส่งคืนผลลัพธ์ของเครื่องมือ`}

/>

:::note
เนื่องจาก MCP มีการพัฒนาอย่างรวดเร็ว ไดอะแกรมข้างต้นอาจไม่อัปเดตล่าสุดเสมอ โปรดดูเอกสาร [mcp-auth](https://mcp-auth.dev) สำหรับข้อมูลล่าสุด
:::
