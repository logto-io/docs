---
sidebar_position: 1
sidebar_label: เปิดใช้งาน auth สำหรับแอปที่ใช้ MCP
---

import Prerequisites from './fragments/_mcp-prerequisites.mdx';
import SampleCode from './fragments/_mcp-sample-code.mdx';
import SetUpServer from './fragments/_mcp-set-up-server.mdx';

# เปิดใช้งาน auth สำหรับแอปที่ใช้ MCP ของคุณด้วย Logto

คู่มือนี้จะแนะนำวิธีการผสาน Logto เข้ากับเซิร์ฟเวอร์ MCP ของคุณโดยใช้ [mcp-auth](https://mcp-auth.dev) เพื่อให้คุณสามารถยืนยันตัวตนผู้ใช้และดึงข้อมูลอัตลักษณ์ของพวกเขาอย่างปลอดภัยด้วยกระบวนการมาตรฐาน OpenID Connect

คุณจะได้เรียนรู้วิธี:

- กำหนดค่า Logto เป็นเซิร์ฟเวอร์การอนุญาต (authorization server) สำหรับเซิร์ฟเวอร์ MCP ของคุณ
- ตั้งค่าเครื่องมือ “whoami” ในเซิร์ฟเวอร์ MCP เพื่อส่งคืนการอ้างสิทธิ์ของอัตลักษณ์ผู้ใช้ปัจจุบัน
- ทดสอบกระบวนการด้วย MCP Inspector (MCP client)

หลังจากจบบทเรียนนี้ เซิร์ฟเวอร์ MCP ของคุณจะสามารถ:

- ยืนยันตัวตนผู้ใช้ใน Logto tenant ของคุณ
- ส่งคืนการอ้างสิทธิ์ของอัตลักษณ์ (`sub`, `username`, `name`, `email` ฯลฯ) สำหรับการเรียกใช้เครื่องมือ "whoami"

เมื่อผสานการทำงานเสร็จสมบูรณ์ คุณสามารถแทนที่ MCP Inspector ด้วย MCP client ของคุณเอง เช่น เว็บแอป เพื่อเข้าถึงเครื่องมือและทรัพยากรที่เซิร์ฟเวอร์ MCP ของคุณเปิดเผย

<Prerequisites />

## ตั้งค่าแอปใน Logto \{#set-up-app-in-logto}

1. ลงชื่อเข้าใช้ Logto Console ของคุณ
2. ไปที่ <CloudLink to="/applications">**Applications**</CloudLink> → **Create application** → **Create app without framework**
3. เลือกประเภท: Single-page app
4. กรอกชื่อแอปและข้อมูลที่จำเป็นอื่น ๆ จากนั้นคลิก **Create application**
5. บันทึกและคัดลอก **App ID** และ **Issuer endpoint**

<SetUpServer />

## ทดสอบการผสานการทำงาน \{#test-the-integration}

1. เริ่มเซิร์ฟเวอร์ MCP
2. เริ่ม MCP Inspector

   เนื่องจากข้อจำกัดของ MCP Inspector เวอร์ชันปัจจุบัน เราจำเป็นต้องใช้เวอร์ชัน forked จาก mcp-auth:

   ```bash
   git clone https://github.com/mcp-auth/inspector.git
   cd inspector
   npm install
   npm run dev
   ```

   จากนั้นเปิด URL ที่แสดงในเทอร์มินัล

3. ใน MCP Inspector:

   - **Transport Type**: `SSE`
   - **URL**: `http://localhost:3001/sse`
   - **OAuth Client ID**: วาง Logto App ID ของคุณ
   - **Auth Params**: `{"scope": "openid profile email"}`
   - **Redirect URI**: URL นี้ควรถูกเติมอัตโนมัติ ให้คัดลอกไว้

4. ค้นหาแอปพลิเคชันที่คุณสร้างไว้ใน Logto Console เปิดหน้ารายละเอียด แล้ววาง redirect URI ลงในส่วน **Settings** / **Redirect URIs** จากนั้นบันทึกการเปลี่ยนแปลง
5. กลับไปที่ MCP Inspector แล้วคลิก **Connect** ระบบจะนำคุณไปสู่ประสบการณ์การลงชื่อเข้าใช้ของ Logto

หลังจากลงชื่อเข้าใช้เสร็จ คุณจะถูกนำกลับไปยัง MCP Inspector ไปที่ **Tools** -> **List Tools** -> **whoami** -> **Run Tool**

คุณควรเห็นการอ้างสิทธิ์ของผู้ใช้ เช่น:

```json
{
  "sub": "user_XXXX",
  "username": "alice",
  "name": "Alice Smith",
  "email": "alice@example.com"
}
```

<SampleCode />
