import Checkpoint from '../../fragments/_checkpoint-test-your-application.md';
import AssumingUrl from '../../fragments/_web-assuming-url.mdx';
import WebConfigureRedirectUris from '../../fragments/_web-configure-redirect-uris.mdx';
import SignInFlowSummary from '../../fragments/_web-sign-in-flow-summary.mdx';
import SignOutNote from '../../fragments/_web-sign-out-note.md';

### กำหนดค่าแอปพลิเคชัน \{#configure-application}

ในโปรเจกต์ Angular ของคุณ ให้เพิ่ม auth provider ใน `app.config.ts`:

```ts title="app/app.config.ts"
import { buildAngularAuthConfig } from '@logto/js';
import { provideAuth } from 'angular-auth-oidc-client';

export const appConfig: ApplicationConfig = {
  providers: [
    provideHttpClient(withFetch()),
    provideAuth({
      config: buildAngularAuthConfig({
        endpoint: '<your-logto-endpoint>',
        appId: '<your-app-id>',
        redirectUri: 'http://localhost:3000/callback',
        postLogoutRedirectUri: 'http://localhost:3000/',
      }),
    }),
    // ...other providers
  ],
};
```

### กำหนดค่า redirect URI \{#configure-redirect-uris}

<SignInFlowSummary />

<AssumingUrl />

<WebConfigureRedirectUris />

### จัดการ redirect \{#handle-redirect}

เนื่องจากเราใช้ `http://localhost:3000/callback` เป็น redirect URI ตอนนี้เราต้องจัดการให้ถูกต้อง ไลบรารี `angular-auth-oidc-client` มีฟีเจอร์ในตัวสำหรับจัดการ redirect นี้ คุณเพียงแค่กำหนดค่า config ของ auth provider ให้ถูกต้อง ไลบรารีจะจัดการส่วนที่เหลือให้เอง

```ts title="app/app.config.ts"
export const appConfig: ApplicationConfig = {
  providers: [
    provideAuth({
      config: buildAngularAuthConfig({
        // ...other config
        // highlight-start
        redirectUri: 'http://localhost:3000/callback',
        postLogoutRedirectUri: 'http://localhost:3000/',
        // highlight-end
      }),
    }),
    // ...other providers
  ],
};
```

### สร้างฟังก์ชัน sign-in และ sign-out \{#implement-sign-in-and-sign-out}

ในคอมโพเนนต์ที่คุณต้องการเพิ่มฟังก์ชัน sign-in และ sign-out (เช่น `app.component.ts`) ให้ inject `OidcSecurityService` และใช้สำหรับ sign in และ sign out

```ts title="app/app.component.ts"
import { OidcSecurityService } from 'angular-auth-oidc-client';

export class AppComponent implements OnInit {
  constructor(public oidcSecurityService: OidcSecurityService) {}

  signIn() {
    this.oidcSecurityService.authorize();
  }

  signOut() {
    this.oidcSecurityService.logoff().subscribe((result) => {
      console.log('app sign-out', result);
    });
  }
}
```

จากนั้นใน template ให้เพิ่มปุ่มสำหรับ sign in และ sign out:

```html title="app/app.component.html"
<button (click)="signIn()">Sign in</button>
<br />
<button (click)="signOut()">Sign out</button>
```

<SignOutNote />

<Checkpoint />
