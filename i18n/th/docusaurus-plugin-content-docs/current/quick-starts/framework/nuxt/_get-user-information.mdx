import CodeBlock from '@theme/CodeBlock';

import ClaimsNeedNetworkRequest from '../../fragments/_claims-need-network-request.mdx';
import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import GetUserInfoApis from '../../fragments/_get-user-info-apis.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

### แสดงข้อมูลผู้ใช้ \{#display-user-information}

เมื่อผู้ใช้ลงชื่อเข้าใช้แล้ว ค่าที่คืนมาจาก `useLogtoUser()` จะเป็นอ็อบเจกต์ที่มีข้อมูลของผู้ใช้ คุณสามารถแสดงข้อมูลนี้ในแอปของคุณได้:

```html title="index.vue"
<script setup lang="ts">
  const user = useLogtoUser();
</script>
<template>
  <!-- highlight-start -->
  <!-- แสดงข้อมูลผู้ใช้เมื่อเข้าสู่ระบบแล้ว -->
  <ul v-if="Boolean(user)">
    <li v-for="(value, key) in user"><b>{{ key }}:</b> {{ value }}</li>
  </ul>
  <!-- highlight-end -->
  <!-- ปุ่มเข้าสู่ระบบ / ออกจากระบบแบบย่อ -->
  <nuxt-link :to="`/sign-${ user ? 'out' : 'in' }`"> Sign {{ user ? 'out' : 'in' }} </nuxt-link>
</template>
```

### ขอการอ้างสิทธิ์เพิ่มเติม \{#request-additional-claims}

<FindUserInfoMissing method="useLogtoUser()" />

<ScopesAndClaimsIntroduction />

หากต้องการขอขอบเขต (scopes) เพิ่มเติม คุณสามารถกำหนดค่าใน options ของโมดูล `logto` ได้ดังนี้:

```ts title="nuxt.config.ts"
import { UserScope } from '@logto/nuxt';

export default defineNuxtConfig({
  logto: {
    // highlight-next-line
    scopes: [UserScope.Email, UserScope.Phone], // เพิ่ม scopes ตามต้องการ
    // ...other configs
  },
});
```

จากนั้นคุณจะสามารถเข้าถึงการอ้างสิทธิ์ (claims) เพิ่มเติมในอ็อบเจกต์ `user` ได้:

```html title="index.vue"
<template>
  <div v-if="user">
    <p>ชื่อ: {{ user.name }}</p>
    <p>อีเมล: {{ user.email }}</p>
    <p>โทรศัพท์: {{ user.phone }}</p>
  </div>
</template>
```

<ClaimsNeedNetworkRequest
  type="option"
  configOption="fetchUserInfo"
  codeSnippet={
    <CodeBlock language="ts" title="nuxt.config.ts">{`export default defineNuxtConfig({
  logto: {
    scopes: [UserScope.CustomData],
    // highlight-next-line
    fetchUserInfo: true,
  },
  // ...other configurations
});`}</CodeBlock>
  }
/>

### รับข้อมูลผู้ใช้ด้วยตนเอง \{#get-user-information-manually}

หากต้องการเข้าถึงเมธอดทั้งหมดที่ Logto client มีให้ คุณสามารถใช้ composable `useLogtoClient()` ได้:

```ts title="index.vue"
const client = useLogtoClient();
```

:::warning
Logto client ใช้งานได้เฉพาะฝั่งเซิร์ฟเวอร์เท่านั้น composable นี้จะคืนค่า `undefined` ในฝั่ง client
:::

<GetUserInfoApis
  getIdTokenClaimsApi="client.getIdTokenClaims()"
  fetchUserInfoApi="client.fetchUserInfo()"
/>

ตัวอย่างเช่น หากต้องการดึงข้อมูลผู้ใช้ด้วยตนเอง:

```ts title="index.vue"
import { useLogtoClient, useState, callOnce } from '#imports';

const client = useLogtoClient();
const userInfo = useState(null);

// เรียกเพียงครั้งเดียวเพื่อป้องกันการทำงานจากฝั่ง client
await callOnce(async () => {
  if (!client) {
    throw new Error('Logto client is not available');
  }

  if (!(await client.isAuthenticated())) {
    return;
  }

  try {
    userInfo.value = await client.fetchUserInfo();
  } catch (error) {
    console.error('ไม่สามารถดึงข้อมูลผู้ใช้:', error);
  }
});
```

### ขอบเขต (Scopes) และ การอ้างสิทธิ์ (Claims) \{#scopes-and-claims}

<ScopesAndClaims />
