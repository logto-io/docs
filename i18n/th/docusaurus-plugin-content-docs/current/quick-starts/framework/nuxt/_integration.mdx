import Checkpoint from '../../fragments/_checkpoint-test-your-application.md';
import AssumingUrl from '../../fragments/_web-assuming-url.mdx';
import WebConfigureRedirectUris from '../../fragments/_web-configure-redirect-uris.mdx';
import SignInFlowSummary from '../../fragments/_web-sign-in-flow-summary.mdx';

### ลงทะเบียนโมดูล Logto \{#register-logto-module}

ในไฟล์ config ของ Nuxt ของคุณ ให้เพิ่มโมดูล Logto และกำหนดค่า:

```ts title="nuxt.config.ts"
export default defineNuxtConfig({
  // highlight-start
  modules: ['@logto/nuxt'],
  runtimeConfig: {
    logto: {
      endpoint: '<your-logto-endpoint>',
      appId: '<your-logto-app-id>',
      appSecret: '<your-logto-app-secret>',
      cookieEncryptionKey: '<a-random-string>',
    },
  },
  // highlight-end
  // ...การตั้งค่าอื่น ๆ
});
```

เนื่องจากข้อมูลเหล่านี้มีความอ่อนไหว แนะนำให้ใช้ environment variables (`.env`):

```bash title=".env"
NUXT_LOGTO_ENDPOINT="<your-logto-endpoint>"
NUXT_LOGTO_APP_ID="<your-logto-app-id>"
NUXT_LOGTO_APP_SECRET="<your-logto-app-secret>"
NUXT_LOGTO_COOKIE_ENCRYPTION_KEY="<a-random-string>"
```

ดูข้อมูลเพิ่มเติมได้ที่ [runtime config](https://nuxt.com/docs/guide/going-further/runtime-config)

### กำหนดค่า redirect URI \{#configure-redirect-uris}

<SignInFlowSummary />

<AssumingUrl />

<WebConfigureRedirectUris />

### จัดการ callback \{#handle-callback}

ไม่จำเป็นต้องตั้งค่าเพิ่มเติมเพื่อจัดการเส้นทาง callback เมื่อคุณลงทะเบียนโมดูล `@logto/nuxt` ระบบจะดำเนินการดังนี้:

- เพิ่มสามเส้นทางสำหรับการลงชื่อเข้าใช้ (`/sign-in`), ลงชื่อออก (`/sign-out`), และ callback (`/callback`)
- นำเข้า composable สองตัว: `useLogtoClient` และ `useLogtoUser`

เส้นทางเหล่านี้สามารถกำหนดค่าได้ผ่าน `logto.pathnames` ใน options ของโมดูล ตัวอย่างเช่น:

```ts title="nuxt.config.ts"
export default defineNuxtConfig({
  // highlight-start
  logto: {
    pathnames: {
      signIn: '/login',
      signOut: '/logout',
      callback: '/auth/callback',
    },
  },
  // highlight-end
  // ...การตั้งค่าอื่น ๆ
});
```

ดู [ไฟล์ type definition](https://github.com/logto-io/js/blob/HEAD/packages/nuxt/src/runtime/utils/types.ts) ในแพ็กเกจ `@logto/nuxt` สำหรับข้อมูลเพิ่มเติม

:::note
หากคุณกำหนดเส้นทาง callback เป็น path อื่น คุณต้องอัปเดต redirect URI ใน Logto ให้ตรงกันด้วย
:::

### สร้างฟังก์ชันลงชื่อเข้าใช้และลงชื่อออก \{#implement-sign-in-and-sign-out}

เนื่องจากหน้า Nuxt จะถูก hydrate และกลายเป็น single-page application (SPA) หลังโหลดครั้งแรก เราจึงต้องเปลี่ยนเส้นทางผู้ใช้ไปยังเส้นทางลงชื่อเข้าใช้หรือออกเมื่อจำเป็น เพื่อช่วยในเรื่องนี้ SDK ของเรามี composable `useLogtoUser()` ซึ่งสามารถใช้ได้ทั้งฝั่งเซิร์ฟเวอร์และไคลเอนต์

```html title="index.vue"
<script setup lang="ts">
  import { useLogtoUser } from '#imports'; // เพิ่มบรรทัดนี้หากปิด auto-import
  const user = useLogtoUser();
</script>
<template>
  <!-- ปุ่มลงชื่อเข้าใช้และออกแบบง่าย -->
  <nuxt-link :to="`/sign-${ user ? 'out' : 'in' }`"> Sign {{ user ? 'out' : 'in' }} </nuxt-link>
</template>
```

<Checkpoint />
