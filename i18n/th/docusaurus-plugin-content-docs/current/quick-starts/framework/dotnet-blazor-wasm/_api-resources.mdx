import ApiResourcesDescription from '../../fragments/_api-resources-description.md';

<ApiResourcesDescription />

โดยปกติ เมื่อคุณเข้าถึง `User?.AccessToken` คุณจะได้รับโทเค็นทึบ (Opaque token) ซึ่งมีความยาวสั้นและไม่ใช่ JWT (JSON Web Token) โทเค็นนี้ใช้สำหรับเข้าถึง userinfo endpoint

### เพิ่มทรัพยากร API (API resource) ลงในการตั้งค่า \{#add-api-resource-to-configuration}

หากต้องการรับ JWT ที่สามารถใช้เข้าถึงทรัพยากร API ที่กำหนดไว้ใน Logto ให้เพิ่มพารามิเตอร์ต่อไปนี้ลงในไฟล์ `appsettings.json` (โดยใช้ `https://my-api-resource` เป็นตัวอย่าง):

{/* eslint-disable prettier/prettier */}
```json5 title="appsettings.json"
{
  // ...
  "IdentityServer": {
    // ...
    // highlight-start
    "Scope": "openid profile email <your-api-scopes>", // เพิ่มขอบเขต API ของคุณที่นี่
    "Resource": "https://my-api-resource",
    "ExtraTokenParams": {
        "resource": "https://my-api-resource" // ตรวจสอบให้แน่ใจว่า key "resource" เป็นตัวพิมพ์เล็กทั้งหมด
    }
    // highlight-end
  }
}
```
{/* eslint-enable prettier/prettier */}

พร็อพเพอร์ตี้ `Resource` ใช้สำหรับเพิ่มทรัพยากร API ลงในคำขอการยืนยันตัวตน (auth request) ส่วนพร็อพเพอร์ตี้ `ExtraTokenParams` ใช้สำหรับเพิ่มทรัพยากร API ลงในคำขอโทเค็น (token request) เนื่องจาก Logto ปฏิบัติตาม [RFC 8707](https://tools.ietf.org/html/rfc8707) สำหรับทรัพยากร API จึงต้องกำหนดทั้งสองพร็อพเพอร์ตี้นี้

:::caution
เนื่องจาก WebAssembly เป็นแอปพลิเคชันฝั่งไคลเอนต์ คำขอโทเค็นจะถูกส่งไปยังฝั่งเซิร์ฟเวอร์เพียงครั้งเดียว ด้วยเหตุนี้ `LoadUserInfo` จะขัดแย้งกับการดึงโทเค็นการเข้าถึง (Access token) สำหรับทรัพยากร API
:::

### ใช้โทเค็นการเข้าถึง (Access token) \{#use-access-token}

เมื่อผู้ใช้ได้รับการยืนยันตัวตนแล้ว คุณสามารถเข้าถึงทรัพยากร API ได้โดยใช้พร็อพเพอร์ตี้ `User?.AccessToken` ตัวอย่างเช่น คุณสามารถใช้ `HttpClient` เพื่อเข้าถึงทรัพยากร API ได้ดังนี้:

```csharp
using Blorc.OpenIdConnect;

// เพิ่ม HttpClient สำหรับทรัพยากร API ของคุณ
builder.Services
    .AddHttpClient("MyApiResource", client =>
    {
        client.BaseAddress = new Uri("https://my-api-resource");
    })
    .AddAccessToken(); // เพิ่มโทเค็นการเข้าถึงใน request header
```
