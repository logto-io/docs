import SignInFlowSummary from '../../fragments/_web-sign-in-flow-summary.mdx';

### เริ่มต้น Logto client \{#init-logto-client}

เพิ่มโค้ดต่อไปนี้ในโปรเจกต์ Capacitor ของคุณ:

```ts
import LogtoClient, { type LogtoConfig } from '@logto/capacitor';

const logtoConfig: LogtoConfig = {
  endpoint: '<your-logto-endpoint>',
  appId: '<your-application-id>',
};

const logtoClient = new LogtoClient(config);
```

### ดำเนินการลงชื่อเข้าใช้ \{#implement-sign-in}

<SignInFlowSummary />

ต่อไป มาตั้งค่า redirect URI กัน Redirect URI นี้ใช้สำหรับนำผู้ใช้กลับไปยังแอปของคุณหลังจากจบกระบวนการยืนยันตัวตน

ตรวจสอบให้แน่ใจว่า URI นี้นำกลับไปยังแอป Capacitor เช่น `com.example.app://callback` โดยค่าดังกล่าวอาจแตกต่างกันไปตามการตั้งค่าแอป Capacitor ของคุณ ดูรายละเอียดเพิ่มเติมได้ที่ [Capacitor Deep Links](https://capacitorjs.com/docs/guides/deep-links)

จากนั้น เพิ่มโค้ดต่อไปนี้ใน onClick handler ของปุ่มลงชื่อเข้าใช้:

```ts
const onClick = async () => {
  await logtoClient.signIn('com.example.app://callback');
  console.log(await logtoClient.isAuthenticated()); // true
  console.log(await logtoClient.getIdTokenClaims()); // { sub: '...', ... }
};
```

### ดำเนินการลงชื่อออก \{#implement-sign-out}

เนื่องจาก Capacitor ใช้ Safari View Controller บน iOS และ Chrome Custom Tabs บน Android สถานะการยืนยันตัวตนอาจถูกเก็บไว้ชั่วคราว อย่างไรก็ตาม บางครั้งผู้ใช้อาจต้องการลงชื่อออกจากแอปทันที ในกรณีนี้ เราสามารถใช้เมธอด `signOut` เพื่อลงชื่อออกให้ผู้ใช้ได้:

```ts
const onClick = async () => {
  await logtoClient.signOut();
  console.log(await logtoClient.isAuthenticated()); // false
};
```

เมธอด `signOut` มีพารามิเตอร์เสริมสำหรับ post sign-out redirect URI หากไม่ได้ระบุไว้ ผู้ใช้จะถูกนำไปยังหน้าลงชื่อออกของ Logto

ผู้ใช้จำเป็นต้องกด "Done" เพื่อปิด web view และกลับไปยังแอป Capacitor หากคุณต้องการให้ผู้ใช้ถูกนำกลับไปยังแอป Capacitor โดยอัตโนมัติ สามารถระบุ post sign-out redirect URI ได้ เช่น `com.example.app://callback/sign-out`

ตรวจสอบให้แน่ใจว่า post sign-out redirect URI สามารถนำกลับไปยังแอป Capacitor ได้ จากนั้นเพิ่มโค้ดต่อไปนี้ใน onClick handler ของปุ่มลงชื่อออก:

```ts
const onClick = async () => {
  await logtoClient.signOut('com.example.app://callback/sign-out');
};
```

### เช็คพอยต์: เรียกใช้งานกระบวนการยืนยันตัวตน \{#checkpoint-trigger-the-authentication-flow}

รันแอป Capacitor แล้วคลิกปุ่มลงชื่อเข้าใช้ จะมีหน้าต่างเบราว์เซอร์เปิดขึ้นและนำไปยังหน้าลงชื่อเข้าใช้ของ Logto

หากผู้ใช้ปิดหน้าต่างเบราว์เซอร์โดยไม่จบกระบวนการยืนยันตัวตน แอป Capacitor จะได้รับ `LogtoClientError`
