import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import GetUserInfoApis from '../../fragments/_get-user-info-apis.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

import ScopesAndClaimsCode from './_scopes-and-claims-code.md';

### แสดงข้อมูลผู้ใช้ \{#display-user-information}

หากต้องการแสดงข้อมูลของผู้ใช้ คุณสามารถ inject อ็อบเจกต์ `locals.user` เข้าไปใน layout เพื่อให้สามารถใช้งานได้ในทุกหน้า:

```ts title="+layout.server.ts"
import type { LayoutServerLoad } from './$types';

export const load: LayoutServerLoad = async ({ locals }) => {
  return { user: locals.user };
};
```

ใน Svelte component ของคุณ:

```html title="+page.svelte"
<script>
  /** @type {import('./$types').PageData} */
  export let data;
</script>

{#if data.user}
<ul>
  {#each Object.entries(data.user) as [key, value]}
  <li>{key}: {value}</li>
  {/each}
</ul>
{/if}
```

### ขอ claims เพิ่มเติม \{#request-additional-claims}

<FindUserInfoMissing method="locals.user" />
<ScopesAndClaimsIntroduction />

หากต้องการขอ scopes เพิ่มเติม คุณสามารถส่ง scopes ไปที่อ็อบเจกต์ `LogtoConfig` ในฟังก์ชัน `handleLogto`:

<ScopesAndClaimsCode />

จากนั้นคุณจะสามารถเข้าถึง claims เพิ่มเติมได้ในอ็อบเจกต์ `locals.user`

### Claims ที่ต้องใช้ network request \{#claims-that-need-network-requests}

เพื่อป้องกันไม่ให้อ็อบเจกต์ user มีขนาดใหญ่เกินไป claims บางรายการจำเป็นต้องใช้ network request เพื่อดึงข้อมูล ตัวอย่างเช่น claim custom_data จะไม่ถูกรวมอยู่ในอ็อบเจกต์ user แม้ว่าจะร้องขอไว้ใน scopes ก็ตาม หากต้องการเข้าถึง claims เหล่านี้ คุณสามารถใช้เมธอด `client.fetchUserInfo()`:

โดยปกติแล้ว อ็อบเจกต์ `locals.user` เป็นความสะดวกในการเรียกเมธอด `getIdTokenClaims` แบบ manual หากคุณต้องการใช้ผลลัพธ์จากเมธอด `fetchUserInfo` คุณสามารถตั้งค่า option `fetchUserInfo` เป็น `true` สำหรับ hook ได้ดังนี้:

```ts title="hooks.server.ts"
import { handleLogto } from '@logto/sveltekit';

export const handle = handleLogto(
  {
    /* Logto config */
  },
  {
    /* Cookie config */
  },
  {
    fetchUserInfo: true,
  }
);
```

### ดึงข้อมูลผู้ใช้ด้วยตนเอง \{#fetch-user-information-manually}

<GetUserInfoApis
  getIdTokenClaimsApi="locals.logtoClient.getIdTokenClaims()"
  fetchUserInfoApi="locals.logtoClient.fetchUserInfo()"
/>

### ขอบเขต (Scopes) และ การอ้างสิทธิ์ (Claims) \{#scopes-and-claims}

<ScopesAndClaims />
