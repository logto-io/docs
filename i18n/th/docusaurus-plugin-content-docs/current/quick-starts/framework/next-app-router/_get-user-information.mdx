import CodeBlock from '@theme/CodeBlock';

import ClaimsNeedNetworkRequest from '../../fragments/_claims-need-network-request.mdx';
import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

### แสดงข้อมูลผู้ใช้ \{#display-user-information}

เมื่อผู้ใช้ลงชื่อเข้าใช้แล้ว ค่าที่ได้จาก `getLogtoContext()` จะเป็นอ็อบเจกต์ที่มีข้อมูลของผู้ใช้ คุณสามารถแสดงข้อมูลนี้ในแอปของคุณได้:

```tsx title="app/page.tsx"
import { getLogtoContext } from '@logto/next/server-actions';
import { logtoConfig } from './logto';

// ฟังก์ชันหลักของหน้า Home
export default async function Home() {
  const { claims } = await getLogtoContext(logtoConfig);

  return (
    <main>
      {claims && (
        <div>
          <h2>การอ้างสิทธิ์ (Claims):</h2>
          <table>
            <thead>
              <tr>
                <th>ชื่อ</th>
                <th>ค่า</th>
              </tr>
            </thead>
            <tbody>
              {Object.entries(claims).map(([key, value]) => (
                <tr key={key}>
                  <td>{key}</td>
                  <td>{String(value)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </main>
  );
}
```

### รับข้อมูลผู้ใช้ใน API route handlers \{#get-user-information-in-api-route-handlers}

คุณยังสามารถรับข้อมูลผู้ใช้ใน [route handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers) ของ API ได้เช่นกัน:

```tsx title="app/api/profile/route.ts"
import { getLogtoContext } from '@logto/next/server-actions';
import { logtoConfig } from '../../logto';

export const dynamic = 'force-dynamic';

export async function GET() {
  const { claims } = await getLogtoContext(logtoConfig);

  return Response.json({ claims });
}
```

### ขอการอ้างสิทธิ์เพิ่มเติม \{#request-additional-claims}

<FindUserInfoMissing method="getLogtoContext" />

<ScopesAndClaimsIntroduction />

หากต้องการขอขอบเขต (scopes) เพิ่มเติม คุณสามารถกำหนดค่า params ขณะ init Logto client ได้ดังนี้:

```ts title="app/logto.ts"
import { UserScope, LogtoNextConfig } from '@logto/next';

export const logtoConfig: LogtoNextConfig = {
  // highlight-next-line
  scopes: [UserScope.Email, UserScope.Phone], // เพิ่ม scopes ตามต้องการ
  // ...other configs
});
```

จากนั้นคุณสามารถเข้าถึงการอ้างสิทธิ์เพิ่มเติมใน context response ได้:

```ts title="app/page.tsx"
export default async function Home() {
  const { claims: { email } = {}, } = await getLogtoContext(logtoConfig);

  return (
    <div>
      {email && <p>อีเมล: {email}</p>}
    </div>
  );
};

export default Home;
```

<ClaimsNeedNetworkRequest
  type="option"
  configOption="fetchUserInfo"
  value="userInfo"
  codeSnippet={
    <CodeBlock language="ts" title="app/page.tsx">{`export default async function Home() {
  const { userInfo } = await getLogtoContext(logtoConfig, { fetchUserInfo: true });
  return (
    <div>
      {userInfo && <p>อีเมล: {userInfo.email}</p>}
    </div>
  );
};

export default Home;`}</CodeBlock>
  }
/>

### ขอบเขตและการอ้างสิทธิ์ \{#scopes-and-claims}

<ScopesAndClaims />
