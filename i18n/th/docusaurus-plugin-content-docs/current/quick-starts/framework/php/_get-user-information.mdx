import CodeBlock from '@theme/CodeBlock';

import CliamsNeedNetworkRequest from '../../fragments/_claims-need-network-request.mdx';
import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

### แสดงข้อมูลผู้ใช้ \{#display-user-information}

เพื่อแสดงข้อมูลของผู้ใช้ คุณสามารถใช้เมธอด `getIdTokenClaims` หรือ `fetchUserInfo` เพื่อดึงข้อมูลผู้ใช้ได้ โดย `getIdTokenClaims` จะคืนค่าข้อมูลผู้ใช้ที่อยู่ในโทเค็น ID (ID token) ส่วน `fetchUserInfo` จะดึงข้อมูลผู้ใช้จาก userinfo endpoint

```php title="index.php"
Route::get('/userinfo', function () {
  if ($client->isAuthenticated() === false) {
    return "ยังไม่ได้ยืนยันตัวตน <a href='/sign-in'>ลงชื่อเข้าใช้</a>";
  }

  return (
    // ดึงข้อมูล claims ของโทเค็น ID ในเครื่อง
    json_decode($client->getIdTokenClaims())
    . "<br>"
    // ดึงข้อมูลผู้ใช้จาก userinfo endpoint ของ Logto
    json_decode($client->fetchUserInfo())
  );
});
```

โมเดลข้อมูลของเราอ้างอิงจาก [JsonModel](https://github.com/logto-io/php/blob/master/docs/api/classes/Logto/Sdk/Models/JsonModel.md) ซึ่งสามารถรับคีย์ที่ไม่ได้กำหนดไว้ล่วงหน้าได้อย่างปลอดภัยขณะเข้ารหัสหรือถอดรหัส JSON

โปรดทราบว่า ฟิลด์ (การอ้างสิทธิ์ (claim)) ที่มีค่า `null` ไม่ได้หมายความว่าฟิลด์นั้นถูกตั้งค่าแล้ว สาเหตุอาจเป็นเพราะขอบเขต (scope) ที่เกี่ยวข้องไม่ได้ร้องขอ หรือผู้ใช้ไม่มีฟิลด์นั้น

ตัวอย่างเช่น หากเราไม่ได้ร้องขอขอบเขต `email` ขณะลงชื่อเข้าใช้ ฟิลด์ `email` จะเป็น `null` อย่างไรก็ตาม หากร้องขอขอบเขต `email` ฟิลด์ `email` จะเป็นที่อยู่อีเมลของผู้ใช้ (ถ้ามี)

### ร้องขอการอ้างสิทธิ์เพิ่มเติม \{#request-additional-claims}

<FindUserInfoMissing method="getIdTokenClaims" />

<ScopesAndClaimsIntroduction />

หากต้องการร้องขอขอบเขตเพิ่มเติม คุณสามารถกำหนดค่า `scopes` ขณะเริ่มต้น Logto client ได้ดังนี้:

```php title="index.php"
$client = new LogtoClient(
  new LogtoConfig(
    // ...การตั้งค่าอื่น ๆ
    // highlight-next-line
    scopes: ["email", "phone"], // ปรับตามที่ต้องการ
  ),
);
```

หรือจะใช้ enum `UserScope` เพื่อเพิ่ม scopes ก็ได้:

```php title="index.php"
// highlight-next-line
use Logto\Sdk\Constants\UserScope;

$client = new LogtoClient(
  new LogtoConfig(
    // ...การตั้งค่าอื่น ๆ
    // highlight-next-line
    scopes: [UserScope::email, UserScope::phone], // ปรับตามที่ต้องการ
  ),
);
```

จากนั้น การอ้างสิทธิ์ (claims) เพิ่มเติมจะปรากฏในค่าที่คืนมาของ `getIdTokenClaims` หรือ `fetchUserInfo`

<CliamsNeedNetworkRequest
  type="method"
  method="fetchUserInfo"
  codeSnippet={
    <CodeBlock
      language="php"
      title="index.php"
    >{`$client->fetchUserInfo()->custom_data;`}</CodeBlock>
  }
/>

### ขอบเขตและการอ้างสิทธิ์ (Scopes and claims) \{#scopes-and-claims}

<ScopesAndClaims />
