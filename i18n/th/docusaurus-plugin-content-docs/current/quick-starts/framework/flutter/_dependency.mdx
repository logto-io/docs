### ความเข้ากันได้ของเวอร์ชัน SDK \{#sdk-version-compatibility}

| เวอร์ชัน Logto SDK | เวอร์ชัน Dart SDK | รองรับ Dart 3.0 หรือไม่ |
| ------------------ | ----------------- | ----------------------- |
| < 2.0.0            | >= 2.17.6 < 3.0.0 | false                   |
| >= 2.0.0 < 3.0.0   | >= 3.0.0          | true                    |
| >= 3.0.0           | >= 3.6.0          | true                    |

### การตั้งค่า flutter_secure_storage \{#flutter_secure_storage-set-up}

เบื้องหลัง SDK นี้ใช้ [flutter_secure_storage](https://pub.dev/packages/flutter_secure_storage) เพื่อจัดเก็บโทเค็นอย่างปลอดภัยข้ามแพลตฟอร์ม

- สำหรับ iOS ใช้ Keychain
- สำหรับ Android ใช้การเข้ารหัส AES

#### กำหนดค่าเวอร์ชัน Android \{#config-android-version}

ตั้งค่า android:minSdkVersion เป็น `>= 18` ในไฟล์ `android/app/build.gradle` ของโปรเจกต์ของคุณ

```kotlin title="build.gradle"
  android {
      ...

      defaultConfig {
          ...
          minSdkVersion 18
          ...
      }
  }
```

#### ปิดการสำรองข้อมูลอัตโนมัติบน Android \{#disable-auto-backup-on-android}

โดยปกติ Android จะสำรองข้อมูลไปยัง Google Drive ซึ่งอาจทำให้เกิดข้อผิดพลาด `java.security.InvalidKeyException:Failed` ในการถอดรหัสคีย์ เพื่อหลีกเลี่ยงปัญหานี้

1. เพื่อปิดการสำรองข้อมูลอัตโนมัติ ให้ไปที่ไฟล์ manifest ของแอปและตั้งค่า `android:allowBackup` และ `android:fullBackupContent` เป็น `false`

   ```xml title="AndroidManifest.xml"
   <manifest ... >
       ...
       <application
         android:allowBackup="false"
         android:fullBackupContent="false"
         ...
       >
           ...
       </application>
   </manifest>

   ```

2. ยกเว้น `sharedprefs` จาก `FlutterSecureStorage`

   หากคุณต้องการเก็บ `android:fullBackupContent` ไว้สำหรับแอปของคุณแทนที่จะปิดการใช้งาน คุณสามารถยกเว้นไดเรกทอรี `sharedprefs` จากการสำรองข้อมูล
   ดูรายละเอียดเพิ่มเติมใน [เอกสาร Android](https://developer.android.com/identity/data/autobackup#IncludingFiles)

   > ในไฟล์ AndroidManifest.xml ของคุณ ให้เพิ่มแอตทริบิวต์ android:fullBackupContent ลงใน `<application>` ตามตัวอย่างด้านล่าง แอตทริบิวต์นี้จะชี้ไปยังไฟล์ XML ที่มีการกำหนดกฎการสำรองข้อมูล

   ```xml title="AndroidManifest.xml"
   <application ...
     android:fullBackupContent="@xml/backup_rules">
   </application>
   ```

   > สร้างไฟล์ XML ชื่อ `@xml/backup_rules` ในไดเรกทอรี `res/xml/` ในไฟล์นี้ให้เพิ่มกฎด้วย `<include>` และ `<exclude>` ตัวอย่างนี้จะสำรอง shared preferences ทั้งหมดยกเว้น device.xml:

   ```xml title="@xml/backup_rules"
   <?xml version="1.0" encoding="utf-8"?>
   <full-backup-content>
     <exclude domain="sharedpref" path="FlutterSecureStorage"/>
   </full-backup-content>
   ```

โปรดตรวจสอบรายละเอียดเพิ่มเติมได้ที่ [flutter_secure_storage](https://pub.dev/packages/flutter_secure_storage#configure-android-version)

### การตั้งค่า flutter_web_auth_2 \{#flutter_web_auth_2-set-up}

เบื้องหลัง SDK นี้ใช้ [flutter_web_auth_2](https://pub.dev/packages/flutter_web_auth_2) เพื่อยืนยันตัวตนผู้ใช้กับ Logto แพ็กเกจนี้ช่วยให้ยืนยันตัวตนกับ Logto ได้ง่ายโดยใช้ system webview หรือ browser

ปลั๊กอินนี้ใช้ `ASWebAuthenticationSession` บน iOS 12+ และ macOS 10.15+, `SFAuthenticationSession` บน iOS 11, `Chrome Custom Tabs` บน Android และเปิดหน้าต่างใหม่บน Web

- iOS: ไม่ต้องตั้งค่าเพิ่มเติม

- Android: ลงทะเบียน callback url บน Android

  เพื่อให้สามารถรับ callback url จากหน้าลงชื่อเข้าใช้ของ Logto ได้ คุณต้องลงทะเบียน redirectUri ของคุณในไฟล์ `AndroidManifest.xml`

  ```xml title="AndroidManifest.xml"
    <manifest>
      <application>
          <activity
            android:name="com.linusu.flutter_web_auth_2.CallbackActivity"
            android:exported="true">
            <intent-filter android:label="flutter_web_auth_2">
            <action android:name="android.intent.action.VIEW" />
            <category android:name="android.intent.category.DEFAULT" />
            <category android:name="android.intent.category.BROWSABLE" />
            <data android:scheme="YOUR_CALLBACK_URL_SCHEME_HERE" />
            </intent-filter>
          </activity>
      </application>
    </manifest>
  ```

- เว็บเบราว์เซอร์: สร้าง endpoint เพื่อจัดการ callback URL

  หากคุณใช้แพลตฟอร์มเว็บ คุณต้องสร้าง endpoint เพื่อจัดการ callback URL และส่งกลับไปยังแอปพลิเคชันโดยใช้ API `postMessage`

  ```html title="callback.html"
  <!doctype html>
  <title>การยืนยันตัวตนเสร็จสมบูรณ์</title>
  <p>การยืนยันตัวตนเสร็จสมบูรณ์ หากไม่เกิดขึ้นโดยอัตโนมัติ กรุณาปิดหน้าต่างนี้</p>
  <script>
    function postAuthenticationMessage() {
      const message = {
        'flutter-web-auth-2': window.location.href,
      };

      if (window.opener) {
        window.opener.postMessage(message, window.location.origin);
        window.close();
      } else if (window.parent && window.parent !== window) {
        window.parent.postMessage(message, window.location.origin);
      } else {
        localStorage.setItem('flutter-web-auth-2', window.location.href);
        window.close();
      }
    }

    postAuthenticationMessage();
  </script>
  ```

โปรดตรวจสอบคู่มือการตั้งค่าในแพ็กเกจ [flutter_web_auth_2](https://pub.dev/packages/flutter_web_auth_2#setup) สำหรับรายละเอียดเพิ่มเติม
