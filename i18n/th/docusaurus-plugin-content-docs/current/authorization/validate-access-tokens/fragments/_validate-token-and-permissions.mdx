import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

หลังจากดึงโทเค็นและดึงข้อมูล OIDC config แล้ว ให้ตรวจสอบสิ่งต่อไปนี้:

- **ลายเซ็น (Signature):** JWT ต้องถูกต้องและลงนามโดย Logto (ผ่าน JWKS)
- **ผู้ออก (Issuer):** ต้องตรงกับผู้ออกของ Logto tenant ของคุณ
- **ผู้รับ (Audience):** ต้องตรงกับตัวบ่งชี้ทรัพยากร API ที่ลงทะเบียนใน Logto หรือบริบทขององค์กรหากเกี่ยวข้อง
- **วันหมดอายุ (Expiration):** โทเค็นต้องไม่หมดอายุ
- **สิทธิ์ (ขอบเขต) (Permissions (scopes)):** โทเค็นต้องมีขอบเขตที่จำเป็นสำหรับ API / การกระทำของคุณ ขอบเขตจะเป็นสตริงที่คั่นด้วยช่องว่างใน `scope` การอ้างสิทธิ์ (claim)
- **บริบทองค์กร (Organization context):** หากปกป้องทรัพยากร API ระดับองค์กร ให้ตรวจสอบการอ้างสิทธิ์ `organization_id`

ดู [JSON Web Token](https://auth.wiki/jwt) เพื่อเรียนรู้เพิ่มเติมเกี่ยวกับโครงสร้างและการอ้างสิทธิ์ของ JWT

### สิ่งที่ต้องตรวจสอบสำหรับแต่ละโมเดลสิทธิ์ (What to check for each permission model) \{#what-to-check-for-each-permission-model}

การอ้างสิทธิ์ (claims) และกฎการตรวจสอบจะแตกต่างกันไปตามโมเดลสิทธิ์:

<Tabs groupId="permission-models">
  <TabItem value="global-api-resources" label="ทรัพยากร API ระดับโกลบอล (Global API resources)">

    - **การอ้างสิทธิ์ผู้รับ (`aud`):** ตัวบ่งชี้ทรัพยากร API
    - **การอ้างสิทธิ์องค์กร (`organization_id`):** _ไม่มี_
    - **ขอบเขต (สิทธิ์) ที่ต้องตรวจสอบ (`scope`):** สิทธิ์ของทรัพยากร API

  </TabItem>
  <TabItem value="organization-permissions" label="สิทธิ์ขององค์กร (ไม่ใช่ API) (Organization (non-API) permissions)">

    - **การอ้างสิทธิ์ผู้รับ (`aud`):** `urn:logto:organization:<id>` (บริบทองค์กรอยู่ในการอ้างสิทธิ์ `aud`)
    - **การอ้างสิทธิ์องค์กร (`organization_id`):** _ไม่มี_
    - **ขอบเขต (สิทธิ์) ที่ต้องตรวจสอบ (`scope`):** สิทธิ์ขององค์กร

  </TabItem>
  <TabItem value="organization-level-api-resources" label="ทรัพยากร API ระดับองค์กร (Organization-level API resources)">

    - **การอ้างสิทธิ์ผู้รับ (`aud`):** ตัวบ่งชี้ทรัพยากร API
    - **การอ้างสิทธิ์องค์กร (`organization_id`):** รหัสองค์กร (ต้องตรงกับคำขอ)
    - **ขอบเขต (สิทธิ์) ที่ต้องตรวจสอบ (`scope`):** สิทธิ์ของทรัพยากร API

  </TabItem>
</Tabs>

<small>
  สำหรับสิทธิ์ขององค์กรที่ไม่ใช่ API บริบทขององค์กรจะแสดงโดยการอ้างสิทธิ์ `aud` (เช่น
  `urn:logto:organization:abc123`) การอ้างสิทธิ์ `organization_id` จะมีเฉพาะในโทเค็นทรัพยากร API
  ระดับองค์กรเท่านั้น
</small>

:::tip
ควรตรวจสอบทั้งสิทธิ์ (ขอบเขต) และบริบท (ผู้รับ, องค์กร) เสมอ เพื่อความปลอดภัยของ API แบบหลายผู้เช่า
:::
