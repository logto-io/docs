## ขั้นตอนที่ 1: ตั้งค่าแอปบน Facebook App Dashboard \{#step-1-set-up-an-app-on-facebook-app-dashboard}

ก่อนที่คุณจะใช้ Facebook เป็นผู้ให้บริการการยืนยันตัวตน คุณต้องตั้งค่าแอปบนแพลตฟอร์มนักพัฒนา Facebook เพื่อขอรับข้อมูลประจำตัว OAuth 2.0

1. [ลงทะเบียนเป็นนักพัฒนา Facebook](https://developers.facebook.com/docs/development/register/) หากคุณยังไม่มีบัญชี
2. ไปที่หน้า [Apps](https://developers.facebook.com/apps)
3. คลิกเลือกแอปที่มีอยู่ หรือ [สร้างแอปใหม่](https://developers.facebook.com/docs/development/create-an-app) หากจำเป็น

:::tip
Use case คือวิธีหลักที่แอปของคุณจะโต้ตอบกับ Meta และกำหนดว่าแอปของคุณจะใช้ API, ฟีเจอร์, สิทธิ์ และผลิตภัณฑ์ใดได้บ้าง หากคุณต้องการเฉพาะการยืนยันตัวตนโซเชียล (เพื่อรับอีเมล & public_profile) ให้เลือก "Authentication and request data from users with Facebook Login" หากคุณต้องการเข้าถึง Facebook API ให้เลือก use case ที่ต้องการ - ส่วนใหญ่รองรับการเชื่อมต่อ "Facebook Login for business" หลังสร้างแอปแล้ว
:::

4. หลังสร้างแอปแล้ว ที่หน้าแดชบอร์ดของแอป ไปที่ **Use cases > Facebook Login > Settings** หรือ **Facebook Login for business > Settings**
5. กรอก **Valid OAuth Redirect URIs** ด้วย **Callback URI** ของ Logto (คัดลอกจากตัวเชื่อมต่อ Facebook ของคุณใน Logto) หลังผู้ใช้ลงชื่อเข้าใช้ด้วย Facebook แล้ว จะถูกเปลี่ยนเส้นทางมายัง URI นี้พร้อม authorization code ที่ Logto ใช้เพื่อจบกระบวนการยืนยันตัวตน
6. ไปที่ **Use cases** แล้วคลิก **Customize** ของ use case ที่คุณเลือกเพื่อเพิ่ม scopes เราแนะนำให้เพิ่ม `email` และ `public_profile` ซึ่งจำเป็นสำหรับการใช้งาน Sign-in with Facebook ใน Logto

## ขั้นตอนที่ 2: ตั้งค่าตัวเชื่อมต่อ Logto ด้วย client credentials \{#step-2-set-up-logto-connector-with-client-credentials}

1. ใน Facebook App Dashboard คลิกเมนูด้านข้าง **App settings > Basic**
2. คุณจะเห็น **App ID** และ **App secret** บนแผงควบคุม
3. คลิกปุ่ม **Show** ข้างกล่องป้อน App secret เพื่อแสดงและคัดลอกค่า
4. ตั้งค่าตัวเชื่อมต่อ Facebook ของคุณใน Logto:
   - กรอกช่อง `clientId` ด้วย **App ID**
   - กรอกช่อง `clientSecret` ด้วย **App secret**
   - คลิก **Save and Done** ใน Logto เพื่อเชื่อมต่อระบบข้อมูลระบุตัวตนของคุณกับ Facebook

## ขั้นตอนที่ 3: กำหนด scopes \{#step-3-configure-scopes}

Scope กำหนดสิทธิ์ที่แอปของคุณร้องขอจากผู้ใช้ และควบคุมว่าโปรเจกต์ของคุณจะเข้าถึงข้อมูลส่วนตัวใดจากบัญชี Facebook ของพวกเขาได้บ้าง

### กำหนด scopes ใน Facebook App Dashboard \{#configure-scopes-in-facebook-app-dashboard}

1. ไปที่ **Facebook App Dashboard > Use cases** แล้วคลิกปุ่ม **Customize**
2. เพิ่มเฉพาะ scopes ที่แอปของคุณต้องการ ผู้ใช้จะตรวจสอบและอนุญาตสิทธิ์เหล่านี้บนหน้าขอความยินยอมของ Facebook:
   - **สำหรับการยืนยันตัวตน (จำเป็น)**: `email` และ `public_profile`
   - **สำหรับการเข้าถึง API (ไม่บังคับ)**: scopes เพิ่มเติมที่แอปของคุณต้องการ (เช่น `threads_content_publish`, `threads_read_replies` สำหรับเข้าถึง Threads API) ดู [Meta Developer Documentation](https://developers.facebook.com/docs/) สำหรับบริการที่มีให้

### กำหนด scopes ใน Logto \{#configure-scopes-in-logto}

เลือกหนึ่งหรือหลายวิธีต่อไปนี้ตามความต้องการของคุณ:

**ตัวเลือกที่ 1: ไม่ต้องการ scope API เพิ่มเติม**

- เว้นช่อง `Scopes` ในตัวเชื่อมต่อ Facebook ของคุณใน Logto ว่างไว้
- ค่า scope เริ่มต้น `email public_profile` จะถูกขอโดยอัตโนมัติเพื่อให้ Logto สามารถดึงข้อมูลผู้ใช้พื้นฐานได้อย่างถูกต้อง

**ตัวเลือกที่ 2: ขอ scope เพิ่มเติมขณะลงชื่อเข้าใช้**

- กรอก scopes ที่ต้องการทั้งหมดในช่อง **Scopes** โดยคั่นด้วยช่องว่าง
- scopes ที่คุณระบุจะแทนที่ค่าเริ่มต้น ดังนั้นควรใส่ scope สำหรับการยืนยันตัวตนเสมอ: `email public_profile`

**ตัวเลือกที่ 3: ขอ scope เพิ่มเติมภายหลัง**

- หลังผู้ใช้ลงชื่อเข้าใช้แล้ว คุณสามารถขอ scope เพิ่มเติมตามต้องการโดยเริ่ม federated social authorization flow ใหม่ และอัปเดต token set ของผู้ใช้
- scopes เพิ่มเติมเหล่านี้ไม่จำเป็นต้องกรอกในช่อง `Scopes` ของตัวเชื่อมต่อ Facebook ใน Logto และสามารถทำได้ผ่าน Social Verification API ของ Logto

เมื่อทำตามขั้นตอนเหล่านี้ ตัวเชื่อมต่อ Facebook ของ Logto จะขอสิทธิ์เท่าที่แอปของคุณต้องการ - ไม่มากและไม่น้อยเกินไป

:::tip
หากแอปของคุณร้องขอ scopes เหล่านี้เพื่อเข้าถึง Facebook API และดำเนินการต่าง ๆ อย่าลืมเปิดใช้งาน **Store tokens for persistent API access** ในตัวเชื่อมต่อ Facebook ของ Logto ดูรายละเอียดในหัวข้อถัดไป
:::

## ขั้นตอนที่ 4: การตั้งค่าทั่วไป \{#step-4-general-settings}

นี่คือการตั้งค่าทั่วไปบางอย่างที่แม้จะไม่ขัดขวางการเชื่อมต่อกับ Facebook แต่ก็อาจมีผลต่อประสบการณ์การยืนยันตัวตนของผู้ใช้ปลายทาง

### ซิงค์ข้อมูลโปรไฟล์ \{#sync-profile-information}

ในตัวเชื่อมต่อ Facebook คุณสามารถตั้งค่านโยบายการซิงค์ข้อมูลโปรไฟล์ เช่น ชื่อผู้ใช้และรูปประจำตัว เลือกได้ดังนี้:

- **ซิงค์เฉพาะตอนสมัคร**: ดึงข้อมูลโปรไฟล์ครั้งเดียวเมื่อผู้ใช้ลงชื่อเข้าใช้ครั้งแรก
- **ซิงค์ทุกครั้งที่ลงชื่อเข้าใช้**: อัปเดตข้อมูลโปรไฟล์ทุกครั้งที่ผู้ใช้ลงชื่อเข้าใช้

### เก็บโทเค็นเพื่อเข้าถึง Facebook APIs (ไม่บังคับ) \{#store-tokens-to-access-facebook-apis-optional}

หากคุณต้องการเข้าถึง Facebook APIs และดำเนินการต่าง ๆ ด้วยการอนุญาตของผู้ใช้ (ไม่ว่าจะผ่าน social sign-in หรือการเชื่อมโยงบัญชี) Logto จำเป็นต้องขอ scope API ที่เกี่ยวข้องและเก็บโทเค็น

1. เพิ่ม scopes ที่จำเป็นตามขั้นตอนในบทเรียนข้างต้น
2. เปิดใช้งาน **Store tokens for persistent API access** ในตัวเชื่อมต่อ Facebook ของ Logto Logto จะเก็บ Facebook access token ไว้อย่างปลอดภัยใน Secret Vault

:::note
Facebook ไม่ได้ให้ refresh token อย่างไรก็ตาม เมื่อเปิดใช้งานการเก็บโทเค็น Logto จะขอ access token แบบอายุยาว (60 วัน) โดยอัตโนมัติเมื่อผู้ใช้ยืนยันตัวตน ในช่วงเวลาดังกล่าว ผู้ใช้สามารถเพิกถอน access token ได้เอง แต่โดยทั่วไปจะไม่ต้องยืนยันตัวตนใหม่เพื่อเข้าถึง Facebook APIs หมายเหตุ: อย่าเพิ่ม `offline_access` ในช่อง `Scope` เพราะอาจทำให้เกิดข้อผิดพลาด
:::

## ขั้นตอนที่ 5: ทดสอบการลงชื่อเข้าใช้ด้วยผู้ใช้ทดสอบของ Facebook (ไม่บังคับ) \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

คุณสามารถใช้บัญชีผู้ใช้ทดสอบ, นักพัฒนา และผู้ดูแลระบบเพื่อทดสอบการลงชื่อเข้าใช้กับแอป หรือจะเผยแพร่แอปโดยตรงเพื่อให้ผู้ใช้ Facebook ทั่วไปลงชื่อเข้าใช้ก็ได้

1. ใน Facebook App Dashboard คลิกเมนูด้านข้าง **App roles > Test Users**
2. คลิกปุ่ม **Create test users** เพื่อสร้างผู้ใช้สำหรับทดสอบ
3. คลิกปุ่ม **Options** ของผู้ใช้ทดสอบที่มีอยู่เพื่อดูตัวเลือกเพิ่มเติม เช่น "เปลี่ยนชื่อและรหัสผ่าน"

## ขั้นตอนที่ 6: เผยแพร่การตั้งค่าการลงชื่อเข้าใช้ Facebook \{#step-6-publish-facebook-sign-in-settings}

โดยปกติแล้ว เฉพาะผู้ใช้ทดสอบ, ผู้ดูแลระบบ และนักพัฒนาเท่านั้นที่สามารถลงชื่อเข้าใช้แอปได้ หากต้องการให้ผู้ใช้ Facebook ทั่วไปลงชื่อเข้าใช้แอปในสภาพแวดล้อม production คุณอาจต้องเผยแพร่แอปนี้

1. ใน Facebook App Dashboard คลิกเมนูด้านข้าง **Publish**
2. กรอก **Privacy Policy URL** และ **User data deletion** หากจำเป็น
3. คลิกปุ่ม **Save changes** ที่มุมขวาล่าง
4. คลิกปุ่มสวิตช์ **Live** ที่แถบด้านบนของแอป
