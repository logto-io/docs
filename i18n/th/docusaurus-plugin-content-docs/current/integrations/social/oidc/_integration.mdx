## สร้างแอป OIDC ของคุณ \{#create-your-oidc-app}

เมื่อคุณเปิดหน้านี้ เราเชื่อว่าคุณทราบแล้วว่าต้องการเชื่อมต่อกับผู้ให้บริการข้อมูลระบุตัวตนโซเชียลรายใด สิ่งแรกที่ต้องทำคือยืนยันว่าผู้ให้บริการข้อมูลระบุตัวตนรองรับโปรโตคอล OIDC ซึ่งเป็นข้อกำหนดเบื้องต้นสำหรับการตั้งค่าตัวเชื่อมต่อที่ถูกต้อง จากนั้นให้ทำตามคำแนะนำของผู้ให้บริการข้อมูลระบุตัวตนเพื่อสมัครและสร้างแอปที่เกี่ยวข้องสำหรับการอนุญาต OIDC

## ตั้งค่าตัวเชื่อมต่อของคุณ \{#configure-your-connector}

เรารองรับเฉพาะประเภท grant แบบ "Authorization Code" เท่านั้นเพื่อเหตุผลด้านความปลอดภัย และเหมาะสมกับกรณีการใช้งานของ Logto อย่างสมบูรณ์

`clientId` และ `clientSecret` สามารถดูได้ที่หน้ารายละเอียดแอป OIDC ของคุณ

_clientId_: client ID คือรหัสประจำตัวที่ไม่ซ้ำกันซึ่งใช้ระบุแอปพลิเคชันไคลเอนต์ระหว่างการลงทะเบียนกับเซิร์ฟเวอร์อนุญาต รหัสนี้ใช้โดยเซิร์ฟเวอร์อนุญาตเพื่อตรวจสอบตัวตนของแอปพลิเคชันไคลเอนต์และเชื่อมโยงโทเค็นการเข้าถึงที่ได้รับอนุญาตกับแอปพลิเคชันไคลเอนต์นั้น

_clientSecret_: client secret คือคีย์ลับที่เซิร์ฟเวอร์อนุญาตออกให้กับแอปพลิเคชันไคลเอนต์ระหว่างการลงทะเบียน แอปพลิเคชันไคลเอนต์ใช้คีย์ลับนี้เพื่อยืนยันตัวเองกับเซิร์ฟเวอร์อนุญาตเมื่อขอโทเค็นการเข้าถึง client secret ถือเป็นข้อมูลลับและควรเก็บไว้อย่างปลอดภัยตลอดเวลา

_tokenEndpointAuthMethod_: วิธีการยืนยันตัวตนที่ endpoint โทเค็นใช้โดยแอปพลิเคชันไคลเอนต์เพื่อยืนยันตัวเองกับเซิร์ฟเวอร์อนุญาตเมื่อขอโทเค็นการเข้าถึง หากต้องการค้นหาวิธีที่รองรับ ให้ดูที่ฟิลด์ `token_endpoint_auth_methods_supported` ที่มีอยู่ใน discovery endpoint ของ OpenID Connect ของผู้ให้บริการ OAuth 2.0 หรือดูเอกสารที่เกี่ยวข้องของผู้ให้บริการ OAuth 2.0

_clientSecretJwtSigningAlgorithm (ไม่บังคับ)_: ต้องใช้เฉพาะเมื่อ `tokenEndpointAuthMethod` เป็น `client_secret_jwt` อัลกอริทึมการลงนาม JWT ด้วย client secret ใช้โดยแอปพลิเคชันไคลเอนต์เพื่อลงนาม JWT ที่ส่งไปยังเซิร์ฟเวอร์อนุญาตระหว่างการขอโทเค็น

_scope_: พารามิเตอร์ scope ใช้เพื่อระบุชุดทรัพยากรและสิทธิ์ที่แอปพลิเคชันไคลเอนต์ร้องขอเข้าถึง โดยปกติ scope จะถูกกำหนดเป็นรายการค่าที่คั่นด้วยช่องว่างซึ่งแสดงถึงสิทธิ์เฉพาะ ตัวอย่างเช่น ค่า scope เป็น "read write" อาจหมายถึงแอปพลิเคชันไคลเอนต์ร้องขอสิทธิ์อ่านและเขียนข้อมูลของผู้ใช้

คุณควรจะสามารถค้นหา `authorizationEndpoint`, `tokenEndpoint`, `jwksUri` และ `issuer` เป็นข้อมูลการตั้งค่าของ OpenID Provider ได้ ซึ่งควรมีอยู่ในเอกสารของผู้ให้บริการโซเชียล

_authenticationEndpoint_: endpoint นี้ใช้เพื่อเริ่มกระบวนการยืนยันตัวตน โดยปกติกระบวนการนี้จะเกี่ยวข้องกับการที่ผู้ใช้เข้าสู่ระบบและให้สิทธิ์แก่แอปพลิเคชันไคลเอนต์ในการเข้าถึงทรัพยากรของตน

_tokenEndpoint_: endpoint นี้ใช้โดยแอปพลิเคชันไคลเอนต์เพื่อรับ id token ที่สามารถใช้เข้าถึงทรัพยากรที่ร้องขอได้ โดยปกติแอปพลิเคชันไคลเอนต์จะส่งคำขอไปยัง token endpoint พร้อม grant type และ authorization code เพื่อรับ id token

_jwksUri_: นี่คือ URL endpoint ที่สามารถรับ JSON Web Key Set (JWKS) ของผู้ให้บริการข้อมูลระบุตัวตนโซเชียล (IdP) ได้ JWKS คือชุดคีย์เข้ารหัสที่ IdP ใช้ในการลงนามและตรวจสอบ JSON Web Token (JWT) ที่ออกระหว่างกระบวนการยืนยันตัวตน `jwksUri` ใช้โดย relying party (RP) เพื่อรับ public key ที่ IdP ใช้ลงนาม JWT เพื่อให้ RP สามารถตรวจสอบความถูกต้องและความสมบูรณ์ของ JWT ที่ได้รับจาก IdP

_issuer_: นี่คือรหัสประจำตัวที่ไม่ซ้ำกันของ IdP ที่ RP ใช้เพื่อตรวจสอบ JWT ที่ได้รับจาก IdP โดยจะถูกรวมอยู่ใน JWT เป็น `iss` [การอ้างสิทธิ์ (claim)](https://www.rfc-editor.org/rfc/rfc7519#section-4) (Id token เป็น JWT เสมอ) ค่า issuer ควรตรงกับ URL ของเซิร์ฟเวอร์อนุญาตของ IdP และควรเป็น URI ที่ RP ไว้วางใจ เมื่อ RP ได้รับ JWT จะตรวจสอบค่า `iss` เพื่อให้แน่ใจว่าออกโดย IdP ที่เชื่อถือได้ และ JWT นั้นมีไว้สำหรับใช้กับ RP

`jwksUri` และ `issuer` ทำงานร่วมกันเพื่อให้กลไกที่ปลอดภัยสำหรับ RP ในการตรวจสอบตัวตนของผู้ใช้ปลายทางระหว่างกระบวนการยืนยันตัวตน โดยใช้ public key ที่ได้จาก `jwksUri` RP สามารถตรวจสอบความถูกต้องและความสมบูรณ์ของ JWT ที่ออกโดย IdP ค่า issuer ช่วยให้ RP ยอมรับเฉพาะ JWT ที่ออกโดย IdP ที่เชื่อถือได้ และ JWT เหล่านั้นมีไว้สำหรับใช้กับ RP เท่านั้น

เนื่องจากต้องมี authentication request เสมอ จึงมี `authRequestOptionalConfig` เพื่อรวบรวมการตั้งค่าเพิ่มเติมทั้งหมด คุณสามารถดูรายละเอียดได้ที่ [OIDC Authentication Request](https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest) คุณอาจสังเกตว่าไม่มี `nonce` ใน config นี้ เนื่องจาก `nonce` ควรไม่ซ้ำกันในแต่ละคำขอ เราจึงจัดการสร้าง `nonce` ในโค้ด ดังนั้นไม่ต้องกังวล! `jwksUri` และ `issuer` ที่กล่าวถึงก่อนหน้านี้ก็ถูกรวมอยู่ใน `idTokenVerificationConfig` เช่นกัน

คุณอาจสงสัยว่าทำไมโปรโตคอล OIDC มาตรฐานรองรับทั้ง implicit และ hybrid flows แต่ตัวเชื่อมต่อ Logto รองรับเฉพาะ authorization flow ได้มีการพิจารณาแล้วว่า implicit และ hybrid flows มีความปลอดภัยน้อยกว่า authorization flow ด้วยเหตุผลด้านความปลอดภัย Logto จึงรองรับเฉพาะ authorization flow เพื่อความปลอดภัยสูงสุดของผู้ใช้ แม้จะแลกกับความสะดวกบางส่วน

`responseType` และ `grantType` สามารถใช้ได้เฉพาะค่าคงที่กับ "Authorization Code" flow เท่านั้น เราจึงตั้งให้เป็นตัวเลือกและจะเติมค่าเริ่มต้นให้อัตโนมัติ

:::note

สำหรับทุก flow type เรามีคีย์ `customConfig` (ไม่บังคับ) สำหรับใส่พารามิเตอร์ที่คุณต้องการปรับแต่ง
ผู้ให้บริการข้อมูลระบุตัวตนโซเชียลแต่ละรายอาจมีการปรับแต่งมาตรฐาน OIDC ของตนเอง หากผู้ให้บริการของคุณยึดตามมาตรฐาน OIDC อย่างเคร่งครัด คุณไม่จำเป็นต้องสนใจ `customConfig`

:::

## ประเภทการตั้งค่า \{#config-types}

| ชื่อ                      | ประเภท                    | จำเป็นต้องมี |
| ------------------------- | ------------------------- | ------------ |
| scope                     | string                    | ใช่          |
| clientId                  | string                    | ใช่          |
| clientSecret              | string                    | ใช่          |
| authorizationEndpoint     | string                    | ใช่          |
| tokenEndpoint             | string                    | ใช่          |
| idTokenVerificationConfig | IdTokenVerificationConfig | ใช่          |
| authRequestOptionalConfig | AuthRequestOptionalConfig | ไม่จำเป็น    |
| customConfig              | Record\<string, string>   | ไม่จำเป็น    |

| คุณสมบัติของ AuthRequestOptionalConfig | ประเภท | จำเป็นต้องมี |
| -------------------------------------- | ------ | ------------ |
| responseType                           | string | ไม่จำเป็น    |
| tokenEndpoint                          | string | ไม่จำเป็น    |
| responseMode                           | string | ไม่จำเป็น    |
| display                                | string | ไม่จำเป็น    |
| prompt                                 | string | ไม่จำเป็น    |
| maxAge                                 | string | ไม่จำเป็น    |
| uiLocales                              | string | ไม่จำเป็น    |
| idTokenHint                            | string | ไม่จำเป็น    |
| loginHint                              | string | ไม่จำเป็น    |
| acrValues                              | string | ไม่จำเป็น    |

| คุณสมบัติของ IdTokenVerificationConfig | ประเภท                             | จำเป็นต้องมี |
| -------------------------------------- | ---------------------------------- | ------------ |
| jwksUri                                | string                             | ใช่          |
| issuer                                 | string \| string[]                 | ไม่จำเป็น    |
| audience                               | string \| string[]                 | ไม่จำเป็น    |
| algorithms                             | string[]                           | ไม่จำเป็น    |
| clockTolerance                         | string \| number                   | ไม่จำเป็น    |
| crit                                   | Record\<string, string \| boolean> | ไม่จำเป็น    |
| currentDate                            | Date                               | ไม่จำเป็น    |
| maxTokenAge                            | string \| number                   | ไม่จำเป็น    |
| subject                                | string                             | ไม่จำเป็น    |
| typ                                    | string                             | ไม่จำเป็น    |

ดูรายละเอียดเพิ่มเติมเกี่ยวกับ `IdTokenVerificationConfig` ได้ที่ [ที่นี่](https://github.com/panva/jose/blob/main/docs/jwt/verify/interfaces/JWTVerifyOptions.md)

## การตั้งค่าทั่วไป \{#general-settings}

ต่อไปนี้เป็นการตั้งค่าทั่วไปที่แม้จะไม่ขัดขวางการเชื่อมต่อกับผู้ให้บริการข้อมูลระบุตัวตนของคุณ แต่ก็อาจมีผลต่อประสบการณ์การยืนยันตัวตนของผู้ใช้ปลายทาง

### ชื่อและโลโก้ปุ่มโซเชียล \{#social-button-name-and-logo}

หากคุณต้องการแสดงปุ่มโซเชียลในหน้าลงชื่อเข้าใช้ คุณสามารถตั้งค่า **ชื่อ** และ **โลโก้** (โหมดมืดและโหมดสว่าง) ของผู้ให้บริการข้อมูลระบุตัวตนโซเชียลได้ เพื่อช่วยให้ผู้ใช้จดจำตัวเลือกเข้าสู่ระบบโซเชียล

### ชื่อผู้ให้บริการข้อมูลระบุตัวตน \{#identity-provider-name}

ตัวเชื่อมต่อโซเชียลแต่ละตัวจะมีชื่อผู้ให้บริการข้อมูลระบุตัวตน (IdP) ที่ไม่ซ้ำกันเพื่อแยกแยะตัวตนของผู้ใช้ ตัวเชื่อมต่อทั่วไปจะใช้ชื่อ IdP คงที่ แต่ตัวเชื่อมต่อแบบกำหนดเองต้องใช้ค่าที่ไม่ซ้ำกัน ดูข้อมูลเพิ่มเติมเกี่ยวกับ [ชื่อ IdP](https://docs.logto.io/connectors/connector-data-structure#target-identity-provider-name)

### ซิงค์ข้อมูลโปรไฟล์ \{#sync-profile-information}

ในตัวเชื่อมต่อ OIDC คุณสามารถตั้งค่านโยบายการซิงค์ข้อมูลโปรไฟล์ เช่น ชื่อผู้ใช้และอวาตาร์ โดยเลือกได้ดังนี้:

- **ซิงค์เฉพาะตอนสมัครสมาชิก**: ดึงข้อมูลโปรไฟล์ครั้งเดียวเมื่อผู้ใช้ลงชื่อเข้าใช้ครั้งแรก
- **ซิงค์ทุกครั้งที่ลงชื่อเข้าใช้**: อัปเดตข้อมูลโปรไฟล์ทุกครั้งที่ผู้ใช้ลงชื่อเข้าใช้

### เก็บโทเค็นเพื่อเข้าถึง API ของบุคคลที่สาม (ไม่บังคับ) \{#store-tokens-to-access-third-party-apis-optional}

หากคุณต้องการเข้าถึง API ของผู้ให้บริการข้อมูลระบุตัวตนและดำเนินการด้วยการอนุญาตของผู้ใช้ (ไม่ว่าจะผ่าน social sign-in หรือ account linking) Logto จำเป็นต้องขอขอบเขต API เฉพาะและเก็บโทเค็น

1. เพิ่มขอบเขตที่ต้องการในช่อง **scope** ตามคำแนะนำข้างต้น
2. เปิดใช้งาน **เก็บโทเค็นเพื่อเข้าถึง API อย่างต่อเนื่อง** ในตัวเชื่อมต่อ OIDC ของ Logto Logto จะเก็บโทเค็นการเข้าถึงไว้อย่างปลอดภัยใน Secret Vault
3. สำหรับผู้ให้บริการข้อมูลระบุตัวตน OAuth/OIDC มาตรฐาน ต้องรวมขอบเขต `offline_access` เพื่อรับโทเค็นรีเฟรช ป้องกันการขอความยินยอมจากผู้ใช้ซ้ำ

:::warning
เก็บ client secret ของคุณให้ปลอดภัยและอย่าเปิดเผยในโค้ดฝั่งไคลเอนต์ หากถูกเปิดเผย ให้สร้างใหม่ทันทีในหน้าตั้งค่าแอปของผู้ให้บริการข้อมูลระบุตัวตนของคุณ
:::

## ใช้งานตัวเชื่อมต่อ OIDC \{#utilize-the-oidc-connector}

เมื่อคุณสร้างตัวเชื่อมต่อ OIDC และเชื่อมต่อกับผู้ให้บริการข้อมูลระบุตัวตนแล้ว คุณสามารถนำไปใช้ใน flow สำหรับผู้ใช้ปลายทาง เลือกตัวเลือกที่ตรงกับความต้องการของคุณ:

### เปิดใช้งานปุ่มเข้าสู่ระบบโซเชียล \{#enable-social-sign-in-button}

1. ใน Logto Console ไปที่ <CloudLink to="/sign-in-experience/sign-up-and-sign-in">ประสบการณ์การลงชื่อเข้าใช้ > สมัครสมาชิกและลงชื่อเข้าใช้</CloudLink>
2. เพิ่มตัวเชื่อมต่อ OIDC ในส่วน **เข้าสู่ระบบโซเชียล** เพื่อให้ผู้ใช้ยืนยันตัวตนกับผู้ให้บริการข้อมูลระบุตัวตนของคุณ

เรียนรู้เพิ่มเติมเกี่ยวกับ [ประสบการณ์เข้าสู่ระบบโซเชียล](https://docs.logto.io/end-user-flows/sign-up-and-sign-in/social-sign-in)

### เชื่อมโยงหรือยกเลิกการเชื่อมโยงบัญชีโซเชียล \{#link-or-unlink-a-social-account}

ใช้ Account API เพื่อสร้าง Account Center แบบกำหนดเองในแอปของคุณ ให้ผู้ใช้ที่ลงชื่อเข้าใช้เชื่อมโยงหรือยกเลิกการเชื่อมโยงบัญชีโซเชียลของตน [ดูตัวอย่างการใช้งาน Account API](https://docs.logto.io/end-user-flows/account-settings/by-account-api#link-a-new-social-connection)

:::tip
สามารถเปิดใช้งานตัวเชื่อมต่อ OIDC เฉพาะสำหรับการเชื่อมโยงบัญชีและเข้าถึง API ได้ โดยไม่ต้องเปิดใช้งานสำหรับเข้าสู่ระบบโซเชียล
:::

### เข้าถึง API ของผู้ให้บริการข้อมูลระบุตัวตนและดำเนินการ \{#access-identity-provider-apis-and-perform-actions}

แอปพลิเคชันของคุณสามารถดึงโทเค็นการเข้าถึงที่เก็บไว้จาก Secret Vault เพื่อเรียกใช้ API ของผู้ให้บริการข้อมูลระบุตัวตนและทำงาน backend อัตโนมัติ ความสามารถเฉพาะขึ้นอยู่กับผู้ให้บริการข้อมูลระบุตัวตนและขอบเขตที่คุณร้องขอ ดูคู่มือการดึงโทเค็นที่เก็บไว้เพื่อเข้าถึง API

## จัดการข้อมูลระบุตัวตนโซเชียลของผู้ใช้ \{#manage-user-s-social-identity}

หลังจากผู้ใช้เชื่อมโยงบัญชีโซเชียลแล้ว ผู้ดูแลระบบสามารถจัดการการเชื่อมต่อนั้นใน Logto Console ได้ดังนี้:

1. ไปที่ <CloudLink to="/users">Logto console > การจัดการผู้ใช้</CloudLink> และเปิดโปรไฟล์ของผู้ใช้
2. ใต้ **การเชื่อมต่อโซเชียล** ค้นหารายการผู้ให้บริการข้อมูลระบุตัวตนและคลิก **จัดการ**
3. ในหน้านี้ ผู้ดูแลระบบสามารถจัดการการเชื่อมต่อโซเชียลของผู้ใช้ ดูข้อมูลโปรไฟล์ทั้งหมดที่ได้รับและซิงค์จากบัญชีโซเชียล และตรวจสอบสถานะโทเค็นการเข้าถึง

:::note
การตอบกลับ access token ของผู้ให้บริการข้อมูลระบุตัวตนบางรายจะไม่มีข้อมูลขอบเขตที่เฉพาะเจาะจง Logto จึงไม่สามารถแสดงรายการสิทธิ์ที่ผู้ใช้อนุญาตได้โดยตรง อย่างไรก็ตาม ตราบใดที่ผู้ใช้ได้ให้ความยินยอมกับขอบเขตที่ร้องขอระหว่างการอนุญาต แอปพลิเคชันของคุณจะมีสิทธิ์ที่เกี่ยวข้องเมื่อเข้าถึง OIDC API
:::
