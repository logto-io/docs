## ขั้นตอนที่ 1: สร้างโปรเจกต์บน Google Auth Platform \{#step-1-create-a-project-on-google-auth-platform}

ก่อนที่คุณจะใช้ Google เป็นผู้ให้บริการการยืนยันตัวตน คุณต้องตั้งค่าโปรเจกต์ใน Google Cloud Console เพื่อขอรับข้อมูลประจำตัว OAuth 2.0 หากคุณมีโปรเจกต์อยู่แล้ว สามารถข้ามขั้นตอนนี้ได้

1. ไปที่ [Google Cloud Console](https://console.cloud.google.com/) และลงชื่อเข้าใช้ด้วยบัญชี Google ของคุณ
2. คลิกปุ่ม **Select a project** ที่แถบเมนูด้านบน จากนั้นคลิกปุ่ม **New Project** เพื่อสร้างโปรเจกต์ใหม่
3. ในโปรเจกต์ที่สร้างขึ้นใหม่ ไปที่ **APIs & Services > OAuth consent screen** เพื่อกำหนดค่าของแอป:
   - **ข้อมูลแอป (App information)**: กรอก **Application name** และ **Support email** ที่จะแสดงบนหน้าขอความยินยอม
   - **ผู้รับ (Audience)**: เลือกประเภทผู้รับที่คุณต้องการ:
     - **Internal** - สำหรับผู้ใช้ Google Workspace ภายในองค์กรของคุณเท่านั้น
     - **External** - สำหรับผู้ใช้ Google ทุกคน (ต้องผ่านการตรวจสอบเพื่อใช้งานจริง)
   - **ข้อมูลติดต่อ (Contact information)**: ระบุอีเมลเพื่อให้ Google แจ้งเตือนคุณเกี่ยวกับการเปลี่ยนแปลงใด ๆ ของโปรเจกต์
   - ติ๊ก **I agree to Google's policies** เพื่อเสร็จสิ้นการตั้งค่าพื้นฐาน
4. หากต้องการ ไปที่ส่วน **Branding** เพื่อแก้ไขข้อมูลผลิตภัณฑ์และอัปโหลด **App logo** ซึ่งจะแสดงบนหน้าขอความยินยอม OAuth เพื่อช่วยให้ผู้ใช้จดจำแอปของคุณ

:::tip
หากคุณเลือกประเภทผู้รับเป็น **External** คุณจะต้องเพิ่มผู้ใช้ทดสอบระหว่างการพัฒนา และเผยแพร่แอปของคุณสำหรับการใช้งานจริง
:::

## ขั้นตอนที่ 2: สร้างข้อมูลประจำตัว OAuth 2.0 \{#step-2-create-oauth-2-0-credentials}

ไปที่หน้า [Credentials](https://console.cloud.google.com/apis/credentials) ใน Google Cloud Console และสร้างข้อมูลประจำตัว OAuth สำหรับแอปพลิเคชันของคุณ

1. คลิก **Create Credentials > OAuth client ID**
2. เลือก **Web application** เป็นประเภทแอปพลิเคชัน
3. กรอก **Name** ของ OAuth client เพื่อช่วยให้คุณระบุข้อมูลประจำตัวนี้ (ไม่ได้แสดงให้ผู้ใช้ปลายทางเห็น)
4. กำหนดค่า URI ที่ได้รับอนุญาต:
   - **Authorized JavaScript origins**: เพิ่ม origin ของ Logto instance ของคุณ (เช่น `https://your-logto-domain.com`)
   - **Authorized redirect URIs**: เพิ่ม **Callback URI** ของ Logto (คัดลอกจาก Logto Google connector ของคุณ)
5. คลิก **Create** เพื่อสร้าง OAuth client

## ขั้นตอนที่ 3: กำหนดค่าตัวเชื่อมต่อ Logto ด้วยข้อมูลประจำตัว \{#step-3-configure-logto-connector-with-credentials}

หลังจากสร้าง OAuth client แล้ว Google จะแสดงหน้าต่างพร้อมข้อมูลประจำตัวของคุณ:

1. คัดลอก **Client ID** แล้ววางลงในช่อง `clientId` ใน Logto
2. คัดลอก **Client secret** แล้ววางลงในช่อง `clientSecret` ใน Logto
3. คลิก **Save and Done** ใน Logto เพื่อเชื่อมต่อระบบข้อมูลระบุตัวตนของคุณกับ Google

:::warning
เก็บรักษา client secret ของคุณให้ปลอดภัย และอย่าเปิดเผยในโค้ดฝั่ง client หากถูกเปิดเผย ให้สร้างใหม่ทันที
:::

## ขั้นตอนที่ 4: กำหนดค่าขอบเขต (Scopes) \{#step-4-configure-scopes}

ขอบเขต (Scopes) กำหนดสิทธิ์ที่แอปของคุณร้องขอจากผู้ใช้ และควบคุมว่าแอปของคุณสามารถเข้าถึงข้อมูลใดจากบัญชี Google ของผู้ใช้ได้บ้าง

### กำหนดค่าขอบเขตใน Google Cloud Console \{#configure-scopes-in-google-cloud-console}

1. ไปที่ **APIs & Services > OAuth consent screen > Scopes**
2. คลิก **Add or Remove Scopes** และเลือกเฉพาะขอบเขตที่แอปของคุณต้องการ:
   - **การยืนยันตัวตน (Authentication) (จำเป็น)**:
     - `https://www.googleapis.com/auth/userinfo.email`
     - `https://www.googleapis.com/auth/userinfo.profile`
     - `openid`
   - **การเข้าถึง API (API access) (ไม่บังคับ)**: เพิ่มขอบเขตเพิ่มเติมที่แอปของคุณต้องการ (เช่น Drive, Calendar, YouTube) ค้นหาบริการที่มีได้ใน [Google API Library](https://console.cloud.google.com/apis/library) หากแอปของคุณต้องการเข้าถึง Google API เกินกว่าสิทธิ์พื้นฐาน ให้เปิดใช้งาน API เฉพาะที่แอปของคุณจะใช้ (เช่น Google Drive API, Gmail API, Calendar API) ใน Google API Library ก่อน
3. คลิก **Update** เพื่อยืนยันการเลือก
4. คลิก **Save and Continue** เพื่อบันทึกการเปลี่ยนแปลง

### กำหนดค่าขอบเขตใน Logto \{#configure-scopes-in-logto}

เลือกวิธีใดวิธีหนึ่งหรือหลายวิธีต่อไปนี้ตามความต้องการของคุณ:

**ตัวเลือกที่ 1: ไม่ต้องการขอบเขต API เพิ่มเติม**

- เว้นว่างช่อง `Scopes` ใน Logto Google connector ของคุณ
- ขอบเขตเริ่มต้น `openid profile email` จะถูกขอโดยอัตโนมัติเพื่อให้ Logto สามารถดึงข้อมูลผู้ใช้พื้นฐานได้อย่างถูกต้อง

**ตัวเลือกที่ 2: ขอขอบเขตเพิ่มเติมขณะลงชื่อเข้าใช้**

- กรอกขอบเขตทั้งหมดที่ต้องการในช่อง **Scopes** โดยคั่นด้วยช่องว่าง
- ขอบเขตที่คุณระบุจะแทนที่ค่าเริ่มต้น ดังนั้นควรใส่ขอบเขตการยืนยันตัวตนเสมอ: `https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile openid`
- ใช้ URL ขอบเขตแบบเต็ม ตัวอย่าง: `https://www.googleapis.com/auth/calendar.readonly`

**ตัวเลือกที่ 3: ขอขอบเขตเพิ่มเติมภายหลัง**

- หลังจากผู้ใช้ลงชื่อเข้าใช้แล้ว คุณสามารถขอขอบเขตเพิ่มเติมตามต้องการโดยเริ่ม federated social authorization flow ใหม่ และอัปเดต token set ของผู้ใช้
- ขอบเขตเพิ่มเติมเหล่านี้ไม่จำเป็นต้องกรอกในช่อง `Scopes` ของ Logto Google connector และสามารถทำได้ผ่าน Social Verification API ของ Logto

เมื่อทำตามขั้นตอนเหล่านี้ ตัวเชื่อมต่อ Logto Google ของคุณจะร้องขอเฉพาะสิทธิ์ที่แอปของคุณต้องการ — ไม่มากและไม่น้อยเกินไป

:::tip
หากแอปของคุณร้องขอขอบเขตเหล่านี้เพื่อเข้าถึง Google API และดำเนินการต่าง ๆ อย่าลืมเปิดใช้งาน **Store tokens for persistent API access** ใน Logto Google connector ดูรายละเอียดในหัวข้อถัดไป
:::

## ขั้นตอนที่ 5: ปรับแต่งการแจ้งเตือนการยืนยันตัวตน \{#step-5-customize-authentication-prompts}

กำหนดค่า **Prompts** ใน Logto เพื่อควบคุมประสบการณ์การยืนยันตัวตนของผู้ใช้ Prompts คืออาร์เรย์ของสตริงที่ระบุประเภทของการโต้ตอบที่ต้องการจากผู้ใช้:

- `none` - เซิร์ฟเวอร์การอนุญาตจะไม่แสดงหน้าการยืนยันตัวตนหรือขอความยินยอมใด ๆ หากผู้ใช้ยังไม่ได้รับการยืนยันตัวตนหรือยังไม่ได้ให้ความยินยอมสำหรับขอบเขตที่ร้องขอ จะส่งคืนข้อผิดพลาด ใช้เพื่อตรวจสอบการยืนยันตัวตนและ/หรือความยินยอมที่มีอยู่
- `consent` - เซิร์ฟเวอร์การอนุญาตจะแจ้งให้ผู้ใช้ให้ความยินยอมก่อนส่งข้อมูลกลับไปยัง client จำเป็นสำหรับการเปิดใช้งาน **offline access** เพื่อเข้าถึง Google API
- `select_account` - เซิร์ฟเวอร์การอนุญาตจะแจ้งให้ผู้ใช้เลือกบัญชีผู้ใช้ เหมาะสำหรับผู้ใช้ที่มีหลายบัญชี Google เพื่อเลือกบัญชีที่ต้องการใช้ในการยืนยันตัวตน

## ขั้นตอนที่ 6: การตั้งค่าทั่วไป \{#step-6-general-settings}

นี่คือการตั้งค่าทั่วไปบางประการที่แม้จะไม่ขัดขวางการเชื่อมต่อกับ Google แต่ก็อาจมีผลต่อประสบการณ์การยืนยันตัวตนของผู้ใช้ปลายทาง

### ซิงค์ข้อมูลโปรไฟล์ \{#sync-profile-information}

ในตัวเชื่อมต่อ Google คุณสามารถตั้งค่านโยบายการซิงค์ข้อมูลโปรไฟล์ เช่น ชื่อผู้ใช้และรูปประจำตัว เลือกได้ดังนี้:

- **ซิงค์เฉพาะตอนสมัคร (Only sync at sign-up)**: ดึงข้อมูลโปรไฟล์ครั้งเดียวเมื่อผู้ใช้ลงชื่อเข้าใช้ครั้งแรก
- **ซิงค์ทุกครั้งที่ลงชื่อเข้าใช้ (Always sync at sign-in)**: อัปเดตข้อมูลโปรไฟล์ทุกครั้งที่ผู้ใช้ลงชื่อเข้าใช้

### เก็บโทเค็นเพื่อเข้าถึง Google APIs (ไม่บังคับ) \{#store-tokens-to-access-google-apis-optional}

หากคุณต้องการเข้าถึง [Google APIs](https://console.cloud.google.com/apis/library) และดำเนินการต่าง ๆ ด้วยการอนุญาตจากผู้ใช้ (ไม่ว่าจะผ่าน social sign-in หรือ account linking) Logto จำเป็นต้องขอขอบเขต API ที่เกี่ยวข้องและเก็บโทเค็น

1. เพิ่มขอบเขตที่ต้องการในการตั้งค่า OAuth consent screen ของ Google Cloud Console และ Logto Google connector
2. เปิดใช้งาน **Store tokens for persistent API access** ใน Logto Google connector Logto จะเก็บ Google access และ refresh tokens อย่างปลอดภัยใน Secret Vault
3. เพื่อให้แน่ใจว่า refresh tokens ถูกส่งกลับมา ให้ตั้งค่าตัวเชื่อมต่อ Logto Google ดังนี้:
   - ตั้งค่า **Prompts** ให้มี `consent`
   - เปิดใช้งาน **Offline Access**

:::warning
คุณไม่จำเป็นต้องเพิ่ม `offline_access` ในช่อง `Scope` ของ Logto — การเพิ่มอาจทำให้เกิดข้อผิดพลาด Google จะใช้ `access_type=offline` โดยอัตโนมัติเมื่อเปิดใช้งาน offline access
:::

## ขั้นตอนที่ 7: เปิดใช้งาน Google One Tap (ไม่บังคับ) \{#step-7-enable-google-one-tap-optional}

[Google One Tap](https://developers.google.com/identity/gsi/web/guides/features) เป็นวิธีที่ปลอดภัยและสะดวกในการให้ผู้ใช้ลงชื่อเข้าใช้เว็บไซต์ของคุณด้วยบัญชี Google ผ่านอินเทอร์เฟซแบบ popup

เมื่อคุณตั้งค่าตัวเชื่อมต่อ Google แล้ว คุณจะเห็นการ์ดสำหรับ Google One Tap ในหน้ารายละเอียดตัวเชื่อมต่อ เปิดใช้งาน Google One Tap โดยสลับสวิตช์

### ตัวเลือกการกำหนดค่า Google One Tap \{#google-one-tap-configuration-options}

- **Auto-select credential if possible** - ลงชื่อเข้าใช้ผู้ใช้โดยอัตโนติด้วยบัญชี Google หาก [ตรงตามเงื่อนไขที่กำหนด](https://developers.google.com/identity/gsi/web/guides/automatic-sign-in-sign-out)
- **Cancel the prompt if user clicks/taps outside** - ปิดหน้าต่าง Google One Tap หากผู้ใช้คลิกหรือตอบนอกหน้าต่าง หากปิดใช้งาน ผู้ใช้ต้องคลิกปุ่มปิดเพื่อปิดหน้าต่าง
- **Enable Upgraded One Tap UX on ITP browsers** - เปิดใช้งานประสบการณ์ผู้ใช้ Google One Tap แบบใหม่บนเบราว์เซอร์ที่มี Intelligent Tracking Prevention (ITP) ดูข้อมูลเพิ่มเติมใน [เอกสารนี้](https://developers.google.com/identity/gsi/web/guides/features#upgraded_ux_on_itp_browsers)

:::warning
อย่าลืมเพิ่มโดเมนของคุณในส่วน **Authorized JavaScript origins** ในการตั้งค่า OAuth client มิฉะนั้น Google One Tap จะไม่สามารถแสดงผลได้
:::

### ข้อจำกัดสำคัญของ Google One Tap \{#important-limitations-with-google-one-tap}

หากคุณเปิดใช้งาน **Store tokens for persistent API access** พร้อมกับ **Google One Tap** คุณจะไม่ได้รับ access token หรือขอบเขตที่ร้องขอโดยอัตโนมัติ

การลงชื่อเข้าใช้ด้วย Google One Tap (ต่างจากปุ่ม "Sign in with Google" มาตรฐาน) จะ **ไม่** ออก OAuth access token แต่จะคืนค่าเฉพาะ ID token (JWT ที่ลงลายเซ็น) เพื่อยืนยันตัวตนผู้ใช้เท่านั้น ไม่ได้ให้สิทธิ์เข้าถึง API

หากต้องการเข้าถึง Google APIs สำหรับผู้ใช้ที่ลงชื่อเข้าใช้ด้วย Google One Tap คุณสามารถใช้ Social Verification API ของ Logto เพื่อเริ่ม federated social authorization flow ใหม่หลังจากผู้ใช้ลงชื่อเข้าใช้ด้วย Google One Tap วิธีนี้ช่วยให้คุณร้องขอขอบเขตเพิ่มเติมตามต้องการและอัปเดต token set ของผู้ใช้ โดยไม่ต้องกรอกขอบเขตเหล่านั้นล่วงหน้าใน Logto Google connector วิธีนี้รองรับ incremental authorization ผู้ใช้จะถูกขอสิทธิ์เพิ่มเติมเฉพาะเมื่อแอปของคุณต้องการจริง ๆ

ศึกษาข้อมูลเพิ่มเติมเกี่ยวกับ [ข้อจำกัดของ Google One Tap](https://developers.google.com/identity/gsi/web/guides/overview) ในเอกสารทางการ

## ขั้นตอนที่ 8: ทดสอบและเผยแพร่แอปของคุณ \{#step-8-test-and-publish-your-app}

### สำหรับแอป Internal \{#for-internal-apps}

หากประเภท **Audience** ใน Google ของคุณตั้งเป็น **Internal** แอปของคุณจะใช้ได้เฉพาะกับผู้ใช้ Google Workspace ภายในองค์กรของคุณ คุณสามารถทดสอบด้วยบัญชีใดก็ได้ในองค์กร

### สำหรับแอป External \{#for-external-apps}

หากประเภท **Audience** ของคุณเป็น **External**:

1. **ระหว่างการพัฒนา**: ไปที่ **OAuth consent screen > Test users** และเพิ่มอีเมลผู้ใช้ทดสอบ เฉพาะผู้ใช้เหล่านี้เท่านั้นที่สามารถลงชื่อเข้าใช้แอปของคุณได้
2. **สำหรับการใช้งานจริง**: คลิก **Publish App** ในส่วน OAuth consent screen เพื่อให้แอปของคุณพร้อมใช้งานสำหรับทุกคนที่มีบัญชี Google

:::note
แอปที่ร้องขอขอบเขตที่ละเอียดอ่อนหรือถูกจำกัด อาจต้องผ่านการตรวจสอบโดย Google ก่อนเผยแพร่ ซึ่งอาจใช้เวลาหลายสัปดาห์
:::
