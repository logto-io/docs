## สร้างแอป OAuth ของคุณ \{#create-your-oauth-app}

เมื่อคุณเปิดหน้านี้ เราเชื่อว่าคุณทราบแล้วว่าต้องการเชื่อมต่อกับผู้ให้บริการข้อมูลระบุตัวตนโซเชียลรายใด สิ่งแรกที่ต้องทำคือยืนยันว่าผู้ให้บริการข้อมูลระบุตัวตนรองรับโปรโตคอล OAuth ซึ่งเป็นข้อกำหนดเบื้องต้นสำหรับการตั้งค่าตัวเชื่อมต่อที่ถูกต้อง จากนั้นให้ทำตามคำแนะนำของผู้ให้บริการข้อมูลระบุตัวตนเพื่อสมัครและสร้างแอปที่เกี่ยวข้องสำหรับการอนุญาต OAuth

## ตั้งค่าตัวเชื่อมต่อของคุณ \{#configure-your-connector}

เรารองรับเฉพาะประเภท grant แบบ "Authorization Code" เพื่อความปลอดภัย และเหมาะสมกับกรณีการใช้งานของ Logto อย่างสมบูรณ์

`clientId` และ `clientSecret` สามารถดูได้ที่หน้ารายละเอียดแอป OAuth ของคุณ

_clientId_: client ID คือรหัสระบุที่ไม่ซ้ำกันซึ่งใช้ระบุแอปพลิเคชันลูกค้าในระหว่างการลงทะเบียนกับเซิร์ฟเวอร์อนุญาต รหัสนี้ใช้โดยเซิร์ฟเวอร์อนุญาตเพื่อตรวจสอบตัวตนของแอปพลิเคชันลูกค้าและเชื่อมโยงโทเค็นการเข้าถึงที่ได้รับอนุญาตกับแอปพลิเคชันลูกค้านั้น

_clientSecret_: client secret คือคีย์ลับที่ออกให้กับแอปพลิเคชันลูกค้าโดยเซิร์ฟเวอร์อนุญาตในระหว่างการลงทะเบียน แอปพลิเคชันลูกค้าจะใช้คีย์ลับนี้เพื่อยืนยันตัวตนกับเซิร์ฟเวอร์อนุญาตเมื่อขอโทเค็นการเข้าถึง client secret ถือเป็นข้อมูลลับและควรเก็บไว้อย่างปลอดภัยตลอดเวลา

_tokenEndpointAuthMethod_: วิธีการยืนยันตัวตนที่ token endpoint ใช้โดยแอปพลิเคชันลูกค้าเพื่อยืนยันตัวตนกับเซิร์ฟเวอร์อนุญาตเมื่อขอโทเค็นการเข้าถึง หากต้องการค้นหาวิธีที่รองรับ ให้ดูที่ฟิลด์ `token_endpoint_auth_methods_supported` ที่มีอยู่ใน discovery endpoint ของ OpenID Connect ของผู้ให้บริการ OAuth 2.0 หรือดูเอกสารที่เกี่ยวข้องของผู้ให้บริการ OAuth 2.0

_clientSecretJwtSigningAlgorithm (ไม่บังคับ)_: ใช้เฉพาะเมื่อ `tokenEndpointAuthMethod` เป็น `client_secret_jwt` อัลกอริทึมสำหรับลงนาม JWT ด้วย client secret ใช้โดยแอปพลิเคชันลูกค้าเพื่อลงนาม JWT ที่ส่งไปยังเซิร์ฟเวอร์อนุญาตระหว่างการขอโทเค็น

_scope_: พารามิเตอร์ scope ใช้เพื่อระบุชุดทรัพยากรและสิทธิ์ที่แอปพลิเคชันลูกค้าต้องการเข้าถึง โดยปกติ scope จะถูกกำหนดเป็นรายการค่าที่คั่นด้วยช่องว่างซึ่งแทนสิทธิ์เฉพาะ ตัวอย่างเช่น ค่า scope เป็น "read write" อาจหมายถึงแอปพลิเคชันลูกค้าขอสิทธิ์อ่านและเขียนข้อมูลของผู้ใช้

คุณควรค้นหา `authorizationEndpoint`, `tokenEndpoint` และ `userInfoEndpoint` ในเอกสารของผู้ให้บริการโซเชียล

_authenticationEndpoint_: endpoint นี้ใช้เริ่มต้นกระบวนการยืนยันตัวตน โดยปกติจะเกี่ยวข้องกับการที่ผู้ใช้เข้าสู่ระบบและให้สิทธิ์แก่แอปพลิเคชันลูกค้าในการเข้าถึงทรัพยากรของตน

_tokenEndpoint_: endpoint นี้ใช้โดยแอปพลิเคชันลูกค้าเพื่อขอโทเค็นการเข้าถึงที่สามารถใช้เข้าถึงทรัพยากรที่ร้องขอได้ โดยปกติแอปพลิเคชันลูกค้าจะส่งคำขอไปยัง token endpoint พร้อม grant type และ authorization code เพื่อรับโทเค็นการเข้าถึง

_userInfoEndpoint_: endpoint นี้ใช้โดยแอปพลิเคชันลูกค้าเพื่อขอข้อมูลเพิ่มเติมเกี่ยวกับผู้ใช้ เช่น ชื่อเต็ม อีเมล หรือรูปโปรไฟล์ โดยปกติจะเข้าถึงหลังจากแอปพลิเคชันลูกค้าได้รับโทเค็นการเข้าถึงจาก token endpoint แล้ว

Logto ยังมีฟิลด์ `profileMap` ให้ผู้ใช้ปรับแต่งการแมปข้อมูลจากโปรไฟล์ของผู้ให้บริการโซเชียล ซึ่งมักจะไม่เป็นมาตรฐาน คีย์คือชื่อฟิลด์โปรไฟล์ผู้ใช้มาตรฐานของ Logto และค่าที่ตรงกันควรเป็นชื่อฟิลด์ของโปรไฟล์โซเชียล ในปัจจุบัน Logto สนใจเฉพาะ 'id', 'name', 'avatar', 'email' และ 'phone' จากโปรไฟล์โซเชียล โดย 'id' เป็นฟิลด์ที่จำเป็นและฟิลด์อื่นเป็นตัวเลือก

`responseType` และ `grantType` สามารถเป็นค่า FIXED ได้เฉพาะกับ authorization code grant type ดังนั้นเราจึงตั้งให้เป็นตัวเลือกและจะเติมค่าเริ่มต้นให้อัตโนมัติ

ตัวอย่างเช่น คุณสามารถดู [Google user profile response](https://developers.google.com/identity/openid-connect/openid-connect#an-id-tokens-payload) และดังนั้น `profileMap` ควรเป็นแบบนี้:

```json
{
  "id": "sub",
  "avatar": "picture"
}
```

:::note

เรามีคีย์ `customConfig` (ไม่บังคับ) สำหรับใส่พารามิเตอร์ที่คุณปรับแต่งเอง
ผู้ให้บริการข้อมูลระบุตัวตนโซเชียลแต่ละรายอาจมีความแตกต่างจากมาตรฐาน OAuth หากผู้ให้บริการของคุณยึดตามมาตรฐาน OAuth อย่างเคร่งครัด คุณไม่จำเป็นต้องสนใจ `customConfig`

:::

## ประเภทการตั้งค่า \{#config-types}

| ชื่อ                      | ประเภท                  | จำเป็น |
| ------------------------- | ----------------------- | ------ |
| authorizationEndpoint     | string                  | true   |
| userInfoEndpoint          | string                  | true   |
| clientId                  | string                  | true   |
| clientSecret              | string                  | true   |
| tokenEndpointResponseType | enum                    | false  |
| responseType              | string                  | false  |
| grantType                 | string                  | false  |
| tokenEndpoint             | string                  | false  |
| scope                     | string                  | false  |
| customConfig              | Record\<string, string> | false  |
| profileMap                | ProfileMap              | false  |

| ฟิลด์ ProfileMap | ประเภท | จำเป็น | ค่าเริ่มต้น |
| ---------------- | ------ | ------ | ----------- |
| id               | string | false  | id          |
| name             | string | false  | name        |
| avatar           | string | false  | avatar      |
| email            | string | false  | email       |
| phone            | string | false  | phone       |

## การตั้งค่าทั่วไป \{#general-settings}

ต่อไปนี้เป็นการตั้งค่าทั่วไปที่แม้จะไม่ขัดขวางการเชื่อมต่อกับผู้ให้บริการข้อมูลระบุตัวตนของคุณ แต่ก็อาจมีผลต่อประสบการณ์การยืนยันตัวตนของผู้ใช้ปลายทาง

### ชื่อและโลโก้ปุ่มโซเชียล \{#social-button-name-and-logo}

หากคุณต้องการแสดงปุ่มโซเชียลในหน้าลงชื่อเข้าใช้ คุณสามารถตั้งค่า **ชื่อ** และ **โลโก้** (โหมดมืดและโหมดสว่าง) ของผู้ให้บริการข้อมูลระบุตัวตนโซเชียล เพื่อช่วยให้ผู้ใช้จดจำตัวเลือกเข้าสู่ระบบโซเชียลได้

### ชื่อผู้ให้บริการข้อมูลระบุตัวตน \{#identity-provider-name}

ตัวเชื่อมต่อโซเชียลแต่ละตัวจะมีชื่อผู้ให้บริการข้อมูลระบุตัวตน (IdP) เฉพาะเพื่อแยกแยะตัวตนผู้ใช้ ตัวเชื่อมต่อทั่วไปจะใช้ชื่อ IdP แบบคงที่ แต่ตัวเชื่อมต่อแบบกำหนดเองต้องใช้ค่าที่ไม่ซ้ำกัน ดูข้อมูลเพิ่มเติมเกี่ยวกับ [ชื่อ IdP](https://docs.logto.io/connectors/connector-data-structure#target-identity-provider-name)

### ซิงค์ข้อมูลโปรไฟล์ \{#sync-profile-information}

ในตัวเชื่อมต่อ OAuth คุณสามารถตั้งค่านโยบายการซิงค์ข้อมูลโปรไฟล์ เช่น ชื่อผู้ใช้และรูปโปรไฟล์ เลือกได้ดังนี้:

- **ซิงค์เฉพาะตอนสมัครสมาชิก**: ดึงข้อมูลโปรไฟล์ครั้งเดียวเมื่อผู้ใช้ลงชื่อเข้าใช้ครั้งแรก
- **ซิงค์ทุกครั้งที่ลงชื่อเข้าใช้**: อัปเดตข้อมูลโปรไฟล์ทุกครั้งที่ผู้ใช้ลงชื่อเข้าใช้

### เก็บโทเค็นเพื่อเข้าถึง API ของบุคคลที่สาม (ไม่บังคับ) \{#store-tokens-to-access-third-party-apis-optional}

หากคุณต้องการเข้าถึง API ของผู้ให้บริการข้อมูลระบุตัวตนและดำเนินการต่าง ๆ ด้วยการอนุญาตของผู้ใช้ (ไม่ว่าจะผ่าน social sign-in หรือการเชื่อมบัญชี) Logto จำเป็นต้องขอ scope ของ API ที่ต้องการและเก็บโทเค็นไว้

1. เพิ่ม scope ที่ต้องการในฟิลด์ **scope** ตามคำแนะนำข้างต้น
2. เปิดใช้งาน **Store tokens for persistent API access** ในตัวเชื่อมต่อ OAuth ของ Logto Logto จะเก็บโทเค็นการเข้าถึงไว้ใน Secret Vault อย่างปลอดภัย
3. สำหรับผู้ให้บริการข้อมูลระบุตัวตน OAuth/OIDC มาตรฐาน ต้องใส่ scope `offline_access` เพื่อขอโทเค็นรีเฟรช ป้องกันการขอความยินยอมจากผู้ใช้ซ้ำ

:::warning
เก็บ client secret ของคุณให้ปลอดภัยและอย่าเปิดเผยในโค้ดฝั่งไคลเอนต์ หากถูกเปิดเผย ให้สร้างใหม่ทันทีในหน้าตั้งค่าแอปของผู้ให้บริการข้อมูลระบุตัวตนของคุณ
:::

## ใช้งานตัวเชื่อมต่อ OAuth \{#utilize-the-oauth-connector}

เมื่อคุณสร้างตัวเชื่อมต่อ OAuth และเชื่อมต่อกับผู้ให้บริการข้อมูลระบุตัวตนแล้ว คุณสามารถนำไปใช้ในกระบวนการสำหรับผู้ใช้ปลายทาง เลือกตัวเลือกที่ตรงกับความต้องการของคุณ:

### เปิดใช้งานปุ่ม social sign-in \{#enable-social-sign-in-button}

1. ใน Logto Console ไปที่ <CloudLink to="/sign-in-experience/sign-up-and-sign-in">ประสบการณ์การลงชื่อเข้าใช้ > สมัครสมาชิกและลงชื่อเข้าใช้</CloudLink>
2. เพิ่มตัวเชื่อมต่อ OAuth ในส่วน **Social sign-in** เพื่อให้ผู้ใช้ยืนยันตัวตนกับผู้ให้บริการข้อมูลระบุตัวตนของคุณ

ดูข้อมูลเพิ่มเติมเกี่ยวกับ [ประสบการณ์ social sign-in](https://docs.logto.io/end-user-flows/sign-up-and-sign-in/social-sign-in)

### เชื่อมหรือยกเลิกการเชื่อมบัญชีโซเชียล \{#link-or-unlink-a-social-account}

ใช้ Account API เพื่อสร้างศูนย์บัญชีผู้ใช้แบบกำหนดเองในแอปของคุณ ให้ผู้ใช้ที่ลงชื่อเข้าใช้เชื่อมหรือยกเลิกการเชื่อมบัญชีโซเชียลของตน [ดูตัวอย่างการใช้งาน Account API](https://docs.logto.io/end-user-flows/account-settings/by-account-api#link-a-new-social-connection)

:::tip
สามารถเปิดใช้งานตัวเชื่อมต่อ OAuth เฉพาะสำหรับการเชื่อมบัญชีและเข้าถึง API ได้ โดยไม่ต้องเปิดใช้งานสำหรับ social sign-in ก็ได้
:::

### เข้าถึง API ของผู้ให้บริการข้อมูลระบุตัวตนและดำเนินการต่าง ๆ \{#access-identity-provider-apis-and-perform-actions}

แอปพลิเคชันของคุณสามารถดึงโทเค็นการเข้าถึงที่เก็บไว้จาก Secret Vault เพื่อเรียกใช้ API ของผู้ให้บริการข้อมูลระบุตัวตนและทำงาน backend อัตโนมัติ ความสามารถเฉพาะขึ้นอยู่กับผู้ให้บริการข้อมูลระบุตัวตนและ scope ที่คุณร้องขอ ดูคู่มือการดึงโทเค็นที่เก็บไว้เพื่อเข้าถึง API

## จัดการข้อมูลระบุตัวตนโซเชียลของผู้ใช้ \{#manage-user-s-social-identity}

หลังจากผู้ใช้เชื่อมบัญชีโซเชียลแล้ว ผู้ดูแลระบบสามารถจัดการการเชื่อมต่อนั้นใน Logto Console ได้ดังนี้:

1. ไปที่ <CloudLink to="/users">Logto console > การจัดการผู้ใช้</CloudLink> และเปิดโปรไฟล์ของผู้ใช้
2. ในส่วน **Social connections** ค้นหารายการผู้ให้บริการข้อมูลระบุตัวตนและคลิก **จัดการ**
3. ในหน้านี้ ผู้ดูแลระบบสามารถจัดการการเชื่อมต่อโซเชียลของผู้ใช้ ดูข้อมูลโปรไฟล์ทั้งหมดที่ได้รับและซิงค์จากบัญชีโซเชียล และตรวจสอบสถานะโทเค็นการเข้าถึง

:::note
การตอบกลับ access token ของผู้ให้บริการข้อมูลระบุตัวตนบางรายจะไม่มีข้อมูล scope ที่เฉพาะเจาะจง ดังนั้น Logto จึงไม่สามารถแสดงรายการสิทธิ์ที่ผู้ใช้อนุญาตได้โดยตรง อย่างไรก็ตาม ตราบใดที่ผู้ใช้ได้ให้ความยินยอมกับ scope ที่ร้องขอระหว่างการอนุญาต แอปพลิเคชันของคุณจะมีสิทธิ์ที่เกี่ยวข้องเมื่อเข้าถึง OAuth API
:::
