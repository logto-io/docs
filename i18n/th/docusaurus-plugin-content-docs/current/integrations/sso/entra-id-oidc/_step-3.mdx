ขอบเขต (Scopes) กำหนดสิทธิ์ที่แอปของคุณร้องขอจากผู้ใช้ และควบคุมว่าแอปของคุณสามารถเข้าถึงข้อมูลใดจากบัญชี Microsoft Entra ID ของพวกเขาได้ การร้องขอสิทธิ์ Microsoft Graph ต้องมีการกำหนดค่าทั้งสองฝั่ง:

**ใน Microsoft Entra admin center:**

1. ไปที่ **Microsoft Entra ID > App registrations** และเลือกแอปพลิเคชันของคุณ
2. ไปที่ **API permissions > Add a permission > Microsoft Graph > Delegated permissions**
3. เลือกเฉพาะสิทธิ์ที่แอปของคุณต้องการ:
   - สิทธิ์ OpenID:
     - `openid` (จำเป็น) - ลงชื่อเข้าใช้ผู้ใช้
     - `profile` (จำเป็น) - ดูโปรไฟล์พื้นฐานของผู้ใช้
     - `email` (จำเป็น) - ดูที่อยู่อีเมลของผู้ใช้
     - `offline_access` (ไม่บังคับ) - ต้องใช้เฉพาะเมื่อคุณเปิดใช้งาน [จัดเก็บโทเค็นเพื่อเข้าถึง API อย่างต่อเนื่อง](#step-4-store-tokens-to-access-microsoft-apis-optional) ในตัวเชื่อมต่อ Logto และต้องการรับโทเค็นรีเฟรช (Refresh token) เพื่อเข้าถึง Microsoft Graph APIs แบบยาวนาน
   - การเข้าถึง API (ไม่บังคับ): เพิ่มสิทธิ์เพิ่มเติมที่แอปของคุณต้องการ สิทธิ์ Microsoft Graph ที่พบบ่อย เช่น `Mail.Read`, `Calendars.Read`, `Files.Read` เป็นต้น สามารถดู [รายการสิทธิ์ของ Microsoft Graph](https://docs.microsoft.com/en-us/graph/permissions-reference) เพื่อค้นหาสิทธิ์ที่มีให้ใช้งาน
4. คลิก **Add permissions** เพื่อยืนยันการเลือก
5. หากแอปของคุณต้องการการยินยอมจากผู้ดูแลระบบสำหรับสิทธิ์บางรายการ ให้คลิก **Grant admin consent for [Your Organization]**

<center>
  <img src="/img/assets/entra_id_oidc_add_api_permissions.webp" alt="เพิ่มสิทธิ์ Microsoft API" />
</center>

**ในตัวเชื่อมต่อ Logto Microsoft Entra ID:**

1. Logto จะเพิ่มขอบเขต `openid`, `profile` และ `email` โดยอัตโนมัติเพื่อดึงข้อมูลตัวตนพื้นฐานของผู้ใช้ คุณสามารถเว้นว่างช่อง `Scopes` ได้หากต้องการเพียงข้อมูลผู้ใช้พื้นฐาน
2. เพิ่ม `offline_access` ในช่อง `Scopes` หากคุณวางแผนจะจัดเก็บโทเค็นเพื่อเข้าถึง API อย่างต่อเนื่อง ขอบเขตนี้จะเปิดใช้งานโทเค็นรีเฟรชสำหรับการเข้าถึง API แบบยาวนาน
3. เพิ่มขอบเขตเพิ่มเติม (คั่นด้วยช่องว่าง) ในช่อง `Scopes` เพื่อร้องขอข้อมูลเพิ่มเติมจาก Microsoft Graph ใช้ชื่อขอบเขตมาตรฐาน เช่น: `User.Read Mail.Read Calendars.Read`

:::tip

หากแอปของคุณร้องขอขอบเขตเหล่านี้เพื่อเข้าถึง Microsoft Graph API และดำเนินการต่าง ๆ อย่าลืมเปิดใช้งาน **จัดเก็บโทเค็นเพื่อเข้าถึง API อย่างต่อเนื่อง** ในตัวเชื่อมต่อ Logto Microsoft Entra ID ดูรายละเอียดในหัวข้อถัดไป

:::
