## 先決條件 \{#prerequisites}

- 一個 [Mailgun](https://www.mailgun.com/) 帳號
- 來自你 Mailgun 帳號的 API 金鑰，需具備發送郵件（電子郵件）的權限。詳情請參閱 [Where Can I Find My API Key and SMTP Credentials?](https://help.mailgun.com/hc/en-us/articles/203380100-Where-Can-I-Find-My-API-Key-and-SMTP-Credentials-)。

## 基本設定 \{#basic-configuration}

- 當你使用不同的 Mailgun API endpoint 時，請填寫 `endpoint` 欄位，例如，歐盟區域應為 `https://api.eu.mailgun.net`。預設值為 `https://api.mailgun.net`。
- 在 `domain` 欄位填入你於 Mailgun 帳號註冊的網域。此值可於 Mailgun 控制台的 **Domains** 區段找到。網域格式應為 `example.com`，不需加上 `https://` 或 `http://` 前綴。
- 在 `apiKey` 欄位填入你於 Mailgun 帳號產生的 API 金鑰。
- 在 `from` 欄位填入你欲作為寄件者的電子郵件地址。此信箱必須已在你的 Mailgun 帳號中註冊。格式應為 `Sender Name <sender@example.com>`。

## 郵件內容設定（Deliveries）\{#deliveries}

### 設定物件（Config object）\{#config-object}

「Deliveries」區段允許你針對不同情境設定要發送的郵件內容。這是一個 JSON 鍵值對映，key 為用途類型（usage type），value 則為包含郵件內容設定的物件。

```json
{
  "<usage-type>": {
    // ...
  }
}
```

### 用途類型（Usage types）\{#usage-types}

支援以下用途類型：

- `Register`：使用者註冊時發送的郵件。
- `SignIn`：使用者登入時發送的郵件。
- `ForgotPassword`：使用者重設密碼時發送的郵件。
- `Generic`：使用者執行一般操作時發送的郵件，例如測試郵件連接器。

:::note
若 deliveries 設定中未指定用途類型，將發送 generic 郵件。若未指定 generic 郵件，連接器將回傳錯誤。
:::

### 內容設定（Content config）\{#content-config}

此連接器同時支援直接 HTML 內容與 Mailgun 範本。每種用途類型只能擇一使用。

在主旨與內容中，你可以使用 `{{code}}` 佔位符插入驗證碼。

若使用直接 HTML 內容，請填寫以下欄位：

- `subject`：郵件主旨。
- `replyTo`：作為回覆地址的電子郵件。
- `html`：（必填）郵件的 HTML 內容。
- `text`：郵件的純文字版本。

若使用 Mailgun 範本，請填寫以下欄位：

- `subject`：郵件主旨。
- `replyTo`：作為回覆地址的電子郵件。
- `template`：（必填）要使用的 Mailgun 範本名稱。
- `variables`：傳遞給 Mailgun 範本的變數。應為 JSON 鍵值對映，因為發送前會被字串化。注意無需包含 `code` 變數，連接器會自動加入。

### 範例 \{#example}

以下為 deliveries 設定範例：

```json
{
  "Register": {
    "subject": "{{code}} 是你的驗證碼",
    "replyTo": "Foo <foo@bar.com>",
    "html": "<h1>歡迎加入 Logto</h1><p>你的驗證碼是 {{code}}。</p>",
    "text": "歡迎加入 Logto。你的驗證碼是 {{code}}。"
  },
  "SignIn": {
    "subject": "歡迎回來 Logto",
    "replyTo": "Foo <foo@bar.com>",
    "template": "logto-sign-in",
    "variables": {
      "bar": "baz"
    }
  }
}
```
