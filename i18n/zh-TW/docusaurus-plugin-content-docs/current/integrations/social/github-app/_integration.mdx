## 步驟 1：建立 GitHub App \{#step-1-create-a-github-app}

在你能將 GitHub 作為驗證 (Authentication) 提供者之前，必須先在 GitHub 上建立一個 GitHub App，以取得 OAuth 2.0 憑證。

1. 前往 [GitHub](https://github.com/) 並使用你的帳號登入，或如有需要註冊新帳號。
2. 導航至 [Settings > Developer settings > GitHub Apps](https://github.com/settings/apps)。
3. 點擊 **New GitHub App** 註冊新應用程式：
   - **GitHub App name**：輸入你的應用程式唯一名稱。名稱不得超過 34 個字元，且需在 GitHub 上全域唯一。
   - **Homepage URL**：輸入你的應用程式首頁網址。
   - **Callback URL**：從 Logto GitHub 連接器複製 **Callback URI** 並貼上於此。若有需要可新增多個 callback URL。使用者透過 GitHub 登入後，將被導向此處並帶有 Logto 用於完成驗證 (Authentication) 的授權碼。
   - **Expire user authorization tokens**：請保持**勾選**（建議）。這將啟用權杖過期與重新整理權杖 (Refresh token)，提升安全性。
   - **Request user authorization (OAuth) during installation**：可選擇勾選，讓使用者在安裝時授權你的應用程式。
   - **Webhook**：若不需要 webhook 事件，請取消勾選 **Active**。僅用於驗證 (Authentication) 的情境通常不需 webhook。
4. 在 **Permissions** 區段，設定你的應用程式所需權限（詳見下方步驟 2）。
5. 在 **Where can this GitHub App be installed?**，若希望任何 GitHub 帳號的使用者都能用你的應用程式進行驗證 (Authentication)，請選擇 **Any account**。
6. 點擊 **Create GitHub App** 建立 GitHub App。

:::note
與 OAuth Apps 不同，GitHub Apps 採用細緻權限（fine-grained permissions）而非廣泛權限範圍 (Scopes)。你需在 GitHub 控制台於建立應用程式時設定權限，使用者在授權時會授予特定儲存庫的存取權。

更多 GitHub App 設定細節，請參閱 [Registering a GitHub App](https://docs.github.com/en/apps/creating-github-apps/registering-a-github-app/registering-a-github-app)。
:::

## 步驟 2：在 GitHub 設定權限 \{#step-2-configure-permissions-in-github}

GitHub Apps 採用細緻權限（fine-grained permissions），而非 OAuth 權限範圍 (Scopes)。你必須在建立或編輯 GitHub App 時，**於 GitHub 控制台設定權限**。這些權限決定你的應用程式能存取哪些資料。

### 瞭解 GitHub App 權限類型 \{#understanding-github-app-permissions}

權限分為三種類型：

- **儲存庫權限 (Repository permissions)**：存取儲存庫層級資源（程式碼、議題、拉取請求等）
- **組織權限 (Organization permissions)**：存取組織層級資源（成員、團隊、專案等）
- **帳號權限 (Account permissions)**：存取使用者帳號資料（電子郵件、個人檔案、追蹤者等）

每個權限可選擇：

- **No access**：應用程式無法存取此資源
- **Read-only**：僅可讀取此資源，無法修改
- **Read & write**：可讀取並修改此資源

### 驗證 (Authentication) 推薦權限設定 \{#recommended-permissions-for-authentication}

若僅需「以 GitHub 登入」的基本功能，請設定以下最低 **帳號權限 (Account permissions)**：

| 權限                | 存取層級  | 用途                         |
| ------------------- | --------- | ---------------------------- |
| **Email addresses** | Read-only | 取得使用者電子郵件以建立帳號 |

:::tip
GitHub Apps 代表使用者操作時，預設可讀取公開個人檔案資訊。你無需額外請求基本個人資料（如使用者名稱、大頭貼、公開個人頁面網址）的權限。
:::

### 進階 API 存取權限 \{#additional-permissions-for-api-access}

若你的應用程式需存取驗證 (Authentication) 以外的 GitHub API，請在 GitHub 控制台新增對應權限。常見範例如下：

| 權限類型         | 權限          | 存取層級                 | 使用情境                           |
| ---------------- | ------------- | ------------------------ | ---------------------------------- |
| **Repository**   | Contents      | Read-only / Read & write | 存取儲存庫檔案與程式碼             |
| **Repository**   | Issues        | Read & write             | 建立與管理議題                     |
| **Repository**   | Pull requests | Read & write             | 建立與管理拉取請求                 |
| **Repository**   | Metadata      | Read-only                | 存取儲存庫中繼資料（許多操作必需） |
| **Organization** | Members       | Read-only                | 列出組織成員                       |
| **Account**      | Followers     | Read-only                | 存取使用者追蹤者與追蹤名單         |

這不是完整清單 — GitHub Apps 支援更多細緻權限。完整列表請參閱 [Permissions required for GitHub Apps](https://docs.github.com/en/rest/overview/permissions-required-for-github-apps)。

:::tip[與 OAuth Apps 的主要差異]
與 OAuth Apps 需在 Logto 連接器設定權限範圍 (Scope) 不同，GitHub App 權限完全於 GitHub 控制台管理。你可以在 Logto GitHub 連接器的 `Scope` 欄位留空 — 因為 GitHub Apps 不使用傳統 OAuth 權限範圍。

只需在 GitHub 設定所需權限，使用者授權時會自動提示授權。
:::

## 步驟 3：設定 Logto 連接器 \{#step-3-configure-your-logto-connector}

建立 GitHub App 後，你會被導向其設定頁面，可在此取得憑證。

1. 在 GitHub App 設定頁複製 **Client ID**，貼到 Logto 的 `clientId` 欄位。
2. 在 **Client secrets** 區點擊 **Generate a new client secret**，複製產生的密鑰並貼到 Logto 的 `clientSecret` 欄位。
3. 在 Logto 點擊 **Save and Done**，即可將你的身分系統與 GitHub 連接。

:::warning
請妥善保管 Client secret，切勿在前端程式碼中暴露。若遺失 GitHub client secret 將無法找回，需重新產生。
:::

:::note
GitHub App 的 Client ID 與 App ID 不同。請務必使用設定頁標示為「Client ID」的值，而非 App ID。
:::

## 步驟 4：一般設定 \{#step-4-general-settings}

以下為一些不會阻礙 GitHub 連線、但可能影響終端使用者驗證 (Authentication) 體驗的通用設定。

### 同步個人檔案資訊 \{#sync-profile-information}

在 GitHub 連接器中，你可設定如何將 GitHub 使用者資訊同步到 Logto 使用者檔案，包括 `name`、`avatar` 與 `email`。可選擇：

- **僅於註冊時同步**：使用者首次登入時擷取一次個人資訊。
- **每次登入時皆同步**：每次登入時都更新個人資訊。

### 儲存權杖以存取 GitHub API（選用） \{#store-tokens-to-access-github-apis-optional}

若你希望存取 GitHub API 並以使用者授權執行操作（無論是社交登入或帳號連結），請在 Logto 啟用權杖儲存：

1. 在 GitHub App 設定（步驟 2）中設定所需權限。
2. 在 Logto GitHub 連接器啟用 **Store tokens for persistent API access**。Logto 會將存取權杖 (Access token) 與重新整理權杖 (Refresh token) 安全儲存於 Secret Vault。

:::note
由於 GitHub Apps 一律發放重新整理權杖 (Refresh token)，Logto 會自動儲存兩種權杖。Access token 有效期為 8 小時，但 Logto 可利用 refresh token 取得新 access token，確保 API 存取不中斷，最長可達 6 個月。
:::

## 步驟 5：測試整合（選用） \{#step-5-test-your-integration-optional}

在正式上線前，請測試你的 GitHub App 整合：

1. 在 Logto 開發租戶中使用該連接器。
2. 驗證使用者能否以 GitHub 登入。
3. 檢查授權時是否正確提示所需權限。
4. 若啟用權杖儲存，確認存取權杖（與重新整理權杖）儲存無誤。
5. 使用儲存的權杖測試 API 呼叫，確保權限運作正常。

GitHub Apps 可立即與任何 GitHub 使用者帳號配合使用 — 不像其他平台那樣需要測試帳號或應用程式審核。但若你的應用程式安裝於組織，組織擁有者可能需批准安裝。
