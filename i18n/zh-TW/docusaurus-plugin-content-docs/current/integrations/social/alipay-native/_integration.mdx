## 註冊 Alipay 開發者帳號 \{#register-alipay-developer-account}

[註冊 Alipay 開發者帳號](https://certifyweb.alipay.com/certify/reg/guide#/)（如果你還沒有的話）。

## 建立並設定 Alipay 應用程式 \{#create-and-configure-alipay-app}

1. 使用剛註冊的帳號登入 [Alipay 控制台](https://open.alipay.com/)。
2. 前往「我的應用」(我的应用) 面板中的「網頁 & 行動應用」(网页&移动应用) 分頁。
3. 點擊「立即建立」(立即创建) 按鈕開始設定你的應用程式。
4. 在「應用名稱」(应用名称) 欄位依命名規範命名，並上傳「應用圖示」(应用图标)，確保「應用類型」(应用类型) 選擇「行動應用」(移动应用)。若要建立 iOS App，需填寫唯一的「Bundle ID」。Android App 則需填寫「應用簽名」(应用签名) 與「應用套件名稱」(应用包名)。
5. 完成應用程式建立後，進入總覽頁面，點擊「新增能力」(添加能力)，新增「第三方應用授權」(第三方应用授权)、「獲取會員資訊」(获取会员信息) 及「App Alipay 登入」(App 支付宝登录)，以啟用 Alipay 登入功能。
6. 前往 [Alipay 客戶中心](https://b.alipay.com/index2.htm)，並以開發者帳號登入。點擊頂部的「帳號中心」(账号中心)，進入「APPID 綁定」(APPID 绑定)，入口在側邊欄底部。於此輸入你在步驟 4 創建的行動應用 APPID，點擊「新增綁定」(添加绑定)。
7. 點擊「App Alipay 登入」的「簽約」(Sign) 按鈕，依指引完成簽約流程。完成後，你會發現步驟 5 新增的能力已生效。
8. 回到 Alipay 開放平台控制台頁面，在「開發資訊」(开发信息) 區塊可找到「介面加簽方式（密鑰 / 證書）」(接口加签方式（密钥/证书）)。點擊「設定」(设置) 按鈕，進入簽名方式設定頁面。建議選擇「公鑰」(公钥) 簽名模式，並將你產生的公鑰檔案內容填入文字框。
9. 點擊 Alipay 控制台頁面底部的「設定」(设置) 按鈕，設定「授權回調地址」(授权回调地址)。Logto core 預設的 redirect URI 為 `${your_logto_origin}/callback/${connector_id}`。`connector_id` 可於 Logto 管理後台連接器詳細頁頂部找到。
10. 完成上述所有步驟後，回到 Alipay 控制台頁面右上角，點擊「提交審核」(提交审核)。審核通過後，即可順利啟用 Alipay 登入流程。

:::note

你可以在本機終端機執行以下指令，使用 _openssl_ 產生金鑰對。

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

在 Alipay 應用設定網站填寫公鑰時，需移除 `public.pem` 的檔頭與檔尾，刪除所有換行字元，並將剩餘內容貼入「公鑰」(public key) 的文字框中。
:::

## 設定 Logto Alipay Native 連接器 \{#set-up-the-logto-alipay-native-connector-settings}

1. 在 [Alipay 控制台工作區](https://open.alipay.com/dev/workspace) 的「我的應用」(我的应用) 面板，點擊「網頁 & 行動應用」(网页&移动应用) 分頁，可查詢所有應用的 APPID。
2. 在前述步驟 7，你已產生一組包含私鑰與公鑰的金鑰對。
3. 填寫 Logto 連接器設定：
   - `appId` 欄位填入步驟 1 取得的 APPID。
   - `privateKey` 欄位填入步驟 2 產生的私鑰檔案內容。請務必將所有換行字元以 '\n' 取代。私鑰檔案不需移除檔頭與檔尾。
   - `signType` 欄位填入 'RSA2'，因我們在「建立並設定 Alipay 應用程式」步驟 7 選擇了 `公鑰` 簽名模式。

### 設定類型 \{#config-types}

| 名稱       | 類型        | 列舉值         |
| ---------- | ----------- | -------------- |
| appId      | string      | N/A            |
| privateKey | string      | N/A            |
| signType   | enum string | 'RSA' / 'RSA2' |

## 在你的應用中啟用 Alipay Native 登入 \{#enable-alipay-native-sign-in-in-your-app}

### iOS \{#ios}

假設你已在應用中整合 [Logto iOS SDK](/quick-starts/swift)。這樣一來，流程非常簡單，甚至不需要閱讀 Alipay SDK 文件：

**1. 將 `LogtoSocialPluginAlipay` 加入 Xcode 專案**

新增 framework：

<img src="/img/assets/add-framework.png" alt="Add framework" />

:::note

此插件已內含 Alipay「極簡版 SDK」(极简版 SDK)。匯入插件後可直接使用 `import AFServiceSDK`。

:::

**2. 在 `LogtoClient` 初始化選項中加入插件**

```swift
let logtoClient = LogtoClient(
  useConfig: config,
  socialPlugins: [LogtoSocialPluginAlipay(callbackScheme: "your-scheme")]
)
```

其中 `callbackScheme` 為 [自訂 URL Scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) 之一，可導向你的應用。

### Android \{#android}

假設你已在應用中整合 [Logto Android SDK](/quick-starts/android)。這樣一來，流程非常簡單，甚至不需要閱讀 Alipay SDK 文件：

**1. 下載 Alipay「極簡版 SDK」並加入專案**

從 [Logto 3rd-party Social SDKs](https://github.com/logto-io/social-sdks/blob/master/alipay/android/alipaySdk-15.7.9-20200727142846.aar) 下載 Alipay「極簡版 SDK」(极简版 SDK) 至專案的 `app/libs` 資料夾：

```bash
project-path/app/libs/alipaySdk-15.7.9-20200727142846.aar
```

**2. 將 Alipay「極簡版 SDK」設為相依套件**

打開你的 `build.gradle` 檔案：

```bash
project-path/app/build.gradle
```

新增相依套件：

```kotlin
dependencies {
  // ...
  implementation(files("./libs/alipaySdk-15.7.9-20200727142846.aar"))  // kotlin-script
  // 或
  implementation files('./libs/alipaySdk-15.7.9-20200727142846.aar')  // groovy-script
}
```
