## 步驟 1：在 Facebook App Dashboard 建立應用程式 \{#step-1-set-up-an-app-on-facebook-app-dashboard}

在你能將 Facebook 作為驗證 (Authentication) 提供者前，必須先在 Facebook 開發者平台建立應用程式，以取得 OAuth 2.0 憑證。

1. 如果你還沒有帳號，請先[註冊成為 Facebook 開發者](https://developers.facebook.com/docs/development/register/)。
2. 前往 [Apps](https://developers.facebook.com/apps) 頁面。
3. 點選你現有的應用程式，或[建立新應用程式](https://developers.facebook.com/docs/development/create-an-app)。

:::tip
用例（Use case）是你的應用程式與 Meta 互動的主要方式，決定可用的 API、功能、權限與產品。如果你只需要社交驗證（取得 email 與 public_profile），請選擇「Authentication and request data from users with Facebook Login」。若你想存取 Facebook API，請選擇你偏好的用例——大多數用例在建立應用程式後也支援整合「Facebook Login for business」。
:::

4. 建立應用程式後，在應用程式儀表板頁面，前往 **Use cases > Facebook Login > Settings** 或 **Facebook Login for business > Settings**。
5. 在 **Valid OAuth Redirect URIs** 欄位填入 Logto 的 **Callback URI**（可從你的 Logto Facebook 連接器複製）。使用者以 Facebook 登入後，會被導向此處，Logto 會用授權碼完成驗證 (Authentication)。
6. 前往 **Use cases**，點擊你的用例的 **Customize**，新增權限範圍（Scopes）。建議新增 `email` 與 `public_profile`，這是 Logto 實現 Facebook 登入所需的基本權限。

## 步驟 2：以用戶端憑證設定 Logto 連接器 \{#step-2-set-up-logto-connector-with-client-credentials}

1. 在 Facebook App Dashboard，點選側邊欄的 **App settings > Basic**。
2. 你會在面板上看到 **App ID** 與 **App secret**。
3. 點擊 App secret 輸入框旁的 **Show** 按鈕以顯示並複製內容。
4. 設定你的 Logto Facebook 連接器：
   - 將 **App ID** 填入 `clientId` 欄位。
   - 將 **App secret** 填入 `clientSecret` 欄位。
   - 在 Logto 點擊 **Save and Done**，即可將你的身分系統與 Facebook 連接。

## 步驟 3：設定權限範圍（Scopes） \{#step-3-configure-scopes}

權限範圍（Scopes）定義你的應用程式向使用者請求哪些權限，並控制你的專案能從他們的 Facebook 帳號存取哪些私人資料。

### 在 Facebook App Dashboard 設定權限範圍 \{#configure-scopes-in-facebook-app-dashboard}

1. 前往 **Facebook App Dashboard > Use cases**，點擊 **Customize** 按鈕。
2. 只新增你的應用程式所需的權限範圍。使用者會在 Facebook 使用者授權頁面 (Consent screen) 審核並授權這些權限：
   - **驗證 (Authentication)（必要）**：`email` 與 `public_profile`。
   - **API 存取（選用）**：應用程式需要的其他權限範圍（例如存取 Threads API 的 `threads_content_publish`、`threads_read_replies`）。可參考 [Meta 開發者文件](https://developers.facebook.com/docs/) 了解可用服務。

### 在 Logto 設定權限範圍 \{#configure-scopes-in-logto}

根據需求選擇以下其中一種方式：

**選項 1：不需額外 API 權限範圍**

- 保持 Logto Facebook 連接器的 `Scopes` 欄位為空。
- 預設會請求 `email public_profile` 權限，確保 Logto 能正確取得基本使用者資訊。

**選項 2：登入時請求額外權限範圍**

- 在 **Scopes** 欄位輸入所有需要的權限範圍，並以空格分隔。
- 此處列出的權限範圍會覆蓋預設值，因此請務必包含驗證 (Authentication) 權限：`email public_profile`。

**選項 3：後續漸進式請求權限範圍**

- 使用者登入後，可透過重新啟動聯邦社交授權流程，並更新使用者儲存的權杖集，按需請求額外權限範圍。
- 這些額外權限範圍無需填寫在 Logto Facebook 連接器的 `Scopes` 欄位，可透過 Logto 的 Social Verification API 實現。

依照這些步驟，Logto Facebook 連接器會精確請求你的應用程式所需的權限——不多也不少。

:::tip
如果你的應用程式請求這些權限以存取 Facebook API 並執行操作，請務必在 Logto Facebook 連接器啟用 **Store tokens for persistent API access**。詳情請見下一節。
:::

## 步驟 4：一般設定 \{#step-4-general-settings}

以下為一些不會阻礙 Facebook 連線，但可能影響終端使用者驗證 (Authentication) 體驗的一般設定。

### 同步個人資料資訊 \{#sync-profile-information}

在 Facebook 連接器中，你可以設定同步個人資料資訊（如使用者名稱與頭像）的政策。可選擇：

- **僅於註冊時同步**：使用者首次登入時擷取一次個人資料。
- **每次登入時皆同步**：每次使用者登入時都會更新個人資料。

### 儲存權杖以存取 Facebook API（選用） \{#store-tokens-to-access-facebook-apis-optional}

若你希望存取 Facebook API 並在使用者授權下執行操作（無論是社交登入或帳號連結），Logto 需取得特定 API 權限範圍並儲存權杖。

1. 依照上述教學新增所需權限範圍。
2. 在 Logto Facebook 連接器啟用 **Store tokens for persistent API access**。Logto 會將 Facebook 存取權杖安全儲存在 Secret Vault。

:::note
Facebook 不提供重新整理權杖 (Refresh tokens)。但啟用權杖儲存後，Logto 會在使用者驗證 (Authentication) 時自動請求長效型存取權杖（60 天）。在此期間，使用者可手動撤銷存取權杖，否則無需重新授權即可存取 Facebook API。注意：請勿在 `Scope` 欄位新增 `offline_access`，否則可能導致錯誤。
:::

## 步驟 5：使用 Facebook 測試用戶測試登入（選用） \{#step-5-test-sign-in-with-facebook-s-test-users-optional}

你可以使用測試、開發者與管理員帳號測試應用程式登入。你也可以直接發佈應用程式，讓任何 Facebook 使用者都能登入。

1. 在 Facebook App Dashboard，點選側邊欄 **App roles > Test Users**。
2. 點擊 **Create test users** 按鈕建立測試用戶。
3. 點擊現有測試用戶的 **Options** 按鈕以查看更多操作，例如「更改名稱與密碼」。

## 步驟 6：發佈 Facebook 登入設定 \{#step-6-publish-facebook-sign-in-settings}

通常只有測試、管理員與開發者用戶能登入應用程式。若要讓正式環境下的普通 Facebook 使用者也能登入，需將應用程式發佈。

1. 在 Facebook App Dashboard，點選側邊欄 **Publish**。
2. 如有需要，填寫 **Privacy Policy URL** 與 **User data deletion** 欄位。
3. 點擊右下角的 **Save changes** 按鈕。
4. 點擊應用程式頂部的 **Live** 開關按鈕。
