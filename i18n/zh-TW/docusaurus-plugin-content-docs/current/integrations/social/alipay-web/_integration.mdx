## 註冊 Alipay 開發者帳號 \{#register-alipay-developer-account}

[註冊 Alipay 開發者帳號](https://certifyweb.alipay.com/certify/reg/guide#/)（如果你還沒有的話）。

## 建立並設定 Alipay 應用程式 \{#create-and-configure-alipay-app}

1. 使用剛註冊的帳號登入 [Alipay 控制台](https://open.alipay.com/)。
2. 在「我的應用」(我的应用) 面板中，前往「網頁 & 行動應用」(网页&移动应用) 分頁。
3. 點擊「立即建立」(立即创建) 按鈕開始設定你的應用程式。
4. 在「應用名稱」(应用名称) 欄位中依照命名規範命名你的應用，並上傳「應用圖示」(应用图标)，確保「應用類型」(应用类型) 選擇「網頁應用」(网页应用)。
5. 完成應用建立後，會進入總覽頁面，這裡需要點擊「新增能力」(添加能力)，新增「第三方應用授權」(第三方应用授权)、「獲取會員資訊」(获取会员信息) 以及「App Alipay 登入」(App 支付宝登录)，以啟用 Alipay 登入功能。
6. 前往 [Alipay 客戶中心](https://b.alipay.com/index2.htm)，並使用 Alipay 開發者帳號登入。點擊頂部的「帳號中心」(账号中心)，進入「APPID 綁定」(APPID 绑定)，入口在側邊欄底部。於此輸入你在步驟 4 創建的網頁應用 APPID，點擊「新增綁定」(添加绑定)。
7. 點擊「App Alipay 登入」的「簽約」(Sign) 按鈕，並依照指引完成簽約流程。完成後，你會發現步驟 5 新增的能力已經生效。
8. 回到 Alipay 開放平台控制台頁面，在「開發資訊」(开发信息) 區塊可以找到「介面加簽方式（密鑰/證書）」(接口加签方式（密钥/证书）)。點擊「設定」(设置) 按鈕，進入加簽方式設定頁面。建議選擇「公鑰」(公钥) 作為加簽模式，並將你產生的公鑰檔案內容填入文字輸入框。
9. 在 Alipay 控制台頁面底部，點擊「設定」(设置) 按鈕，設定「授權回調地址」(授权回调地址)。`${your_logto_origin}/callback/${connector_id}` 是 Logto core 預設的 redirect URI。`connector_id` 可在 Logto 管理後台連接器詳細頁面頂部找到。
10. 完成上述所有步驟後，回到 Alipay 控制台頁面右上角，點擊「提交審核」(提交审核)。審核通過後，即可順利啟用 Alipay 登入流程。

:::note
你可以在本機終端機執行以下指令，使用 _openssl_ 產生金鑰對。

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

在 Alipay 應用設定網站填寫公鑰時，請移除 `public.pem` 的標頭與結尾，刪除所有換行字元，並將剩餘內容貼入「公鑰」(public key) 的文字輸入框。

:::

## 設定 Logto Alipay Web 連接器 \{#set-up-the-logto-alipay-web-connector-settings}

1. 在 [Alipay 控制台工作區](https://open.alipay.com/dev/workspace) 的「我的應用」(我的应用) 面板，點擊「網頁 & 行動應用」(网页&移动应用) 分頁，可以找到所有應用的 APPID。
2. 在前述步驟 7，你已經產生了一組包含私鑰與公鑰的金鑰對。
3. 填寫 Logto 連接器設定：
   - `appId` 欄位填入你在步驟 1 取得的 APPID。
   - `privateKey` 欄位填入步驟 2 產生的私鑰檔案內容。請務必將所有換行字元替換為 '\n'，且不要移除私鑰檔案的標頭與結尾。
   - `signType` 欄位填入 'RSA2'，因為我們在「建立並設定 Alipay 應用程式」步驟 7 選擇了 `Public key` 加簽模式。
   - `charset` 欄位可填 'gbk' 或 'utf8'，此欄位為選填，預設值為 'utf8'。
   - `scope` 欄位可填 'auth_base' 或 'auth_user'，此欄位為選填，預設值為 'auth_user'。你可以參考 [不同值的差異](https://opendocs.alipay.com/fw/api/105942)。

### 設定類型 \{#config-types}

| 名稱       | 類型               | 列舉值                     |
| ---------- | ------------------ | -------------------------- |
| appId      | string             | N/A                        |
| privateKey | string             | N/A                        |
| signType   | enum string        | 'RSA' / 'RSA2'             |
| charset    | enum string (選填) | 'gbk' / 'utf8' / undefined |
| scope      | enum string (選填) | 'auth_user' / 'auth_base'  |
