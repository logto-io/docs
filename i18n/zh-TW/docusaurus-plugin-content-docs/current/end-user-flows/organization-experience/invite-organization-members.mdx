---
sidebar_position: 6
---

# 邀請組織成員

在多租戶應用程式中，常見需求之一是邀請成員加入組織。本指南將帶你瞭解實作此功能的步驟與技術細節。

## 流程概覽 \{#flow-overview}

整體流程如下圖所示：

```mermaid
sequenceDiagram
	Participant U as 終端使用者 (End user)
  Participant A as 組織管理員 (Organization admin)
  Participant C as 你的多組織應用程式 (Your multi-organization app)
	Participant L as Logto

  A ->> C: 輸入受邀者電子郵件與角色 (Input invitee email and role)
  C ->> L: 使用 Management API 建立組織邀請 (Create organization invitation with Management API)
  L -->> C: 回傳邀請 ID (Return invitation ID)
  C ->> C: 組合帶有邀請 ID 的邀請連結 (Compose invitation link with invitation ID)
  C ->> L: 請求發送帶有邀請連結的邀請郵件 (Request sending invitation email with invitation link)
  L -->> U: 發送帶有邀請連結的邀請郵件 (Send invitation email with invitation link)
  U ->> C: 點擊邀請連結並導向你的著陸頁，<br />接受或拒絕邀請 (Click invitation link and navigate to your landing page,<br /> accept or reject the invitation)
  C ->> L: 使用 Management API 更新邀請狀態 (Update invitation status with Management API)
```

## 建立組織角色 \{#create-organization-roles}

在邀請成員之前，請先建立組織角色。參閱 [組織範本](/authorization/organization-template) 以瞭解更多角色與權限相關資訊。

本指南將建立兩個典型的組織角色：`admin` 與 `member`。

`admin` 角色擁有組織內所有資源的完整存取權限，而 `member` 角色則有較有限的權限。例如：

- `admin` 角色：
  - `read:data` - 讀取所有組織資料資源的權限。
  - `write:data` - 寫入所有組織資料資源的權限。
  - `delete:data` - 刪除所有組織資料資源的權限。
  - `invite:member` - 邀請成員加入組織。
  - `manage:member` - 管理組織內成員。
  - `delete:member` - 移除組織成員。
- `member` 角色：
  - `read:data` - 讀取所有組織資料資源的權限。
  - `write:data` - 寫入所有組織資料資源的權限。
  - `invite:member` - 邀請成員加入組織。

這些設定可在 [Logto Console](https://cloud.logto.io/) 輕鬆完成。你也可以使用 [Logto Management API](https://openapi.logto.io/operation/operation-createorganizationrole) 以程式化方式建立組織角色。

## 設定你的電子郵件連接器 \{#configure-your-email-connector}

由於邀請是透過電子郵件發送，請確保你的 [電子郵件連接器](/connectors/email-connectors) 已正確設定。若要發送邀請，請設定一個 `OrganizationInvitation` 用途類型的 [電子郵件範本](/connectors/email-connectors/email-templates#email-template-types)。你可以在內容中加入組織（如名稱、Logo）與邀請人（如電子郵件、姓名）[變數](/connectors/email-connectors/email-templates#email-template-variables)，並依需求自訂 [在地化範本](/connectors/email-connectors/email-templates#email-template-localization)。

以下為 `OrganizationInvitation` 用途類型的電子郵件範本範例：

```json
{
  "subject": "你被邀請加入 {{organization.name}}",
  "content": "<p>你好，</p><p>{{inviter.name}} ({{inviter.primaryEmail}}) 邀請你加入 <strong>{{organization.name}}</strong>。</p><p>點擊這個 <a href=\"{{link}}\" target=\"_blank\">連結</a> 接受邀請並開始使用。</p><p>如果你未預期收到此邀請，請忽略這封郵件。</p>",
  "usageType": "OrganizationInvitation",
  "type": "text/html"
}
```

電子郵件內容中的 `{{link}}` 佔位符會在郵件發送時自動替換為實際的邀請連結。

## 使用 Logto Management API 處理邀請 \{#handle-invitations-with-logto-management-api}

:::note

如果你尚未設定 Logto Management API，請參閱 [與 Management API 互動](/integrate-logto/interact-with-management-api) 以取得詳細資訊。

:::

### 使用 Logto Management API 建立組織邀請 \{#create-an-organization-invitation-with-logto-management-api}

組織功能中包含一組與邀請相關的 Management API。你可以透過這些 API：

- `POST /api/organization-invitations`：建立帶有指定組織角色的組織邀請。
- `POST /api/one-time-tokens`：為受邀者建立一次性權杖，供其接受邀請時驗證身分。[進一步瞭解](/end-user-flows/one-time-token)
- `POST /api/organization-invitations/{id}/message`：透過電子郵件將組織邀請發送給受邀者。

:::note

請求內容支援 `link` 屬性，你可以根據邀請 ID 組合自訂邀請連結。例如：

:::

```json
{
  "link": "https://your-app.com/invitation/join?id=your-invitation-id&token=your-one-time-token&email=invitee-email"
}
```
