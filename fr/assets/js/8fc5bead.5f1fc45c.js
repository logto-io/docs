"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[5497],{81875:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"quick-starts/database/hasura/README","title":"Ajoutez l\u2019authentification \xe0 votre application Hasura","description":"Hasura est un outil qui peut rapidement fournir des API GraphQL et REST correspondant \xe0 vos donn\xe9es. En consid\xe9rant la s\xe9curit\xe9 des donn\xe9es, Hasura offre \xe9galement la possibilit\xe9 de peaufiner le contr\xf4le d\'acc\xe8s pour chaque API diff\xe9rente.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/quick-starts/database/hasura/README.mdx","sourceDirName":"quick-starts/database/hasura","slug":"/quick-starts/hasura","permalink":"/fr/quick-starts/hasura","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/quick-starts/database/hasura/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/hasura","sidebar_label":"Hasura","sidebar_custom_props":{"description":"Int\xe9grer Logto avec Hasura."}},"sidebar":"quickStartSidebar","previous":{"title":"Web traditionnel","permalink":"/fr/quick-starts/traditional-web"},"next":{"title":"Supabase","permalink":"/fr/quick-starts/supabase"}}');var a=r(86070),t=r(15658);const o={slug:"/quick-starts/hasura",sidebar_label:"Hasura",sidebar_custom_props:{description:"Int\xe9grer Logto avec Hasura."}},i="Ajoutez l\u2019authentification \xe0 votre application Hasura",c={},u=[{value:"Contexte",id:"contexte",level:2},{value:"Commencer",id:"commencer",level:2},{value:"1. Cr\xe9er une ressource API Hasura dans Logto",id:"1-cr\xe9er-une-ressource-api-hasura-dans-logto",level:3},{value:"2. Cr\xe9er des r\xf4les selon la configuration Hasura dans Logto",id:"2-cr\xe9er-des-r\xf4les-selon-la-configuration-hasura-dans-logto",level:3},{value:"3. Configurer la variable d&#39;environnement Hasura <code>HASURA_GRAPHQL_JWT_SECRET</code> pour activer le mode JWT",id:"3-configurer-la-variable-denvironnement-hasura-hasura_graphql_jwt_secret-pour-activer-le-mode-jwt",level:3},{value:"4. Personnaliser les revendications suppl\xe9mentaires du jeton d\u2019acc\xe8s utilisateur",id:"4-personnaliser-les-revendications-suppl\xe9mentaires-du-jeton-dacc\xe8s-utilisateur",level:3},{value:"5. Int\xe9grer Logto SDK",id:"5-int\xe9grer-logto-sdk",level:3},{value:"Conclusion",id:"conclusion",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"ajoutez-lauthentification-\xe0-votre-application-hasura",children:"Ajoutez l\u2019authentification \xe0 votre application Hasura"})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.a,{href:"https://hasura.io/",children:"Hasura"})," est un outil qui peut rapidement fournir des API GraphQL et REST correspondant \xe0 vos donn\xe9es. En consid\xe9rant la s\xe9curit\xe9 des donn\xe9es, Hasura offre \xe9galement la possibilit\xe9 de peaufiner le contr\xf4le d'acc\xe8s pour chaque API diff\xe9rente."]}),"\n",(0,a.jsx)(s.p,{children:"Habituellement, les utilisateurs de Hasura utilisent d'autres services de gestion d'identit\xe9 et d'authentification, Logto \xe9tant l'un des plus populaires parmi eux."}),"\n",(0,a.jsx)(s.p,{children:"Dans cet article de blog, nous supposerons que vous utilisez d\xe9j\xe0 les services Hasura. Nous allons introduire comment int\xe9grer Hasura et Logto pour maximiser la s\xe9curit\xe9 de vos donn\xe9es. Si vous n'avez pas de compte Logto, inscrivez-vous et commencez \xe0 l'utiliser d\xe8s maintenant !"}),"\n",(0,a.jsx)(s.h2,{id:"contexte",children:"Contexte"}),"\n",(0,a.jsxs)(s.p,{children:["Hasura utilise la ",(0,a.jsx)(s.a,{href:"https://hasura.io/docs/latest/auth/overview/",children:"gestion des acc\xe8s bas\xe9e sur les r\xf4les"}),", tandis que Logto utilise le standard ",(0,a.jsx)(s.a,{href:"/authorization/role-based-access-control",children:"Contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["Dans le mod\xe8le et les meilleures pratiques de Logto pour le RBAC, nous conseillons aux utilisateurs d'utiliser ",(0,a.jsx)(s.code,{children:"scope"})," pour correspondre \xe0 la granularit\xe9 la plus fine des Permissions, d'utiliser ",(0,a.jsx)(s.code,{children:"role"})," comme un ensemble de ",(0,a.jsx)(s.code,{children:"scope"}),"s pour des op\xe9rations par lots pratiques, et finalement de v\xe9rifier ",(0,a.jsx)(s.code,{children:"scope"})," (g\xe9n\xe9ralement du c\xf4t\xe9 des fournisseurs de ressources) pour v\xe9rifier si un utilisateur peut effectuer une op\xe9ration sp\xe9cifique."]}),"\n",(0,a.jsxs)(s.p,{children:["Dans Hasura, un ",(0,a.jsx)(s.code,{children:"role"})," correspond \xe0 la granularit\xe9 la plus fine des Permissions, et les v\xe9rifications de Permission sont effectu\xe9es par rapport aux ",(0,a.jsx)(s.code,{children:"role"}),"s. Par cons\xe9quent, lors de la configuration de Logto, nous recommandons de mapper un ",(0,a.jsx)(s.code,{children:"role"})," \xe0 exactement un ",(0,a.jsx)(s.code,{children:"scope"}),". Cette approche peut lier les Permissions de Logto et de Hasura ensemble pour \xe9viter toute confusion et mauvaise utilisation."]}),"\n",(0,a.jsxs)(s.p,{children:["Hasura peut prendre en charge le contr\xf4le d'acc\xe8s en utilisant des Webhooks ou des JWT. Notre pr\xe9c\xe9dent ",(0,a.jsx)(s.a,{href:"https://blog.logto.io/logto-x-hasura",children:"article de blog"})," a introduit comment utiliser les Webhooks, et dans les sections suivantes, nous expliquerons comment utiliser le contr\xf4le d'acc\xe8s en mode JWT de Hasura."]}),"\n",(0,a.jsx)(s.h2,{id:"commencer",children:"Commencer"}),"\n",(0,a.jsxs)(s.p,{children:["Commen\xe7ons par un exemple simple. Supposons qu'un utilisateur ait d\xe9j\xe0 deux API dans Hasura, ",(0,a.jsx)(s.code,{children:"GET /user"})," et ",(0,a.jsx)(s.code,{children:"PATCH /user"}),", correspondant \xe0 deux r\xf4les : ",(0,a.jsx)(s.code,{children:"user:reader"})," et ",(0,a.jsx)(s.code,{children:"user:maintainer"}),", respectivement."]}),"\n",(0,a.jsx)(s.h3,{id:"1-cr\xe9er-une-ressource-api-hasura-dans-logto",children:"1. Cr\xe9er une ressource API Hasura dans Logto"}),"\n",(0,a.jsx)(s.p,{children:"Cr\xe9ez une ressource API Hasura dans Logto."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Hasura API",src:r(59080).A+"",width:"1286",height:"776"})}),"\n",(0,a.jsx)(s.h3,{id:"2-cr\xe9er-des-r\xf4les-selon-la-configuration-hasura-dans-logto",children:"2. Cr\xe9er des r\xf4les selon la configuration Hasura dans Logto"}),"\n",(0,a.jsxs)(s.p,{children:["Nous devons cr\xe9er deux ",(0,a.jsx)(s.code,{children:"scope"}),"s pour la ressource API Hasura mentionn\xe9e \xe0 l'\xe9tape 1, \xe0 savoir ",(0,a.jsx)(s.code,{children:"read:user"})," et ",(0,a.jsx)(s.code,{children:"maintain:user"}),", puis cr\xe9er deux r\xf4les : ",(0,a.jsx)(s.code,{children:"user:reader"})," (contenant le ",(0,a.jsx)(s.code,{children:"scope"})," ",(0,a.jsx)(s.code,{children:"read:user"}),") et ",(0,a.jsx)(s.code,{children:"user:maintainer"})," (incluant le ",(0,a.jsx)(s.code,{children:"scope"})," ",(0,a.jsx)(s.code,{children:"maintain:user"}),") pour correspondre un \xe0 un avec les r\xf4les de Hasura. Et attribuez ces r\xf4les aux utilisateurs Logto selon les besoins."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Hasura API with scopes",src:r(51803).A+"",width:"2642",height:"836"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"User reader role",src:r(11143).A+"",width:"2648",height:"740"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"User maintainer role",src:r(54696).A+"",width:"2652",height:"736"})}),"\n",(0,a.jsxs)(s.h3,{id:"3-configurer-la-variable-denvironnement-hasura-hasura_graphql_jwt_secret-pour-activer-le-mode-jwt",children:["3. Configurer la variable d'environnement Hasura ",(0,a.jsx)(s.code,{children:"HASURA_GRAPHQL_JWT_SECRET"})," pour activer le mode JWT"]}),"\n",(0,a.jsxs)(s.p,{children:["En examinant les ",(0,a.jsx)(s.a,{href:"https://hasura.io/docs/latest/auth/authentication/jwt/#hasura-jwt-configuration-options",children:"options de configuration JWT de Hasura"}),", nous devons ajouter et configurer la variable d'environnement ",(0,a.jsx)(s.code,{children:"HASURA_GRAPHQL_JWT_SECRET"})," avant de pouvoir utiliser JWT pour le contr\xf4le d'acc\xe8s."]}),"\n",(0,a.jsxs)(s.p,{children:["Il existe de nombreuses options diff\xe9rentes qui peuvent \xeatre configur\xe9es, mais ici nous introduisons le cas le plus simple : seul le ",(0,a.jsx)(s.code,{children:"jwk_url"})," doit \xeatre configur\xe9. Cette valeur peut \xeatre obtenue \xe0 partir de votre point de terminaison de configuration OpenID de Logto (",(0,a.jsx)(s.a,{href:"https://your.logto.domain/oidc/.well-known/openid-configuration",children:"https://your.logto.domain/oidc/.well-known/openid-configuration"}),")."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Hasura JWT config",src:r(59202).A+"",width:"1064",height:"788"})}),"\n",(0,a.jsx)(s.h3,{id:"4-personnaliser-les-revendications-suppl\xe9mentaires-du-jeton-dacc\xe8s-utilisateur",children:"4. Personnaliser les revendications suppl\xe9mentaires du jeton d\u2019acc\xe8s utilisateur"}),"\n",(0,a.jsx)(s.p,{children:"En utilisant la fonctionnalit\xe9 de revendications de jeton personnalis\xe9es de Logto, personnalisez la logique pour ajouter des revendications suppl\xe9mentaires au jeton d\u2019acc\xe8s utilisateur."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"User access token script",src:r(82943).A+"",width:"2656",height:"1526"})}),"\n",(0,a.jsxs)(s.p,{children:["Personnalisez la m\xe9thode ",(0,a.jsx)(s.code,{children:"getCustomJwtClaims"})," pour ajouter des donn\xe9es dans le JWT sur lesquelles Hasura s'appuie pour mettre en \u0153uvre le contr\xf4le d'acc\xe8s. Cela peut inclure des donn\xe9es li\xe9es \xe0 l'utilisateur \xe9tant autoris\xe9 pendant cette instance, y compris les ",(0,a.jsx)(s.code,{children:"role"}),"s qu'ils poss\xe8dent, qui peuvent \xeatre accessibles via ",(0,a.jsx)(s.code,{children:"context"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["Nous avons \xe9galement d\xe9fini une variable d'environnement ",(0,a.jsx)(s.code,{children:"USER_DEFAULT_ROLE_NAMES"})," pour \xe9viter le codage en dur."]}),"\n",(0,a.jsx)(s.h3,{id:"5-int\xe9grer-logto-sdk",children:"5. Int\xe9grer Logto SDK"}),"\n",(0,a.jsx)(s.p,{children:"Apr\xe8s avoir configur\xe9 Logto et Hasura, int\xe9grez votre application avec le Logto SDK. Ici, nous utilisons un exemple React pour pr\xe9visualiser le jeton d\u2019acc\xe8s utilisateur \xe9mis par Logto apr\xe8s la connexion de l'utilisateur."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"User with roles",src:r(26523).A+"",width:"2656",height:"912"})}),"\n",(0,a.jsxs)(s.p,{children:["Tout d'abord, nous attribuons les r\xf4les ",(0,a.jsx)(s.code,{children:"user:reader"})," et ",(0,a.jsx)(s.code,{children:"user:maintainer"})," pr\xe9c\xe9demment cr\xe9\xe9s \xe0 l'utilisateur, puis nous nous connectons en tant que cet utilisateur."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-tsx",children:"const config: LogtoConfig = {\n  endpoint: 'http://localhost:3001',\n  appId: '<your-application-id>',\n  appSecret: '<your-application-secret>',\n  scopes: [\n    ...// existing scopes\n    'read:user',\n    'maintain:user',\n  ],\n  resources: [\n    ...// existing resources\n    'https://*.hasura.app/api',\n  ],\n};\n"})}),"\n",(0,a.jsx)(s.p,{children:"Obtenez le jeton d\u2019acc\xe8s utilisateur et demandez les API Hasura :"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-tsx",children:"const accessToken = await logto.getAccessToken('https://*.hasura.app/api');\n\n// Avant d'envoyer la requ\xeate \xe0 Hasura\nrequest.headers.set('Authorization', `Bearer ${accessToken}`);\nrequest.headers.set('x-Hasura-Role', '<required-role-for-the-endpoint>');\n"})}),"\n",(0,a.jsx)(s.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsx)(s.p,{children:"Dans cet article, nous fournissons une autre m\xe9thode de contr\xf4le d'acc\xe8s bas\xe9e sur JWT prise en charge par Hasura, autre que le Webhook."}),"\n",(0,a.jsxs)(s.p,{children:["En comparant les processus de contr\xf4le d'acc\xe8s ",(0,a.jsx)(s.a,{href:"https://hasura.io/docs/latest/auth/authentication/webhook/",children:"Webhook"})," et ",(0,a.jsx)(s.a,{href:"https://hasura.io/docs/latest/auth/authentication/jwt/",children:"JWT"})," de Hasura, nous pouvons voir que l'approche Webhook envoie un Webhook \xe0 Logto et attend une r\xe9ponse avec chaque requ\xeate Hasura ; tandis que l'approche bas\xe9e sur JWT peut \xeatre utilis\xe9e en continu jusqu'\xe0 l'expiration du JWT."]}),"\n",(0,a.jsx)(s.p,{children:"L'approche JWT peut r\xe9duire la charge r\xe9seau et \xe9liminer la latence r\xe9seau apport\xe9e par les Webhooks ; pendant ce temps, l'approche Webhook peut synchroniser les changements dans les Permissions utilisateur en temps r\xe9el."}),"\n",(0,a.jsx)(s.p,{children:"Les utilisateurs peuvent choisir l'approche appropri\xe9e en fonction de ces conclusions, combin\xe9es \xe0 leurs besoins commerciaux r\xe9els."})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},51803:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/hasura-api-with-scopes-ab26b108b1aa93f0225ca8cc55a70c8c.webp"},59080:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/hasura-api-f0466211049ca00f0b07f1b913ba58e4.webp"},59202:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/hasura-jwt-config-1935efe8a692058171ed131f90921dde.webp"},82943:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/user-access-token-script-924dba883452e140764247739744b91d.webp"},54696:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/user-maintainer-role-bc2937b4169034c8979712dd1484d864.webp"},11143:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/user-reader-role-cc358419b86d766f002b9dda90515555.webp"},26523:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/user-with-roles-ceb339a231a4e03f51e23691f45dd790.webp"},15658:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>i});var n=r(30758);const a={},t=n.createContext(a);function o(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);