"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[2399],{22480:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>c,contentTitle:()=>n,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"authorization/api-resources/protect-your-api","title":"Proteger sua API","description":"Se voc\xea n\xe3o precisa de pol\xedticas de controle de acesso flex\xedveis e granulares, pode simplesmente proteger sua API diretamente. Vamos gui\xe1-lo atrav\xe9s de um diagrama de sequ\xeancia e os passos necess\xe1rios para mostrar como integrar o controle de acesso em seu aplicativo.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/api-resources/protect-your-api.mdx","sourceDirName":"authorization/api-resources","slug":"/authorization/api-resources/protect-your-api","permalink":"/pt-BR/authorization/api-resources/protect-your-api","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/api-resources/protect-your-api.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Recursos de API","permalink":"/pt-BR/authorization/api-resources/"},"next":{"title":"Guia: Python","permalink":"/pt-BR/authorization/api-resources/python"}}');var t=r(86070),s=r(15658);const a={sidebar_position:1},n="Proteger sua API",c={},d=[{value:"Solicita\xe7\xe3o de autentica\xe7\xe3o",id:"solicita\xe7\xe3o-de-autentica\xe7\xe3o",level:2},{value:"Solicita\xe7\xe3o de token",id:"solicita\xe7\xe3o-de-token",level:2},{value:"Solicita\xe7\xe3o ao recurso de API",id:"solicita\xe7\xe3o-ao-recurso-de-api",level:2},{value:"Validar tokens de autoriza\xe7\xe3o para solicita\xe7\xf5es de API",id:"validar-tokens-de-autoriza\xe7\xe3o-para-solicita\xe7\xf5es-de-api",level:2},{value:"Entendendo o token JWS",id:"entendendo-o-token-jws",level:4},{value:"Validar o token de autoriza\xe7\xe3o",id:"validar-o-token-de-autoriza\xe7\xe3o",level:4},{value:"Refer\xeancia",id:"refer\xeancia",level:2}];function l(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.header,{children:(0,t.jsx)(o.h1,{id:"proteger-sua-api",children:"Proteger sua API"})}),"\n",(0,t.jsx)(o.p,{children:"Se voc\xea n\xe3o precisa de pol\xedticas de controle de acesso flex\xedveis e granulares, pode simplesmente proteger sua API diretamente. Vamos gui\xe1-lo atrav\xe9s de um diagrama de sequ\xeancia e os passos necess\xe1rios para mostrar como integrar o controle de acesso em seu aplicativo."}),"\n",(0,t.jsx)(o.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API\n\n    Note over Client,API: 1. Solicita\xe7\xe3o de autentica\xe7\xe3o\n    Client->>Logto: GET /oidc/auth\n    Note right of Client: com resource=https://resource-server.com/api<br/>e escopo opcional=read write\n    Logto--\x3e>Client: Retorna authorization_code\n\n    Note over Client,API: 2. Solicita\xe7\xe3o de token\n    Client->>Logto: POST /oidc/token\n    Note right of Client: com authorization_code<br/>resource=https://resource-server.com/api<br/>e escopo opcional=read write\n    Logto--\x3e>Client: Retorna token de acesso JWT\n    Note left of Logto: Token cont\xe9m:<br/>- P\xfablico restrito ao recurso<br/>- Escopos concedidos (se houver)\n\n    Note over Client,API: 3. Solicita\xe7\xe3o de API\n    Client->>API: Solicita\xe7\xe3o com token Bearer\n    Note over API: Validar token JWT:\n    Note over API: - Verificar assinatura<br/>- Verificar emissor<br/>- Verificar p\xfablico<br/>- Verificar expira\xe7\xe3o<br/>- Verificar escopos (se RBAC habilitado)\n    alt Token V\xe1lido\n        API--\x3e>Client: Recurso Protegido\n    else Token Inv\xe1lido\n        API--\x3e>Client: 401 N\xe3o Autorizado\n    end"}),"\n",(0,t.jsx)(o.p,{children:"Neste tutorial"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:["Endpoint do Logto: ",(0,t.jsx)(o.code,{children:"https://tenant-id.logto.app"})]}),"\n",(0,t.jsxs)(o.li,{children:["Aplicativo cliente: ",(0,t.jsx)(o.code,{children:"https://client.example.org"})]}),"\n",(0,t.jsxs)(o.li,{children:["Servidor de recursos da API: ",(0,t.jsx)(o.code,{children:"https://resource-server.com/api"})]}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:"Voc\xea deve substituir esses pelos seus endpoints reais ao implementar."}),"\n",(0,t.jsx)(o.h2,{id:"solicita\xe7\xe3o-de-autentica\xe7\xe3o",children:"Solicita\xe7\xe3o de autentica\xe7\xe3o"}),"\n",(0,t.jsxs)(o.p,{children:["Forne\xe7a uma lista de par\xe2metros de indicador de recurso em uma ",(0,t.jsx)(o.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest",children:"Solicita\xe7\xe3o de Autentica\xe7\xe3o"}),". Isso indicar\xe1 todos os recursos protegidos que o usu\xe1rio pode solicitar."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"GET https://tenant-id.logto.app/oidc/auth?response_type=code\n    &client_id=s6BhdRkqt3\n    &state=tNwzQ87pC6llebpmac_IDeeq-mCR2wLDYljHUZUAWuI\n    &redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb\n    &resource=https%3A%2F%2Fresource-server.com%2Fapi\n    &scope=read%20write\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Logto validar\xe1 e armazenar\xe1 esses indicadores de recurso. Um ",(0,t.jsx)(o.code,{children:"authorization_code"})," ser\xe1 concedido e retornado com escopos restritos a esses recursos especificados."]}),"\n",(0,t.jsx)(o.p,{children:"Exemplo de configura\xe7\xe3o do Logto SDK:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-tsx",children:"const config: LogtoConfig = {\n  // ...outras configura\xe7\xf5es\n  resources: ['https://resource-server.com/api'],\n  scopes: ['read', 'write'],\n};\n"})}),"\n",(0,t.jsx)(o.h2,{id:"solicita\xe7\xe3o-de-token",children:"Solicita\xe7\xe3o de token"}),"\n",(0,t.jsxs)(o.p,{children:["Quando o par\xe2metro de recurso est\xe1 presente em uma ",(0,t.jsx)(o.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#TokenRequest",children:"Solicita\xe7\xe3o de Token"})," junto com o ",(0,t.jsx)(o.code,{children:"authorization_code"})," concedido acima, ele especificar\xe1 o p\xfablico do recurso de API alvo do token de acesso solicitado."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"POST https://tenant-id.logto.app/oidc/token HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=authorization_code&redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb&code=10esc29BWC2qZB0acc9v8zAv9ltc2pko105tQauZ&resource=https%3A%2F%2Fresource-server.com%2Fapi\n"})}),"\n",(0,t.jsx)(o.p,{children:"Um token de acesso criptografado com o p\xfablico restrito a este recurso solicitado ser\xe1 concedido pelo Logto. O token carrega todos os dados que voc\xea precisar\xe1 para representar o status de autoriza\xe7\xe3o da solicita\xe7\xe3o. Por exemplo, a identidade e o papel do usu\xe1rio da solicita\xe7\xe3o, o p\xfablico do token e o tempo de expira\xe7\xe3o."}),"\n",(0,t.jsx)(o.p,{children:"Exemplo de c\xf3digo do Logto SDK:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-tsx",children:"const accessToken = await logtoClient.getAccessToken('https://resource-server.com/api');\n"})}),"\n",(0,t.jsx)(o.p,{children:"O payload do accessToken conter\xe1:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-tsx",children:"{\n  iss: '<your-logto-endpoint>/oidc',\n  aud: 'https://resource-server.com/api',\n  scope: 'read write'\n}\n"})}),"\n",(0,t.jsx)(o.h2,{id:"solicita\xe7\xe3o-ao-recurso-de-api",children:"Solicita\xe7\xe3o ao recurso de API"}),"\n",(0,t.jsxs)(o.p,{children:["O usu\xe1rio cliente enviou uma solicita\xe7\xe3o ao Recurso de API apresentando o ",(0,t.jsx)(o.code,{children:"access_token"})," fornecido no cabe\xe7alho de Autoriza\xe7\xe3o."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"GET https://resource-server.com/api/users\nAuthorization: Bearer eyJhbGciOiJIUz...\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Logto segue o protocolo padr\xe3o de autoriza\xe7\xe3o baseado em token para proteger seus Recursos de API. Para saber mais sobre OAuth 2.0, consulte o ",(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1",children:"documento oficial"})," do OAuth 2.0."]}),"\n",(0,t.jsx)(o.h2,{id:"validar-tokens-de-autoriza\xe7\xe3o-para-solicita\xe7\xf5es-de-api",children:"Validar tokens de autoriza\xe7\xe3o para solicita\xe7\xf5es de API"}),"\n",(0,t.jsxs)(o.p,{children:["Logto emite um token de autoriza\xe7\xe3o no formato padr\xe3o ",(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519",children:"JWT"})," para cada solicita\xe7\xe3o de API autorizada. O token \xe9 criptografado e assinado como um token ",(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515",children:"JWS"}),"."]}),"\n",(0,t.jsx)(o.h4,{id:"entendendo-o-token-jws",children:"Entendendo o token JWS"}),"\n",(0,t.jsxs)(o.p,{children:["Um token ",(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515",children:"JWS"})," codificado \xe9 constru\xeddo com tr\xeas partes:"]}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"Cabe\xe7alho JOSE: Declara o tipo de c\xf3digo e o algoritmo de codifica\xe7\xe3o"}),"\n",(0,t.jsx)(o.li,{children:"Payload JWS: Inclui todas as reivindica\xe7\xf5es do token"}),"\n",(0,t.jsxs)(o.li,{children:["Assinatura JWS: Assinatura assinada com ",(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7517",children:"JWK"})]}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:"Um esquema padr\xe3o do Payload JWS emitido pelo Logto: (as reivindica\xe7\xf5es podem variar, com base na sua configura\xe7\xe3o OIDC personalizada)"}),"\n",(0,t.jsxs)(o.table,{children:[(0,t.jsx)(o.thead,{children:(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.th,{children:"chave"}),(0,t.jsx)(o.th,{children:"descri\xe7\xe3o"})]})}),(0,t.jsxs)(o.tbody,{children:[(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"jti"}),(0,t.jsx)(o.td,{children:"ID \xfanico do JWT"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"sub"}),(0,t.jsx)(o.td,{children:"sujeito, geralmente user-id"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"iat"}),(0,t.jsx)(o.td,{children:"timestamp do momento de emiss\xe3o"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"exp"}),(0,t.jsx)(o.td,{children:"timestamp do momento de expira\xe7\xe3o"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"client_id"}),(0,t.jsx)(o.td,{children:"id do aplicativo"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"iss"}),(0,t.jsx)(o.td,{children:"identidade do emissor do token"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"aud"}),(0,t.jsx)(o.td,{children:"p\xfablico do token"})]}),(0,t.jsxs)(o.tr,{children:[(0,t.jsx)(o.td,{children:"scope"}),(0,t.jsx)(o.td,{children:"escopos (permiss\xf5es) do token"})]})]})]}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsxs)(o.p,{children:["Para desenvolvimento, para inspecionar visualmente um token JWT, voc\xea pode visitar uma ",(0,t.jsx)(o.a,{href:"https://www.jstoolset.com/jwt",children:"ferramenta de decodifica\xe7\xe3o de JWT"})," para decodificar e verificar os tokens que voc\xea recebeu. Tenha cuidado ou nunca use os tokens de um ambiente de produ\xe7\xe3o. Como este \xe9 um servi\xe7o online p\xfablico fornecido por terceiros, seu token pode ser exposto."]})}),"\n",(0,t.jsx)(o.h4,{id:"validar-o-token-de-autoriza\xe7\xe3o",children:"Validar o token de autoriza\xe7\xe3o"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validando um JWT"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validando a assinatura JWS"})}),"\n",(0,t.jsxs)(o.li,{children:["O emissor do token \xe9 ",(0,t.jsx)(o.code,{children:"https://<your-logto-domain>/oidc"})," (emitido pelo seu servidor de autentica\xe7\xe3o Logto)"]}),"\n",(0,t.jsx)(o.li,{children:"O p\xfablico do token \xe9 igual ao indicador de recurso do receptor atual registrado no Logto Admin Console"}),"\n",(0,t.jsx)(o.li,{children:"O token est\xe1 dentro do seu tempo de expira\xe7\xe3o"}),"\n",(0,t.jsxs)(o.li,{children:["(Somente ",(0,t.jsx)(o.a,{href:"/authorization/role-based-access-control/protect-api-resources-with-rbac",children:"RBAC"}),") O token possui o ",(0,t.jsx)(o.code,{children:"scope"})," desejado"]}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:"Existem v\xe1rias bibliotecas e pacotes de c\xf3digo aberto que podem ajud\xe1-lo a validar e decodificar um token JWT facilmente. Voc\xea pode escolher um e integr\xe1-lo ao seu aplicativo backend com base na linguagem e framework que est\xe1 usando. Por favor, confira alguns dos exemplos que temos:"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"/authorization/api-resources/node-express",children:"Node (Express)"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"/authorization/api-resources/spring-boot",children:"Spring Boot"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"/authorization/api-resources/python",children:"Python"})}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"refer\xeancia",children:"Refer\xeancia"}),"\n",(0,t.jsxs)(o.p,{children:["Logto usa o Protocolo de Autoriza\xe7\xe3o OAuth 2.0 baseado em c\xf3digo para tornar sua solicita\xe7\xe3o de API segura. Se voc\xea estiver interessado na estrat\xe9gia por tr\xe1s disso, consulte a ",(0,t.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1",children:"especifica\xe7\xe3o"})," do OAuth 2.0 para mais detalhes."]})]})}function p(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},15658:(e,o,r)=>{r.d(o,{R:()=>a,x:()=>n});var i=r(30758);const t={},s=i.createContext(t);function a(e){const o=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function n(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:o},e.children)}}}]);