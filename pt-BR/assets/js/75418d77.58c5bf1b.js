"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[36540],{4358:(o,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"authorization/organization-template/protect-api-reources","title":"Proteger recurso de API com modelo de organiza\xe7\xe3o","description":"Al\xe9m de Proteger sua API, que protege recursos garantindo que um JWT v\xe1lido esteja presente, pap\xe9is de organiza\xe7\xe3o tamb\xe9m podem ser aplicados para filtrar os escopos. Neste artigo, vamos nos concentrar em como o papel da organiza\xe7\xe3o afeta a delega\xe7\xe3o e valida\xe7\xe3o de escopos no seu fluxo de autentica\xe7\xe3o.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-api-reources.mdx","sourceDirName":"authorization/organization-template","slug":"/authorization/organization-template/protect-api-reources","permalink":"/pt-BR/authorization/organization-template/protect-api-reources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-api-reources.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Proteger recursos da organiza\xe7\xe3o","permalink":"/pt-BR/authorization/organization-template/protect-organization-resources"},"next":{"title":"Autoriza\xe7\xe3o (Authorization)","permalink":"/pt-BR/authorization/"}}');var n=a(86070),r=a(15658);const t={sidebar_position:3},s="Proteger recurso de API com modelo de organiza\xe7\xe3o",c={},d=[{value:"O par\xe2metro adicional <code>organization_id</code>",id:"o-par\xe2metro-adicional-organization_id",level:2},{value:"Configura\xe7\xe3o do cliente",id:"configura\xe7\xe3o-do-cliente",level:2},{value:"Valida\xe7\xe3o do servidor de API",id:"valida\xe7\xe3o-do-servidor-de-api",level:2}];function l(o){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",mermaid:"mermaid",p:"p",pre:"pre",...(0,r.R)(),...o.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.header,{children:(0,n.jsx)(e.h1,{id:"proteger-recurso-de-api-com-modelo-de-organiza\xe7\xe3o",children:"Proteger recurso de API com modelo de organiza\xe7\xe3o"})}),"\n",(0,n.jsxs)(e.p,{children:["Al\xe9m de ",(0,n.jsx)(e.a,{href:"/authorization/api-resources/protect-your-api",children:"Proteger sua API"}),", que protege recursos garantindo que um JWT v\xe1lido esteja presente, pap\xe9is de organiza\xe7\xe3o tamb\xe9m podem ser aplicados para filtrar os escopos. Neste artigo, vamos nos concentrar em como o papel da organiza\xe7\xe3o afeta a delega\xe7\xe3o e valida\xe7\xe3o de escopos no seu fluxo de autentica\xe7\xe3o."]}),"\n",(0,n.jsx)(e.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API\n\n    Note over Client,API: Solicita\xe7\xe3o de Token\n    Client->>Logto: POST /oidc/token\n    Note right of Client: com recurso, organization_id,<br/>e escopos solicitados\n\n    Note over Logto: Verificar se o usu\xe1rio pertence<br/>\xe0 organiza\xe7\xe3o especificada\n    Logto--\x3e>Client: Retorna token de acesso JWT\n    Note left of Logto: Token cont\xe9m:<br/>- Reivindica\xe7\xf5es padr\xe3o do JWT<br/>- organization_id<br/>- Escopos filtrados pelo papel da organiza\xe7\xe3o\n\n    Note over Client,API: Solicita\xe7\xe3o de API\n    Client->>API: Solicita\xe7\xe3o com token Bearer\n\n    Note over API: Validar token JWT:<br/>1. Valida\xe7\xe3o padr\xe3o do JWT<br/>2. Verificar organization_id<br/>3. Verificar escopos\n\n    alt Token Inv\xe1lido\n        API--\x3e>Client: 401 N\xe3o autorizado\n    else Token V\xe1lido\n        alt organization_id e escopo v\xe1lidos\n            API--\x3e>Client: Recurso Protegido\n        else Caso contr\xe1rio\n            API--\x3e>Client: 403 Proibido\n        end\n    end"}),"\n",(0,n.jsxs)(e.h2,{id:"o-par\xe2metro-adicional-organization_id",children:["O par\xe2metro adicional ",(0,n.jsx)(e.code,{children:"organization_id"})]}),"\n",(0,n.jsxs)(e.p,{children:["Al\xe9m da solicita\xe7\xe3o normal de concess\xe3o de token de acesso, no diagrama adicionamos um par\xe2metro adicional ",(0,n.jsx)(e.code,{children:"organization_id"}),", isso informa ao Logto para restringir os escopos aos pap\xe9is espec\xedficos da organiza\xe7\xe3o."]}),"\n",(0,n.jsx)(e.h2,{id:"configura\xe7\xe3o-do-cliente",children:"Configura\xe7\xe3o do cliente"}),"\n",(0,n.jsxs)(e.p,{children:["Se voc\xea estiver usando o SDK do Logto, pode adicionar ",(0,n.jsx)(e.code,{children:"organization_id"})," como o segundo par\xe2metro do m\xe9todo ",(0,n.jsx)(e.code,{children:"getAccessToken"}),"."]}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-tsx",children:"const accessToken = await logto.getAccessToken('https://my-resource.com/api', 'org_1');\n\n// Ou obtendo reivindica\xe7\xf5es diretamente\nconst accessTokenClaims = await logto.getAccessTokenClaims('https://my-resource.com/api', 'org_1');\nconsole.log(accessTokenClaims.organization_id); // 'org_1'\nconsole.log(accessTokenClaims.aud); // 'https://my-resource.com/api'\n"})}),"\n",(0,n.jsxs)(e.p,{children:["Ent\xe3o, apenas os escopos herdados dos pap\xe9is dessa organiza\xe7\xe3o ser\xe3o inclu\xeddos no token de acesso, assim como uma reivindica\xe7\xe3o adicional ",(0,n.jsx)(e.code,{children:"organization_id"}),"."]}),"\n",(0,n.jsx)(e.h2,{id:"valida\xe7\xe3o-do-servidor-de-api",children:"Valida\xe7\xe3o do servidor de API"}),"\n",(0,n.jsxs)(e.p,{children:["Al\xe9m da valida\xe7\xe3o normal do token de acesso JWT, voc\xea precisar\xe1 adicionar um n\xedvel adicional para verificar se ",(0,n.jsx)(e.code,{children:"organization_id"})," est\xe1 presente e \xe9 v\xe1lido."]})]})}function p(o={}){const{wrapper:e}={...(0,r.R)(),...o.components};return e?(0,n.jsx)(e,{...o,children:(0,n.jsx)(l,{...o})}):l(o)}},15658:(o,e,a)=>{a.d(e,{R:()=>t,x:()=>s});var i=a(30758);const n={},r=i.createContext(n);function t(o){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof o?o(e):{...e,...o}}),[e,o])}function s(o){let e;return e=o.disableParentContext?"function"==typeof o.components?o.components(n):o.components||n:t(o.components),i.createElement(r.Provider,{value:e},o.children)}}}]);