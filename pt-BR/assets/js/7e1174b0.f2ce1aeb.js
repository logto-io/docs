"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[12774],{42515:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>t,contentTitle:()=>d,default:()=>l,frontMatter:()=>n,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"quick-starts/database/hasura/README","title":"Adicionar autentica\xe7\xe3o ao seu aplicativo Hasura","description":"Hasura \xe9 uma ferramenta que pode rapidamente fornecer APIs GraphQL e REST correspondentes aos seus dados. Considerando a seguran\xe7a dos dados, Hasura tamb\xe9m oferece a capacidade de ajustar o controle de acesso para cada API diferente.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/quick-starts/database/hasura/README.mdx","sourceDirName":"quick-starts/database/hasura","slug":"/quick-starts/hasura","permalink":"/pt-BR/quick-starts/hasura","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/quick-starts/database/hasura/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/hasura","sidebar_label":"Hasura","sidebar_custom_props":{"description":"Integrar Logto com Hasura."}},"sidebar":"quickStartSidebar","previous":{"title":"Web tradicional","permalink":"/pt-BR/quick-starts/traditional-web"},"next":{"title":"Supabase","permalink":"/pt-BR/quick-starts/supabase"}}');var r=o(86070),i=o(15658);const n={slug:"/quick-starts/hasura",sidebar_label:"Hasura",sidebar_custom_props:{description:"Integrar Logto com Hasura."}},d="Adicionar autentica\xe7\xe3o ao seu aplicativo Hasura",t={},c=[{value:"Contexto",id:"contexto",level:2},{value:"Come\xe7ar",id:"come\xe7ar",level:2},{value:"1. Criar recurso de API Hasura no Logto",id:"1-criar-recurso-de-api-hasura-no-logto",level:3},{value:"2. Criar pap\xe9is de acordo com a configura\xe7\xe3o do Hasura no Logto",id:"2-criar-pap\xe9is-de-acordo-com-a-configura\xe7\xe3o-do-hasura-no-logto",level:3},{value:"3. Configurar a vari\xe1vel de ambiente do Hasura <code>HASURA_GRAPHQL_JWT_SECRET</code> para habilitar o modo JWT",id:"3-configurar-a-vari\xe1vel-de-ambiente-do-hasura-hasura_graphql_jwt_secret-para-habilitar-o-modo-jwt",level:3},{value:"4. Personalizar reivindica\xe7\xf5es extras do token de acesso do usu\xe1rio",id:"4-personalizar-reivindica\xe7\xf5es-extras-do-token-de-acesso-do-usu\xe1rio",level:3},{value:"5. Integrar Logto SDK",id:"5-integrar-logto-sdk",level:3},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2}];function u(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"adicionar-autentica\xe7\xe3o-ao-seu-aplicativo-hasura",children:"Adicionar autentica\xe7\xe3o ao seu aplicativo Hasura"})}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.a,{href:"https://hasura.io/",children:"Hasura"})," \xe9 uma ferramenta que pode rapidamente fornecer APIs GraphQL e REST correspondentes aos seus dados. Considerando a seguran\xe7a dos dados, Hasura tamb\xe9m oferece a capacidade de ajustar o controle de acesso para cada API diferente."]}),"\n",(0,r.jsx)(a.p,{children:"Normalmente, os usu\xe1rios do Hasura utilizam outros servi\xe7os de gerenciamento de identidade e autentica\xe7\xe3o, sendo o Logto um dos mais populares entre eles."}),"\n",(0,r.jsx)(a.p,{children:"Neste post do blog, assumiremos que voc\xea j\xe1 est\xe1 usando os servi\xe7os do Hasura. Vamos introduzir como integrar Hasura e Logto para maximizar a seguran\xe7a dos seus dados. Se voc\xea n\xe3o tem uma conta Logto, inscreva-se e comece a usar agora!"}),"\n",(0,r.jsx)(a.h2,{id:"contexto",children:"Contexto"}),"\n",(0,r.jsxs)(a.p,{children:["Hasura emprega ",(0,r.jsx)(a.a,{href:"https://hasura.io/docs/latest/auth/overview/",children:"gerenciamento de acesso baseado em papel"}),", enquanto Logto usa o padr\xe3o ",(0,r.jsx)(a.a,{href:"/authorization/role-based-access-control",children:"Controle de acesso baseado em papel (RBAC)"}),"."]}),"\n",(0,r.jsxs)(a.p,{children:["No modelo e nas melhores pr\xe1ticas do Logto para RBAC, aconselhamos os usu\xe1rios a usarem ",(0,r.jsx)(a.code,{children:"escopo"})," para corresponder \xe0 granularidade mais fina das permiss\xf5es, usar ",(0,r.jsx)(a.code,{children:"papel"})," como um conjunto de ",(0,r.jsx)(a.code,{children:"escopo"}),"s para opera\xe7\xf5es em lote convenientes, e, por fim, verificar ",(0,r.jsx)(a.code,{children:"escopo"})," (geralmente do lado dos provedores de recursos) para verificar se um usu\xe1rio pode realizar uma opera\xe7\xe3o espec\xedfica."]}),"\n",(0,r.jsxs)(a.p,{children:["No Hasura, um ",(0,r.jsx)(a.code,{children:"papel"})," corresponde \xe0 granularidade mais fina das permiss\xf5es, e as verifica\xe7\xf5es de permiss\xe3o s\xe3o realizadas contra ",(0,r.jsx)(a.code,{children:"pap\xe9is"}),". Portanto, durante a configura\xe7\xe3o do Logto, recomendamos mapear um ",(0,r.jsx)(a.code,{children:"papel"})," para exatamente um ",(0,r.jsx)(a.code,{children:"escopo"}),". Essa abordagem pode vincular as permiss\xf5es do Logto e do Hasura para evitar confus\xe3o e uso indevido."]}),"\n",(0,r.jsxs)(a.p,{children:["Hasura pode suportar controle de acesso usando Webhooks ou JWT. Nosso ",(0,r.jsx)(a.a,{href:"https://blog.logto.io/logto-x-hasura",children:"post anterior no blog"})," introduziu como usar Webhooks, e nas se\xe7\xf5es seguintes, explicaremos como utilizar o controle de acesso no modo JWT do Hasura."]}),"\n",(0,r.jsx)(a.h2,{id:"come\xe7ar",children:"Come\xe7ar"}),"\n",(0,r.jsxs)(a.p,{children:["Vamos come\xe7ar com um exemplo simples. Suponha que um usu\xe1rio j\xe1 tenha duas APIs no Hasura, ",(0,r.jsx)(a.code,{children:"GET /user"})," e ",(0,r.jsx)(a.code,{children:"PATCH /user"}),", correspondendo a dois pap\xe9is: ",(0,r.jsx)(a.code,{children:"user:reader"})," e ",(0,r.jsx)(a.code,{children:"user:maintainer"}),", respectivamente."]}),"\n",(0,r.jsx)(a.h3,{id:"1-criar-recurso-de-api-hasura-no-logto",children:"1. Criar recurso de API Hasura no Logto"}),"\n",(0,r.jsx)(a.p,{children:"Crie um recurso de API Hasura no Logto."}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Hasura API",src:o(66649).A+"",width:"1286",height:"776"})}),"\n",(0,r.jsx)(a.h3,{id:"2-criar-pap\xe9is-de-acordo-com-a-configura\xe7\xe3o-do-hasura-no-logto",children:"2. Criar pap\xe9is de acordo com a configura\xe7\xe3o do Hasura no Logto"}),"\n",(0,r.jsxs)(a.p,{children:["Precisamos criar dois ",(0,r.jsx)(a.code,{children:"escopo"}),"s para o recurso de API Hasura mencionado no passo 1, a saber, ",(0,r.jsx)(a.code,{children:"read:user"})," e ",(0,r.jsx)(a.code,{children:"maintain:user"}),", e ent\xe3o criar dois pap\xe9is: ",(0,r.jsx)(a.code,{children:"user:reader"})," (contendo o escopo ",(0,r.jsx)(a.code,{children:"read:user"}),") e ",(0,r.jsx)(a.code,{children:"user:maintainer"})," (incluindo o escopo ",(0,r.jsx)(a.code,{children:"maintain:user"}),") para corresponder um a um com os pap\xe9is do Hasura. E atribuir esses pap\xe9is aos usu\xe1rios do Logto conforme necess\xe1rio."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Hasura API with scopes",src:o(88382).A+"",width:"2642",height:"836"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"User reader role",src:o(70946).A+"",width:"2648",height:"740"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"User maintainer role",src:o(23809).A+"",width:"2652",height:"736"})}),"\n",(0,r.jsxs)(a.h3,{id:"3-configurar-a-vari\xe1vel-de-ambiente-do-hasura-hasura_graphql_jwt_secret-para-habilitar-o-modo-jwt",children:["3. Configurar a vari\xe1vel de ambiente do Hasura ",(0,r.jsx)(a.code,{children:"HASURA_GRAPHQL_JWT_SECRET"})," para habilitar o modo JWT"]}),"\n",(0,r.jsxs)(a.p,{children:["Ao analisar as ",(0,r.jsx)(a.a,{href:"https://hasura.io/docs/latest/auth/authentication/jwt/#hasura-jwt-configuration-options",children:"op\xe7\xf5es de configura\xe7\xe3o JWT do Hasura"}),", precisamos adicionar e configurar a vari\xe1vel de ambiente ",(0,r.jsx)(a.code,{children:"HASURA_GRAPHQL_JWT_SECRET"})," antes de podermos usar JWT para controle de acesso."]}),"\n",(0,r.jsxs)(a.p,{children:["Existem muitas op\xe7\xf5es diferentes que podem ser configuradas, mas aqui introduzimos o caso mais simples: apenas o ",(0,r.jsx)(a.code,{children:"jwk_url"})," precisa ser configurado. Este valor pode ser obtido do endpoint de configura\xe7\xe3o OpenID do seu Logto (",(0,r.jsx)(a.a,{href:"https://your.logto.domain/oidc/.well-known/openid-configuration",children:"https://your.logto.domain/oidc/.well-known/openid-configuration"}),")."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Hasura JWT config",src:o(17573).A+"",width:"1064",height:"788"})}),"\n",(0,r.jsx)(a.h3,{id:"4-personalizar-reivindica\xe7\xf5es-extras-do-token-de-acesso-do-usu\xe1rio",children:"4. Personalizar reivindica\xe7\xf5es extras do token de acesso do usu\xe1rio"}),"\n",(0,r.jsx)(a.p,{children:"Usando o recurso de reivindica\xe7\xf5es personalizadas de token do Logto, personalize a l\xf3gica para adicionar reivindica\xe7\xf5es extras ao token de acesso do usu\xe1rio."}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"User access token script",src:o(57346).A+"",width:"2656",height:"1526"})}),"\n",(0,r.jsxs)(a.p,{children:["Personalize o m\xe9todo ",(0,r.jsx)(a.code,{children:"getCustomJwtClaims"})," para adicionar dados no JWT dos quais o Hasura depende para implementar o controle de acesso. Isso pode incluir dados relacionados ao usu\xe1rio sendo autorizado durante aquela inst\xe2ncia, incluindo ",(0,r.jsx)(a.code,{children:"pap\xe9is"})," que eles possuem, que podem ser acessados atrav\xe9s de ",(0,r.jsx)(a.code,{children:"context"}),"."]}),"\n",(0,r.jsxs)(a.p,{children:["Tamb\xe9m definimos uma vari\xe1vel de ambiente ",(0,r.jsx)(a.code,{children:"USER_DEFAULT_ROLE_NAMES"})," para evitar codifica\xe7\xe3o fixa."]}),"\n",(0,r.jsx)(a.h3,{id:"5-integrar-logto-sdk",children:"5. Integrar Logto SDK"}),"\n",(0,r.jsx)(a.p,{children:"Ap\xf3s configurar Logto e Hasura, integre seu aplicativo com o Logto SDK. Aqui usamos um exemplo em React para visualizar o token de acesso do usu\xe1rio emitido pelo Logto ap\xf3s o login do usu\xe1rio."}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"User with roles",src:o(18284).A+"",width:"2656",height:"912"})}),"\n",(0,r.jsxs)(a.p,{children:["Primeiro, atribu\xedmos os pap\xe9is ",(0,r.jsx)(a.code,{children:"user:reader"})," e ",(0,r.jsx)(a.code,{children:"user:maintainer"})," criados anteriormente ao usu\xe1rio, e ent\xe3o fazemos login como esse usu\xe1rio."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-tsx",children:"const config: LogtoConfig = {\n  endpoint: 'http://localhost:3001',\n  appId: '<your-application-id>',\n  appSecret: '<your-application-secret>',\n  scopes: [\n    ...// escopos existentes\n    'read:user',\n    'maintain:user',\n  ],\n  resources: [\n    ...// recursos existentes\n    'https://*.hasura.app/api',\n  ],\n};\n"})}),"\n",(0,r.jsx)(a.p,{children:"Obtenha o token de acesso do usu\xe1rio e solicite as APIs do Hasura:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-tsx",children:"const accessToken = await logto.getAccessToken('https://*.hasura.app/api');\n\n// Antes de enviar a solicita\xe7\xe3o para o Hasura\nrequest.headers.set('Authorization', `Bearer ${accessToken}`);\nrequest.headers.set('x-Hasura-Role', '<required-role-for-the-endpoint>');\n"})}),"\n",(0,r.jsx)(a.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,r.jsx)(a.p,{children:"Neste artigo, fornecemos outro m\xe9todo de controle de acesso baseado em JWT suportado pelo Hasura, al\xe9m do Webhook."}),"\n",(0,r.jsxs)(a.p,{children:["Comparando os processos de controle de acesso do Hasura por ",(0,r.jsx)(a.a,{href:"https://hasura.io/docs/latest/auth/authentication/webhook/",children:"Webhook"})," e ",(0,r.jsx)(a.a,{href:"https://hasura.io/docs/latest/auth/authentication/jwt/",children:"JWT"}),", podemos ver que a abordagem Webhook envia um Webhook para o Logto e aguarda uma resposta com cada solicita\xe7\xe3o do Hasura; enquanto a abordagem baseada em JWT pode ser usada continuamente at\xe9 que o JWT expire."]}),"\n",(0,r.jsx)(a.p,{children:"A abordagem JWT pode reduzir a carga de rede e eliminar a lat\xeancia de rede trazida pelos Webhooks; enquanto isso, a abordagem Webhook pode sincronizar mudan\xe7as nas permiss\xf5es do usu\xe1rio em tempo real."}),"\n",(0,r.jsx)(a.p,{children:"Os usu\xe1rios podem escolher a abordagem apropriada com base nessas conclus\xf5es, combinadas com suas necessidades reais de neg\xf3cios."})]})}function l(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},88382:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/hasura-api-with-scopes-ab26b108b1aa93f0225ca8cc55a70c8c.webp"},66649:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/hasura-api-f0466211049ca00f0b07f1b913ba58e4.webp"},17573:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/hasura-jwt-config-1935efe8a692058171ed131f90921dde.webp"},57346:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/user-access-token-script-924dba883452e140764247739744b91d.webp"},23809:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/user-maintainer-role-bc2937b4169034c8979712dd1484d864.webp"},70946:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/user-reader-role-cc358419b86d766f002b9dda90515555.webp"},18284:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/user-with-roles-ceb339a231a4e03f51e23691f45dd790.webp"},15658:(e,a,o)=>{o.d(a,{R:()=>n,x:()=>d});var s=o(30758);const r={},i=s.createContext(r);function n(e){const a=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function d(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:n(e.components),s.createElement(i.Provider,{value:a},e.children)}}}]);