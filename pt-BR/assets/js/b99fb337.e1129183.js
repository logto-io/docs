"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[93758],{80978:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>c,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"authorization/organization-template/protect-organization-resources","title":"Proteger recursos da organiza\xe7\xe3o","description":"Al\xe9m de Proteger sua API, que considera a API como o recurso, a organiza\xe7\xe3o tamb\xe9m pode ser um recurso, e proteger seu recurso de organiza\xe7\xe3o da mesma forma. Neste artigo, vamos nos concentrar em como mudar para proteger seu recurso de organiza\xe7\xe3o de maneira semelhante.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-organization-resources.mdx","sourceDirName":"authorization/organization-template","slug":"/authorization/organization-template/protect-organization-resources","permalink":"/pt-BR/authorization/organization-template/protect-organization-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-organization-resources.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Configurar modelo de organiza\xe7\xe3o","permalink":"/pt-BR/authorization/organization-template/configure-organization-template"},"next":{"title":"Proteger recurso de API com modelo de organiza\xe7\xe3o","permalink":"/pt-BR/authorization/organization-template/protect-api-reources"}}');var r=n(86070),i=n(15658),s=n(78551),t=n(77501);const c={sidebar_position:2},l="Proteger recursos da organiza\xe7\xe3o",d={},u=[{value:"Passo 1: Obter IDs de organiza\xe7\xe3o do fluxo OIDC",id:"passo-1-obter-ids-de-organiza\xe7\xe3o-do-fluxo-oidc",level:2},{value:"Opcional: Obter pap\xe9is da organiza\xe7\xe3o",id:"opcional-obter-pap\xe9is-da-organiza\xe7\xe3o",level:3},{value:"Passo 2. Buscar token de organiza\xe7\xe3o",id:"passo-2-buscar-token-de-organiza\xe7\xe3o",level:2},{value:"Adicionar par\xe2metros \xe0 solicita\xe7\xe3o de autentica\xe7\xe3o",id:"adicionar-par\xe2metros-\xe0-solicita\xe7\xe3o-de-autentica\xe7\xe3o",level:3},{value:"Buscar o token de organiza\xe7\xe3o",id:"buscar-o-token-de-organiza\xe7\xe3o",level:3},{value:"Exemplo",id:"exemplo",level:3},{value:"Buscar token de organiza\xe7\xe3o para um aplicativo m\xe1quina para m\xe1quina",id:"buscar-token-de-organiza\xe7\xe3o-para-um-aplicativo-m\xe1quina-para-m\xe1quina",level:3},{value:"Passo 3. Verificar tokens de organiza\xe7\xe3o",id:"passo-3-verificar-tokens-de-organiza\xe7\xe3o",level:2}];function p(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"proteger-recursos-da-organiza\xe7\xe3o",children:"Proteger recursos da organiza\xe7\xe3o"})}),"\n",(0,r.jsxs)(o.p,{children:["Al\xe9m de ",(0,r.jsx)(o.a,{href:"/authorization/api-resources/protect-your-api",children:"Proteger sua API"}),", que considera a API como o recurso, a organiza\xe7\xe3o tamb\xe9m pode ser um recurso, e proteger seu recurso de organiza\xe7\xe3o da mesma forma. Neste artigo, vamos nos concentrar em como mudar para proteger seu recurso de organiza\xe7\xe3o de maneira semelhante."]}),"\n",(0,r.jsx)(o.mermaid,{value:'sequenceDiagram\n    participant Cliente\n    participant Logto\n    participant API\n\n    %% Fluxo OIDC Padr\xe3o\n    Note over Cliente,Logto: Fluxo OIDC Padr\xe3o\n    Cliente->>Logto: Solicita\xe7\xe3o de autoriza\xe7\xe3o\n    Note right of Cliente: Inclui escopos de organiza\xe7\xe3o:<br/>"urn:logto:scope:organizations"\n    Logto->>Cliente: C\xf3digo de autoriza\xe7\xe3o\n    Cliente->>Logto: Solicita\xe7\xe3o de token\n    Logto->>Cliente: Token de ID + Token de acesso\n    Note right of Cliente: Token de ID cont\xe9m `organizations`\n\n    %% Solicita\xe7\xe3o de Token de Organiza\xe7\xe3o\n    Note over Cliente,API: Solicita\xe7\xe3o de Token de Organiza\xe7\xe3o\n    Cliente->>Logto: POST /oidc/token\n    Note right of Cliente: com recurso "urn:logto:scope:organizations"<br/>e escopos solicitados incluindo<br/>"urn:logto:scope:organizations"\n    Note right of Cliente: inclui par\xe2metro organization_id\n\n    Note over Logto: Verificar acesso do usu\xe1rio \xe0 organiza\xe7\xe3o\n\n    alt Sem acesso ao organization_id\n        Logto--\x3e>Cliente: 403 Proibido\n    else Tem acesso \xe0 organiza\xe7\xe3o\n        Note over Logto: Filtrar escopos solicitados\n        Logto--\x3e>Cliente: Retorna token de acesso JWT\n        Note left of Logto: Token cont\xe9m:<br/>- Reivindica\xe7\xf5es padr\xe3o JWT<br/>- Escopos concedidos<br/>- p\xfablico `urn:logto:organization:{organization_id}`\n    end\n\n    Note over Cliente,API: Solicita\xe7\xe3o de API\n    Cliente->>API: Solicita\xe7\xe3o com token Bearer (token de organiza\xe7\xe3o JWT)\n\n    Note over API: Validar token JWT:<br/>- Valida\xe7\xe3o padr\xe3o JWT<br/>- Verificar organization_id\n\n    alt Token Inv\xe1lido\n        API--\x3e>Cliente: 401 N\xe3o autorizado\n    else Token V\xe1lido\n        alt organization_id inv\xe1lido\n            API--\x3e>Cliente: 403 Proibido\n        else organization_id v\xe1lido\n            API--\x3e>Cliente: Recurso Protegido\n        end\n    end'}),"\n",(0,r.jsx)(o.h2,{id:"passo-1-obter-ids-de-organiza\xe7\xe3o-do-fluxo-oidc",children:"Passo 1: Obter IDs de organiza\xe7\xe3o do fluxo OIDC"}),"\n",(0,r.jsxs)(o.p,{children:["Logto estende o protocolo padr\xe3o ",(0,r.jsx)(o.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect"})," para permitir que seu aplicativo obtenha as informa\xe7\xf5es da organiza\xe7\xe3o do usu\xe1rio. Existem duas maneiras de fazer isso:"]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Se voc\xea estiver usando um Logto SDK com suporte a Organiza\xe7\xf5es, pode adicionar o escopo ",(0,r.jsx)(o.code,{children:"urn:logto:scope:organizations"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"scopes"})," do objeto de configura\xe7\xe3o. Normalmente, o SDK ter\xe1 um enum para esse escopo, por exemplo, ",(0,r.jsx)(o.code,{children:"UserScope.Organizations"})," nos ",(0,r.jsx)(o.a,{href:"https://github.com/logto-io/js",children:"Logto JS SDKs"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t.A,{groupId:"sdk",children:[(0,r.jsx)(s.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-ts",children:"import { LogtoClient, UserScope } from '@logto/browser'; // ou @logto/node, @logto/client\n\nconst logto = new LogtoClient({\n  // ...\n  scopes: [UserScope.Organizations],\n});\n"})})}),(0,r.jsx)(s.A,{value:"react",label:"React",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"import { LogtoProvider, UserScope } from '@logto/react';\n\nconst App = () => (\n  <LogtoProvider\n    config={{\n      // ...\n      scopes: [UserScope.Organizations],\n    }}\n  >\n    {/* ... */}\n  </LogtoProvider>\n);\n"})})}),(0,r.jsx)(s.A,{value:"python",label:"Python",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-python",children:"from logto import UserInfoScope\n\nclient = LogtoClient(\n    LogtoConfig(\n        # ...\n        scopes=[UserInfoScope.organizations],\n    )\n)\n"})})}),(0,r.jsx)(s.A,{value:"php",label:"PHP",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-php",children:"use Logto\\Sdk\\Constants\\UserScope;\n\n$client = new LogtoClient(\n  new LogtoConfig(\n    // ...\n    scopes: [UserScope::organizations],\n  )\n);\n"})})}),(0,r.jsx)(s.A,{value:"swift",label:"Swift",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-swift",children:"import Logto\nimport LogtoClient\n\nlet config = try? LogtoConfig(\n    // ...\n    scopes: [\n        UserScope.organizations.rawValue,\n    ],\n    // ...\n)\nlet client = LogtoClient(useConfig: config)\n"})})}),(0,r.jsx)(s.A,{value:"others",label:"Outros",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-ts",children:"const config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n};\n"})})})]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Para outros casos, voc\xea precisa adicionar o escopo ",(0,r.jsx)(o.code,{children:"urn:logto:scope:organizations"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"scope"})," da configura\xe7\xe3o do SDK (ou solicita\xe7\xe3o de autentica\xe7\xe3o)."]}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Uma vez que o usu\xe1rio conclua o fluxo de autentica\xe7\xe3o, voc\xea pode obter as informa\xe7\xf5es da organiza\xe7\xe3o do ",(0,r.jsx)(o.code,{children:"idToken"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"// Use JavaScript como exemplo\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // Um array de strings com IDs de organiza\xe7\xe3o\n"})}),"\n",(0,r.jsxs)(o.p,{children:["O campo ",(0,r.jsx)(o.code,{children:"organizations"})," (reivindica\xe7\xe3o) tamb\xe9m ser\xe1 inclu\xeddo na resposta do ",(0,r.jsx)(o.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"endpoint UserInfo"}),"."]}),"\n",(0,r.jsx)(o.h3,{id:"opcional-obter-pap\xe9is-da-organiza\xe7\xe3o",children:"Opcional: Obter pap\xe9is da organiza\xe7\xe3o"}),"\n",(0,r.jsxs)(o.p,{children:["Se voc\xea ainda n\xe3o configurou pap\xe9is da organiza\xe7\xe3o, consulte ",(0,r.jsx)(o.a,{href:"/authorization/organization-template/configure-organization-template/#create-organization-role",children:"esta se\xe7\xe3o"}),"."]}),"\n",(0,r.jsx)(o.p,{children:"Para obter todos os pap\xe9is da organiza\xe7\xe3o do usu\xe1rio atual:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Se voc\xea estiver usando um Logto SDK com suporte a Organiza\xe7\xf5es, pode adicionar o escopo ",(0,r.jsx)(o.code,{children:"urn:logto:scope:organization_roles"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"scopes"})," do objeto de configura\xe7\xe3o. Normalmente, o SDK ter\xe1 um enum para esse escopo, por exemplo, ",(0,r.jsx)(o.code,{children:"UserScope.OrganizationRoles"})," nos ",(0,r.jsx)(o.a,{href:"https://github.com/logto-io/js",children:"Logto JS SDKs"}),"."]}),"\n",(0,r.jsxs)(o.li,{children:["Para outros casos, voc\xea precisa adicionar o escopo ",(0,r.jsx)(o.code,{children:"urn:logto:scope:organization_roles"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"scope"})," da configura\xe7\xe3o do SDK (ou solicita\xe7\xe3o de autentica\xe7\xe3o)."]}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Ent\xe3o voc\xea pode obter os pap\xe9is da organiza\xe7\xe3o do ",(0,r.jsx)(o.code,{children:"idToken"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"// Use JavaScript como exemplo\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organization_roles); // Um array de strings com pap\xe9is da organiza\xe7\xe3o\n"})}),"\n",(0,r.jsxs)(o.p,{children:["Cada string no array est\xe1 no formato ",(0,r.jsx)(o.code,{children:"organization_id:role_id"}),", por exemplo, ",(0,r.jsx)(o.code,{children:"org_123:admin"})," significa que o usu\xe1rio tem o papel ",(0,r.jsx)(o.code,{children:"admin"})," na organiza\xe7\xe3o com ID ",(0,r.jsx)(o.code,{children:"org_123"}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["O campo ",(0,r.jsx)(o.code,{children:"organization_roles"})," (reivindica\xe7\xe3o) tamb\xe9m ser\xe1 inclu\xeddo na resposta do ",(0,r.jsx)(o.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"endpoint UserInfo"}),"."]}),"\n",(0,r.jsx)(o.h2,{id:"passo-2-buscar-token-de-organiza\xe7\xe3o",children:"Passo 2. Buscar token de organiza\xe7\xe3o"}),"\n",(0,r.jsx)(o.p,{children:"Para realizar a\xe7\xf5es no contexto de uma organiza\xe7\xe3o, o usu\xe1rio precisa receber um token de acesso para essa organiza\xe7\xe3o (token de organiza\xe7\xe3o). O token de organiza\xe7\xe3o \xe9 um token JWT que cont\xe9m o ID da organiza\xe7\xe3o e as permiss\xf5es (escopos) do usu\xe1rio na organiza\xe7\xe3o."}),"\n",(0,r.jsx)(o.h3,{id:"adicionar-par\xe2metros-\xe0-solicita\xe7\xe3o-de-autentica\xe7\xe3o",children:"Adicionar par\xe2metros \xe0 solicita\xe7\xe3o de autentica\xe7\xe3o"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Se voc\xea estiver usando um Logto SDK com suporte a Organiza\xe7\xf5es, pode adicionar o escopo ",(0,r.jsx)(o.code,{children:"urn:logto:scope:organizations"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"scopes"})," do objeto de configura\xe7\xe3o, da mesma forma que ",(0,r.jsx)(o.a,{href:"/authorization/organization-template/protect-organization-resources/#step-1-get-organization-ids-from-oidc-flow",children:"Obter IDs de organiza\xe7\xe3o do usu\xe1rio atual"}),".","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"O Logto SDK com suporte a Organiza\xe7\xf5es cuidar\xe1 automaticamente do restante da configura\xe7\xe3o."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(o.li,{children:["Para outros casos, voc\xea precisa adicionar os escopos ",(0,r.jsx)(o.code,{children:"offline_access"})," e ",(0,r.jsx)(o.code,{children:"urn:logto:scope:organizations"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"scope"})," e o recurso ",(0,r.jsx)(o.code,{children:"urn:logto:resource:organizations"})," ao par\xe2metro ",(0,r.jsx)(o.code,{children:"resource"})," da configura\xe7\xe3o do SDK (ou solicita\xe7\xe3o de autentica\xe7\xe3o).","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Nota: ",(0,r.jsx)(o.code,{children:"offline_access"})," \xe9 necess\xe1rio para obter o ",(0,r.jsx)(o.code,{children:"refresh_token"})," que pode ser usado para buscar tokens de organiza\xe7\xe3o."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"// Apenas para outros casos. Para Logto SDKs, veja acima.\nconst config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n  resource: 'urn:logto:resource:organizations',\n};\n"})}),"\n",(0,r.jsx)(o.admonition,{type:"note",children:(0,r.jsxs)(o.p,{children:["O recurso ",(0,r.jsx)(o.code,{children:"urn:logto:resource:organizations"})," \xe9 um recurso especial que representa o modelo de organiza\xe7\xe3o."]})}),"\n",(0,r.jsx)(o.h3,{id:"buscar-o-token-de-organiza\xe7\xe3o",children:"Buscar o token de organiza\xe7\xe3o"}),"\n",(0,r.jsxs)(o.p,{children:["Logto estende o tipo de concess\xe3o ",(0,r.jsx)(o.code,{children:"refresh_token"})," padr\xe3o para permitir que seu aplicativo busque tokens de organiza\xe7\xe3o."]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Se voc\xea estiver usando um Logto SDK com suporte a Organiza\xe7\xf5es, pode chamar o m\xe9todo ",(0,r.jsx)(o.code,{children:"getOrganizationToken()"})," (ou o m\xe9todo ",(0,r.jsx)(o.code,{children:"getOrganizationTokenClaims()"}),") do SDK."]}),"\n",(0,r.jsxs)(o.li,{children:["Para outros casos, voc\xea precisa chamar o endpoint de token com os seguintes par\xe2metros:","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"grant_type"}),": ",(0,r.jsx)(o.code,{children:"refresh_token"}),"."]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"client_id"}),": O ID do aplicativo que o usu\xe1rio usou para autenticar."]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"refresh_token"}),": O ",(0,r.jsx)(o.code,{children:"refresh_token"})," que voc\xea obteve do fluxo de autentica\xe7\xe3o."]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"organization_id"}),": O ID da organiza\xe7\xe3o para a qual voc\xea deseja obter o token."]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"scope"})," (opcional): Os escopos que voc\xea deseja conceder ao usu\xe1rio na organiza\xe7\xe3o. Se n\xe3o especificado, o servidor de autoriza\xe7\xe3o tentar\xe1 conceder os mesmos escopos do fluxo de autentica\xe7\xe3o."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.A,{groupId:"sdk",children:[(0,r.jsx)(s.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-ts",children:"const token = await logto.getOrganizationToken('<organization-id>');\n"})})}),(0,r.jsx)(s.A,{value:"react",label:"React",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"const App = () => {\n  const { getOrganizationToken } = useLogto();\n\n  const getToken = async () => {\n    const token = await getOrganizationToken('<organization-id>');\n  };\n\n  return <button onClick={getToken}>Get organization token</button>;\n};\n"})})}),(0,r.jsx)(s.A,{value:"python",label:"Python",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-python",children:'token = await client.getOrganizationToken("<organization-id>")\n# ou\nclaims = await client.getOrganizationTokenClaims("<organization-id>")\n'})})}),(0,r.jsx)(s.A,{value:"php",label:"PHP",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-php",children:"$token = $client->getOrganizationToken('<organization-id>');\n// ou\n$claims = $client->getOrganizationTokenClaims('<organization-id>');\n"})})}),(0,r.jsx)(s.A,{value:"swift",label:"Swift",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-swift",children:'let token = try await client.getOrganizationToken(forId: "<organization-id>")\n'})})}),(0,r.jsx)(s.A,{value:"others",label:"Outros",children:(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-ts",children:"// Use JavaScript como exemplo\n\nconst params = new URLSearchParams();\n\nparams.append('grant_type', 'refresh_token');\nparams.append('client_id', 'YOUR_CLIENT_ID');\nparams.append('refresh_token', 'REFRESH_TOKEN');\nparams.append('organization_id', 'org_123');\n\nconst response = await fetch('https://YOUR_LOGTO_ENDPOINT/oidc/token', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n  },\n  body: params,\n});\n"})})})]}),"\n",(0,r.jsxs)(o.p,{children:["A resposta estar\xe1 no mesmo formato do ",(0,r.jsx)(o.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint",children:"endpoint de token padr\xe3o"}),", e o ",(0,r.jsx)(o.code,{children:"access_token"})," \xe9 o token de organiza\xe7\xe3o no formato JWT."]}),"\n",(0,r.jsx)(o.p,{children:"Al\xe9m das reivindica\xe7\xf5es regulares de um token de acesso, o token de organiza\xe7\xe3o tamb\xe9m cont\xe9m as seguintes reivindica\xe7\xf5es:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"aud"}),": O p\xfablico do token de organiza\xe7\xe3o \xe9 ",(0,r.jsx)(o.code,{children:"urn:logto:organization:{organization_id}"}),"."]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.code,{children:"scope"}),": Os escopos concedidos ao usu\xe1rio na organiza\xe7\xe3o com espa\xe7o como delimitador."]}),"\n"]}),"\n",(0,r.jsx)(o.h3,{id:"exemplo",children:"Exemplo"}),"\n",(0,r.jsx)(o.p,{children:"Um bom exemplo pode valer mais que mil palavras. Suponha que nosso modelo de organiza\xe7\xe3o tenha a seguinte configura\xe7\xe3o:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Permiss\xf5es: ",(0,r.jsx)(o.code,{children:"read:logs"}),", ",(0,r.jsx)(o.code,{children:"write:logs"}),", ",(0,r.jsx)(o.code,{children:"read:users"}),", ",(0,r.jsx)(o.code,{children:"write:users"}),"."]}),"\n",(0,r.jsxs)(o.li,{children:["Pap\xe9is: ",(0,r.jsx)(o.code,{children:"admin"}),", ",(0,r.jsx)(o.code,{children:"member"}),".","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["O papel ",(0,r.jsx)(o.code,{children:"admin"})," tem todas as permiss\xf5es."]}),"\n",(0,r.jsxs)(o.li,{children:["O papel ",(0,r.jsx)(o.code,{children:"member"})," tem permiss\xf5es ",(0,r.jsx)(o.code,{children:"read:logs"})," e ",(0,r.jsx)(o.code,{children:"read:users"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:"E o usu\xe1rio tem a seguinte configura\xe7\xe3o:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["IDs de organiza\xe7\xe3o: ",(0,r.jsx)(o.code,{children:"org_1"}),", ",(0,r.jsx)(o.code,{children:"org_2"}),"."]}),"\n",(0,r.jsxs)(o.li,{children:["Pap\xe9is da organiza\xe7\xe3o: ",(0,r.jsx)(o.code,{children:"org_1:admin"}),", ",(0,r.jsx)(o.code,{children:"org_2:member"}),"."]}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:"Na configura\xe7\xe3o do Logto SDK (ou solicita\xe7\xe3o de autentica\xe7\xe3o), configuramos outras coisas corretamente e adicionamos os seguintes escopos:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.code,{children:"urn:logto:scope:organizations"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.code,{children:"openid"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.code,{children:"offline_access"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.code,{children:"read:logs"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.code,{children:"write:logs"})}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Agora, quando o usu\xe1rio conclui o fluxo de autentica\xe7\xe3o, podemos obter os IDs de organiza\xe7\xe3o do ",(0,r.jsx)(o.code,{children:"idToken"}),":"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"// Use JavaScript como exemplo\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // ['org_1', 'org_2']\n"})}),"\n",(0,r.jsx)(o.p,{children:"Se quisermos obter os tokens de organiza\xe7\xe3o:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-tsx",children:"// Use JavaScript como exemplo\nconst org1Token = await logto.getOrganizationTokenClaims('org_1');\nconst org2Token = await logto.getOrganizationTokenClaims('org_2');\n\nconsole.log(org1Token.aud); // 'urn:logto:organization:org_1'\nconsole.log(org1Token.scope); // 'read:logs write:logs'\nconsole.log(org2Token.aud); // 'urn:logto:organization:org_2'\nconsole.log(org2Token.scope); // 'read:logs'\n\nconst org3Token = await logto.getOrganizationTokenClaims('org_3'); // Erro: Usu\xe1rio n\xe3o \xe9 membro da organiza\xe7\xe3o\n"})}),"\n",(0,r.jsx)(o.p,{children:"Explica\xe7\xe3o:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Para ",(0,r.jsx)(o.code,{children:"org_1"}),", o usu\xe1rio tem o papel ",(0,r.jsx)(o.code,{children:"admin"}),", ent\xe3o o token de organiza\xe7\xe3o deve ter todas as permiss\xf5es dispon\xedveis (escopos)."]}),"\n",(0,r.jsxs)(o.li,{children:["Para ",(0,r.jsx)(o.code,{children:"org_2"}),", o usu\xe1rio tem o papel ",(0,r.jsx)(o.code,{children:"member"}),", ent\xe3o o token de organiza\xe7\xe3o deve ter permiss\xf5es ",(0,r.jsx)(o.code,{children:"read:logs"})," e ",(0,r.jsx)(o.code,{children:"read:users"})," (escopos)."]}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Como solicitamos apenas os escopos ",(0,r.jsx)(o.code,{children:"read:logs"})," e ",(0,r.jsx)(o.code,{children:"write:logs"}),' no fluxo de autentica\xe7\xe3o, os tokens de organiza\xe7\xe3o foram "reduzidos" de acordo, resultando na interse\xe7\xe3o dos escopos solicitados e os escopos dispon\xedveis.']}),"\n",(0,r.jsx)(o.h3,{id:"buscar-token-de-organiza\xe7\xe3o-para-um-aplicativo-m\xe1quina-para-m\xe1quina",children:"Buscar token de organiza\xe7\xe3o para um aplicativo m\xe1quina para m\xe1quina"}),"\n",(0,r.jsxs)(o.p,{children:["Semelhante a buscar tokens de organiza\xe7\xe3o para usu\xe1rios, voc\xea tamb\xe9m pode buscar tokens de organiza\xe7\xe3o para aplicativos m\xe1quina para m\xe1quina. A \xfanica diferen\xe7a \xe9 que voc\xea precisa usar o tipo de concess\xe3o ",(0,r.jsx)(o.code,{children:"client_credentials"})," em vez do tipo de concess\xe3o ",(0,r.jsx)(o.code,{children:"refresh_token"}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["Para saber mais sobre aplicativos m\xe1quina para m\xe1quina, veja ",(0,r.jsx)(o.a,{href:"/quick-starts/m2m/",children:"M\xe1quina para m\xe1quina: Autentica\xe7\xe3o com Logto"}),"."]}),"\n",(0,r.jsx)(o.h2,{id:"passo-3-verificar-tokens-de-organiza\xe7\xe3o",children:"Passo 3. Verificar tokens de organiza\xe7\xe3o"}),"\n",(0,r.jsxs)(o.p,{children:["Uma vez que o aplicativo obt\xe9m um token de organiza\xe7\xe3o, ele pode usar o token da mesma forma que um token de acesso regular, por exemplo, chamar as APIs com o token no cabe\xe7alho ",(0,r.jsx)(o.code,{children:"Authorization"})," no formato ",(0,r.jsx)(o.code,{children:"Bearer {token}"}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["Na sua API, a maneira de verificar o token de organiza\xe7\xe3o \xe9 bastante semelhante a ",(0,r.jsx)(o.a,{href:"/authorization/api-resources/protect-your-api/#validate-authorization-tokens-for-api-requests",children:"Proteger sua API"}),". Principais diferen\xe7as:"]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Ao contr\xe1rio dos tokens de acesso para recursos de API, um usu\xe1rio N\xc3O PODE obter um token de organiza\xe7\xe3o se n\xe3o for membro da organiza\xe7\xe3o."}),"\n",(0,r.jsxs)(o.li,{children:["O p\xfablico do token de organiza\xe7\xe3o \xe9 ",(0,r.jsx)(o.code,{children:"urn:logto:organization:{organization_id}"}),"."]}),"\n",(0,r.jsxs)(o.li,{children:["Para certas permiss\xf5es (escopos), voc\xea precisa verificar a reivindica\xe7\xe3o ",(0,r.jsx)(o.code,{children:"scope"})," do token de organiza\xe7\xe3o dividindo a string com espa\xe7o como delimitador."]}),"\n"]})]})}function g(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},78551:(e,o,n)=>{n.d(o,{A:()=>s});n(30758);var a=n(13526);const r={tabItem:"tabItem_PGP0"};var i=n(86070);function s(e){let{children:o,hidden:n,className:s}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,s),hidden:n,children:o})}},77501:(e,o,n)=>{n.d(o,{A:()=>k});var a=n(30758),r=n(13526),i=n(65052),s=n(25557),t=n(77469),c=n(50873),l=n(62230),d=n(60196);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:o}=e;return!!o&&"object"==typeof o&&"value"in o}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:o,children:n}=e;return(0,a.useMemo)((()=>{const e=o??function(e){return u(e).map((e=>{let{props:{value:o,label:n,attributes:a,default:r}}=e;return{value:o,label:n,attributes:a,default:r}}))}(n);return function(e){const o=(0,l.XI)(e,((e,o)=>e.value===o.value));if(o.length>0)throw new Error(`Docusaurus error: Duplicate values "${o.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[o,n])}function g(e){let{value:o,tabValues:n}=e;return n.some((e=>e.value===o))}function h(e){let{queryString:o=!1,groupId:n}=e;const r=(0,s.W6)(),i=function(e){let{queryString:o=!1,groupId:n}=e;if("string"==typeof o)return o;if(!1===o)return null;if(!0===o&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:o,groupId:n});return[(0,c.aZ)(i),(0,a.useCallback)((e=>{if(!i)return;const o=new URLSearchParams(r.location.search);o.set(i,e),r.replace({...r.location,search:o.toString()})}),[i,r])]}function m(e){const{defaultValue:o,queryString:n=!1,groupId:r}=e,i=p(e),[s,c]=(0,a.useState)((()=>function(e){let{defaultValue:o,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(o){if(!g({value:o,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${o}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return o}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:o,tabValues:i}))),[l,u]=h({queryString:n,groupId:r}),[m,x]=function(e){let{groupId:o}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(o),[r,i]=(0,d.Dv)(n);return[r,(0,a.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:r}),j=(()=>{const e=l??m;return g({value:e,tabValues:i})?e:null})();(0,t.A)((()=>{j&&c(j)}),[j]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!g({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),x(e)}),[u,x,i]),tabValues:i}}var x=n(13887);const j={tabList:"tabList_CGfx",tabItem:"tabItem_JX1E"};var z=n(86070);function f(e){let{className:o,block:n,selectedValue:a,selectValue:s,tabValues:t}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),d=e=>{const o=e.currentTarget,n=c.indexOf(o),r=t[n].value;r!==a&&(l(o),s(r))},u=e=>{let o=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;o=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;o=c[n]??c[c.length-1];break}}o?.focus()};return(0,z.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},o),children:t.map((e=>{let{value:o,label:n,attributes:i}=e;return(0,z.jsx)("li",{role:"tab",tabIndex:a===o?0:-1,"aria-selected":a===o,ref:e=>c.push(e),onKeyDown:u,onClick:d,...i,className:(0,r.A)("tabs__item",j.tabItem,i?.className,{"tabs__item--active":a===o}),children:n??o},o)}))})}function v(e){let{lazy:o,children:n,selectedValue:i}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(o){const e=s.find((e=>e.props.value===i));return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,z.jsx)("div",{className:"margin-top--md",children:s.map(((e,o)=>(0,a.cloneElement)(e,{key:o,hidden:e.props.value!==i})))})}function b(e){const o=m(e);return(0,z.jsxs)("div",{className:(0,r.A)("tabs-container",j.tabList),children:[(0,z.jsx)(f,{...o,...e}),(0,z.jsx)(v,{...o,...e})]})}function k(e){const o=(0,x.A)();return(0,z.jsx)(b,{...e,children:u(e.children)},String(o))}},15658:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>t});var a=n(30758);const r={},i=a.createContext(r);function s(e){const o=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:o},e.children)}}}]);