"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[22058],{95244:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"integrate-logto/protected-app","title":"Aplicativo Protegido","description":"O Aplicativo Protegido \xe9 projetado para eliminar a complexidade das integra\xe7\xf5es de SDK, separando a camada de autentica\xe7\xe3o do seu aplicativo. N\xf3s lidamos com a autentica\xe7\xe3o, permitindo que voc\xea se concentre em sua funcionalidade principal. Uma vez que um usu\xe1rio \xe9 autenticado, o Aplicativo Protegido serve o conte\xfado do seu servidor.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","sourceDirName":"integrate-logto","slug":"/integrate-logto/protected-app","permalink":"/pt-BR/integrate-logto/protected-app","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Compreender o fluxo de autentica\xe7\xe3o","permalink":"/pt-BR/integrate-logto/integrate-logto-into-your-application/understand-authentication-flow"},"next":{"title":"Aplicativos de terceiros","permalink":"/pt-BR/integrate-logto/third-party-applications/"}}');var n=a(86070),r=a(15658);const t={sidebar_position:2},s="Aplicativo Protegido",d={},c=[{value:"Como o Aplicativo Protegido funciona",id:"como-o-aplicativo-protegido-funciona",level:2},{value:"Proteja seu servidor de origem",id:"proteja-seu-servidor-de-origem",level:2},{value:"Valida\xe7\xe3o de Cabe\xe7alho HTTP",id:"valida\xe7\xe3o-de-cabe\xe7alho-http",level:3},{value:"Valida\xe7\xe3o de JSON Web Tokens (JWT)",id:"valida\xe7\xe3o-de-json-web-tokens-jwt",level:3},{value:"Obter estado de autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio",id:"obter-estado-de-autentica\xe7\xe3o-e-informa\xe7\xf5es-do-usu\xe1rio",level:2},{value:"Obter o host original",id:"obter-o-host-original",level:2},{value:"Personalizar regras de autentica\xe7\xe3o",id:"personalizar-regras-de-autentica\xe7\xe3o",level:2},{value:"Desenvolvimento local",id:"desenvolvimento-local",level:2},{value:"Transi\xe7\xe3o para integra\xe7\xe3o de SDK",id:"transi\xe7\xe3o-para-integra\xe7\xe3o-de-sdk",level:2}];function l(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"aplicativo-protegido",children:"Aplicativo Protegido"})}),"\n",(0,n.jsx)(o.p,{children:"O Aplicativo Protegido \xe9 projetado para eliminar a complexidade das integra\xe7\xf5es de SDK, separando a camada de autentica\xe7\xe3o do seu aplicativo. N\xf3s lidamos com a autentica\xe7\xe3o, permitindo que voc\xea se concentre em sua funcionalidade principal. Uma vez que um usu\xe1rio \xe9 autenticado, o Aplicativo Protegido serve o conte\xfado do seu servidor."}),"\n",(0,n.jsx)(o.h2,{id:"como-o-aplicativo-protegido-funciona",children:"Como o Aplicativo Protegido funciona"}),"\n",(0,n.jsx)(o.p,{children:"O Aplicativo Protegido, alimentado pela Cloudflare, opera globalmente em redes de borda, garantindo baixa lat\xeancia e alta disponibilidade para o seu aplicativo."}),"\n",(0,n.jsx)(o.p,{children:"O Aplicativo Protegido mant\xe9m o estado da sess\xe3o e as informa\xe7\xf5es do usu\xe1rio. Se um usu\xe1rio n\xe3o estiver autenticado, o Aplicativo Protegido o redireciona para a p\xe1gina de login. Uma vez autenticado, o Aplicativo Protegido envolve a solicita\xe7\xe3o do usu\xe1rio com autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio, e a encaminha para o servidor de origem."}),"\n",(0,n.jsx)(o.p,{children:"Este processo \xe9 visualizado no seguinte fluxograma:"}),"\n",(0,n.jsx)(o.mermaid,{value:'graph LR\n  A("Cliente<br/>(Navegador)") --\x3e|Solicita\xe7\xe3o| B(Logto<br/>Aplicativo Protegido)\n  B --\x3e Condition{{Rota<br/>corresponde?}}\n  Condition --\x3e|Sim| Matched{{Est\xe1 autenticado?}}\n  Matched --\x3e|Sim| C(Servidor de origem)\n  Matched --\x3e|N\xe3o| D(Login Logto)\n  Condition --\x3e|N\xe3o| C'}),"\n",(0,n.jsx)(o.h2,{id:"proteja-seu-servidor-de-origem",children:"Proteja seu servidor de origem"}),"\n",(0,n.jsx)(o.p,{children:"O servidor de origem, que pode ser um dispositivo f\xedsico ou virtual n\xe3o pertencente ao Aplicativo Protegido do Logto, \xe9 onde reside o conte\xfado do seu aplicativo. Semelhante a um servidor de Rede de Distribui\xe7\xe3o de Conte\xfado (CDN), o Aplicativo Protegido gerencia processos de autentica\xe7\xe3o e recupera conte\xfado do seu servidor de origem. Portanto, se os usu\xe1rios obtiverem acesso direto ao seu servidor de origem, eles podem contornar a autentica\xe7\xe3o e seu aplicativo n\xe3o estar\xe1 mais protegido."}),"\n",(0,n.jsx)(o.p,{children:"Portanto, \xe9 importante proteger as conex\xf5es de origem, isso impede que invasores descubram e acessem seu servidor de origem sem autentica\xe7\xe3o. Existem v\xe1rias maneiras de fazer isso:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Valida\xe7\xe3o de Cabe\xe7alho HTTP"}),"\n",(0,n.jsx)(o.li,{children:"Valida\xe7\xe3o de JSON Web Tokens (JWT)"}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"valida\xe7\xe3o-de-cabe\xe7alho-http",children:"Valida\xe7\xe3o de Cabe\xe7alho HTTP"}),"\n",(0,n.jsxs)(o.p,{children:["Proteger seu servidor de origem pode ser alcan\xe7ado usando ",(0,n.jsx)(o.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#basic_authentication_scheme",children:"Autentica\xe7\xe3o B\xe1sica HTTP"})," para proteger seu servidor de origem."]}),"\n",(0,n.jsx)(o.p,{children:"Cada solicita\xe7\xe3o do Aplicativo Protegido inclui o seguinte cabe\xe7alho:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"Authorization: Basic base64(appId:appSecret)\n"})}),"\n",(0,n.jsx)(o.p,{children:"Ao validar este cabe\xe7alho, voc\xea pode confirmar que a solicita\xe7\xe3o vem do Aplicativo Protegido e negar quaisquer solicita\xe7\xf5es que n\xe3o incluam este cabe\xe7alho."}),"\n",(0,n.jsx)(o.p,{children:"Se voc\xea estiver usando Nginx ou Apache, pode consultar os seguintes guias para implementar a Autentica\xe7\xe3o B\xe1sica HTTP no seu servidor de origem:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Nginx: ",(0,n.jsx)(o.a,{href:"https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/",children:"Configurando Autentica\xe7\xe3o B\xe1sica HTTP"})]}),"\n",(0,n.jsxs)(o.li,{children:["Apache: ",(0,n.jsx)(o.a,{href:"https://httpd.apache.org/docs/2.4/howto/auth.html",children:"Autentica\xe7\xe3o e Autoriza\xe7\xe3o"})]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Para verificar os cabe\xe7alhos dentro do seu aplicativo, consulte o ",(0,n.jsx)(o.a,{href:"https://developers.cloudflare.com/workers/examples/basic-auth/",children:"exemplo de Autentica\xe7\xe3o B\xe1sica HTTP"})," fornecido pela Cloudflare para aprender como restringir o acesso usando o esquema B\xe1sico HTTP."]}),"\n",(0,n.jsx)(o.h3,{id:"valida\xe7\xe3o-de-json-web-tokens-jwt",children:"Valida\xe7\xe3o de JSON Web Tokens (JWT)"}),"\n",(0,n.jsx)(o.p,{children:"Outra maneira de proteger seu servidor de origem \xe9 usando JSON Web Tokens (JWT)."}),"\n",(0,n.jsx)(o.p,{children:"Cada solicita\xe7\xe3o autenticada do Aplicativo Protegido inclui o seguinte cabe\xe7alho:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"Logto-ID-Token: <JWT>\n"})}),"\n",(0,n.jsxs)(o.p,{children:["O JWT \xe9 chamado de ",(0,n.jsx)(o.a,{href:"https://auth.wiki/id-token",children:"Token de ID"}),", que \xe9 assinado pelo Logto e cont\xe9m informa\xe7\xf5es do usu\xe1rio. Ao validar este JWT, voc\xea pode confirmar que a solicita\xe7\xe3o vem do Aplicativo Protegido e negar quaisquer solicita\xe7\xf5es que n\xe3o incluam este cabe\xe7alho."]}),"\n",(0,n.jsxs)(o.p,{children:["O token \xe9 criptografado e assinado como um token ",(0,n.jsx)(o.a,{href:"https://auth.wiki/jws",children:"JWS"}),"."]}),"\n",(0,n.jsx)(o.p,{children:"Os passos de valida\xe7\xe3o:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validando um JWT"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validando a assinatura JWS"})}),"\n",(0,n.jsxs)(o.li,{children:["O emissor do token \xe9 ",(0,n.jsx)(o.code,{children:"https://<your-logto-domain>/oidc"})," (emitido pelo seu servidor de autentica\xe7\xe3o Logto)"]}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"const express = require('express');\nconst jwksClient = require('jwks-rsa');\nconst jwt = require('jsonwebtoken');\n\nconst ISSUER = 'https://<your-logto-domain>/oidc';\nconst CERTS_URL = 'https://<your-logto-domain>/oidc/jwks';\n\nconst client = jwksClient({\n  jwksUri: CERTS_URL,\n});\n\nconst getKey = (header, callback) => {\n  client.getSigningKey(header.kid, function (err, key) {\n    callback(err, key?.getPublicKey());\n  });\n};\n\nconst verifyToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  // Certifique-se de que a solicita\xe7\xe3o recebida tenha nosso cabe\xe7alho de token\n  if (!token) {\n    return res\n      .status(403)\n      .send({ status: false, message: 'cabe\xe7alho Logto-ID-Token necess\xe1rio ausente' });\n  }\n\n  jwt.verify(token, getKey, { issuer: ISSUER }, (err, decoded) => {\n    if (err) {\n      return res.status(403).send({ status: false, message: 'token de ID inv\xe1lido' });\n    }\n\n    req.user = decoded;\n    next();\n  });\n};\n\nconst app = express();\n\napp.use(verifyToken);\n\napp.get('/', (req, res) => {\n  res.send('Ol\xe1 Mundo!');\n});\n\napp.listen(3000);\n"})}),"\n",(0,n.jsx)(o.h2,{id:"obter-estado-de-autentica\xe7\xe3o-e-informa\xe7\xf5es-do-usu\xe1rio",children:"Obter estado de autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio"}),"\n",(0,n.jsxs)(o.p,{children:["Se voc\xea precisar obter autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio para seu aplicativo, tamb\xe9m pode usar o cabe\xe7alho ",(0,n.jsx)(o.code,{children:"Logto-ID-Token"}),"."]}),"\n",(0,n.jsx)(o.p,{children:"Se voc\xea apenas quiser decodificar o token, pode usar o seguinte c\xf3digo:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"const express = require('express');\n\nconst decodeIdToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  if (!token) {\n    return res.status(403).send({\n      status: false,\n      message: 'cabe\xe7alho Logto-ID-Token necess\xe1rio ausente',\n    });\n  }\n\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    throw new Error('Token de ID inv\xe1lido');\n  }\n\n  const payload = parts[1];\n  const decodedPayload = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\n  const claims = JSON.parse(decodedPayload);\n\n  req.user = claims;\n  next();\n};\n\nconst app = express();\n\napp.use(decodeIdToken);\n\napp.get('/', (req, res) => {\n  res.json(req.user);\n});\n\napp.listen(3000);\n"})}),"\n",(0,n.jsx)(o.h2,{id:"obter-o-host-original",children:"Obter o host original"}),"\n",(0,n.jsxs)(o.p,{children:["Se voc\xea precisar obter o host original solicitado pelo cliente, pode usar o cabe\xe7alho ",(0,n.jsx)(o.code,{children:"Logto-Host"})," ou ",(0,n.jsx)(o.code,{children:"x-forwarded-host"}),"."]}),"\n",(0,n.jsx)(o.h2,{id:"personalizar-regras-de-autentica\xe7\xe3o",children:"Personalizar regras de autentica\xe7\xe3o"}),"\n",(0,n.jsx)(o.p,{children:'Por padr\xe3o, o Aplicativo Protegido proteger\xe1 todas as rotas. Se voc\xea precisar personalizar as regras de autentica\xe7\xe3o, pode definir o campo "Regras de autentica\xe7\xe3o personalizadas" no Console.'}),"\n",(0,n.jsx)(o.p,{children:"Ele suporta express\xf5es regulares, aqui est\xe3o dois cen\xe1rios de caso:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Para proteger apenas as rotas ",(0,n.jsx)(o.code,{children:"/admin"})," e ",(0,n.jsx)(o.code,{children:"/privacy"})," com autentica\xe7\xe3o: ",(0,n.jsx)(o.code,{children:"^/(admin|privacy)/.*"})]}),"\n",(0,n.jsxs)(o.li,{children:["Para excluir imagens JPG da autentica\xe7\xe3o: ",(0,n.jsx)(o.code,{children:"^(?!.*\\.jpg$).*$"})]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"desenvolvimento-local",children:"Desenvolvimento local"}),"\n",(0,n.jsxs)(o.p,{children:["O Aplicativo Protegido \xe9 projetado para funcionar com seu servidor de origem. No entanto, se seu servidor de origem n\xe3o for acess\xedvel publicamente, voc\xea pode usar uma ferramenta como ",(0,n.jsx)(o.a,{href:"https://ngrok.com/",children:"ngrok"})," ou ",(0,n.jsx)(o.a,{href:"https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/",children:"Cloudflare Tunnels"})," para expor seu servidor local \xe0 internet."]}),"\n",(0,n.jsx)(o.h2,{id:"transi\xe7\xe3o-para-integra\xe7\xe3o-de-sdk",children:"Transi\xe7\xe3o para integra\xe7\xe3o de SDK"}),"\n",(0,n.jsx)(o.p,{children:'O Aplicativo Protegido \xe9 projetado para simplificar o processo de autentica\xe7\xe3o. No entanto, se voc\xea decidir fazer a transi\xe7\xe3o para a integra\xe7\xe3o de SDK para melhor controle e personaliza\xe7\xe3o, pode criar um novo aplicativo no Logto e configurar a integra\xe7\xe3o do SDK. E para uma transi\xe7\xe3o suave, voc\xea pode reutilizar as configura\xe7\xf5es do aplicativo do Aplicativo Protegido. O Aplicativo Protegido \xe9, na verdade, um "Aplicativo Web Tradicional" no Logto, voc\xea pode encontrar o "AppId" e "AppSecret" nas configura\xe7\xf5es do aplicativo. Ap\xf3s a conclus\xe3o da transi\xe7\xe3o, voc\xea pode remover o Aplicativo Protegido do seu aplicativo.'})]})}function p(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},15658:(e,o,a)=>{a.d(o,{R:()=>t,x:()=>s});var i=a(30758);const n={},r=i.createContext(n);function t(e){const o=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),i.createElement(r.Provider,{value:o},e.children)}}}]);