<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Logto x Hasura: How to use open-source auth + GraphQL solution to boost your project | Logto Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.logto.io/blog/logto-x-hasura"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Logto x Hasura: How to use open-source auth + GraphQL solution to boost your project | Logto Docs"><meta data-rh="true" name="description" content="Intro"><meta data-rh="true" property="og:description" content="Intro"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-08-20T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/gao-sun"><meta data-rh="true" property="article:tag" content="graphql,hasura,api"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.logto.io/blog/logto-x-hasura"><link data-rh="true" rel="alternate" href="https://docs.logto.io/blog/logto-x-hasura" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.logto.io/zh-cn/blog/logto-x-hasura" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://docs.logto.io/blog/logto-x-hasura" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DE7QZWOVO6-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Logto Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Logto Docs Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Logto Docs" href="/opensearch.xml">

<script src="https://plausible.io/js/plausible.js" defer="defer" data-domain="docs.logto.io"></script>
<meta name="google-site-verification" content="3EYzsnarDwG6zL2dlHvyC8ySVcV6Q3RGlvh7-bvhb2k">

<link rel="alternate" type="application/rss+xml" href="/tutorial/rss.xml" title="Logto Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tutorial/atom.xml" title="Logto Docs Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/terms/rss.xml" title="Logto Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/terms/atom.xml" title="Logto Docs Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/about/rss.xml" title="Logto Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/about/atom.xml" title="Logto Docs Atom Feed"><link rel="stylesheet" href="/assets/css/styles.fe8d029a.css">
<link rel="preload" href="/assets/js/runtime~main.7d75c6e4.js" as="script">
<link rel="preload" href="/assets/js/main.21172b37.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_qOKZ" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://logto.io" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logto.svg" alt="Silverhand Logo" class="themedImage_QPoH themedImage--light_ehiH"><img src="/img/logto_dark.svg" alt="Silverhand Logo" class="themedImage_QPoH themedImage--dark_ONH6"></div></a><a class="navbar__item navbar__link" href="/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/sdk/">SDK</a><a class="navbar__item navbar__link" href="/api">API</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_Wl9i"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/blog/logto-x-hasura" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/blog/logto-x-hasura" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><a href="https://github.com/logto-io/logto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_SDTL"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_w01h colorModeToggle_gthU"><button class="clean-btn toggleButton_c3ob toggleButtonDisabled_OPIK" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_qRpN"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OlOt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_URjm"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_qA9k"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_xvU1" itemprop="headline">Logto x Hasura: How to use open-source auth + GraphQL solution to boost your project</h1><div class="container_IYVW margin-vert--md"><time datetime="2022-08-20T00:00:00.000Z" itemprop="datePublished">August 20, 2022</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_nANF"><div class="avatar margin-bottom--sm"><a href="https://github.com/gao-sun" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/gao-sun.png" alt="Gao"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gao-sun" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Gao</span></a></div><small class="avatar__subtitle" itemprop="description">Founder of Silverhand</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_KgUL" id="intro">Intro<a href="#intro" class="hash-link" aria-label="Direct link to Intro" title="Direct link to Intro">​</a></h2><p>When it comes to a new project, you usually cannot skip several things: APIs, authentication + authorization, identity, and end-user sign-in flow. It used to be hard to kick off these things because there are many concepts and technologies that spread widely: RESTful/GraphQL, web frontend, native client, connect clients with APIs, auth best practices to balance security and user experience, etc.</p><p>Also, most of the works are “repeating”. I mean, they are needed and similar for almost every project, with some tweaks.</p><p>Sounds scary and tedious? Don’t panic. Today we have open source. With the two open-source projects below, things become not tricky :</p><ul><li><a href="https://github.com/logto-io/logto" target="_blank" rel="noopener noreferrer">Logto</a>: Helps you build the sign-in, auth, and user identity within minutes.</li><li><a href="https://github.com/hasura/graphql-engine" target="_blank" rel="noopener noreferrer">Hasura</a>: Blazing fast, instant real-time GraphQL APIs on your DB with fine-grained access control.</li></ul><center><img loading="lazy" alt="Logto x Hasura" src="/assets/images/logos-3fc88b5045a437c285845ee9fe4b015c.png" width="480" class="img_jkbZ"></center><p>In this article, we’ll focus on connecting Logto and Hasura, which enables you to implement authentication, authorization, and GraphQL APIs without friction. Thus you can quickly jump into your business without rocket-science learning.</p><h2 class="anchor anchorWithStickyNavbar_KgUL" id="get-started">Get started<a href="#get-started" class="hash-link" aria-label="Direct link to Get started" title="Direct link to Get started">​</a></h2><h3 class="anchor anchorWithStickyNavbar_KgUL" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3><p>Since both <a href="https://docs.logto.io/docs/tutorials/get-started/" target="_blank" rel="noopener noreferrer">Logto</a> and <a href="https://hasura.io/docs/latest/getting-started/index/" target="_blank" rel="noopener noreferrer">Hasura</a> have a decent get-started guide, we assume you have read them and have a basic feeling. Access to a running instance of both is needed.</p><p>We assume the accessible endpoints are:</p><ul><li>Logto: <code>http://localhost:3001</code></li><li>Hasura: <code>http://localhost:8080</code></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_nqcy"><div class="admonitionHeading_zpIq"><span class="admonitionIcon_IsQN"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_SHEn"><p>If you are using Docker/Docker Compose, for accessing of your machine(host)’s <code>localhost</code>, you can use the Docker magic string <code>host.docker.internal</code>. In this case, the Logto endpoint will be <code>http://host.docker.internal:3001</code>.</p></div></div><p>Also, we assume you have a preferred platform and framework to build the client app, say React or Next.js.</p><h3 class="anchor anchorWithStickyNavbar_KgUL" id="set-up-api-in-logto">Set up API in Logto<a href="#set-up-api-in-logto" class="hash-link" aria-label="Direct link to Set up API in Logto" title="Direct link to Set up API in Logto">​</a></h3><p>In the left navigation sidebar of your Logto Admin Console, click “API Resources”, and you’ll see the API Resource management page.</p><p>Then click the huge “+ Create API Resource” button in the top-right corner. In the opening modal, enter <code>Hasura</code> for API name and <code>https://hasura.api</code> for API identifier.</p><center><img loading="lazy" alt="Create API modal" src="/assets/images/create-api-c5c6e125bce972eb32323f2d4e27b436.png" width="540" class="img_jkbZ"></center><p>We’ll use this API identifier for the rest of our article. But feel free to change the values based on your preference.</p><p>Click “Create API Resource”, and it will show a message that indicates the resource has been successfully created. That’s all we need in Logto for now.</p><h3 class="anchor anchorWithStickyNavbar_KgUL" id="enable-webhook-authentication-in-hasura">Enable webhook authentication in Hasura<a href="#enable-webhook-authentication-in-hasura" class="hash-link" aria-label="Direct link to Enable webhook authentication in Hasura" title="Direct link to Enable webhook authentication in Hasura">​</a></h3><p><a href="https://hasura.io/docs/latest/auth/index/" target="_blank" rel="noopener noreferrer">Hasura uses role-based access management</a>, which handles authorization. So, we only need to figure out authentication. It supports two methods: Webhook and JWT. We choose <a href="https://hasura.io/docs/latest/auth/authentication/webhook/" target="_blank" rel="noopener noreferrer">webhook</a> since it’s more flexible.</p><p>To enable webhook authentication, you must set the admin secret and auth hook endpoint.</p><ul><li>The admin secret is the key to having Hasura admin access when sending requests. It is required before enabling webhook authentication. Remember to keep it somewhere safe, and don’t use it in production.</li><li>The auth hook endpoint is a URL to send authentication requests.</li></ul><p>You can set them via <a href="https://hasura.io/docs/latest/auth/authentication/webhook/#configuring-webhook-mode" target="_blank" rel="noopener noreferrer">environment variables</a>:</p><div class="language-yaml codeBlockContainer_DX1o theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EwC_"><pre tabindex="0" class="prism-code language-yaml codeBlock__7R1 thin-scrollbar"><code class="codeBlockLines_QPnn"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">HASURA_GRAPHQL_ADMIN_SECRET</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myadminsecretkey </span><span class="token comment" style="color:#999988;font-style:italic"># Replace with your own secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">HASURA_GRAPHQL_AUTH_HOOK</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3001/api/authn/hasura</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">resource=https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//hasura.api</span><br></span></code></pre><div class="buttonGroup_I80O"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_sN_3" aria-hidden="true"><svg class="copyButtonIcon_BIKD" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_NZqA" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You may notice we use the API identifier filled in Logto to build the auth hook endpoint. It ensures that the user is passing the correct bearer token instead of a random one that may from malicious.</p><p>You need to update the auth hook endpoint if you have a different Logto endpoint or API indicator. Say you have <code>https://logto.domain.com</code> as the Logto endpoint and <code>https://graphql.domain.com</code> as the API identifier, then it will be:</p><div class="language-yaml codeBlockContainer_DX1o theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EwC_"><pre tabindex="0" class="prism-code language-yaml codeBlock__7R1 thin-scrollbar"><code class="codeBlockLines_QPnn"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">HASURA_GRAPHQL_AUTH_HOOK</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//logto.domain.com/api/authn/hasura</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">resource=https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//graphql.domain.com</span><br></span></code></pre><div class="buttonGroup_I80O"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_sN_3" aria-hidden="true"><svg class="copyButtonIcon_BIKD" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_NZqA" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From now, for every GraphQL request, Hasura will bring all request headers to the Logto auth hook endpoint, and Logto will respond properly.</p><h2 class="anchor anchorWithStickyNavbar_KgUL" id="send-secured-graphql-requests">Send secured GraphQL requests<a href="#send-secured-graphql-requests" class="hash-link" aria-label="Direct link to Send secured GraphQL requests" title="Direct link to Send secured GraphQL requests">​</a></h2><h3 class="anchor anchorWithStickyNavbar_KgUL" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h3><p>Since we won’t use the Hasura admin secret in production, every GraphQL request is secured by the following headers:</p><ul><li><code>Authorization</code> The standard bearer token that Logto generates.</li><li><code>Expected-Role</code> The role you want Logto to show in the auth hook response.</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_nqcy"><div class="admonitionHeading_zpIq"><span class="admonitionIcon_IsQN"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_SHEn"><p>If the user that the <code>Authorization</code> header indicates doesn’t have the <code>Expected-Role</code>, Logto will respond with <code>401 Unauthorized</code>.</p></div></div><p>The <code>Authorization</code> header requires a valid Access Token in JWT format with the Hasura API indicator for audience. Hold on - it’s quite hard to remember and compose all these things. Fortunately we get Logto SDKs to simplify the geeky part.</p><h3 class="anchor anchorWithStickyNavbar_KgUL" id="set-default-roles-in-logto">Set default roles in Logto<a href="#set-default-roles-in-logto" class="hash-link" aria-label="Direct link to Set default roles in Logto" title="Direct link to Set default roles in Logto">​</a></h3><p>By default, only the first user will have an <code>admin</code> role name. After that, Logto will NOT assign any role names to new users. But for Hasura, it is necessary to have a role to perform an authed request.</p><p>While access control is still an under-the-hood feature of Logto, we don’t want you to manually add the default role names. You can set an environment variable <code>USER_DEFAULT_ROLE_NAMES</code> with a comma-separated string <a href="https://docs.logto.io/docs/references/core/configuration" target="_blank" rel="noopener noreferrer">for Logto</a>. E.g.:</p><div class="language-yaml codeBlockContainer_DX1o theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EwC_"><pre tabindex="0" class="prism-code language-yaml codeBlock__7R1 thin-scrollbar"><code class="codeBlockLines_QPnn"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">USER_DEFAULT_ROLE_NAMES</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">good_user</span><br></span></code></pre><div class="buttonGroup_I80O"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_sN_3" aria-hidden="true"><svg class="copyButtonIcon_BIKD" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_NZqA" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then two roles <code>user</code> and <code>good_user</code> will be automatically added to newly created users. It will reflect in both <code>users</code> table and Access Tokens.</p><h3 class="anchor anchorWithStickyNavbar_KgUL" id="integrate-logto-sdk">Integrate Logto SDK<a href="#integrate-logto-sdk" class="hash-link" aria-label="Direct link to Integrate Logto SDK" title="Direct link to Integrate Logto SDK">​</a></h3><p>Follow the <a href="https://docs.logto.io/docs/recipes/integrate-logto/" target="_blank" rel="noopener noreferrer">integration guide</a> to integrate a Logto SDK in your client app. It enables not only the ability to generate a valid Access Token for GraphQL requests, but also a smooth sign-in experience for your end-users.</p><p>Once you finish the guide, we need one tiny modification to the <code>LogtoConfig</code>: Add the API indicator you created in Logto Admin Console to <code>resources</code>. Taking React SDK as an example:</p><div class="language-tsx codeBlockContainer_DX1o theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EwC_"><pre tabindex="0" class="prism-code language-tsx codeBlock__7R1 thin-scrollbar"><code class="codeBlockLines_QPnn"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> config</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">LogtoConfig</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endpoint</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:3001&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;your-application-id&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;https://hasura.api&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Add this line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_I80O"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_sN_3" aria-hidden="true"><svg class="copyButtonIcon_BIKD" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_NZqA" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_KgUL" id="send-requests">Send requests<a href="#send-requests" class="hash-link" aria-label="Direct link to Send requests" title="Direct link to Send requests">​</a></h3><p>Finally! After the user is signed in, use <code>getAccessToken()</code> in Logto SDK to fetch the Access Token for Hasura GraphQL requests:</p><div class="language-tsx codeBlockContainer_DX1o theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EwC_"><pre tabindex="0" class="prism-code language-tsx codeBlock__7R1 thin-scrollbar"><code class="codeBlockLines_QPnn"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> accessToken </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> logto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getAccessToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://hasura.api&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Before sending the request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Authorization&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">accessToken</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Expected-Role&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_I80O"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_sN_3" aria-hidden="true"><svg class="copyButtonIcon_BIKD" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_NZqA" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_KgUL" id="recap">Recap<a href="#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap">​</a></h2><p>With the effort above, we successfully implemented all the non-skippable things in the intro:</p><ul><li>A database-schema-driven GraphQL API endpoint</li><li>An auth and identity service on top of OIDC protocol</li><li>The complete end-user sign-in flow and auth state management</li><li>Secured API access based on user identity and roles</li></ul><p>Not that hard, right? If you meet any issues, feel free to join the <a href="https://discord.gg/vRvwuwgpVX" target="_blank" rel="noopener noreferrer">Logto</a> or <a href="https://discord.gg/hasura" target="_blank" rel="noopener noreferrer">Hasura</a> discord server to have a live chat with the team.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_Pg1w"><div class="col"><b>Tags:</b><ul class="tags_vA09 padding--none margin-left--sm"><li class="tag_kwzm"><a class="tag_amvJ tagRegular_G2B2" href="/blog/tags/graphql">graphql</a></li><li class="tag_kwzm"><a class="tag_amvJ tagRegular_G2B2" href="/blog/tags/hasura">hasura</a></li><li class="tag_kwzm"><a class="tag_amvJ tagRegular_G2B2" href="/blog/tags/api">api</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/design-for-seamless-sie-1"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">The design considerations for a seamless sign-in experience (First Chapter)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/typescript-all-in-one"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">TypeScript all-in-one: Monorepo with its pains and gains</div></a></nav></main><div class="col col--2"><div class="tableOfContents_MdFo thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro" class="table-of-contents__link toc-highlight">Intro</a></li><li><a href="#get-started" class="table-of-contents__link toc-highlight">Get started</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#set-up-api-in-logto" class="table-of-contents__link toc-highlight">Set up API in Logto</a></li><li><a href="#enable-webhook-authentication-in-hasura" class="table-of-contents__link toc-highlight">Enable webhook authentication in Hasura</a></li></ul></li><li><a href="#send-secured-graphql-requests" class="table-of-contents__link toc-highlight">Send secured GraphQL requests</a><ul><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#set-default-roles-in-logto" class="table-of-contents__link toc-highlight">Set default roles in Logto</a></li><li><a href="#integrate-logto-sdk" class="table-of-contents__link toc-highlight">Integrate Logto SDK</a></li><li><a href="#send-requests" class="table-of-contents__link toc-highlight">Send requests</a></li></ul></li><li><a href="#recap" class="table-of-contents__link toc-highlight">Recap</a></li></ul></div></div></div></div></div><footer class="footer_TCBS"><div class="container_oxh8"><div class="logoRow_e6WH"><img src="/img/silverhand.svg" alt="Logo"></div><div class="footerRow_MwlS"><div class="copyRight_Do1v">Copyright © 2023 Silverhand Inc. Built with Docusaurus.</div><div class="links_lMuC"><a class="footer__link-item" href="/">Docs</a><a href="https://github.com/logto-io/logto" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a><a href="https://logto.io/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a><a href="mailto: contact@logto.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.7d75c6e4.js"></script>
<script src="/assets/js/main.21172b37.js"></script>
</body>
</html>